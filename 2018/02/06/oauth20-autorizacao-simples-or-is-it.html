<!DOCTYPE html><html lang=pt-br> <head><meta charset=utf-8><title>OAuth2.0: Autorização simples (or is it?) | Klaus Laube</title><meta name=author content="Klaus Peter Laube"><meta name=description content="OAuth 2.0 pode parecer confuso, e em alguns momentos ele é. Nesse post vamos revisar o conceito por trás do OAuth, e entender como os papéis interagem durante o processo de autorização."><meta name=robots content=index,follow><meta property=og:site_name content="Klaus Laube"><meta property=og:type content=website><meta name=keywords content="desenvolvimento, web, oauth, oauth2, auth, apis"><meta property=og:title content="OAuth2.0: Autorização simples (or is it?)"><meta property=og:description content="OAuth 2.0 pode parecer confuso, e em alguns momentos ele é. Nesse post vamos revisar o conceito por trás do OAuth, e entender como os papéis interagem durante o processo de autorização."><meta property=og:url content=https://klauslaube.com.br/2018/02/06/oauth20-autorizacao-simples-or-is-it.html><meta property=og:image content=https://klauslaube.com.br//images/blog/oauth-let-me-in.jpg><meta property=fb:app_id content=262757647133878><meta name=google-site-verification content=xCq0H3B3JhkPcAdZ03J0vayijvH_g1rQVMZ_DVcMsQY><meta name=viewport content="width=device-width, initial-scale=1.0"><link rel=icon type=image/x-icon href=https://klauslaube.com.br/favicon.ico><link rel=alternate type=application/rss+xml title="Klaus Laube » Feed" href=https://klauslaube.com.br/feed/rss.xml><link rel=canonical href=https://klauslaube.com.br/2018/02/06/oauth20-autorizacao-simples-or-is-it.html><link rel=stylesheet href=https://unpkg.com/purecss@1.0.0/build/pure-min.css integrity=sha384-nn4HPE8lTHyVtfCBi5yW9d20FjT8BJwUXyWZT9InLYax14RDjBj46LmSztkmNP9w crossorigin=anonymous><link rel=stylesheet href=https://klauslaube.com.br/theme/css/styles.min.css?0830b1e2></head> <body> <div class="Page pure-g is-fullEntry"> <div class="PageHeader pure-u-1"> <nav class="pure-menu pure-menu-open pure-menu-horizontal"> <a href=https://klauslaube.com.br/index.html title="Home page" class="PageHeader-link pure-menu-heading pure-menu-link">Klaus<span class=u-highlighted>Laube</a> <ul class="PageHeader-menu pure-menu-list"> <li class=pure-menu-item> <a href=https://about.me/klauslaube class="PageHeader-menu-link pure-menu-link">Contato</a> </li> </ul> </nav> </div> <div class="PageContent pure-u-1"> <article class="Article u-box" itemscope itemtype=http://schema.org/BlogPosting> <div itemprop=image itemscope itemtype=http://schema.org/ImageObject> <meta itemprop=url content=https://klauslaube.com.br//images/blog/oauth-let-me-in.jpg> </div> <span itemprop=mainEntityOfPage> <header> <h1 class=Article-title itemprop="headline name"> OAuth2.0: Autorização simples (or is it?) </h1> <p class=Article-meta> Por <span class=Article-author itemprop=author>Klaus Peter Laube</span>. <span class=Article-pubDate> Publicado em <time datetime=2018-02-06T11:45:00-02:00 itemprop=datePublished>06 Fev, 2018</time> </span> </p> </header> <div class=Article-content itemprop=articleBody> <img src=/images/blog/oauth2-logo.jpg alt="Logotipo do OAuth 2.0" class=representative-image width=180 height=180> <p>É isso mesmo, meu caro leitor! Já pincelamos alguns assuntos que cerceiam o desenvolvimento de <a href=https://klauslaube.com.br/tag/apis.html title="Leia mais sobre API"><em>APIs</em></a>, desde <a href=https://klauslaube.com.br/2017/01/06/construindo-apis-em-django-com-restless.html title="Construindo APIs em Django com Restless">bibliotecas</a> até a construção de <a href=https://klauslaube.com.br/2017/01/31/ramilificando-as-suas-apis.html title="Ramilificando as suas APIs">especificações</a>. Nesse <em>post</em> vamos introduzir a camada de <em>auth</em> de uma <em>API</em> <a href=https://klauslaube.com.br/tag/web.html title="Leia mais sobre web"><em>web</em></a>, e entender como podemos resolver esse problema através do protocolo <em>OAuth 2.0</em>.</p> <!-- PELICAN_END_SUMMARY --> <h2>O que é OAuth 2.0?</h2> <p>Diretamente do <a href=https://oauth.net/2/ title="Leia mais sobre OAuth">oauth2.net</a>:</p> <blockquote> <p>OAuth 2.0 is the industry-standard protocol for authorization. OAuth 2.0 supersedes the work done on the original OAuth protocol created in 2006. OAuth 2.0 focuses on client developer simplicity while providing specific authorization flows for web applications, desktop applications, mobile phones, and living room devices.</p> </blockquote> <p>Em outras palavras, é um <em>framework</em> de autorização que possibilita aplicações a obterem acesso limitado a contas de usuários em um serviço <a href=https://klauslaube.com.br/tag/http.html title="Leia mais sobre HTTP"><em>HTTP</em></a>, como <em>Facebook</em>, <em>GitHub</em> ou <em>Twitter</em>. Ele funciona delegando a autenticação do usuário ao serviço que "hosteia" a sua conta, e autoriza aplicações <em>third-party</em> a acessarem a mesma.</p> <p>Imagine que você criou um serviço <em>web</em>. É razoável assumir que você aplique alguma forma proprietária para resolver a questão de autenticação de usuários. Um formulário com <em>username</em> e <em>password</em> seria o suficiente para realizar a tarefa. Imagine que o seu serviço comece a ganhar notoriedade, e com isso potenciais parceiros desejam se integrar com a sua solução. Construir uma <a href=https://klauslaube.com.br/tag/rest.html title="Leia mais sobre REST"><em>API REST</em></a> é um caminho confortável, uma vez que o padrão é aberto, bem explorado, e não há nenhuma restrição de patente ou direitos para que o seu parceiro o adote.</p> <p>O mesmo acontece com o <em>OAuth</em>. Agora você precisa autorizar o acesso a sua <em>API</em>, afinal não é todo parceiro que terá acesso a parte <em>premium</em> da sua solução. Ao invés de bolar um fluxo proprietário, no qual o seu parceiro terá que desenvolver uma biblioteca apenas para conectar-se ao seu serviço, você adota o <em>OAuth 2.0</em>. Como é um padrão aberto, o interessado provavelmente já o conhece e já possui as ferramentas necessárias.</p> <p><img class=align-center-keep-size src=/images/blog/oauth-let-me-in.jpg width=640 height=427 title="O OAuth 2.0 é comprovadamente seguro. Mas nem tanto contra vampiros... (amazon.com)" alt="O OAuth 2.0 é comprovadamente seguro. Mas nem tanto contra vampiros... (amazon.com)"></p> <p>Embora pareça complicado, é possível resumir o fluxo do <em>OAuth 2.0</em> com o diagrama abaixo:</p> <p><img class=align-center-keep-size src=/images/blog/oauth-overview.png width=640 height=359 title="Diagrama exibindo a dança realizada para autorizar um usuário (api.slack.com)" alt="Diagrama exibindo a dança realizada para autorizar um usuário (api.slack.com)"></p> <p>Entender melhor os papéis envolvidos nesse processo pode dar mais cor ao entendimento do diagrama acima.</p> <h2>Papéis</h2> <p>O protocolo <em>OAuth</em> faz uso de 4 papéis:</p> <h3>Resource owner (user)</h3> <p>O <em>resource owner</em> é o usuário que autoriza a aplicação a acessar a sua conta.</p> <p><strong>Exemplo:</strong> Você.</p> <h3>Client (application)</h3> <p>A aplicação que está tentando acessar a conta do usuário. O usuário precisa autorizá-la a fazê-lo.</p> <p><strong>Exemplo:</strong> Um aplicativo de galeria de imagens que conecta-se ao seu <em>Dropbox</em>.</p> <h3>Authorization server</h3> <p>Esse é o servidor que apresenta a interface onde o usuário pode aprovar ou negar o acesso daquele aplicativo à sua conta.</p> <p><strong>Exemplo:</strong> Servidor de autorização do <em>Dropbox</em>.</p> <h3>Resource server (API)</h3> <p>É o serviço/<em>API</em> no qual estamos tentando acessar. O <em>resource server</em> lida com requisições autenticadas após o aplicativo ter obtido um <em>token</em> de acesso.</p> <p><strong>Exemplo:</strong> <em>API</em> de arquivos do <em>Dropbox</em>.</p> <p>No cenário descrito acima, ter o <em>authorization server</em> e o <em>resource server</em> no mesmo serviço é aceitável. Mas podemos ter a necessidade de apenas autenticar o usuário (utilizando o <em>Facebook</em> como <em>authorization server</em>, por exemplo) e prover funcionalidades da nossa própria <em>API</em> (agindo como <em>resource server</em>).</p> <h2>Fluxos</h2> <p><img class=align-center-keep-size src=/images/blog/oauth2-diagram-dropbox.png width=640 height=622 title="Diagrama de autorização de usuário no Dropbox (dropbox.com)" alt="Diagrama de autorização de usuário no Dropbox (dropbox.com)"></p> <p>Você provavelmente já passou pelo fluxo ilustrado acima ao fazer <em>login</em> no <em>Spotify</em>.</p> <p>O <em>app</em> do <em>Spotify</em> pede autorização ao <em>Facebook</em> para acessar os dados da sua conta. O <em>Facebook</em> por sua vez exibe uma tela, solicitando que você autorize o acesso clicando em um botão. Com isso, <em>Facebook</em> autoriza acesso do <em>Spotify</em> e a partir daí ele é capaz de ver o seu endereço de e-mail e consequentemente ter certeza de que "você é você".</p> <p>No caso do exemplo da galeria de fotos, os seguintes passos são executados:</p> <ul> <li>A aplicação requisita autorização para acessar os recursos do usuário;</li> <li>Se o usuário autorizá-la, a aplicação recebe um <em>authorization grant</em>;</li> <li>A aplicação requisita um <em>access token</em> do <em>authorization server</em>, apresentando as suas próprias credenciais e o <em>authorization grant</em> cedido pelo usuário;</li> <li>Se as credenciais e o <em>authorization grant</em> forem válidos, o <em>authorization server</em> emite um <em>access token</em> para a aplicação. O processo de autorização está completo;</li> <li>A aplicação requisita o recurso protegido do <em>resource server</em>, apresentando o <em>access token</em> para autenticação;</li> <li>Se o <em>access token</em> for válido, o <em>resource server</em> retorna o recurso para a aplicação.</li> </ul> <p>Caso você esteja construindo o aplicativo de galeria de fotos, é necessário criar um "app" na área de <em>Developers</em> do <em>Dropbox</em>, como mostrado abaixo:</p> <p><img class=align-center-keep-size src=/images/blog/dropbox-app-creation.png width=640 height=522 title="Área de criação de app" alt="Área de criação de app"></p> <p>Ao finalizar o cadastro, o <em>app</em> receberá um <code>app key</code> e <code>app secret</code>. Essas são as credenciais do aplicativo, que devem ser apresentadas ao <em>authorization server</em> juntamente com o <code>authorization grant</code>, para que o processo execute com sucesso.</p> <p><a href=https://www.dropbox.com/developers/reference/oauth-guide>Leia o OAuth guide, do Dropbox</a>.</p> <h2>Diferenças para o OAuth 1.0</h2> <p>O <em>OAuth 1.0</em> foi baseado em protocolos proprietários, e com o passar do tempo pode-se dizer que ele "não envelheceu bem". O <em>OAuth 2.0</em> surgiu das lições aprendidas com o primeiro, e tem como principais melhorias:</p> <ul> <li>Utilizar <em>HTTPS</em> para todas as comunicações entre navegadores, clientes e <em>API</em>;</li> <li>Melhor experiência de autorização para aplicativos nativos e suporte para extensões;</li> <li>A separação em papéis permite uma melhor escala de operação, uma vez que é possível tratar o <em>user authorization</em> e as <em>API calls</em> em contextos (serviços e até mesmo máquinas) diferentes.</li> </ul> <h2>Considerações finais</h2> <p>Se até então o protocolo não ficou muito claro, não se preocupe! É na prática que o <em>OAuth 2.0</em> começa a fazer mais sentido, e é isso que abordaremos no próximo <em>post</em>.</p> <p>Entender como esse protocolo funciona é fundamental para compreender outras variações como <a href=https://oauth.net/2/native-apps/ >Native Apps auth</a>, <a href=http://tools.ietf.org/html/rfc7522>SAML</a> ou <a href=https://tools.ietf.org/html/rfc7519>JWT</a>.</p> <p>Até a próxima!</p> <h2>Referências</h2> <ul> <li><a href=https://aaronparecki.com/oauth-2-simplified/ >Aaron Parecki - OAuth 2 Simplified</a></li> <li><a href=https://www.digitalocean.com/community/tutorials/an-introduction-to-oauth-2>DigitalOcean - An Introduction to OAuth 2</a></li> <li><a href=https://www.dropbox.com/developers/reference/oauth-guide>Dropbox - OAuth guide</a></li> <li><a href=https://oauth.net/2/ >Oauth.net - OAuth 2.0</a></li> <li><a href=https://api.slack.com/docs/oauth>Slack API - Using OAuth 2.0</a></li> </ul> </div> </span> <div class=Article-tags> <span class=Article-tagLabel>Tags:</span> <span itemprop=keywords> <a href=https://klauslaube.com.br/tag/desenvolvimento.html title="Leia mais sobre" class=Article-tagLink>desenvolvimento</a> <a href=https://klauslaube.com.br/tag/web.html title="Leia mais sobre" class=Article-tagLink>web</a> <a href=https://klauslaube.com.br/tag/oauth.html title="Leia mais sobre" class=Article-tagLink>oauth</a> <a href=https://klauslaube.com.br/tag/oauth2.html title="Leia mais sobre" class=Article-tagLink>oauth2</a> <a href=https://klauslaube.com.br/tag/auth.html title="Leia mais sobre" class=Article-tagLink>auth</a> <a href=https://klauslaube.com.br/tag/apis.html title="Leia mais sobre" class=Article-tagLink>apis</a> </span> </div> <div class=Article-comments> <div id=disqus_thread></div> <script type=text/javascript>
        var disqus_shortname = "klauslaube";
        var disqus_identifier = "2018/02/06/oauth20-autorizacao-simples-or-is-it.html";

        (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script> <noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript rel=nofollow>comments powered by Disqus.</a></noscript> </div> </article> </div> <footer class="PageFooter pure-u-1"> <div class=u-box> <p>O conteúdo deste blog está sob a licença <a class=PageFooter-link href=http://creativecommons.org/licenses/by/3.0/deed.pt_BR title="Distribua, adapte, use. Mas mencione o autor." rel=nofollow>Creative Commons Attribution 3.0</a>.</p> <p>O código está disponível em <a class=PageFooter-link href=https://github.com/kplaube/blog/ title=Contribute! rel=nofollow>GitHub</a>.</p> </div> </footer> </div> <script>
        (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
        function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
        e=o.createElement(i);r=o.getElementsByTagName(i)[0];
        e.src='//www.google-analytics.com/analytics.js';
        r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
        ga('create','UA-19657400-1');ga('send','pageview');
    </script> </body> </html>