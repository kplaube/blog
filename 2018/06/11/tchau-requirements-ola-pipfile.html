<!DOCTYPE html><html lang=pt-br> <head><meta charset=utf-8><title>Tchau, requirements. Olá, Pipfile! | Klaus Laube</title><meta name=author content="Klaus Peter Laube"><meta name=description content="Admito que no começo fui cético em relação ao Pipfile. Mas hoje, após artigos e debates sobre a ferramenta, não tenho dúvida sobre a sua utilidade. Venha comigo entender como o Pipfile + Pipenv podem tornar a sua stack mais simples."><meta name=robots content=index,follow><meta property=og:site_name content="Klaus Laube"><meta property=og:type content=website><meta name=keywords content="desenvolvimento, python, pip, virtualenv, pipfile, pipenv"><meta property=og:title content="Tchau, requirements. Olá, Pipfile!"><meta property=og:description content="Admito que no começo fui cético em relação ao Pipfile. Mas hoje, após artigos e debates sobre a ferramenta, não tenho dúvida sobre a sua utilidade. Venha comigo entender como o Pipfile + Pipenv podem tornar a sua stack mais simples."><meta property=og:url content=https://klauslaube.com.br/2018/06/11/tchau-requirements-ola-pipfile.html><meta property=og:image content=https://klauslaube.com.br//images/blog/rambo-knife.jpg><meta property=fb:app_id content=262757647133878><meta name=google-site-verification content=xCq0H3B3JhkPcAdZ03J0vayijvH_g1rQVMZ_DVcMsQY><meta name=viewport content="width=device-width, initial-scale=1.0"><link rel=icon type=image/x-icon href=https://klauslaube.com.br/favicon.ico><link rel=alternate type=application/rss+xml title="Klaus Laube » Feed" href=https://klauslaube.com.br/feed/rss.xml><link rel=canonical href=https://klauslaube.com.br/2018/06/11/tchau-requirements-ola-pipfile.html><link rel=stylesheet href=https://unpkg.com/purecss@1.0.0/build/pure-min.css integrity=sha384-nn4HPE8lTHyVtfCBi5yW9d20FjT8BJwUXyWZT9InLYax14RDjBj46LmSztkmNP9w crossorigin=anonymous><link rel=stylesheet href=https://klauslaube.com.br/theme/css/styles.min.css?0830b1e2></head> <body> <div class="Page pure-g is-fullEntry"> <div class="PageHeader pure-u-1"> <nav class="pure-menu pure-menu-open pure-menu-horizontal"> <a href=https://klauslaube.com.br/index.html title="Home page" class="PageHeader-link pure-menu-heading pure-menu-link">Klaus<span class=u-highlighted>Laube</a> <ul class="PageHeader-menu pure-menu-list"> <li class=pure-menu-item> <a href=https://about.me/klauslaube class="PageHeader-menu-link pure-menu-link">Contato</a> </li> </ul> </nav> </div> <div class="PageContent pure-u-1"> <article class="Article u-box" itemscope itemtype=http://schema.org/BlogPosting> <div itemprop=image itemscope itemtype=http://schema.org/ImageObject> <meta itemprop=url content=https://klauslaube.com.br//images/blog/rambo-knife.jpg> </div> <span itemprop=mainEntityOfPage> <header> <h1 class=Article-title itemprop="headline name"> Tchau, requirements. Olá, Pipfile! </h1> <p class=Article-meta> Por <span class=Article-author itemprop=author>Klaus Peter Laube</span>. <span class=Article-pubDate> Publicado em <time datetime=2018-06-11T16:40:00-03:00 itemprop=datePublished>11 Jun, 2018</time> </span> </p> </header> <div class=Article-content itemprop=articleBody> <img src=/images/blog/python-logo.png alt="Logotipo do Python" class=representative-image width=180 height=180> <p>Admito que no começo fui cético em relação ao <a href=https://github.com/pypa/pipfile title="The replacement for requirements.txt"><em>Pipfile</em></a>. Pode ser a idade, mas questionei a real necessidade do mesmo. Para mim era muito óbvio! Eu já tinha o <a href=https://klauslaube.com.br/tag/pip.html title="Leia mais sobre pip"><em>pip</em></a>, o <a href=https://klauslaube.com.br/tag/virtualenv.html title="Leia mais sobre virtualenv"><em>virtualenv</em></a> e até mesmo o <a href=https://klauslaube.com.br/tag/.html title="Leia mais sobre Pyenv"><em>pyenv</em></a>. Hoje, após ler alguns artigos e debater com alguns colegas, fico até envergonhado de não ter visto o potencial da ferramenta no seu primeiro momento.</p> <!-- PELICAN_END_SUMMARY --> <p>Se você está na dúvida, assim como eu estive, vem comigo que te mostro as principais vantagens do <em>Pipfile</em> (e do <em>Pipenv</em>).</p> <h2>O que há de errado com o requirements.txt?</h2> <p>Esse foi o meu "turning point" em relação ao <em>Pipfile</em>. E foi o <a href=https://twitter.com/rcmachado title="Perfil no Twitter"><em>@rcmachado</em></a> quem respondeu essa pergunta:</p> <blockquote> <p>O build não é determinístico.</p> </blockquote> <p>Vamos supor que estamos desenvolvendo um projeto em <a href=https://klauslaube.com.br/tag/django.html title="Leia mais sobre Django"><em>Django</em></a>. Instalamos via <code>pip install Django</code>, e jogamos a dependência no <code>requirements.txt</code>:</p> <div class=highlight><pre><span></span><span class=o>#</span> <span class=n>requirements</span><span class=p>.</span><span class=n>txt</span>

<span class=n>Django</span>
</pre></div> <p>Como você garante que a mesma versão do <em>Django</em> está instalada nos diferentes ambientes do projeto (dev, qa, staging, production, etc)? Da forma acima, você não garante. O <code>pip</code> instalará a última versão do pacote disponível no <a href=https://pypi.org/ title="The Python Package Index"><em>PyPI</em></a>.</p> <p>Para minimizar esse problema, podemos "pinar" a versão do <em>Django</em>:</p> <div class=highlight><pre><span></span><span class=o>#</span> <span class=n>requirements</span><span class=p>.</span><span class=n>txt</span>

<span class=n>Django</span><span class=o>==</span><span class=mi>2</span><span class=p>.</span><span class=mi>0</span><span class=p>.</span><span class=mi>6</span>
</pre></div> <p>Agora garantimos a versão do <em>framework</em> em todos os ambientes do projeto. Sabemos que o <em>Django</em> tem uma dependência, o <a href=http://pytz.sourceforge.net/ title="World Timezone Definitions for Python"><em>pytz</em></a>, o que acontece com ela?</p> <p>Bem... se o <em>framework</em> estabelecer exatamente qual versão da dependência ele utiliza, não será um problema. Mas <a href=https://github.com/django/django/blob/master/setup.py#L86>nem sempre isso acontece</a>:</p> <div class=highlight><pre><span></span><span class=c1># django/setup.py</span>

<span class=p>(</span><span class=o>...</span><span class=p>)</span>

<span class=n>setup</span><span class=p>(</span>
    <span class=p>(</span><span class=o>...</span><span class=p>)</span>
    <span class=n>install_requires</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;pytz&#39;</span><span class=p>],</span>
    <span class=p>(</span><span class=o>...</span><span class=p>)</span>
<span class=p>)</span>

<span class=p>(</span><span class=o>...</span><span class=p>)</span>
</pre></div> <p>Para garantir que a mesma versão do <em>pytz</em> está sendo instalada nos diferentes ambientes do projeto, podemos "pinar" a sua versão no <code>requirements.txt</code>:</p> <div class=highlight><pre><span></span><span class=o>#</span> <span class=n>requirements</span><span class=p>.</span><span class=n>txt</span>

<span class=n>Django</span><span class=o>==</span><span class=mi>2</span><span class=p>.</span><span class=mi>0</span><span class=p>.</span><span class=mi>6</span>
<span class=n>pytz</span><span class=o>==</span><span class=mi>2018</span><span class=p>.</span><span class=mi>4</span>
</pre></div> <p>E por fim, adicionar um <code>--no-deps</code> ao comando <code>pip</code>, assim ele se manterá fiel às dependências descritas no <code>requirements.txt</code>:</p> <div class=highlight><pre><span></span>$ pip install -r requirements.txt --no-deps
</pre></div> <p>Note que você virou responsável por uma função que deveria ser desempenhada pelo <em>package manager</em>. Com o passar do tempo, esse tipo de gestão passa a ser árdua e suscetível a erros.</p> <h2>Pipfile to the rescue</h2> <p>Segundo o <a href=https://github.com/pypa/pipfile title="the replacement for requirements.txt">repositório oficial</a>, o <em>Pipfile</em> é:</p> <blockquote> <p>(...) a replacement for the existing standard pip's requirements.txt file.</p> </blockquote> <p>Como esperado, o padrão traz melhorias em relação ao <code>requirements.txt</code>. O já citado "ambientes determinísticos" é alcançado através do <code>Pipfile.lock</code>, um conceito usado em gerenciadores de pacotes de outras linguagens, como <a href=http://bundler.io/ title="Package manager do Ruby"><em>Bundler</em></a>, <a href=https://crates.io/ title="Package manager do Rust"><em>Cargo</em></a> ou <a href=https://yarnpkg.com/en/ title="Package manager do Node"><em>Yarn</em></a>, onde as versões das dependências são "congeladas", garantindo que você obtenha o mesmo resultado em qualquer ambiente, e executando quantas vezes quiser.</p> <p>Outra vantagem é o uso de um único arquivo para diferentes ambientes. Com o uso de <em>requirements</em>, geralmente acabamos com um arquivo de texto específico para cada ambiente:</p> <div class=highlight><pre><span></span><span class=o>#</span> <span class=n>requirements</span><span class=p>.</span><span class=n>txt</span>

<span class=n>Django</span>
</pre></div> <p>Mais um para dependências exclusivas do ambiente de desenvolvimento:</p> <div class=highlight><pre><span></span><span class=o>#</span> <span class=n>requirements</span><span class=o>-</span><span class=n>dev</span><span class=p>.</span><span class=n>txt</span>

<span class=o>-</span><span class=n>r</span> <span class=n>requirements</span><span class=p>.</span><span class=n>txt</span>

<span class=n>django</span><span class=o>-</span><span class=n>debug</span><span class=o>-</span><span class=n>toolbar</span>
<span class=n>pytest</span>
</pre></div> <p>Com o <em>Pipfile</em>, é possível utilizar o mesmo arquivo:</p> <div class=highlight><pre><span></span><span class=c1># Pipfile</span>

<span class=k>[[source]]</span>
<span class=na>url</span> <span class=o>=</span> <span class=s>&quot;https://pypi.org/simple&quot;</span>
<span class=na>verify_ssl</span> <span class=o>=</span> <span class=s>true</span>
<span class=na>name</span> <span class=o>=</span> <span class=s>&quot;pypi&quot;</span>

<span class=k>[dev-packages]</span>
<span class=na>pytest</span> <span class=o>=</span> <span class=s>&quot;*&quot;</span>

<span class=k>[packages]</span>
<span class=na>Django</span> <span class=o>=</span> <span class=s>&quot;*&quot;</span>

<span class=k>[requires]</span>
<span class=na>python_version</span> <span class=o>=</span> <span class=s>&quot;3.6&quot;</span>
</pre></div> <h2>Pipfile != Pipenv</h2> <p>Grande parte dos artigos que lí sobre <em>Pipfile</em> começavam com algum comando como o abaixo:</p> <div class=highlight><pre><span></span>$ pipenv install django
</pre></div> <p>Uma coisa que tem que ficar clara é: O <em>Pipenv</em> está para o <em>pip</em>, assim como o <em>Pipfile</em> está para o <em>requirements</em>.</p> <p><img class=align-center-keep-size src=/images/blog/rambo-knife.jpg width=640 height=310 title="Pipenv é tipo a faca do Rambo. Resolve qualquer parada (mann.tv)" alt="Pipenv é tipo a faca do Rambo. Resolve qualquer parada (mann.tv)"></p> <p>Até o momento da publicação desse artigo, o <code>pip</code> não suporta o formato do <em>Pipfile</em> (ou pelo menos a versão que tenho instalada aqui). Portanto, a maneira mais conveniente de utilizar o <em>Pipfile</em> hoje é através do utilitário de linha de comando <code>pipenv</code>.</p> <p>Segundo o <a href=https://github.com/pypa/pipenv title="Python Development Workflow for Humans">repositório oficial</a>, o <em>Pipenv</em> é:</p> <blockquote> <p>(...) a tool that aims to bring the best of all packaging worlds (bundler, composer, npm, cargo, yarn, etc.) to the Python world. Windows is a first–class citizen, in our world.</p> </blockquote> <p>Através do <em>parsing</em> do <em>Pipfile</em>, a ferramenta resolve dependências do projeto (através dos parâmetros <code>install</code>, <code>uninstall</code> ou <code>update</code>), exibe a árvore de dependências (através do parâmetro <code>graph</code>) e analisa as mesmas (através do <code>check</code>). Mas além de atuar como um gerenciador de pacotes, o <em>Pipenv</em> tem uma funcionalidade fantástica: Cria e gerencia <em>virtualenvs</em> de forma automática.</p> <h2>Virtualização out of the box</h2> <p>Já escrevi sobre virtualização com <a href=https://klauslaube.com.br/2015/07/23/virtualenvwrapper-o-basico-para-um-bom-ambiente-de-desenvolvimento-python.html title="Artigo sobre Virtualenvwrapper"><em>virtualenv</em></a> e <a href=https://klauslaube.com.br/2016/04/26/o-simples-e-poderoso-pyenv.html title="Artigo sobre pyenv"><em>pyenv</em></a>. Com o <em>Pipenv</em>, a coisa fica significativamente mais simples.</p> <p>Ao executar o comando <code>pipenv install</code>, por exemplo, a ferramenta automaticamente criará um <em>virtualenv</em> (caso não exista) para o projeto no qual você está trabalhando. Por exemplo:</p> <div class=highlight><pre><span></span>$ <span class=nv>mkdir</span> <span class=o>-</span><span class=nv>p</span> <span class=o>~/</span><span class=nv>workspace</span><span class=o>/</span><span class=nv>test</span><span class=o>-</span><span class=nv>pipenv</span>
$ <span class=nv>cd</span> <span class=o>~/</span><span class=nv>workspace</span><span class=o>/</span><span class=nv>test</span><span class=o>-</span><span class=nv>pipenv</span><span class=o>/</span>
$ <span class=nv>pipenv</span> <span class=nv>install</span> <span class=nv>django</span>

<span class=nv>Creating</span> <span class=nv>a</span> <span class=nv>virtualenv</span> <span class=k>for</span> <span class=nv>this</span> <span class=nv>project</span>…
<span class=nv>Using</span> <span class=o>/</span><span class=nv>home</span><span class=o>/</span><span class=nv>klaus</span><span class=o>/</span>.<span class=nv>pyenv</span><span class=o>/</span><span class=nv>versions</span><span class=o>/</span><span class=mi>2</span>.<span class=mi>7</span>.<span class=mi>14</span><span class=o>/</span><span class=nv>bin</span><span class=o>/</span><span class=nv>python2</span>.<span class=mi>7</span> <span class=ss>(</span><span class=mi>2</span>.<span class=mi>7</span>.<span class=mi>14</span><span class=ss>)</span> <span class=nv>to</span> <span class=nv>create</span> <span class=nv>virtualenv</span>…
</pre></div> <p>Caso você esteja curioso para saber aonde o seu <em>virtualenv</em> foi parar, o comando abaixo pode ajudar:</p> <div class=highlight><pre><span></span>$ pipenv --venv

/home/klaus/.local/share/virtualenvs/test-pipenv-BzNa0eOE
</pre></div> <p>Mas você não precisa se preocupar em saber onde o <code>activate.sh</code> está. Para ativar o <em>virtualenv</em> criado, o parâmetro <code>shell</code> é a melhor saída:</p> <div class=highlight><pre><span></span>$ <span class=nv>pipenv</span> <span class=nv>shell</span>

<span class=nv>Spawning</span> <span class=nv>environment</span> <span class=nv>shell</span> <span class=ss>(</span><span class=o>/</span><span class=nv>bin</span><span class=o>/</span><span class=nv>zsh</span><span class=ss>)</span>. <span class=nv>Use</span> <span class=s1>&#39;</span><span class=s>exit</span><span class=s1>&#39;</span> <span class=nv>to</span> <span class=nv>leave</span>.
. <span class=o>/</span><span class=nv>home</span><span class=o>/</span><span class=nv>klaus</span><span class=o>/</span>.<span class=nv>local</span><span class=o>/</span><span class=nv>share</span><span class=o>/</span><span class=nv>virtualenvs</span><span class=o>/</span><span class=nv>test</span><span class=o>-</span><span class=nv>pipenv</span><span class=o>-</span><span class=nv>BzNa0eOE</span><span class=o>/</span><span class=nv>bin</span><span class=o>/</span><span class=nv>activate</span>
</pre></div> <p>Frustrado com o <em>Python 2.7</em>? Sem problemas! Vamos transformar o projeto em <em>Python 3</em>:</p> <div class=highlight><pre><span></span>$ pipenv install --three
</pre></div> <p>O comando criará um novo <em>virtualenv</em>, dessa vez com a versão mais recente da linguagem. Não esqueça de atualizar o <code>python_version</code> do <code>Pipfile</code>.</p> <h2>Considerações finais</h2> <p>Com o <a href=https://devcenter.heroku.com/articles/python-support title="Python Support - Heroku"><em>Heroku</em> adotando <em>Pipfile</em></a>, me senti mais motivado a migrar alguns projetos para o padrão.</p> <p>Como resultado, tenho simplificado a <em>stack</em> dos mesmos. Antes, eu gerenciava os ambientes virtuais com um <em>mix</em> de <em>virtualenvwrapper</em> e <em>pyenv</em>. Hoje, com apenas um utilitário de linha de comando, sou capaz de gerenciar dependências e virtualização. Além disso, acredito que o <em>setup</em> de um projeto <em>Python</em> fique mais homogêneo, uma vez que não há necessidade de um combo <code>pip + {virtualenv,virtualenvwrapper,pyenv}</code>.</p> <p>Até a próxima.</p> <h2>Referências</h2> <ul> <li><a href=https://www.mattlayman.com/2017/using-pipfile-for-fun-and-profit.html>mattlayman - Using Pipfile for fun and profit</a></li> <li><a href=https://medium.com/grupy-rn/gerenciando-suas-depend%C3%AAncias-e-ambientes-python-com-pipenv-9e5413513fa6>Medium - Gerenciando suas dependências e ambientes python com pipenv</a></li> <li><a href=https://docs.pipenv.org>Pipenv - Python Dev Workflow for Humans</a></li> <li><a href=https://realpython.com/pipenv-guide/ >Real Python - Pipenv: A Guide to the New Python Packaging Tool</a></li> </ul> </div> </span> <div class=Article-tags> <span class=Article-tagLabel>Tags:</span> <span itemprop=keywords> <a href=https://klauslaube.com.br/tag/desenvolvimento.html title="Leia mais sobre" class=Article-tagLink>desenvolvimento</a> <a href=https://klauslaube.com.br/tag/python.html title="Leia mais sobre" class=Article-tagLink>python</a> <a href=https://klauslaube.com.br/tag/pip.html title="Leia mais sobre" class=Article-tagLink>pip</a> <a href=https://klauslaube.com.br/tag/virtualenv.html title="Leia mais sobre" class=Article-tagLink>virtualenv</a> <a href=https://klauslaube.com.br/tag/pipfile.html title="Leia mais sobre" class=Article-tagLink>pipfile</a> <a href=https://klauslaube.com.br/tag/pipenv.html title="Leia mais sobre" class=Article-tagLink>pipenv</a> </span> </div> <div class=Article-comments> <div id=disqus_thread></div> <script type=text/javascript>
        var disqus_shortname = "klauslaube";
        var disqus_identifier = "2018/06/11/tchau-requirements-ola-pipfile.html";

        (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script> <noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript rel=nofollow>comments powered by Disqus.</a></noscript> </div> </article> </div> <footer class="PageFooter pure-u-1"> <div class=u-box> <p>O conteúdo deste blog está sob a licença <a class=PageFooter-link href=http://creativecommons.org/licenses/by/3.0/deed.pt_BR title="Distribua, adapte, use. Mas mencione o autor." rel=nofollow>Creative Commons Attribution 3.0</a>.</p> <p>O código está disponível em <a class=PageFooter-link href=https://github.com/kplaube/blog/ title=Contribute! rel=nofollow>GitHub</a>.</p> </div> </footer> </div> <script>
        (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
        function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
        e=o.createElement(i);r=o.getElementsByTagName(i)[0];
        e.src='//www.google-analytics.com/analytics.js';
        r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
        ga('create','UA-19657400-1');ga('send','pageview');
    </script> </body> </html>