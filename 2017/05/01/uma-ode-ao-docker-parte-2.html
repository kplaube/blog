<!DOCTYPE html><html lang=pt-br> <head><meta charset=utf-8><title>Uma ode ao Docker - Parte 2 | Klaus Laube</title><meta name=author content="Klaus Peter Laube"><meta name=description content="Vamos deixar a parte de containers de lado para falar um pouco mais sobre imagens, e baixar a primeira imagem do Docker Hub"><meta name=robots content=index,follow><meta property=og:site_name content="Klaus Laube"><meta property=og:type content=website><meta name=keywords content="infraestrutura, virtualizacao, containerizacao, docker, nginx"><meta property=og:title content="Uma ode ao Docker - Parte 2"><meta property=og:description content="Vamos deixar a parte de containers de lado para falar um pouco mais sobre imagens, e baixar a primeira imagem do Docker Hub"><meta property=og:url content=https://klauslaube.com.br/2017/05/01/uma-ode-ao-docker-parte-2.html><meta property=og:image content=https://klauslaube.com.br//images/blog/docker-image-container.jpg><meta property=fb:app_id content=262757647133878><meta name=google-site-verification content=xCq0H3B3JhkPcAdZ03J0vayijvH_g1rQVMZ_DVcMsQY><meta name=viewport content="width=device-width, initial-scale=1.0"><link rel=icon type=image/x-icon href=https://klauslaube.com.br/favicon.ico><link rel=alternate type=application/rss+xml title="Klaus Laube » Feed" href=https://klauslaube.com.br/feed/rss.xml><link rel=canonical href=https://klauslaube.com.br/2017/05/01/uma-ode-ao-docker-parte-2.html><link rel=stylesheet href=https://unpkg.com/purecss@1.0.0/build/pure-min.css integrity=sha384-nn4HPE8lTHyVtfCBi5yW9d20FjT8BJwUXyWZT9InLYax14RDjBj46LmSztkmNP9w crossorigin=anonymous><link rel=stylesheet href=https://klauslaube.com.br/theme/css/styles.min.css?0830b1e2></head> <body> <div class="Page pure-g is-fullEntry"> <div class="PageHeader pure-u-1"> <nav class="pure-menu pure-menu-open pure-menu-horizontal"> <a href=https://klauslaube.com.br/index.html title="Home page" class="PageHeader-link pure-menu-heading pure-menu-link">Klaus<span class=u-highlighted>Laube</a> <ul class="PageHeader-menu pure-menu-list"> <li class=pure-menu-item> <a href=https://about.me/klauslaube class="PageHeader-menu-link pure-menu-link">Contato</a> </li> </ul> </nav> </div> <div class="PageContent pure-u-1"> <article class="Article u-box" itemscope itemtype=http://schema.org/BlogPosting> <div itemprop=image itemscope itemtype=http://schema.org/ImageObject> <meta itemprop=url content=https://klauslaube.com.br//images/blog/docker-image-container.jpg> </div> <span itemprop=mainEntityOfPage> <header> <h1 class=Article-title itemprop="headline name"> Uma ode ao Docker - Parte 2 </h1> <p class=Article-meta> Por <span class=Article-author itemprop=author>Klaus Peter Laube</span>. <span class=Article-pubDate> Publicado em <time datetime=2017-05-01T22:25:00-03:00 itemprop=datePublished>01 Mai, 2017</time> </span> </p> </header> <div class=Article-content itemprop=articleBody> <img src=/images/blog/docker-logo-2.png alt="Logotipo do Docker" class=representative-image width=180 height=180> <p>No <a href=https://klauslaube.com.br/2017/01/14/uma-ode-ao-docker-parte-1.html title="Uma ode ao Docker - Parte 1"><em>post</em> anterior</a> falamos sobre o <em>Docker</em>, e arranhamos um pouco sobre a diferença entre virtualização com <em>Hypervisor</em> e <em>Container</em>. Nesse <em>post</em>, vamos explorar um pouquinho mais alguns conceitos, mostrando como funciona essa ferramenta que é sensação quando o assunto é <em>virtual machines</em>.</p> <!-- PELICAN_END_SUMMARY --> <p>Mas antes, vamos relembrar o que é o <em>Docker</em>:</p> <blockquote> <p>"Docker is an open platform for building, shipping and running distributed applications. It gives programmers, development teams, and operations engineers the common toolbox they need to take advantage of the distributed and networked nature of modern applications."</p> </blockquote> <p>Em uma linguagem mais simples, <em>Docker</em> lhe dá a habilidade de executar aplicações dentro de um ambiente controlado, conhecido como <em>Container</em>. <em>Containers</em> são similares às tradicionais máquinas virtuais, contudo, eles compartilham o mesmo sistema operacional e provém um conjunto de comandos que permitem a execução e controle da sua aplicação ou processo.</p> <p><a href="https://www.youtube.com/watch?v=pGYAg7TMmp0" title="Docker Tutorial - What is Docker & Docker Containers, Images, etc?">Veja a diferença entre <em>Vagrant</em> e <em>Docker</em></a>.</p> <h2>Instalando</h2> <p>Talvez você se depare com alguns artigos na <em>Internet</em>, que ao falar sobre a instalação do <em>Docker</em>, também mencionem <strong>boot2docker</strong> ou a necessidade do <strong>docker-machine</strong>. Houve um tempo onde utilizar <em>Docker</em> em máquinas <em>Windows</em> ou <em>OSX</em> não era tão trivial assim... mas esse tempo ficou para trás.</p> <p>Hoje, basta acessar a <a href=https://www.docker.com/community-edition#/download title="Baixe o Docker Community Edition">página de <em>download</em></a>, selecionar o seu sistema operacional, e seguir o passo a passo (que geralmente consiste em uma série de "next-next-finish").</p> <p><a href=https://docs.docker.com/docker-for-mac/docker-toolbox/ title="Docker for Mac vs. Docker Toolbox">Entenda a diferença entre o Docker Toolbox e Docker for Mac</a>.</p> <p>Uma vez instalado, através do terminal execute o seguinte comando:</p> <div class=highlight><pre><span></span>$ docker images

REPOSITORY   TAG   IMAGE  ID   CREATED   SIZE
</pre></div> <p>Esse é o momento ideal para falarmos de outro conceito muito importante dentro do <em>Docker</em>: <strong>Images</strong>.</p> <h2>Imagens</h2> <p>Segundo a documentação oficial:</p> <blockquote> <p>An image is a lightweight, stand-alone, executable package that includes everything needed to run a piece of software, including the code, a runtime, libraries, environment variables, and config files.</p> </blockquote> <p>Ou seja, um <em>Docker Image</em> é um binário que inclui todos os requisitos necessários para rodar um <em>Container</em>. Podemos pensar sobre esse conceito como uma tecnologia para empacotamento (ou até mesmo como uma espécie <em>snapshot</em>), onde não só definimos nossa distribuição <em>Linux</em> ou serviços utilizados (como <em>Postgres</em> ou <em>Nginx</em>, por exemplo), como também adicionamos a nossa própria aplicação ao pacote.</p> <p>Uma imagem é imutável, ou seja, <em>read only</em>. Imagens geralmente são compostas por outras camadas de imagens (<em>image layers</em>). Isso é um <em>approach</em> interessante, já que uma vez que uma camada seja baixada ela não precisará ser baixada novamente, mesmo se outras imagens utilizarem da mesma camada:</p> <p><img class=align-center-keep-size src=/images/blog/docker-image-container.jpg width=610 height=424 title="Esquema representando o Sistema de Arquivo (docs.docker.com)" alt="Esquema representando o Sistema de Arquivo (docs.docker.com)"></p> <p>Um <em>Docker Container</em> em vias práticas é uma "instância" da imagem... é o que a imagem se torna em memória ao ser executada. De forma preguiçosa, podemos fazer a analogia com a <a href=https://klauslaube.com.br/tag/oop.html title="Leia mais sobre OOP">Orientação a Objetos</a>, onde a imagem pode ser comparada com uma classe, e a instância com um <em>Container</em>. Podemos ter tantos <em>containers</em> quanto necessário para uma mesma imagem.</p> <h2>Um pouco de prática</h2> <p>Vamos baixar a nossa primeira imagem <em>Docker</em>. Para isso, execute o seguinte comando:</p> <div class=highlight><pre><span></span>$ docker pull docker/whalesay
</pre></div> <p>O comando <code>docker pull</code> fará o <em>download</em> da imagem <code>docker/whalesay</code> para o seu computador. Essa imagem está hospedada (por padrão) no <a href=https://hub.docker.com/r/docker/whalesay/ ><em>Docker Hub</em></a>, uma espécie de "Github para imagens Docker".</p> <p><a href=https://hub.docker.com/ title="Docker Hub">Leia mais sobre o <em>Docker Hub</em></a>.</p> <p>É possível visualizarmos a imagem através do comando <code>docker images</code>:</p> <div class=highlight><pre><span></span>$ docker images

REPOSITORY         TAG       IMAGE ID        CREATED          SIZE
docker/whalesay    latest    6b362a9f73eb    <span class=m>23</span> months ago    <span class=m>247</span> MB
</pre></div> <p>É uma prática comum o repositório/nome da imagem ser chamado de <code>&lt;repositório&gt;/&lt;nome de imagem&gt;</code>. Isso evita que haja duplicidade no <em>Docker Hub</em>. Para executar a imagem (e por consequência criar um <em>Container</em>), temos o comando <code>docker run</code>:</p> <div class=highlight><pre><span></span>$ docker run docker/whalesay cowsay boo
 _____
&lt; boo &gt;
 -----
    <span class=se>\</span>
     <span class=se>\</span>
      <span class=se>\</span>
                    <span class=c1>##        .</span>
              <span class=c1>## ## ##       ==</span>
           <span class=c1>## ## ## ##      ===</span>
       /<span class=s2>&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;</span>___/ <span class=o>===</span>
  ~~~ <span class=o>{</span>~~ ~~~~ ~~~ ~~~~ ~~ ~ /  <span class=o>===</span>- ~~~
       <span class=se>\_</span>_____ o          __/
        <span class=se>\ </span>   <span class=se>\ </span>       __/
          <span class=se>\_</span>___<span class=se>\_</span>_____/
</pre></div> <p>Também é possível executarmos através do <code>ID</code> da imagem:</p> <div class=highlight><pre><span></span>$ docker run 6b362a9f73eb cowsay boo2
</pre></div> <h2>Welcome to Nginx!</h2> <p>É claro que o <em>Docker</em> é muito mais poderoso do que isso. Por exemplo, vamos baixar o <a href=https://klauslaube.com.br/tag/nginx.html title="Leia mais sobre o Nginx"><em>Nginx</em></a> e ver como podemos receber uma simpática tela de "It's working":</p> <div class=highlight><pre><span></span>$ docker pull nginx
</pre></div> <p>Notou a ausência do <code>&lt;repositório&gt;/</code>? Repositórios oficiais no <em>Docker Hub</em> não necessitam de um prefixo, e você pode encontrá-los na interface <em>web</em> através do <em>path</em> <code>_/&lt;nome da imagem&gt;</code>. Por exemplo, o endereço do <em>Nginx</em> no <em>Docker Hub</em> é <a href=https://hub.docker.com/_/nginx/ >https://hub.docker.com/_/nginx/</a>.</p> <p><img class=align-center-keep-size src=/images/blog/memento-docker.png width=610 height=458 title="Assim como em Memento, o Docker também depende de imagens e tem memória curta (problemasfilosoficos.blogspot.com.br)" alt="Assim como em Memento, o Docker também depende de imagens e tem memória curta (problemasfilosoficos.blogspot.com.br)"></p> <p>Vamos executar o <em>Nginx</em>:</p> <div class=highlight><pre><span></span>$ docker run -p <span class=m>5000</span>:80 nginx
</pre></div> <p>Mapemos a porta <code>5000</code> da nossa máquina para apontar para a porta <code>80</code> do <em>Container</em>. Logo, ao acessarmos o <code>http://localhost:5000</code>, recebemos a simpática tela de boas vindas ao <em>Nginx</em>.</p> <p>Podemos dar um nome ao processo, e ainda executá-lo em modo <em>daemon</em>:</p> <div class=highlight><pre><span></span>$ docker run --name docker-nginx -p <span class=m>5000</span>:80 -d nginx

796ab2f0a662c045d0cfc99ff836a364a384406b8c6eaf03bcfb65e6cfd87751
</pre></div> <p>O valor de retorno é o <em>ID</em> do <em>Container</em>. Note a presença dos parâmetros <code>--name</code> e <code>-d</code>.</p> <p>Para listar os <em>Containers</em> ativos, usamos o comando <code>ps</code>:</p> <div class=highlight><pre><span></span>$ docker ps

CONTAINER ID    IMAGE    COMMAND
796ab2f0a662    nginx    <span class=s2>&quot;nginx -g &#39;daemon ...&quot;</span>
CREATED           STATUS           PORTS                  NAMES
<span class=m>12</span> seconds ago    Up <span class=m>11</span> seconds    <span class=m>0</span>.0.0.0:5000-&gt;80/tcp   docker-nginx
</pre></div> <p>Para parar o serviço:</p> <div class=highlight><pre><span></span>$ docker stop docker-nginx
</pre></div> <p>Pronto! Simples como as melhores coisas da vida.</p> <h2>Considerações finais</h2> <p>Lembro até hoje do momento em que ouvi falar sobre <em>Docker</em> pela primeira vez, e me questionei: Onde é que eu encaixo a minha ferramenta de provisionamento?</p> <p>Pois bem, não se faz necessário ter uma ferramenta de provisionamento uma vez que a sua aplicação seja empacotada em uma imagem <em>Docker</em>. A forma de pensar no <em>deploy</em> da aplicação muda, uma vez que ela esteja "containerizada".</p> <p>No próximo <em>post</em> da série vamos utilizar <em>Docker</em> em uma aplicação <a href=https://klauslaube.com.br/tag/python.html title="Leia mais sobre Python"><em>Python</em></a> e <a href=https://klauslaube.com.br/tag/django.html title="Leia mais sobre Django"><em>Django</em></a>, e nos deparar com algumas peculiaridades de ambientes <em>Docker</em> (como por exemplo, os ambiente efêmeros).</p> <p>Até a próxima!</p> <h2>Referências</h2> <ul> <li><a href=https://docs.docker.com/get-started/ ><em>Docker Docs</em> - <em>Get started, Part 1: Orientation and Setup</em></a></li> <li><a href=http://www.mundodocker.com.br/o-que-e-uma-imagem/ ><em>MundoDocker</em> - O que é uma imagem?</a></li> <li><a href=https://docs.openshift.com/enterprise/3.0/architecture/core_concepts/containers_and_images.html#docker-images><em>Openshift</em> - <em>Docker images</em></a></li> <li><a href=https://semaphoreci.com/community/tutorials/dockerizing-a-python-django-web-application><em>Semaphore</em> - <em>Dockerizing a Python Django web Application</em></a></li> <li><a href=http://stackoverflow.com/questions/23735149/docker-image-vs-container><em>Stackoverflow</em> - <em>Docker image vs container</em></a></li> </ul> </div> </span> <div class=Article-tags> <span class=Article-tagLabel>Tags:</span> <span itemprop=keywords> <a href=https://klauslaube.com.br/tag/infraestrutura.html title="Leia mais sobre" class=Article-tagLink>infraestrutura</a> <a href=https://klauslaube.com.br/tag/virtualizacao.html title="Leia mais sobre" class=Article-tagLink>virtualizacao</a> <a href=https://klauslaube.com.br/tag/containerizacao.html title="Leia mais sobre" class=Article-tagLink>containerizacao</a> <a href=https://klauslaube.com.br/tag/docker.html title="Leia mais sobre" class=Article-tagLink>docker</a> <a href=https://klauslaube.com.br/tag/nginx.html title="Leia mais sobre" class=Article-tagLink>nginx</a> </span> </div> <div class=Article-comments> <div id=disqus_thread></div> <script type=text/javascript>
        var disqus_shortname = "klauslaube";
        var disqus_identifier = "2017/05/01/uma-ode-ao-docker-parte-2.html";

        (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script> <noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript rel=nofollow>comments powered by Disqus.</a></noscript> </div> </article> </div> <footer class="PageFooter pure-u-1"> <div class=u-box> <p>O conteúdo deste blog está sob a licença <a class=PageFooter-link href=http://creativecommons.org/licenses/by/3.0/deed.pt_BR title="Distribua, adapte, use. Mas mencione o autor." rel=nofollow>Creative Commons Attribution 3.0</a>.</p> <p>O código está disponível em <a class=PageFooter-link href=https://github.com/kplaube/blog/ title=Contribute! rel=nofollow>GitHub</a>.</p> </div> </footer> </div> <script>
        (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
        function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
        e=o.createElement(i);r=o.getElementsByTagName(i)[0];
        e.src='//www.google-analytics.com/analytics.js';
        r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
        ga('create','UA-19657400-1');ga('send','pageview');
    </script> </body> </html>