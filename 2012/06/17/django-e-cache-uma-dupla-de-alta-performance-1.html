<!DOCTYPE html><html lang=pt-br> <head><meta charset=utf-8><title>Django e Cache: Uma dupla de alta performance - Parte 1 | Klaus Laube</title><meta name=author content="Klaus Peter Laube"><meta name=description content="Desenvolvedores Django podem contar com boas soluções, do próprio framework e de terceiros, que podem melhorar o caching das aplicações. Neste post, vamos apresentar o framework de caching do Django e como configurá-lo com o Memcached."><meta name=robots content=index,follow><meta property=og:site_name content="Klaus Laube"><meta property=og:type content=website><meta name=keywords content="desenvolvimento, web, python, django, memcached, cache"><meta property=og:title content="Django e Cache: Uma dupla de alta performance - Parte 1"><meta property=og:description content="Desenvolvedores Django podem contar com boas soluções, do próprio framework e de terceiros, que podem melhorar o caching das aplicações. Neste post, vamos apresentar o framework de caching do Django e como configurá-lo com o Memcached."><meta property=og:url content=https://klauslaube.com.br/2012/06/17/django-e-cache-uma-dupla-de-alta-performance-1.html><meta property=og:image content><meta property=fb:app_id content=262757647133878><meta name=google-site-verification content=xCq0H3B3JhkPcAdZ03J0vayijvH_g1rQVMZ_DVcMsQY><meta name=viewport content="width=device-width, initial-scale=1.0"><link rel=icon type=image/x-icon href=https://klauslaube.com.br/favicon.ico><link rel=alternate type=application/rss+xml title="Klaus Laube » Feed" href=https://klauslaube.com.br/feed/rss.xml><link rel=canonical href=https://klauslaube.com.br/2012/06/17/django-e-cache-uma-dupla-de-alta-performance-1.html><link rel=stylesheet href=https://unpkg.com/purecss@1.0.0/build/pure-min.css integrity=sha384-nn4HPE8lTHyVtfCBi5yW9d20FjT8BJwUXyWZT9InLYax14RDjBj46LmSztkmNP9w crossorigin=anonymous><link rel=stylesheet href=https://klauslaube.com.br/theme/css/styles.min.css?0830b1e2></head> <body> <div class="Page pure-g is-fullEntry"> <div class="PageHeader pure-u-1"> <nav class="pure-menu pure-menu-open pure-menu-horizontal"> <a href=https://klauslaube.com.br/index.html title="Home page" class="PageHeader-link pure-menu-heading pure-menu-link">Klaus<span class=u-highlighted>Laube</a> <ul class="PageHeader-menu pure-menu-list"> <li class=pure-menu-item> <a href=https://about.me/klauslaube class="PageHeader-menu-link pure-menu-link">Contato</a> </li> </ul> </nav> </div> <div class="PageContent pure-u-1"> <article class="Article u-box" itemscope itemtype=http://schema.org/BlogPosting> <div itemprop=image itemscope itemtype=http://schema.org/ImageObject> <meta itemprop=url content> </div> <span itemprop=mainEntityOfPage> <header> <h1 class=Article-title itemprop="headline name"> Django e Cache: Uma dupla de alta performance - Parte 1 </h1> <p class=Article-meta> Por <span class=Article-author itemprop=author>Klaus Peter Laube</span>. <span class=Article-pubDate> Publicado em <time datetime=2012-06-17T15:52:22-03:00 itemprop=datePublished>17 Jun, 2012</time> </span> </p> </header> <div class=Article-content itemprop=articleBody> <img src=/images/blog/django-logo.png alt="Logo do Django" class=representative-image width=180 height=180> <p>Embora o <a href=https://klauslaube.com.br/2012/05/14/o-cache-e-o-http.html title="O cache e o HTTP"><em>caching HTTP</em></a> seja essencial para qualquer aplicação <a href=https://klauslaube.com.br/tag/web.html title="Leia mais sobre Web"><em>web</em></a>, <strong>(IMO)</strong> essa modalidade de <a href=https://klauslaube.com.br/tag/cache.html title="Leia mais sobre Cache"><em>cache</em></a> deve ser encarada como um acréscimo à experiência de uso, e não necessariamente como uma “arma” contra problemas de performance. Os usuários poderão abdicar desta funcionalidade, e aí a sua aplicação não poderá depender do protocolo para atingir tempos de resposta atrativos.</p> <!-- PELICAN_END_SUMMARY --> <p>Desenvolvedores <a href=https://klauslaube.com.br/tag/django.html title="Leia mais sobre Django"><em>Django</em></a> podem contar com boas soluções, do próprio <em>framework</em> e de terceiros, que podem melhorar o <em>caching</em> das aplicações (e consequentemente a performance). A grande notícia é que essas ferramentas são fáceis e práticas. Vamos conhecê-las?</p> <h2>O Memcached</h2> <p>Eu juro que tentei escrever uma introdução para este tópico, mas a descricão contida no <a href=http://memcached.org/ title="A distributed memory object caching system">site oficial do <em>Memcached</em></a> é tão boa, que vou simplesmente copiá-la:</p> <blockquote> <p>Memcached is an in-memory key-value store for small chunks of arbitrary data (strings, objects) from results of database calls, API calls, or page rendering.</p> </blockquote> <p>Em outras palavras, é uma ferramenta <em>open source</em>, que tem como função o armazenamento (e gerenciamento) de resultados de <em>queries</em>, conteúdo de arquivos, processamentos avançados, ou qualquer tipo de informação, em memória (um meio muito mais rápido de ser lido que em disco, por exemplo). Embora esse potencial possa ser utilizado para os mais diferentes fins, é como mecanismo de <em>caching</em> que ele se destaca.</p> <p>O <em>Memcached</em> foi construído em um esquema “cliente-servidor”, e é possível utilizá-lo com uma grande quantidade de linguagens de programação. Mas o que eu acho mais bacana na ferramenta é a possibilidade de utilizá-la de forma distribuída. Isso propicia uma flexibilidade muito maior na hora de construirmos a <a href=https://klauslaube.com.br/tag/infraestrutura.html title="Leia mais sobre infra">infraestrutura</a> para servir as nossas aplicações <em>web</em>.</p> <p>Mas a “cereja do bolo” é: O <em>Django</em> funciona muito bem com o <em>Memcached</em>.</p> <h2>Framework de cache do Django</h2> <p>O uso do <em>Memcached</em> não é obrigatório! Na verdade, podemos utilizar diferentes <em>backends</em> para diferentes tipos de mecanismos de <em>cache</em>. O <em>Django</em> possui algumas opções disponíveis, sem necessitar utilizar nenhum “código de terceiro”. Temos a opção de fazer <em>cache</em> em disco, banco de dados ou até mesmo “simularmos” a interação com <em>cache</em> (muito bom para ambientes de desenvolvimento). <a href=https://docs.djangoproject.com/en/1.3/topics/cache/#setting-up-the-cache title="Setting up cache">Leia mais sobre</a>.</p> <p>Neste <em>post</em>, vamos nos concentrar na configuração do <em>Django</em> com o <em>Memcached</em>. Para instalar, <a href=http://code.google.com/p/memcached/wiki/NewInstallFromSource title="Memcached - Why build from source">basta compilar através do make</a>:</p> <div class=highlight><pre><span></span>$ wget http://memcached.org/latest
$ tar -zxvf memcached-1.4.13.tar.gz
$ <span class=nb>cd</span> memcached-1.4.13
$ ./configure
$ make <span class=o>&amp;&amp;</span> make <span class=nb>test</span>
$ make install
</pre></div> <p>Utilizando a <a href=ftp://ftp.tummy.com/pub/python-memcached/ title="Conheça a python-memcached"><em>python-memcached</em></a> como <em>binding</em> <em>Python</em> para o <em>Memcached</em>, basta adicionarmos o seguinte <em>backend</em> ao <strong>settings.py</strong>:</p> <div class=highlight><pre><span></span><span class=n>CACHES</span> <span class=o>=</span> <span class=p>{</span>
    <span class=s1>&#39;default&#39;</span><span class=p>:</span> <span class=p>{</span>
        <span class=s1>&#39;BACKEND&#39;</span><span class=p>:</span> <span class=s1>&#39;django.core.cache.backends.memcached.MemcachedCache&#39;</span><span class=p>,</span>
        <span class=s1>&#39;LOCATION&#39;</span><span class=p>:</span> <span class=s1>&#39;127.0.0.1:11211&#39;</span><span class=p>,</span>
        <span class=s1>&#39;TIMEOUT&#39;</span><span class=p>:</span> <span class=mi>60</span><span class=p>,</span>  <span class=c1># Default: 300 segundos,</span>
        <span class=s1>&#39;KEY_PREFIX&#39;</span><span class=p>:</span> <span class=s1>&#39;djcache&#39;</span><span class=p>,</span>
    <span class=p>}</span>
<span class=p>}</span>
</pre></div> <p>Onde:</p> <ul> <li><code>BACKEND:</code> É o módulo responsável por se comunicar com o <em>Memcached</em>. Estamos utilizando este <em>backend</em> pois optamos pela <em>python-memcached</em>.</li> <li><code>LOCATION:</code> É a porta (ou <em>socket</em>) onde o serviço do <em>Memcached</em> está respondendo. A porta padrão é a 11211.</li> <li><code>TIMEOUT:</code> É o tempo de vida do informação “cacheada”. Acima informamos 60 segundos, o padrão é 5 minutos.</li> <li><code>KEY_PREFIX:</code> É um valor que precederá todas as chaves que utilizarmos com o <em>Django</em>. Bem útil para prevenir que duas aplicações utilizem o mesmo valor no <em>Memcached</em> (quando este não é o comportamento esperado).</li> </ul> <p><a href=https://docs.djangoproject.com/en/dev/topics/cache/#cache-arguments title="Cache Arguments - Django Documentation">Conheça outras opções de configurações.</a></p> <h2>Considerações finais</h2> <p>Pronto! As ferramentas estão apresentadas e estamos prontos para partir para uma abordagem prática.</p> <p>O <em>Django</em> já vem “preparado” para trabalhar com mecanismos de <em>cache</em>. O seu esquema de <em>backends</em> permite que você “acople” diferentes módulos para atender os mais exóticos mecanismos de <em>cache</em>, sem necessariamente precisar alterar código nas suas <em>apps</em>.</p> <p>É bem verdade que o <em>Memcached</em> é um tanto “tradicional”, e que hoje existem alternativas mais “atrativas”, como o <a href=http://redis.io/ title="Redis is an open source, advanced key-value store"><em>Redis</em></a>. Na prática, depende muito do cenário no qual você está inserido, por exemplo, no <a href=http://globoesporte.globo.com/ title="a melhor cobertura sobre o Futebol e Outros Esportes, no Brasil e no Mundo"><em>Globoesporte.com</em></a> utilizamos o <em>Memcached</em> e ele nos atende muito bem.</p> <p>No próximo <em>post</em> vamos partir para uma abordagem mais prática, cobrindo as diferentes maneiras de utilizar <em>caching</em> com <em>Django</em>.</p> <p>Até lá...</p> <h2>Referências</h2> <ul> <li><a href=http://amix.dk/blog/post/19471 title="Um post antigo, com o comparativo entre pylibmc e python-memcached"><em>Amix.dk – memcached: Benchmark of 4 Python libraries</em></a></li> <li><a href=https://docs.djangoproject.com/en/dev/topics/cache/ title="Leia a documentação do framework de cache do Django"><em>Django Documentation – Django’s cache framework</em></a></li> <li><a href=http://memcached.org/ title="Página principal do projeto Memcached"><em>Memcached.org</em></a></li> <li><a href=http://sendapatch.se/projects/pylibmc/ title="Cliente Python escrito em C para trabalhar com o Memcached"><em>pylibmc – Python client for memcached</em></a></li> <li><a href=http://en.wikipedia.org/wiki/Memcached title="Leia mais sobre o Memcached no Wikipedia"><em>Wikipedia: Memcached</em></a></li> </ul> </div> </span> <div class=Article-tags> <span class=Article-tagLabel>Tags:</span> <span itemprop=keywords> <a href=https://klauslaube.com.br/tag/desenvolvimento.html title="Leia mais sobre" class=Article-tagLink>desenvolvimento</a> <a href=https://klauslaube.com.br/tag/web.html title="Leia mais sobre" class=Article-tagLink>web</a> <a href=https://klauslaube.com.br/tag/python.html title="Leia mais sobre" class=Article-tagLink>python</a> <a href=https://klauslaube.com.br/tag/django.html title="Leia mais sobre" class=Article-tagLink>django</a> <a href=https://klauslaube.com.br/tag/memcached.html title="Leia mais sobre" class=Article-tagLink>memcached</a> <a href=https://klauslaube.com.br/tag/cache.html title="Leia mais sobre" class=Article-tagLink>cache</a> </span> </div> <div class=Article-comments> <div id=disqus_thread></div> <script type=text/javascript>
        var disqus_shortname = "klauslaube";
        var disqus_identifier = "2012/06/17/django-e-cache-uma-dupla-de-alta-performance-1.html";

        (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script> <noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript rel=nofollow>comments powered by Disqus.</a></noscript> </div> </article> </div> <footer class="PageFooter pure-u-1"> <div class=u-box> <p>O conteúdo deste blog está sob a licença <a class=PageFooter-link href=http://creativecommons.org/licenses/by/3.0/deed.pt_BR title="Distribua, adapte, use. Mas mencione o autor." rel=nofollow>Creative Commons Attribution 3.0</a>.</p> <p>O código está disponível em <a class=PageFooter-link href=https://github.com/kplaube/blog/ title=Contribute! rel=nofollow>GitHub</a>.</p> </div> </footer> </div> <script>
        (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
        function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
        e=o.createElement(i);r=o.getElementsByTagName(i)[0];
        e.src='//www.google-analytics.com/analytics.js';
        r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
        ga('create','UA-19657400-1');ga('send','pageview');
    </script> </body> </html>