<!DOCTYPE html><html lang=pt-br> <head><meta charset=utf-8><title>Automatize o deploy dos seus projetos com Fabric | Klaus Laube</title><meta name=author content="Klaus Peter Laube"><meta name=description content="O Fabric é uma lib Python, e ferramenta de linha de comando, para auxiliá-lo no deploy e administração de seus sistemas Web, independentemente da linguagem de programação escolhida."><meta name=robots content=index,follow><meta property=og:site_name content="Klaus Laube"><meta property=og:type content=website><meta name=keywords content="desenvolvimento, ambiente-de-desenvolvimento, python, django, fabric, deploy"><meta property=og:title content="Automatize o deploy dos seus projetos com Fabric"><meta property=og:description content="O Fabric é uma lib Python, e ferramenta de linha de comando, para auxiliá-lo no deploy e administração de seus sistemas Web, independentemente da linguagem de programação escolhida."><meta property=og:url content=https://klauslaube.com.br/2012/02/26/automatize-o-deploy-dos-seus-projetos-com-fabric.html><meta property=og:image content><meta property=fb:app_id content=262757647133878><meta name=google-site-verification content=xCq0H3B3JhkPcAdZ03J0vayijvH_g1rQVMZ_DVcMsQY><meta name=viewport content="width=device-width, initial-scale=1.0"><link rel=icon type=image/x-icon href=https://klauslaube.com.br/favicon.ico><link rel=alternate type=application/rss+xml title="Klaus Laube » Feed" href=https://klauslaube.com.br/feed/rss.xml><link rel=canonical href=https://klauslaube.com.br/2012/02/26/automatize-o-deploy-dos-seus-projetos-com-fabric.html><link rel=stylesheet href=https://unpkg.com/purecss@1.0.0/build/pure-min.css integrity=sha384-nn4HPE8lTHyVtfCBi5yW9d20FjT8BJwUXyWZT9InLYax14RDjBj46LmSztkmNP9w crossorigin=anonymous><link rel=stylesheet href=https://klauslaube.com.br/theme/css/styles.min.css?0830b1e2></head> <body> <div class="Page pure-g is-fullEntry"> <div class="PageHeader pure-u-1"> <nav class="pure-menu pure-menu-open pure-menu-horizontal"> <a href=https://klauslaube.com.br/index.html title="Home page" class="PageHeader-link pure-menu-heading pure-menu-link">Klaus<span class=u-highlighted>Laube</a> <ul class="PageHeader-menu pure-menu-list"> <li class=pure-menu-item> <a href=https://about.me/klauslaube class="PageHeader-menu-link pure-menu-link">Contato</a> </li> </ul> </nav> </div> <div class="PageContent pure-u-1"> <article class="Article u-box" itemscope itemtype=http://schema.org/BlogPosting> <div itemprop=image itemscope itemtype=http://schema.org/ImageObject> <meta itemprop=url content> </div> <span itemprop=mainEntityOfPage> <header> <h1 class=Article-title itemprop="headline name"> Automatize o deploy dos seus projetos com Fabric </h1> <p class=Article-meta> Por <span class=Article-author itemprop=author>Klaus Peter Laube</span>. <span class=Article-pubDate> Publicado em <time datetime=2012-02-26T19:40:13-03:00 itemprop=datePublished>26 Fev, 2012</time> </span> </p> </header> <div class=Article-content itemprop=articleBody> <img src=/images/blog/deploy.jpg alt="Deploy now!" class=representative-image width=180 height=180> <p>Durante a minha árdua trajetória com o <a href=https://klauslaube.com.br/tag/php.html title="Leia mais sobre PHP"><em>PHP</em></a>, sempre fiz “subidas” de projetos utilizando um cliente <a href=http://pt.wikipedia.org/wiki/File_Transfer_Protocol title="Leia mais sobre File Transfer Protocol"><em>FTP</em></a>. Um processo manual, extremamente repetitivo (e chato).</p> <!-- PELICAN_END_SUMMARY --> <p>Já com <a href=https://klauslaube.com.br/tag/python.html title="Leia mais sobre Python"><em>Python</em></a>, pude utilizar o <a href=http://pt.wikipedia.org/wiki/SSH title="Leia mais sobre Secure Shell"><em>SSH</em></a>, que me proporcionou maior agilidade e liberdade dentro do ambiente de produção. Mas que não deixou de ser um processo manual, extremamente repetitivo, chato e muito suscetível a falhas.</p> <p>Foi utilizando o <a href=https://klauslaube.com.br/tag/django.html title="Leia mais sobre Django"><em>Django</em></a> que conheci o <a href=http://docs.fabfile.org/en/1.4.0/index.html title="A library and command-line tool for streamlining the use of SSH for application deployment or systems administration tasks"><em>Fabric</em></a>, e percebi quanto tempo podemos economizar automatizando o processo de <em>deploy</em> de nossos projetos.</p> <h2>O agile e o deploy contínuo</h2> <p>Todo e qualquer procedimento de <em>upload</em> do seu projeto para o ambiente de produção corre algum tipo de risco. Com o <em>deploy</em> automatizado, a tendência é que este risco seja reduzido, e que você possa fazer a entrega do seu projeto para <a href=https://klauslaube.com.br/2011/03/07/diferentes-ambientes.html title="Diferentes ambientes: Development, Testing, Staging e Production">diversos ambientes</a> com o menor esforço possível.</p> <p>Logo, não consigo imaginar um cenário eficiente de <em>deploy</em> contínuo, sem a utilização de alguma ferramenta de automatização. É através destas que respeitamos uma das premissas do <a href=https://klauslaube.com.br/tag/agile.html title="Leia mais sobre Agile"><em>agile</em></a>, e diminuímos a incidência de falha humana.</p> <h2>Mas o que é o Fabric?</h2> <p>O <strong><em>Fabric</em></strong> é uma <em>lib</em> <em>Python</em>, e ferramenta de linha de comando, para auxiliá-lo em seu <em>deploy</em> e na administração remota dos seus sistemas.</p> <p>Embora seja feita em <em>Python</em>, pode ser utilizada em projetos escritos em qualquer linguagem. Equivale ao <a href=http://en.wikipedia.org/wiki/Capistrano title="Leia mais sobre o Capistrano"><em>Capistrano</em></a>, alternativa mais famosa, escrita em <em>Ruby</em>.</p> <h2>Em casa de ferreiro, espeto de ferro</h2> <p>Para dar um exemplo de uso do <em>Fabric</em>, podemos utilizar o esquema de <em>deploy</em> deste <em>blog</em>. Sim! O processo está automatizado, e você pode <a href=https://bitbucket.org/kplaube/klauslaube.com.br/src/d579e9d81641/fabfile.py title="Confira o script Fabric no repositório do BitBucket">conferí-lo no <em>BitBucket</em></a>.</p> <p>Antes de mais nada, é necessário ter o <em>Fabric</em> instalado:</p> <div class=highlight><pre><span></span>$ pip install fabric
</pre></div> <p>Todo o procedimento será escrito em um arquivo chamado <strong>fabfile.py</strong>. Com o comando <strong>fab</strong>, a ferramenta carregará este arquivo e permitirá a execução de todos os métodos públicos definidos dentro dele.</p> <p>Vamos listar todos os métodos que <a href=https://bitbucket.org/kplaube/klauslaube.com.br/src/d579e9d81641/fabfile.py title="Veja no BitBucket">criei no <strong>fabfile.py</strong> do <em>blog</em></a>:</p> <div class=highlight><pre><span></span>$ fab -l

Available commands:

bootstrap            Initialize remote host environment.
collect_static       Collect all static files from Django apps and copy ...
create_virtualenv    Setup virtualenv on remote host.
database_restart     Restart the database server on remote server.
deploy               Send the code to the remote host.
http_restart         Restart the HTTP server on remote server.
migrate              Execute South on remote host, to update the databas...
production           Use production environment on remote host.
staging              Use staging environment on remote host.
syncdb               Execute syncdb on remote host.
update_apache_conf   Move apache and fastcgi files to the public html.
update_requirements  Update Python dependencies on remote host.
</pre></div> <p>Como é possível notar na listagem acima, temos operações de <em>deploy</em> (<strong>deploy</strong>, <strong>syncdb</strong>, <strong>update_requirements</strong> e <strong>update_apache_conf</strong>) e operações de administração remota (<strong>database_restart</strong>, <strong>http_restart</strong>, <strong>migrate</strong>, etc). Os métodos <strong>production</strong> e <strong>staging</strong> são basicamente para “setar” para qual ambiente o <em>deploy</em> será realizado. Por exemplo, a cada nova subida de <em>release</em>, executo o seguinte comando:</p> <div class=highlight><pre><span></span>$ fab production deploy http_restart
</pre></div> <p>Onde basicamente:</p> <ul> <li>Defino o usuário, <em>IP</em>, e <em>paths</em> para o ambiente de produção através do método <strong>production</strong>.</li> <li>Executo o envio dos arquivos através de <a href=http://pt.wikipedia.org/wiki/Rsync title="Leia mais sobre Rsync"><strong>Rsync</strong></a> para o servidor, com o método <strong>deploy</strong>.</li> <li>Reinicio o <em>Apache</em> através do método <strong>http_restart</strong>.</li> </ul> <p>Se olharmos atentamente o <a href=https://bitbucket.org/kplaube/klauslaube.com.br/src/d579e9d81641/fabfile.py#cl-101 title="Veja em detalhes o método deploy">método <strong>deploy</strong></a>, utilizamos uma <em>lib</em> (importada no início do arquivo) chamada <strong>rsync_project</strong>. Que corresponde a ferramenta de linha de comando (encontrada em sistemas baseados em <em>Unix</em>) chamada <strong>rsync</strong>. O que o <em>Fabric</em> faz (com maestria) é “abstrair” essas operações para que possamos fazer os nossos procedimentos através de uma interface simples (outros comandos, como <strong>scp</strong> e <strong>sudo</strong> também são utilizados pelo <em>Fabric</em>).</p> <p>A função <a href=https://bitbucket.org/kplaube/klauslaube.com.br/src/d579e9d81641/fabfile.py#cl-199 title="Veja um exemplo de uso no fabfile.py"><strong>run</strong></a> faz grande parte da magia acontecer. Com ela, abrimos uma conexão <em>SSH</em> com o nosso servidor, e executamos comandos como se estívessemos em um terminal. Extremamente útil para fazer <em>restart</em> de serviços, escalonamento de <em>logs</em>, limpeza de temporários, etc.</p> <h2>Considerações finais</h2> <p>O <em>Fabric</em> é muito simples de usar. Lendo o básico da documentação, já somos capazes de automatizar os processos mais triviais.</p> <p>Recomendo o <a href=https://bitbucket.org/copelco/caktus-deployment/src/6ad8ad84a938/example-django-project/caktus_website/fabfile.py title="Veja-o no BitBucket"><strong>fabfile.py</strong></a> da <a href=http://www.caktusgroup.com/ title="Visite o site da Caktus"><em>Caktus Consulting Group</em></a>. Simples e bem escrito, foi nele que me baseei para escrever o <em>script</em> apresentado neste <em>post</em>.</p> <h2>Referências</h2> <ul> <li><a href=http://docs.fabfile.org/en/1.4.0/index.html title="Fabric: a library and command-line tool for streamlining the use of SSH for application deployment or systems administration tasks"><em>Fabric – Documentation</em></a></li> <li><a href=http://yuji.wordpress.com/2011/04/09/django-python-fabric-deployment-script-and-example/ title="Excelente exemplo de uso do Fabric"><em>Useful Stuff – Fabric Deployment Script and Example</em></a></li> </ul> </div> </span> <div class=Article-tags> <span class=Article-tagLabel>Tags:</span> <span itemprop=keywords> <a href=https://klauslaube.com.br/tag/desenvolvimento.html title="Leia mais sobre" class=Article-tagLink>desenvolvimento</a> <a href=https://klauslaube.com.br/tag/ambiente-de-desenvolvimento.html title="Leia mais sobre" class=Article-tagLink>ambiente-de-desenvolvimento</a> <a href=https://klauslaube.com.br/tag/python.html title="Leia mais sobre" class=Article-tagLink>python</a> <a href=https://klauslaube.com.br/tag/django.html title="Leia mais sobre" class=Article-tagLink>django</a> <a href=https://klauslaube.com.br/tag/fabric.html title="Leia mais sobre" class=Article-tagLink>fabric</a> <a href=https://klauslaube.com.br/tag/deploy.html title="Leia mais sobre" class=Article-tagLink>deploy</a> </span> </div> <div class=Article-comments> <div id=disqus_thread></div> <script type=text/javascript>
        var disqus_shortname = "klauslaube";
        var disqus_identifier = "2012/02/26/automatize-o-deploy-dos-seus-projetos-com-fabric.html";

        (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script> <noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript rel=nofollow>comments powered by Disqus.</a></noscript> </div> </article> </div> <footer class="PageFooter pure-u-1"> <div class=u-box> <p>O conteúdo deste blog está sob a licença <a class=PageFooter-link href=http://creativecommons.org/licenses/by/3.0/deed.pt_BR title="Distribua, adapte, use. Mas mencione o autor." rel=nofollow>Creative Commons Attribution 3.0</a>.</p> <p>O código está disponível em <a class=PageFooter-link href=https://github.com/kplaube/blog/ title=Contribute! rel=nofollow>GitHub</a>.</p> </div> </footer> </div> <script>
        (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
        function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
        e=o.createElement(i);r=o.getElementsByTagName(i)[0];
        e.src='//www.google-analytics.com/analytics.js';
        r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
        ga('create','UA-19657400-1');ga('send','pageview');
    </script> </body> </html>