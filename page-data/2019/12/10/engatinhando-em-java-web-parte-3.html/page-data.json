{"componentChunkName":"component---src-templates-blog-post-js","path":"/2019/12/10/engatinhando-em-java-web-parte-3.html","result":{"data":{"markdownRemark":{"html":"<p>No <a href=\"/2019/12/02/engatinhando-em-java-web-parte-2.html\" title=\"Confira a parte 2\"><em>post</em> anterior</a> falamos sobre a especificação\n<em>Servlet</em>, bem como sobre o uso de <em>JavaServer Pages</em> e <em>Expression Language</em>.\nPara finalizar o protótipo proposto, e encerrar essa introdução ao <a href=\"/tag/java.html\" title=\"Leia mais sobre Java\"><em>Java</em></a>,\nprecisamos implementar o método <code class=\"language-text\">POST</code>, e durante esse percurso abordaremos os conceitos de <em>filters</em> e <em>listeners</em>.</p>\n<h2>doGet e doPost</h2>\n<p>Recaptulando o protótipo: Precisamos implementar a funcionalidade de adicionar uma tarefa ao <em>todo list</em>.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 740px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7ca9804f928b464741517e0eb94c0810/07f3a/cypher-ignorance.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAUBBP/EABUBAQEAAAAAAAAAAAAAAAAAAAIB/9oADAMBAAIQAxAAAAGU58NsIwr/xAAYEAADAQEAAAAAAAAAAAAAAAAAAQIDEf/aAAgBAQABBQLXPjymXfMUOnQqaOs//8QAGBEAAgMAAAAAAAAAAAAAAAAAAAESMWH/2gAIAQMBAT8BVksP/8QAGBEAAgMAAAAAAAAAAAAAAAAAABEBEmH/2gAIAQIBAT8BUopp/8QAGhAAAgMBAQAAAAAAAAAAAAAAACEBAjEQEf/aAAgBAQAGPwL2MMQ61HIuf//EABoQAQADAAMAAAAAAAAAAAAAAAEAESExQXH/2gAIAQEAAT8hygE5NGkdMupZ9nNTUZtVFm1n/9oADAMBAAIAAwAAABAQz//EABURAQEAAAAAAAAAAAAAAAAAAAEA/9oACAEDAQE/EEAZCz//xAAYEQADAQEAAAAAAAAAAAAAAAAAASERYf/aAAgBAgEBPxBwbRdj/8QAHBABAAMAAgMAAAAAAAAAAAAAAQARQTFRIXHB/9oACAEBAAE/EAWmwD5fR1H1ACKLe3WcxAeHUfYoKIovImWkprqIEq8rP//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Cypher em The Matrix\"\n        title=\"Se continuar no Python é ficar na Matrix, pode me deixar lá (filmfoodsafari.wordpress.com)\"\n        src=\"/static/7ca9804f928b464741517e0eb94c0810/07f3a/cypher-ignorance.jpg\"\n        srcset=\"/static/7ca9804f928b464741517e0eb94c0810/7809d/cypher-ignorance.jpg 192w,\n/static/7ca9804f928b464741517e0eb94c0810/4ecad/cypher-ignorance.jpg 384w,\n/static/7ca9804f928b464741517e0eb94c0810/07f3a/cypher-ignorance.jpg 740w\"\n        sizes=\"(max-width: 740px) 100vw, 740px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Se continuar no Python é ficar na Matrix, pode me deixar lá (filmfoodsafari.wordpress.com)</figcaption>\n  </figure></p>\n<p>Se inspecionarmos o método <code class=\"language-text\">service</code> da classe <code class=\"language-text\">HttpServlet</code>, veremos que ele já se encarrega de determinar qual verbo <em>HTTP</em>\nestá sendo utilizado pela requisição. Portanto, ao invés de sobrescrevê-lo, é mais eficiente implementarmos os métodos nos quais\nqueremos suportar.</p>\n<p>Renomeie o método <code class=\"language-text\">service</code> para <code class=\"language-text\">doGet</code>, e crie um método vazio para o <code class=\"language-text\">doPost</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@WebServlet</span><span class=\"token punctuation\">(</span>urlPatterns <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">OlaMundoServlet</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">HttpServlet</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Tarefa</span><span class=\"token punctuation\">></span></span> tarefas <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Tarefa</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Tarefa A\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Tarefa</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Tarefa B\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Tarefa</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Tarefa C\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">doGet</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> req<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> resp<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">ServletException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">{</span>\n        req<span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"tarefas\"</span><span class=\"token punctuation\">,</span> tarefas<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">RequestDispatcher</span> rd <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span><span class=\"token function\">getRequestDispatcher</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/WEB-INF/index.jsp\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        rd<span class=\"token punctuation\">.</span><span class=\"token function\">forward</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">,</span> resp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">doPost</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> req<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> resp<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Note a alteração em <code class=\"language-text\">List&lt;Tarefa&gt; tarefas</code>.</p>\n<p>Com a seguinte adição de código ao método <code class=\"language-text\">doPost</code> temos um protótipo que atinge o seu objetivo:</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Override</span>\n<span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">doPost</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> req<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> resp<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">ServletException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">final</span> <span class=\"token class-name\">Tarefa</span> tarefa <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Tarefa</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">.</span><span class=\"token function\">getParameter</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"nome\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    tarefas<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>tarefa<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    req<span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"tarefas\"</span><span class=\"token punctuation\">,</span> tarefas<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">RequestDispatcher</span> rd <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span><span class=\"token function\">getRequestDispatcher</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/WEB-INF/index.jsp\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    rd<span class=\"token punctuation\">.</span><span class=\"token function\">forward</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">,</span> resp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Executando o <em>Maven</em> (<code class=\"language-text\">mvn clean tomcat7:run</code>), e através do endereço <code class=\"language-text\">http://localhost:8080</code>, somos capazes de ver o resultado:</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 400px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5d23ead2544a53efb33934e0b7ae9c7a/e17e5/java-post-browser.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAABYlAAAWJQFJUiTwAAABd0lEQVQoz72S7UvCQBzH909FIk7Np3xCfBjqQutFEEn/WUEPSEIFQZqv3Gi1uanQpktlCBKZzrm5XWdqFEi1XvTle8dxx+d+v+9xyGYY3/Bha9aA1RFx+jB3IIW643ZP3OaKoe6Yw5tw+ZN2d9zpxVBXzIKGLWho3RacG8G3D1KZnCeQDkaz4fgOtrXvj2R8obQnmPKG8AS+l8rmosldeOoL4fA6+ycjl1fXh0fHJ6f5s3zhvHBxUywz1VqVq7Nsg+XqTJWjGW62w9ZZrsHVvhgRxVa5fFsqFUmSgPM9dQd+LcSYC4ApABq0Acaa8WFtanwjRJIkhn4QOr1HUeJbnZGqy5ohv5OvqvGi6J32U7fb1XV9RWVdNyaTiTxWes/D/kAeqsZoabjWdKBpmqqqq9uGQ1EUnueJSqXGcbI8MpF5DjebTYIgaJoeDAamYVEUKYpqt9srs/0AC4JAkmS/3wdmNIPhg0EMxjbV8wL+sxbw8qeA/6v8BnzyEiea5+ulAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Exemplo de POST\"\n        title=\"Exemplo de POST\"\n        src=\"/static/5d23ead2544a53efb33934e0b7ae9c7a/e17e5/java-post-browser.png\"\n        srcset=\"/static/5d23ead2544a53efb33934e0b7ae9c7a/8514f/java-post-browser.png 192w,\n/static/5d23ead2544a53efb33934e0b7ae9c7a/804b2/java-post-browser.png 384w,\n/static/5d23ead2544a53efb33934e0b7ae9c7a/e17e5/java-post-browser.png 400w\"\n        sizes=\"(max-width: 400px) 100vw, 400px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Exemplo de POST</figcaption>\n  </figure></p>\n<p>Ao analisar o código acima, além das possibilidades de melhoria de código (como reaproveitar o\n<code class=\"language-text\">req.getRequestDispatcher(&quot;/WEB-INF/index.jsp&quot;)</code> ao invés de duplicá-lo, ou fazer um <code class=\"language-text\">redirect</code>),\nhá algo muito importante que precisa ser salientado: <em>Servlets</em> não são \"thread safe\".</p>\n<h2>Don't repeat yourself</h2>\n<p>Segundo o <a href=\"https://www.caelum.com.br/apostila-java-web/servlets/#uma-nica-instncia-de-cada-servlet\" title=\"Leia mais na apostila da Caelum\">material da <em>Caelum</em></a>:</p>\n<blockquote>\n<p>De acordo com a especificação de Servlets, por padrão, existe uma única instância de cada Servlet declarada. Ao chegar\numa requisição para a Servlet, uma nova Thread é aberta sobre aquela instância que já existe.</p>\n</blockquote>\n<blockquote>\n<p>Isso significa que, se colocássemos em nossa Servlet uma variável de instância, ela seria compartilhada entre todas\nas threads que acessam essa Servlet! Em outras palavras, seria compartilhado entre todas as requisições e todos os\nclientes enxergariam o mesmo valor. Provavelmente não é o que queremos fazer.</p>\n</blockquote>\n<p>Nosso protótipo está pronto, e a brincadeira com o atributo de instância nos permitiu interagir com o método <code class=\"language-text\">POST</code>.</p>\n<p>Se quisermos seguir em frente e tornar a aplicação mais \"production ready\", outros\naspectos terão que ser considerados, como persistência, segurança, validação de dados, modularidade, e não podemos esquecer\ndesses detalhes como a natureza <em>multithreading</em> que envolve o <em>Java</em>.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 740px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1a27dd338f27cf4defade1b51f89730c/50383/dodge-this.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACqklEQVQozwGfAmD9ALXM3L3a6bnY5s7o8OD0+Or4+vL+/uTw8O/29fv//6eusXFuca3ByZ6utnVydtfZ2/////v8+v7///L8/ABCTV2Qpa/D3eXd+vrp/v74///g5ud5eXuqp6X///+3uLqMjo6wxsybrbV/e4K/xszh6e3t8/Tj7O3f7fEACAkXGh0tP0VReISHo7Gst728iYOIZ2FmgX196/Pvv8nIt8fCu8/On624g36HU01XRTxIrr7BhoqPmqCnABIRHycnMispLSQjJjs6OkZDQVRQT2dhXGFfV2htZXl9eJWdnoWGiouNkFM/PU88NDsvM4mNj3x9f391dQAQEBseHyQnJyknJickJSkhISQlIiUqKCZDQjpDQj49OjiFgn9wbXF4cWltUUJ3X0tCNDNLPEFTRUZtYFoAFhUaMzAuNS8tFhQYJCElJCAhJSIhPjYyMi0uJycqOTQyinp3r6emoKKanoFpmYZyamBjT0RCUERDdWpjADs3OFBKR1FNREVFNVBRPV1cTigkJm5jXW1OSxMQFRYUHGQ2MsOuo9jU1H9lUnttYJeSh7u8uLe6uLu8ugBwcF5naFJqbFiHiXugpaLM099gZWlRSkOBYVRWOTJHKCaUb1eslm6jjW4ZFBgAABY7ODrDwsG/wMO8vLoAcnFqlJKUsbO/x8zdy9PnytTqvsXWtLjHgnhzUzAlfU85kHRatLGkRkA4BAUODhEgOzw/srSxvLq4t7awAMTE1MrK3MnK3MbI2MPI2cHJ28jR5dXh+7W4wlU5LGA4JJWPhs3a7GJkZAoIDh0cIWZgTbazqLq7trO0rADBv8q/vsm8vMS7u8G8vMO/wMm/wcy+wc7DyNizs7muqq6+xM/N1d6ChoQAAQgPEBlkYFCpopS5urSwsqeEXVOjgX+zbAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Trinity em The Matrix\"\n        title=\"Fazer algo funcionar na plataforma JavaEE parece como a Trinity acertando um agente em Matrix (vulturehound.co.uk)\"\n        src=\"/static/1a27dd338f27cf4defade1b51f89730c/50383/dodge-this.png\"\n        srcset=\"/static/1a27dd338f27cf4defade1b51f89730c/8514f/dodge-this.png 192w,\n/static/1a27dd338f27cf4defade1b51f89730c/804b2/dodge-this.png 384w,\n/static/1a27dd338f27cf4defade1b51f89730c/50383/dodge-this.png 740w\"\n        sizes=\"(max-width: 740px) 100vw, 740px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Fazer algo funcionar na plataforma JavaEE parece como a Trinity acertando um agente em Matrix (vulturehound.co.uk)</figcaption>\n  </figure></p>\n<p>E se nesse momento você ainda está disposto a fazer isso \"all by yourself\", reconsidere. Para fins de aprendizado,\nesse tipo de experimento é ótimo mas nada produtivo, portanto, considere o uso de algum <em>framework</em>.</p>\n<h2>Para finalizar: Filters &#x26; Listeners</h2>\n<p>Mas calma! Há dois tópicos que valem a pena ser compreendidos antes de pular para o uso de algum <em>framework</em>.</p>\n<p>Diretamente de uma <a href=\"https://stackoverflow.com/questions/4720942/difference-between-filter-and-listener-in-servlet-java-ee\" title=\"Difference between Filter and Listener\"><em>thread</em> do <em>StackOverflow</em></a>:</p>\n<blockquote>\n<p>Servlet Filter is used for monitoring request and response from client to the servlet, or to modify the request and\nresponse, or to audit and log.</p>\n</blockquote>\n<blockquote>\n<p>Servlet Listener is used for listening to events in a web containers, such as when you create a session, or place an\nattribute in an session or if you passivate and activate in another container, to subscribe to these events you can\nconfigure listener in web.xml, for example HttpSessionListener.</p>\n</blockquote>\n<p>Em outras palavras:</p>\n<ul>\n<li><strong>Filtros:</strong> Usados para interagir com a requisição e com a resposta.</li>\n<li><strong>Listeners:</strong> Usados para interagir com eventos que acontecem dentro de um <em>container</em>.</li>\n</ul>\n<h3>Filters</h3>\n<p>Assim como a interface <code class=\"language-text\">Servlet</code>, possuímos uma interface para a escrita de filtros. O propósito do filtro abaixo é\n\"logar\" o endereço <em>IP</em> do usuário que está realizando a requisição:</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// src/main/java/webapp/LogFilter.java</span>\n<span class=\"token keyword\">package</span> <span class=\"token namespace\">webapp</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">IOException</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Date</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Filter</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">FilterChain</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">FilterConfig</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ServletException</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ServletRequest</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ServletResponse</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">WebFilter</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token annotation punctuation\">@WebFilter</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/*\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">LogFilter</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Filter</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">FilterConfig</span> filterConfig<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">ServletException</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// vazio</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">doFilter</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">ServletResponse</span> response<span class=\"token punctuation\">,</span> <span class=\"token class-name\">FilterChain</span> chain<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">,</span>\n            <span class=\"token class-name\">ServletException</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">String</span> ipAddress <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">getRemoteAddr</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">String</span> now <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"IP: %s; Time: %s\"</span><span class=\"token punctuation\">,</span> ipAddress<span class=\"token punctuation\">,</span> now<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        chain<span class=\"token punctuation\">.</span><span class=\"token function\">doFilter</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Com o uso da <em>annotation</em> <code class=\"language-text\">WebFilter</code>, dizemos que queremos aplicar o filtro para todas as requisições (<code class=\"language-text\">/*</code>). A <em>annotation</em> também é responsável por não precisarmos tocar no arquivo <code class=\"language-text\">web.xml</code>, e temos o filtro funcionando a partir do momento que reiniciamos o <em>Tomcat</em>.</p>\n<p>Com <code class=\"language-text\">Filter</code> agora temos a capacidade de aplicar de uma maneira mais modular conceitos como <a href=\"/2012/05/14/o-cache-e-o-http.html\" title=\"O cache e o HTTP\"><em>cache</em></a>, compactação da\nresposta, controle de sessão, <a href=\"/2012/04/15/problemas-de-seguranca-em-aplicacoes-web.html\" title=\"Problemas comuns em aplicações web\">segurança</a>, entre outros.</p>\n<p><a href=\"https://www.caelum.com.br/apostila-java-web/recursos-importantes-filtros/\" title=\"Recursos importantes: Filtros\">Leia mais sobre filtros na apostila de desenvolvimento <em>web</em> em <em>Java</em>, da <em>Caelum</em></a>.</p>\n<h3>Listeners</h3>\n<p>A necessidade de filtros fica bem evidente, principalmente quando estamos acostumados com <a href=\"https://www.profissionaisti.com.br/2009/04/entendendo-o-django/\" title=\"Entendendo o Django\">estruturas como a do <em>Django</em></a>.\nPossivelmente a necessidade dos <em>listeners</em> exija um pouco mais de criatividade de nossa parte. O <a href=\"https://www.javatpoint.com/ServletContextEvent\" title=\"ServletContextEvent and ServletContextListener\"><em>JavaTPoint</em> pode ajudar</a>:</p>\n<blockquote>\n<p>If you want to perform some action at the time of deploying the web application such as creating database connection,\ncreating all the tables of the project etc, you need to implement ServletContextListener interface and provide the\nimplementation of its methods.</p>\n</blockquote>\n<p>Perfeito! Para ilustrar como interagir com os (<em>context</em>) <em>listeners</em>, temos o código abaixo:</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// src/main/java/webapp/MyListener.java</span>\n<span class=\"token keyword\">package</span> <span class=\"token namespace\">webapp</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ServletContextEvent</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ServletContextListener</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">WebListener</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token annotation punctuation\">@WebListener</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyListener</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">ServletContextListener</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">contextInitialized</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ServletContextEvent</span> sce<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Imagine que estamos setando um pool de conexões com o banco de dados\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">contextDestroyed</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ServletContextEvent</span> sce<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Imagine que estamos fechando o pool de conexões com o banco de dados\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Ao iniciar a aplicação, temos:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ mvn tomcat7:run\n[INFO] Scanning for projects...\n(...)\nINFO: Starting Servlet Engine: Apache Tomcat/7.0.47\nImagine que estamos setando um pool de conexões com o banco de dados</code></pre></div>\n<p>E quando finalizamos a aplicação:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Imagine que estamos fechando o pool de conexões com o banco de dados</code></pre></div>\n<p>E além de fechar o <em>pool</em> de conexões, fechamos também a parte de <em>Servlets</em> dessa série. Fica uma clara impressão de\nque grande parte do que precisamos para desenvolver uma plataforma <em>web</em> já é oferecida pela versão atual do\n<em>Java Enterprise Edition</em>.</p>\n<p><a href=\"https://www.caelum.com.br/apostila-java-web/apendice-topicos-da-servlet-api/#context-listener\" title=\"Context Listener\">Leia mais sobre context listener na apostilia de desenvolvimento <em>web</em> em <em>Java</em>, da <em>Caelum</em></a>.</p>\n<h2>Antes de ir: O lado \"agente Smith\" da força</h2>\n<p>E aqui chegamos ao fim dessa nossa saga cobrindo aspectos do <em>Java EE</em>. Ainda que faltem tópicos considerados relevantes, como o\n<a href=\"https://docs.oracle.com/javaee/7/api/javax/ejb/package-summary.html\" title=\"Enterprise JavaBeans\"><em>EJB</em></a>, <a href=\"https://www.oracle.com/technetwork/java/javaee/javaserverfaces-139869.html\" title=\"JavaServer Faces\"><em>JSF</em></a>\nou <a href=\"https://www.oracle.com/technetwork/java/javaee/tech/persistence-jsp-140049.html\" title=\"Java Persistence API\"><em>JPA</em></a>,\ncobrimos outros tantos que fazem parte da especificação.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 740px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3a5585aa415ad19483f8d2da4dfbe857/07f3a/agent-smith.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAgADBP/EABYBAQEBAAAAAAAAAAAAAAAAAAEAAv/aAAwDAQACEAMQAAAB5SGZVlR//8QAHBAAAgEFAQAAAAAAAAAAAAAAAQIDABIhIjEz/9oACAEBAAEFAnl1BzI9zv5ij3//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAZEAACAwEAAAAAAAAAAAAAAAAAAgEQEWH/2gAIAQEABj8CXkGmi3//xAAcEAACAgIDAAAAAAAAAAAAAAAAASExEUFRYaH/2gAIAQEAAT8hzRzydj2iO2Oe0HmNyw//2gAMAwEAAgADAAAAEIg//8QAFREBAQAAAAAAAAAAAAAAAAAAEEH/2gAIAQMBAT8Qh//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EAB0QAQACAgIDAAAAAAAAAAAAAAEAESExcaFBsfD/2gAIAQEAAT8QSxSwVs2mJZbQ8S7bQrgnVe2AEgAa6mXx4n//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Agente Smith em The Matrix\"\n        title=\"Seja a resistência! Lute contra os engravatados (antagonist.wikia.com)\"\n        src=\"/static/3a5585aa415ad19483f8d2da4dfbe857/07f3a/agent-smith.jpg\"\n        srcset=\"/static/3a5585aa415ad19483f8d2da4dfbe857/7809d/agent-smith.jpg 192w,\n/static/3a5585aa415ad19483f8d2da4dfbe857/4ecad/agent-smith.jpg 384w,\n/static/3a5585aa415ad19483f8d2da4dfbe857/07f3a/agent-smith.jpg 740w\"\n        sizes=\"(max-width: 740px) 100vw, 740px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Seja a resistência! Lute contra os engravatados (antagonist.wikia.com)</figcaption>\n  </figure></p>\n<p>Especificação essa que, além de ter como proposta proporcionar tecnologias para um ambiente mais <em>enterprise</em>, possui outras vantagens,\ncomo por exemplo, a premissa de evitar o <em>vendor lock-in</em>.</p>\n<p>Mas ao contrário do que você possa pensar, e do que eu acreditava até pouco tempo atrás, não seguir essas especificações é uma possibilidade.\nDe fato, algumas comunidades vem desafiando essas \"regras\" e apresentando soluções elegantes e inovadoras dentro do ecossistema <em>Java</em> desde\nmuito tempo. <a href=\"https://docs.spring.io/spring/docs/current/spring-framework-reference/overview.html#overview-history\" title=\"History of Spring and the Spring Framework\">Talvez a mais relevante delas sendo a do <em>Spring</em></a>:</p>\n<blockquote>\n<p>Spring came into being in 2003 as a response to the complexity of the early J2EE specifications. While some consider\nJava EE and Spring to be in competition, Spring is, in fact, complementary to Java EE. The Spring programming model\ndoes not embrace the Java EE platform specification; rather, it integrates with carefully selected individual\nspecifications from the EE umbrella.</p>\n</blockquote>\n<p>Inclusive, em um mundo cada vez mais \"microservices-driven\", seguir completamente essas especificações torna-se questionável,\ncomo ilustra <em>Rod Johnson</em> em sua palestra <a href=\"https://www.infoq.com/presentations/principles-successful-frameworks/\" title=\"Assista no InfoQ\"><em>Eighteen Years of Spring</em></a>.</p>\n<p>E é com o <em>Spring</em> que no próximo artigo experimentaremos esse lado \"rebelde\" e, sem dúvida, mais divertido, do desenvolvimento <a href=\"/tag/desenvolvimento-web.html\" title=\"Leia mais sobre web\"><em>web</em></a> com <em>Java</em>.\nMas se você quiser continuar em um ambiente mais <em>enterprise</em>: <a href=\"https://en.wikipedia.org/wiki/GlassFish\" title=\"Open-source application server\"><em>Glassfish</em></a>, <a href=\"https://en.wikipedia.org/wiki/WildFly\" title=\"Antigo JBoss\"><em>WildFly</em></a>\ne <a href=\"https://en.wikipedia.org/wiki/Apache_Geronimo\" title=\"Application server fornecido pela Apache Foundation\"><em>Geronimo</em></a>; podem ser os próximos passos.</p>\n<h2>Considerações finais</h2>\n<p>E mais uma vez, embora possa ser tentador cair na discussão \"Spring x Java EE\", <em>Siva Prasad</em>\ndeixa essa pérola no artigo <a href=\"https://dzone.com/articles/developers-perspective-spring\" title=\"Leia o artigo na íntegra\">\"A developer's perspective on Spring vs. Java EE\"</a>:</p>\n<blockquote>\n<p>As an enthusiastic Java developer I read the Spring vs JavaEE discussions hoping there might be few things which I\ndon't know such as \"in which areas one is better than the other\". But I find 70% of discussions goes on lame\narguments which is not very interesting to me.</p>\n</blockquote>\n<p>Ter uma noção de como funciona a plataforma <em>EE</em> do <em>Java</em> é benéfico, embora eu admita que não seja lá muito divertido.</p>\n<p>Até a próxima.</p>\n<h2>Referências</h2>\n<ul>\n<li><a href=\"https://www.caelum.com.br/apostila-java-web/servlets/\">Caelum: Apostila Java para Desenvolvimento Web - Servlets</a></li>\n<li><a href=\"https://www.concretepage.com/java-ee/jsp-servlet/weblistener-annotation-example-in-servlet-3-with-servletcontextlistener\">ConcretePage: @WebListener Annotation Example in Servlet 3 with ServletContextListener</a></li>\n<li><a href=\"https://www.dineshonjava.com/what-is-dispatcherservlet-in-spring-and-its-uses/\">Dinesh on Java: What is the DispatcherServlet in Spring and its uses?</a></li>\n<li><a href=\"https://dzone.com/articles/developers-perspective-spring\">DZone: A Developer's Perspective on Spring vs. JavaEE</a></li>\n<li><a href=\"https://www.infoq.com/presentations/principles-successful-frameworks/\">InfoQ: Eighteen Years of Spring</a></li>\n<li><a href=\"https://www.javatpoint.com/ServletContextEvent\">JavaTPoint: ServletContextEvent and ServletContextListener</a></li>\n<li><a href=\"https://docs.spring.io/spring/docs/current/spring-framework-reference/overview.html#overview-history\">Spring: Spring Framework Overview</a></li>\n<li><a href=\"https://stackoverflow.com/questions/4720942/difference-between-filter-and-listener-in-servlet-java-ee\">StackOverflow: Difference between Filter and Listener in Servlet (Java EE)</a></li>\n<li><a href=\"https://stackoverflow.com/questions/15774924/just-what-is-java-ee-really\">StackOverflow: Just what is Java EE really?</a></li>\n<li><a href=\"https://stackoverflow.com/questions/9555842/why-servlets-are-not-thread-safe\">StackOverflow: Why Servlets are not thread safe?</a></li>\n</ul>","excerpt":"No post anterior falamos sobre a especificação\nServlet, bem como sobre o uso de JavaServer Pages e Expression Language.\nPara finalizar o…","frontmatter":{"date":"2019-12-10T13:50:00.000Z","title":"Engatinhando em Java para a web - Parte 3","tags":["desenvolvimento-web","java","servlet"],"thumbnail":{"childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAACQElEQVQ4y41Uv2siQRTev0CiFnaptLsy+Cdok5xcGTh/dCLaqXAasBC0MCeiEhDjWYlnTm0VclxlhGhxGGzEKFbigYoWFhp/fLc7l1nmbnfNPVh25r1533zzvjfDgbHD4UA+dszOd7udOGdzWOOUAPf7PQGQSxKs3+9jvV5L8jjIGAuw3W7JfzKZoFgskrHf74dWq8VmsxE3V2RIg263G5VKRfSvVisYjUZkMhloNBoSH41GxxkKTsrIbDaD4zg8PjyI8XA4THw6nQ56vR5Op1NkqHhkCuiw20my6vQUv6ZT4sve3hKf8GWzWdkSKTL8cHmJd3yii/88Dgfxfb6+JmAmkwkGgwHlcpn4WfWlNXxV1udyYXJ2xq/gcH5ygp/Pz/jCs2o0GiS+WCywXC6Va0idFDDAs3rkwb6rVPhxf4+PViu+3d2R2MvLy9t9yPafYJ+urvD15gadpycyDwYCyOVyYp1ZIRRrSBu53W7j/cXF343MH1loGXadnHFy1O28wjab7Q8b/ng0lkwmZet2FFA4jpWvVygUEktAlRdUbTabkt5TBKSJwi3weDxkLFwvKkK320U+nxc3PgpIxRCumFqtRiKRkCyezWaIx+P/f2TKMJVKoVqtknGtVoPX60Wr1SLzSCRCNlV6hWRVrtfr6HQ6SKfTiEajGA6HiMViGI/HhOH09Sq+yZACFgoFWCwWlEolcaGgrs/nQzAYPPpOcnLv4Hw+x2AwkKgsPKq9Xk/yBioC/rsre+nZZqZgcgx/A/f7pgHDe6SfAAAAAElFTkSuQmCC","width":180,"height":180,"src":"/static/e846b900cea0f35a8b8be48ec64b70bf/d8216/java-mascot.png","srcSet":"/static/e846b900cea0f35a8b8be48ec64b70bf/d8216/java-mascot.png 1x"}},"publicURL":"/static/e846b900cea0f35a8b8be48ec64b70bf/java-mascot.png"}},"fields":{"readingTime":{"minutes":8.22},"slug":"/2019/12/10/engatinhando-em-java-web-parte-3.html"}},"site":{"siteMetadata":{"author":{"name":"Klaus Peter Laube","gravatar":"https://en.gravatar.com/userimage/12163112/d3ae0c6239980b01ff1f1730b65c2ebe.jpg"},"siteUrl":"https://klauslaube.com.br"}}},"pageContext":{"slug":"/2019/12/10/engatinhando-em-java-web-parte-3.html"}}}