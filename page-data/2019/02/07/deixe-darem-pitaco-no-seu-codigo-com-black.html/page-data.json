{"componentChunkName":"component---src-templates-blog-post-js","path":"/2019/02/07/deixe-darem-pitaco-no-seu-codigo-com-black.html","result":{"data":{"markdownRemark":{"html":"<p>J√° abordamos <a href=\"/tag/formatters.html\" title=\"Leia mais sobre formatters\"><em>code formatters</em></a> aqui no <em>blog</em>. Para <a href=\"/tag/javascript.html\" title=\"Leia mais sobre Javascript\"><em>Javascript</em></a> temos o <a href=\"/2019/01/12/deixe-darem-pitaco-no-seu-codigo-com-prettier.html\" title=\"Deixe darem pitaco no seu c√≥digo com Prettier\"><em>Prettier</em></a> como solu√ß√£o mais famosa, e h√° de se reconhecer a s√©rie de vantagens no uso da mesma. Acontece que para <a href=\"/tag/python.html\" title=\"Leia mais sobre Python\"><em>Python</em></a> temos algumas ferramentas t√£o interessantes quanto, como o <em>autopep8</em>, <em>yapf</em> e o <em>Black</em>.</p>\n<p>E √© sobre o √∫ltimo que falaremos nesse <em>post</em>.</p>\n<p>Se voc√™ est√° interessado em um comparativo, <em>Kevin Peters</em> escreveu um artigo bem interessante para o <em>Medium</em> chamado <a href=\"https://medium.com/3yourmind/auto-formatters-for-python-8925065f9505\" title=\"Leia o artigo na √≠ntegra\">\"Auto formatters for Python\"</a>.</p>\n<h2>Al√©m do PEP 8</h2>\n<p>A motiva√ß√£o para usar o <em>Black</em> √© a mesma descrita no <em>post</em> sobre <em>Prettier</em>: Reduzir tempo discutindo <em>code style</em>, e deixar com que uma ferramenta tome essa decis√£o pelo time.</p>\n<p>Em <em>Python</em>, o caminho para chegarmos a um consenso √© relativamente menor. Uma das primeiras coisas que aprendi ao iniciar a minha jornada programando com a linguagem foi seguir a <a href=\"https://www.python.org/dev/peps/pep-0008/\" title=\"Style Guide for Python Code\"><em>PEP 8</em></a> religiosamente. Nela est√£o descritas as conven√ß√µes de c√≥digo adotadas oficialmente, como linhas em branco, indenta√ß√£o, nomes, coment√°rios, etc. Qual o motivo de perder tempo pensando em um <em>style guide</em> para o seu projeto se isso j√° foi discutido e formalizado pela comunidade?</p>\n<p>Ferramentas de <em>linting</em> como <a href=\"https://github.com/PyCQA/pycodestyle\" title=\"Simple Python style checker in one Python file\"><em>pycodestyle</em></a> e <a href=\"https://github.com/PyCQA/flake8\" title=\"Flake8 is a wrapper around PyFlakes, pycodestyle and McCabe\"><em>flake8</em></a> s√£o essenciais e muito comuns. S√£o elas que ir√£o te alertar sobre poss√≠veis quebras de estilo de c√≥digo.</p>\n<p>Mas com o <em>Black</em> vamos al√©m...</p>\n<h2>Formatador descompromissado</h2>\n<p>O <em>Black</em> √© um <em>code formatter</em> para <em>Python</em>, de c√≥digo aberto (<a href=\"https://github.com/ambv/black/blob/master/LICENSE\" title=\"The MIT License\"><em>MIT</em></a>), que tem por lema tornar a formata√ß√£o \"transparente\", para que voc√™ possa focar no conte√∫do.</p>\n<p>O time do <em>Black</em> alega que a ferramenta √© \"descompromissada\", mas nem por isso ela deixa de ser pretensiosa. Diretamente do <a href=\"https://github.com/ambv/black/\" title=\"Black no Github\">reposit√≥rio no <em>Github</em></a>:</p>\n<blockquote>\n<p>By using it, you agree to cede control over minutiae of hand-formatting. In return, Black gives you speed, determinism, and freedom from pycodestyle nagging about formatting. You will save time and mental energy for more important matters.</p>\n</blockquote>\n<p>Em outras palavras, a ferramenta segue as recomenda√ß√µes da <em>PEP 8</em> e formata seu c√≥digo automaticamente. Na verdade, o <em>coding style</em> utilizado √© um <em>subset</em> da <em>PEP 8</em>, logo, algumas regras s√£o \"manipuladas\" (como <a href=\"https://github.com/ambv/black#line-length\" title=\"Leia na documenta√ß√£o do Black\"><em>line-length</em></a> e <a href=\"https://github.com/ambv/black#strings\" title=\"Leia na documenta√ß√£o do Black\">aspas ao inv√©s de ap√≥strofos</a>) de acordo com decis√µes tomadas pelo time de desenvolvedores da ferramenta.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 730px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/28e5a4cc6f236ae0d0858493fb3888a9/1a144/black-walter.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAABAACBf/EABYBAQEBAAAAAAAAAAAAAAAAAAEAAv/aAAwDAQACEAMQAAABCrk6cphUf//EABgQAQEBAQEAAAAAAAAAAAAAAAIBAwAT/9oACAEBAAEFAlSKMzyGct1dvvpyad//xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAwEBPwGI/8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQIBAT8BV//EABsQAAICAwEAAAAAAAAAAAAAAAABAhESE0Ey/9oACAEBAAY/AsdKE9ad8OluR7ZcnbP/xAAbEAEAAgIDAAAAAAAAAAAAAAABAFERIRBBgf/aAAgBAQABPyHdTTceI4+JiuBZqDkKd8JntsZ//9oADAMBAAIAAwAAABDA/wD/xAAXEQADAQAAAAAAAAAAAAAAAAAAARFR/9oACAEDAQE/EE8hen//xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAgEBPxBY/8QAGxABAQEAAgMAAAAAAAAAAAAAAREAITFBYYH/2gAIAQEAAT8QcpY0L3MOqydSnhv3IKJxARvtxF6gplWtAnjKFrh7N//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"&quot;Foto do filme A Vida Secreta de Walter Mitty&quot;\"\n        title=\"Pare de perder tempo discutindo conven√ß√£o de c√≥digo no code review e v√° viver sua vida, como o Walter fez (gq.co.za)\"\n        src=\"/static/28e5a4cc6f236ae0d0858493fb3888a9/1a144/black-walter.jpg\"\n        srcset=\"/static/28e5a4cc6f236ae0d0858493fb3888a9/7809d/black-walter.jpg 192w,\n/static/28e5a4cc6f236ae0d0858493fb3888a9/4ecad/black-walter.jpg 384w,\n/static/28e5a4cc6f236ae0d0858493fb3888a9/1a144/black-walter.jpg 730w\"\n        sizes=\"(max-width: 730px) 100vw, 730px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Pare de perder tempo discutindo conven√ß√£o de c√≥digo no code review e v√° viver sua vida, como o Walter fez (gq.co.za)</figcaption>\n  </figure></p>\n<p>Caso voc√™ n√£o concorde com algumas liberdades que a ferramenta toma, √© poss√≠vel customizar algumas regras adotadas pelo editor. Por exemplo, se voc√™ √© um usu√°rio ass√≠duo de <em>single quotes</em> e n√£o concorda com o uso de <em>double quotes</em>, pode executar o utilit√°rio com o argumento <code class=\"language-text\">--skip-string-normalization</code>. Na humilde opini√£o de quem vos escreve, se voc√™ se pegar usando o <em>Black</em> com muitas exce√ß√µes, talvez valha a pena procurar outra ferramenta de <em>formatting</em>, como os pr√≥prios desenvolvedores sugerem:</p>\n<blockquote>\n<p>Pro-tip: If you're asking yourself \"Do I need to configure anything?\" the answer is \"No\". Black is all about sensible defaults.</p>\n</blockquote>\n<h2>No terminal</h2>\n<p>Mas chega de papo, vamos ao que interessa:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ pip install black</code></pre></div>\n<p>Como qualquer biblioteca <em>Python</em>, instalamos o <em>Black</em> atrav√©s do utilit√°rio <code class=\"language-text\">pip</code>. Na sequ√™ncia, basta execut√°-lo apontando qual arquivo voc√™ pretende formatar.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ black test.py\nreformatted test.py\nAll done! ‚ú® üç∞ ‚ú®\n1 file reformatted.</code></pre></div>\n<p>Tamb√©m √© poss√≠vel passar um diret√≥rio como argumento:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ black plugins/\nreformatted /Users/klaus/Workspace/blog/plugins/global_license.py\nreformatted /Users/klaus/Workspace/blog/plugins/slideshare.py\nAll done! ‚ú® üç∞ ‚ú®\n2 files reformatted, 4 files left unchanged.</code></pre></div>\n<p>N√£o estranhe se a simp√°tica fatia de bolo acima abrir o seu apetite.</p>\n<p>Customiza√ß√µes, embora possam ser chamadas atrav√©s de par√¢metros de linha de comando, tamb√©m podem ser armazenadas no <code class=\"language-text\">pyproject.toml</code> do seu projeto, como ilustra a <a href=\"https://github.com/ambv/black#pyprojecttoml\" title=\"Leia mais na documenta√ß√£o do Black\">documenta√ß√£o oficial</a>.</p>\n<h2>No editor</h2>\n<p>Mas o melhor mesmo √© ter o <em>Black</em> dispon√≠vel no seu editor, deixando-o trabalhar em tempo de escrita de c√≥digo.</p>\n<p>H√° uma vasta op√ß√£o de <a href=\"https://github.com/ambv/black#editor-integration\" title=\"Editor integration\">editores que suportam o <em>Black</em></a>. Para o <a href=\"/tag/vim.html\" title=\"Leia mais sobre o Vim\"><em>Vim</em></a>, continuo com a opini√£o do artigo <a href=\"/2017/10/15/vim-para-desenvolvimento-python.html\" title=\"Leia o artigo na √≠ntegra\">\"Vim para desenvolvimento Python\"</a> e recomendo a utiliza√ß√£o do <a href=\"https://github.com/w0rp/ale\" title=\"Asynchronous Lint Engine for Vim\"><em>ALE</em></a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"vim\"><pre class=\"language-vim\"><code class=\"language-vim\"><span class=\"token comment\">\" ~/.vimrc</span>\n\nPlug <span class=\"token string\">'w0rp/ale'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token string\">'do'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'pip install black'</span> <span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">call</span> plug#<span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">let</span> g<span class=\"token punctuation\">:</span>ale_fix_on_save <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n<span class=\"token keyword\">let</span> g<span class=\"token punctuation\">:</span>ale_fixers <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n\\   <span class=\"token string\">'python'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n\\       <span class=\"token string\">'black'</span><span class=\"token punctuation\">,</span>\n\\       <span class=\"token string\">'remove_trailing_lines'</span><span class=\"token punctuation\">,</span>\n\\       <span class=\"token string\">'trim_whitespace'</span>\n\\   <span class=\"token punctuation\">]</span>\n\\<span class=\"token punctuation\">}</span></code></pre></div>\n<p>J√° para o <a href=\"/tag/vscode.html\" title=\"Leia mais sobre VS Code\"><em>VS Code</em></a>, com o <a href=\"https://marketplace.visualstudio.com/items?itemName=ms-python.python\" title=\"Python extension for Visual Studio Code\"><em>plugin</em> oficial para <em>Python</em></a>, podemos configur√°-lo como ferramenta de <em>formatting</em>:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"python.formatting.blackPath\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"black\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"python.formatting.provider\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"black\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>Em todo lugar</h2>\n<p>Outra op√ß√£o que deveria ser adotada, independente da utiliza√ß√£o do <em>Black</em> no editor, √© o uso de <em>commit hooks</em> para formatar arquivos alterados controlados via <em>git</em>. Volto a recomendar o <a href=\"https://pre-commit.com/\" title=\"A framework for managing and maintaining multi-language pre-commit hooks\"><em>pre-commit</em></a> como ferramenta, e a boa not√≠cia √© que existe um <em>hook</em> com <em>Black</em> configurado e prontinho para uso:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">repos</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">repo</span><span class=\"token punctuation\">:</span> https<span class=\"token punctuation\">:</span>//github.com/ambv/black\n<span class=\"token key atrule\">rev</span><span class=\"token punctuation\">:</span> stable\n<span class=\"token key atrule\">hooks</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> black\n    <span class=\"token key atrule\">language_version</span><span class=\"token punctuation\">:</span> python3.7</code></pre></div>\n<h2>Considera√ß√µes finais</h2>\n<p>√â impressionante a quantidade de tempo e atrito que economizamos quando adotamos uma ferramenta como <em>Black</em> ou <em>yapf</em>. Discuss√µes relacionadas a <em>style guide</em> praticamente inexistem, e os <em>code reviews</em> s√£o mais focados no problema e na qualidade do c√≥digo, do que com conven√ß√µes.</p>\n<p>J√° tive experi√™ncias ruins com <em>formatters</em> em <em>Python</em>, √© verdade. Nem todo time ou projeto se adapta bem com esse tipo de \"ferramenta impositiva\", e embora os pontos positivos sejam √≥bvios, √© na pr√°tica que voc√™ ver√° os negativos. Mas n√£o me vejo mais deixando de ter esse tipo de aux√≠lio enquanto escrevo c√≥digo.</p>\n<p>√â tamb√©m uma forma de pensarmos na experi√™ncia dos outros desenvolvedores, que se juntar√£o ao projeto durante o seu ciclo de vida.</p>\n<p>At√© a pr√≥xima.</p>\n<h2>Refer√™ncias</h2>\n<ul>\n<li><a href=\"https://black.readthedocs.io/en/stable/\">Black - The uncompromising code formatter</a></li>\n<li><a href=\"https://www.mattlayman.com/blog/2018/python-code-black/\">Matt Leyman - Consistent Python code with Black</a></li>\n<li><a href=\"https://code.visualstudio.com/docs/python/editing#_formatting\">Visual Studio Code - Editing Python code in VS Code</a></li>\n</ul>","excerpt":"J√° abordamos code formatters aqui no blog. Para Javascript temos o Prettier como solu√ß√£o mais famosa, e h√° de se reconhecer a s√©rie de‚Ä¶","frontmatter":{"date":"2019-02-07T14:20:00.000Z","title":"Deixe darem pitaco no seu c√≥digo com Black","tags":["formatters","editores","black","python","vscode","vim"],"thumbnail":{"childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAABwElEQVQ4y+1Uv6tBYRg+g+z8ASYDJeVHkmQwIBkoi0UyiWRScgabjCgZZDOJweLczaSUshNCiYGdwnPv99U59zt+dG/du9371tNX53vf53uf98fh8MvG/XHC2+0mnSKu16sM7B3rKxHeX4pBX9m9r8jDvXrpdDpht9thOp1iNpvRcz6fY7/f43w+y4hZDo6VSmyz2aDf76Ner6NWq1HwPI9CoYBisYhSqYRKpYJer4flcvlQLpnkwWCAZDKJWCwGPp+nZIQ4Ho8jEokgGAwiFAohEAhQpFIpvL0JcsmkDsS22y1cLhfMZjMNFgQB1WoV6XQa2WwWdrsder0eBoMBOp0OuVwO0WiU+q/Xa8pBuCTC1WoFq9WKcDgMr9eLbreLRCKB0WiE/Ee25XIZzWaTys5kMlQNyVKr1WKxWHwSspLb7TaVZLFYoNFo4HQ64XA4aHY+nw9utxs2m41m6vf74fF40Gg0ZHV8aArJiEg0mUxQqVRQKpXgOI5CoVBArVbDaDTSUgyHw+dNeTY2x+MRk8mESm+1WhSdTgfj8RiHw+H12Nx/uFwu3xpsYqyv1OVXL4mrRoJYsCv4dPX+/4c/tnfEE6AxciWM9QAAAABJRU5ErkJggg==","width":180,"height":180,"src":"/static/efef2e294b583b3b287726d761b15251/d8216/black-logo.png","srcSet":"/static/efef2e294b583b3b287726d761b15251/d8216/black-logo.png 1x"}},"publicURL":"/static/efef2e294b583b3b287726d761b15251/black-logo.png"}},"fields":{"readingTime":{"minutes":5.25},"slug":"/2019/02/07/deixe-darem-pitaco-no-seu-codigo-com-black.html"}},"site":{"siteMetadata":{"author":{"name":"Klaus Peter Laube","gravatar":"https://en.gravatar.com/userimage/12163112/d3ae0c6239980b01ff1f1730b65c2ebe.jpg"},"siteUrl":"https://klauslaube.com.br"}}},"pageContext":{"slug":"/2019/02/07/deixe-darem-pitaco-no-seu-codigo-com-black.html"}},"staticQueryHashes":["2831923220","4114525740"]}