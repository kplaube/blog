{"componentChunkName":"component---src-templates-blog-post-js","path":"/2019/05/24/lsp-e-o-pyls.html","result":{"data":{"markdownRemark":{"html":"<p>Uma das virtudes do <a href=\"/tag/vscode.html\" title=\"Leia mais sobre o editor\"><em>VS Code</em></a> é como ele integra-se facilmente com diferentes linguagens.\nO esforço é pequeno, geralmente resumindo-se à instalação de um único <em>plugin</em>. Essa característica o torna uma ferramenta extremamente\nprodutiva, e que vem conquistando o coração dos desenvolvedores ao redor do mundo.</p>\n<p>O curioso é que o <em>VS Code</em> utiliza um protocolo aberto para ter esse \"jeitão\" de <em>IDE</em>, chamado <em>Language Server Protocol</em>,\nque entre outras funcionalidades traz ao editor a possibilidade de <em>autocomplete</em>, <em>go to definition</em>, <em>diagnosis</em> e <em>documentation</em>.</p>\n<p>É... <em>Microsoft</em> popularizando protocolos abertos. Tempos interessantes esses que vivemos, não?</p>\n<h2>LSP - Language Server Protocol</h2>\n<p>Durante o desenvolvimento do <em>VS Code</em>, a <em>Microsoft</em> introduziu o <a href=\"https://microsoft.github.io/language-server-protocol/\" title=\"Leia na página oficial do projeto\"><em>Language Server Protocol</em></a>.\nO <a href=\"https://langserver.org/\" title=\"A community-driven source of knowledge for Language Server Protocol implementations\">langserver.org</a> o define da seguinte forma:</p>\n<blockquote>\n<p>The Language Server protocol is used between a tool (the client) and a language smartness provider (the server) to integrate\nfeatures like auto complete, go to definition, find all references and alike into the tool.</p>\n</blockquote>\n<p>Em outras palavras, é um <a href=\"https://microsoft.github.io/language-server-protocol/specification\" title=\"Leia a especificação completa\">protocolo</a> que descreve\na comunicação entre um cliente (um editor de textos, por exemplo) e um servidor (ligado à uma determinada linguagem), com a motivação de proporcionar e enriquecer\nferramentas de desenvolvimento.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/df33db8630f02f86d5ccbf4b680a3164/6aca1/vim-lsp.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 45.3125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAJABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAECAwX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHutUZlh//EABYQAQEBAAAAAAAAAAAAAAAAABACMf/aAAgBAQABBQInH//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABYQAAMAAAAAAAAAAAAAAAAAABAgIf/aAAgBAQAGPwIVP//EABwQAAICAgMAAAAAAAAAAAAAAAERADEQIUFR8P/aAAgBAQABPyH1Rl1ruOSY3zBn/9oADAMBAAIAAwAAABATD//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABsQAQACAgMAAAAAAAAAAAAAAAEAMRBBEXHh/9oACAEBAAE/ENHiUk9kfJBEaSxGsf/Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Ilustração de como funciona a comunicação entre cliente e servidor (kieranbamforth.me)\"\n        title=\"Ilustração de como funciona a comunicação entre cliente e servidor (kieranbamforth.me)\"\n        src=\"/static/df33db8630f02f86d5ccbf4b680a3164/6aca1/vim-lsp.jpg\"\n        srcset=\"/static/df33db8630f02f86d5ccbf4b680a3164/7809d/vim-lsp.jpg 192w,\n/static/df33db8630f02f86d5ccbf4b680a3164/4ecad/vim-lsp.jpg 384w,\n/static/df33db8630f02f86d5ccbf4b680a3164/6aca1/vim-lsp.jpg 650w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Ilustração de como funciona a comunicação entre cliente e servidor (kieranbamforth.me)</figcaption>\n  </figure></p>\n<p>Ou seja, podemos ter uma solução única para <a href=\"/tag/python.html\" title=\"Leia mais sobre Python\"><em>Python</em></a>, que traga as mesmas funcionalidades para diferentes\neditores ou <em>IDEs</em>. Em contrapartida, podemos ter um único editor que suporte diferentes linguagens e tais funcionalidades avançadas.\nO <em>langserver.org</em> chama esse problema de \"The Matrix Problem\":</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 740px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1c782901e02af07ed2b0824bf19b1e38/50383/lsp-the-matrix-problem.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 20.833333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAjUlEQVQI132NwQ7DIAxD+f9P3GWioqChAWqhUCBhs4oq7TQfIr9gB3FcstZKKbXWxpiUEjbnLaD3Xi5yXVcElFLOuXRgHUVrrdaKiQIMHlD43IIfY8CE5My+lFJqq8B3fKntKUIIRIQEM885zSzjfs4ZxkWLdM6lnAVody3DQ+C3P2W6BCKmzv0He+f2Bfio5vTEkYtPAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Com LSP, temos Go funcionando para diferentes editores, seguindo os mesmos princípios (langserver.org)\"\n        title=\"Com LSP, temos Go funcionando para diferentes editores, seguindo os mesmos princípios (langserver.org)\"\n        src=\"/static/1c782901e02af07ed2b0824bf19b1e38/50383/lsp-the-matrix-problem.png\"\n        srcset=\"/static/1c782901e02af07ed2b0824bf19b1e38/8514f/lsp-the-matrix-problem.png 192w,\n/static/1c782901e02af07ed2b0824bf19b1e38/804b2/lsp-the-matrix-problem.png 384w,\n/static/1c782901e02af07ed2b0824bf19b1e38/50383/lsp-the-matrix-problem.png 740w\"\n        sizes=\"(max-width: 740px) 100vw, 740px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Com LSP, temos Go funcionando para diferentes editores, seguindo os mesmos princípios (langserver.org)</figcaption>\n  </figure></p>\n<p>Como afirma o site oficial do projeto:</p>\n<blockquote>\n<p>LSP is a win for both language providers and tooling vendors!</p>\n</blockquote>\n<h2>Como funciona?</h2>\n<p>Na prática, o que acontece é uma comunicação inter-processos entre o <em>language server</em> e a ferramenta de desenvolvimento. O protocolo utilizado para tal operação é o <em>JSON-RPC</em>,\num protocolo simples, e com um formato de dados extremamente popular.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 740px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c9ad9f156d904ad0aa69f1e894ffcf4b/50383/language-server-sequence.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAABYlAAAWJQFJUiTwAAABVklEQVQY00WQz07DMAzG+7YckXgAHoYDEly4AheuiCtI/N2E1qVNnKRNmsRJ2nTD3RBYlmJb+vz9nKrMu/1+f/3ETy5eKe9fJLU0stauVqv1eg0A01RoWGs8vXw7u/o4v/nM00yTqpTleW+Gu2d5+6LXwuUUMSaMkQuxZcx5H1PKObs4Pbx1tP3xqy/zQdx1HUjpjM452ZB0b763vG5h04iaAwO95WrTwKaFzrqxTENcKI5RIaJzbhicT2OjPQcpVCekpmw4NEJK3YMig461QlvssRCI9yGlVP2tyWUnh7xtgawaoRhXVLNWUt0I8peMSxvGzo9aSTqHc74413WtpCQx2Dj4yJVhBzFpFiVoJnQL2jh0sfRhOv7oL7YxhsAxTzbOiJGDIvhWSMIm1OMJ1MY8pmln8CA+RBWOQUfEbGNxAY0LQ1gQrMPBowuJkmpMYxxni//OP5sDvnzeTnatAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Exemplo de como funciona a comunicação entre cliente e servidor (microsoft.github.io)\"\n        title=\"Exemplo de como funciona a comunicação entre cliente e servidor (microsoft.github.io)\"\n        src=\"/static/c9ad9f156d904ad0aa69f1e894ffcf4b/50383/language-server-sequence.png\"\n        srcset=\"/static/c9ad9f156d904ad0aa69f1e894ffcf4b/8514f/language-server-sequence.png 192w,\n/static/c9ad9f156d904ad0aa69f1e894ffcf4b/804b2/language-server-sequence.png 384w,\n/static/c9ad9f156d904ad0aa69f1e894ffcf4b/50383/language-server-sequence.png 740w\"\n        sizes=\"(max-width: 740px) 100vw, 740px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Exemplo de como funciona a comunicação entre cliente e servidor (microsoft.github.io)</figcaption>\n  </figure></p>\n<p>Nem toda linguagem pode suportar todas as funcionalidade definidas pelo protocolo (o mesmo vale para as ferramentas de desenvolvimento), mas isso não impede a sua adoção.\nO protocolo permite que tanto cliente como servidor \"anunciem\" suas capacidades, portanto, as duas pontas podem ter um comportamento preventivo quando determinada capacidade\n(como <em>go to definition</em>) não é suportada.</p>\n<h2>PyLS - Python Language Server</h2>\n<p>Para <em>Python</em>, além do <em>language server</em> implementado pela própria <em>Microsoft</em> e <a href=\"https://github.com/microsoft/python-language-server\" title=\"Repositório do Microsoft Python Language Server\">usado no <em>VS Code</em></a>,\ntemos o <a href=\"https://github.com/palantir/python-language-server\" title=\"Repositório do projeto\"><em>Python Language Server</em></a>. Ele conta com as seguintes funcionalidades:</p>\n<ul>\n<li><em>Auto completion</em></li>\n<li><em>Code linting</em></li>\n<li><em>Signature help</em></li>\n<li><em>Go to definition</em></li>\n<li><em>Hover</em></li>\n<li><em>Find references</em></li>\n<li><em>Document symbols</em></li>\n<li><em>Document formatting</em></li>\n</ul>\n<p>O que acho mais interessante em relação ao projeto é que ele não reinventa a roda. Por exemplo, ele não implementa uma nova ferramenta de <em>linting</em>, pelo contrário, ele utiliza ferramentas\nque já são bem conhecidas pela comunidade:</p>\n<ul>\n<li><em>Auto completion</em>, <em>definitions</em>, <em>hover</em>, <em>references</em>, <em>signature help</em> e <em>symbols</em> são resolvidos via <a href=\"https://github.com/davidhalter/jedi\" title=\"Awesome completion and static analysis for Python\"><em>Jedi</em></a></li>\n<li><em>Auto completion</em> e <em>renaming</em> é resolvido via <a href=\"https://github.com/python-rope/rope\" title=\"Python refactoring library\"><em>Rope</em></a></li>\n<li><em>Linting</em> é resolvido via <a href=\"https://github.com/PyCQA/mccabe\" title=\"McCabe complexity checker\"><em>McCabe</em></a>,\n<a href=\"https://github.com/PyCQA/pyflakes\" title=\"Checks Python source files for errors\"><em>Pyflakes</em></a>, <a href=\"https://github.com/pycqa/pycodestyle\" title=\"Python style checker\"><em>pycodestyle</em></a>\ne <a href=\"https://github.com/PyCQA/pydocstyle\" title=\"Docstring style checker\"><em>pydocstyle</em></a></li>\n<li><em>Formatting</em> é resolvido via <a href=\"https://github.com/hhatto/autopep8\" title=\"Formats Python code to PEP 8\"><em>autopep8</em></a>\ne <a href=\"https://github.com/google/yapf\" title=\"A formatter for Python files\"><em>YAPF</em></a></li>\n</ul>\n<p>Há um certo grau de customização, como por exemplo usar o <a href=\"/2019/02/07/deixe-darem-pitaco-no-seu-codigo-com-black.html\" title=\"Leia mais sobre Black\"><em>Black</em></a> ao invés de <em>YAPF</em>. Discutiremos\nmais sobre esse tópico a seguir.</p>\n<h2>Clientes LSP</h2>\n<p>Segundo o <em>langserver.org</em>, os principais <em>IDEs</em> e editores já possuem alguma forma de cliente implementado. Seja através de extensões (como <em>JetBrains IDE</em>, <a href=\"/tag/vim.html\" title=\"Leia mais sobre Vim\"><em>Vim</em></a>,\n<em>Sublime</em>, <em>Atom</em> e <em>Emacs</em>), ou através de suporte <em>built-in</em> (como <em>VS Code</em> e <em>Oni</em>).</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 740px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/86cf2a69117e22c87b361033b5154429/07f3a/lsp-one-ring.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAECBP/EABUBAQEAAAAAAAAAAAAAAAAAAAAD/9oADAMBAAIQAxAAAAHDac6SaA//xAAaEAADAQADAAAAAAAAAAAAAAAAARECAxMi/9oACAEBAAEFAuPxqNnUhoy47T//xAAVEQEBAAAAAAAAAAAAAAAAAAAQEf/aAAgBAwEBPwGH/8QAFhEAAwAAAAAAAAAAAAAAAAAAARAR/9oACAECAQE/AaV//8QAGRAAAgMBAAAAAAAAAAAAAAAAABEBEDFh/9oACAEBAAY/AtFDXDbZ/8QAGxAAAgIDAQAAAAAAAAAAAAAAAAERITFBYVH/2gAIAQEAAT8hyFF9LaHB+lCZlUzp2bSP/9oADAMBAAIAAwAAABCTD//EABYRAQEBAAAAAAAAAAAAAAAAAAARAf/aAAgBAwEBPxCEx//EABcRAAMBAAAAAAAAAAAAAAAAAAABEVH/2gAIAQIBAT8QwZWf/8QAGxABAAMAAwEAAAAAAAAAAAAAAQARITFBUZH/2gAIAQEAAT8QBuoRQJTAWwLeHN68dS1qvGrmpKZk6zA8B+EyoW+T/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"O Um Anel\"\n        title=\"Sauron faz um anel para juntar a todos. Sem querer comparar Microsoft com Sauron, mas espero que isso não acabe em uma guerra (lego-lord-of-the-rings.wikia.com)\"\n        src=\"/static/86cf2a69117e22c87b361033b5154429/07f3a/lsp-one-ring.jpg\"\n        srcset=\"/static/86cf2a69117e22c87b361033b5154429/7809d/lsp-one-ring.jpg 192w,\n/static/86cf2a69117e22c87b361033b5154429/4ecad/lsp-one-ring.jpg 384w,\n/static/86cf2a69117e22c87b361033b5154429/07f3a/lsp-one-ring.jpg 740w\"\n        sizes=\"(max-width: 740px) 100vw, 740px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Sauron faz um anel para juntar a todos. Sem querer comparar Microsoft com Sauron, mas espero que isso não acabe em uma guerra (lego-lord-of-the-rings.wikia.com)</figcaption>\n  </figure></p>\n<p>Para <em>Vim</em>, uma opção que tenho usado com sucesso é o <a href=\"https://github.com/autozimu/LanguageClient-neovim\" title=\"Repositório oficial do projeto\"><em>LanguageClient-neovim</em></a>, que embora possa parecer\nexclusivo para o <em>Neovim</em>, possui suporte para <em>Vim 8.x</em>.</p>\n<h2>Na prática</h2>\n<h3>Configurando o servidor</h3>\n<p>Vamos para um exemplo prático de como usar <em>LSP</em> e <em>Vim</em> com <em>Python</em>. Mas antes, deixa eu definir algumas <em>constraints</em> do meu ambiente de desenvolvimento:</p>\n<ul>\n<li>Quero utilizar <em>flake8</em> ao invés de <em>pycodestyle</em>;</li>\n<li>Quero utilizar <em>Black</em> ao invés de <em>YAPF</em> ou <em>autopep8</em>;</li>\n<li>Quero utilizar <em>isort</em> como uma das opções de formatação.</li>\n</ul>\n<p>Para começar, vamos instalar o <em>language server</em>. Eu prefiro tê-lo dentro do <a href=\"/tag/virtualenv.html\" title=\"Leia mais sobre Virtualenv\">ambiente virtual</a> do projeto em que estou trabalhando. É trabalhoso\ne repetitivo se você estiver trabalhando em diferentes projetos e <em>virtualenvs</em>!\nUma alternativa mais prática é tê-lo instalado em uma instância global do <a href=\"/2016/04/26/o-simples-e-poderoso-pyenv.html\" title=\"O simples e poderoso Pyenv\"><em>pyenv</em></a>. Fica a seu critério o destino\nda instalação:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ pip install python-language-server</code></pre></div>\n<p>O próprio servidor identificará quais ferramentas você tem instaladas e habilitará determinada capacidade proporcionada por tal ferramenta (por exemplo, se o <em>Rope</em> estiver instalado,\nserá capaz de fazer <em>renaming</em>). Mas dentre elas o <em>Jedi</em> é fundamental, e por isso é instalada automaticamente como dependência do <em>PyLS</em>.</p>\n<p>Nesse momento temos grande parte das funcionalidades cobertas pelo <em>LSP</em> habilitadas pelo servidor. Uma muito útil, que ainda está faltando, é o <em>renaming</em>. Segundo a lista acima, conseguimos\ntal capacidade ao instalar o <em>Rope</em>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ pip install 'python-language-server[rope]'</code></pre></div>\n<p>Se você está interessado em utilizar a configuração padrão do <em>python-language-server</em>, uma opção mais prática é instalar todos os <em>providers</em> de uma só vez:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ pip install 'python-language-server[all]'</code></pre></div>\n<p>Para fins didáticos estamos resolvendo as dependências manualmente. Há uma outra forma de gerenciar quais <em>providers</em> serão utilizados, que discutiremos a seguir.</p>\n<p>Para termos o <em>isort</em> e o <em>Black</em> habilitados como ferramentas de formatação, precisaremos recorrer à <em>plugins</em> de terceiros:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ pip install pyls-isort pyls-black</code></pre></div>\n<p>Infelizmente, o <code class=\"language-text\">pyls-black</code> exige que você não tenha o <code class=\"language-text\">autopep8</code> instalado para funcionar. Como não há um controle manual para decidir qual será usado,\na melhor forma é garantindo que apenas uma das duas extensões esteja instalada.</p>\n<p>Temos tudo o que é necessário para o lado do servidor.</p>\n<h3>Configurando o cliente</h3>\n<p>A melhor forma de instalarmos o <em>LanguageClient-neovim</em> é através do utilitário <code class=\"language-text\">Plug</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"vim\"><pre class=\"language-vim\"><code class=\"language-vim\"><span class=\"token comment\">\" ~/.vimrc</span>\n\nPlug <span class=\"token string\">'autozimu/LanguageClient-neovim'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    \\ <span class=\"token string\">'branch'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'next'</span><span class=\"token punctuation\">,</span>\n    \\ <span class=\"token string\">'do'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'bash install.sh'</span><span class=\"token punctuation\">,</span>\n    \\ <span class=\"token punctuation\">}</span>\n\nPlug <span class=\"token string\">'junegunn/fzf'</span></code></pre></div>\n<p>Ele funciona muito bem com o <a href=\"https://github.com/junegunn/fzf.vim\" title=\"Veja o repositório oficial do projeto\"><em>fzf</em></a>, portanto, é uma boa pedida termos os dois disponíveis.</p>\n<p>O próximo passo é informar ao cliente como encontrar o servidor da linguagem:</p>\n<div class=\"gatsby-highlight\" data-language=\"vim\"><pre class=\"language-vim\"><code class=\"language-vim\"><span class=\"token comment\">\" ~/.vimrc</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token operator\">.</span><span class=\"token operator\">.</span><span class=\"token operator\">.</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">let</span> g<span class=\"token punctuation\">:</span>LanguageClient_serverCommands <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    \\ <span class=\"token string\">'python'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'pyls'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    \\ <span class=\"token punctuation\">}</span></code></pre></div>\n<p>Ainda precisamos dizer ao <em>LSP</em> sobre as nossas preferências. O arquivo abaixo está situado na raíz do projeto que estou trabalhando,\nmais especificamente em <code class=\"language-text\">./.vim/settings.json</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"pyls\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"configurationSources\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"flake8\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"plugins\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"yapf\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"enabled\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Para fins didáticos adicionei o <code class=\"language-text\">yapf</code> à configuração. Alguns <em>plugins</em> possuem a flexibilidade de mesmo que instalados, poderem ser desabilitados.</p>\n<p>Pronto! O cliente está configurado, e com os seguintes comandos você pode explorar todas as funcionalidades do <em>LSP</em>:</p>\n<ul>\n<li><code class=\"language-text\">Ctrl+x Ctrl+o</code>: <em>Auto completion</em> via <em>Omni completion</em> (o <a href=\"https://github.com/Shougo/deoplete.nvim\" title=\"Dark powered asynchronous completion framework for neovim/Vim8\"><em>Deoplete</em></a> é uma boa pedida)</li>\n<li><code class=\"language-text\">:call LanguageClient#textDocument_definition()</code>: <em>Go to definition</em></li>\n<li><code class=\"language-text\">:call LanguageClient#textDocument_hover()</code>: <em>Hover</em></li>\n<li><code class=\"language-text\">:call LanguageClient#textDocument_references()</code>: <em>References</em></li>\n<li><code class=\"language-text\">:call LanguageClient#textDocument_documentSymbol()</code>: Lista de <em>Symbols</em></li>\n<li><code class=\"language-text\">:call LanguageClient#textDocument_rename()</code>: <em>Renaming</em></li>\n<li><code class=\"language-text\">:call LanguageClient#textDocument_formatting()</code>: <em>Formatting</em></li>\n<li><code class=\"language-text\">:call :call LanguageClient_contextMenu()</code>: Menu de contexto mostrando todas as opções disponíveis</li>\n</ul>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b71dd9238b6c9316981247af00919559/6af66/vim-lsp-autocomplete.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.8125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAABaklEQVQoz5WQ2U6DUBCGeROr0I3Ssp59A0o5IAW7JqYxMd73wus+vXQxGm0TTb5M5uL/zswZ43n7Us4bHmupNKUKIY6IwEQem0/gBQa/+iMGcVMaTR2Pmb3wwfLvTa/TcTp3I6vrW73APNVbGCmu5vmq1MsY5FwWQhaqXCfNjvA8BEqoMohkfwiGI/QbQ6VzXS6LYjnLmqJa57On5nW/eT+IpFJxyYSOkCJcTVzaPjGw4XcMwrRQRQQSTDPbwWY36Fp+1/KGNjw/P7g08Id5lCHO1pvdeELuzUlvEHKZT1wy9ljfvpL+KTM4q+tVGFJ7FAUhXSy3lCWeT08Dv0WvTvY82dSbXNeYJq5Pq/lqmj0CoAibtci45EJDlEDMABLnX3zJlGi5qCBJev2oHRWEsk3YDjqfp639YVtvrO25MookpVPKNcISIHYrek0Oknp/yNZvCAgRHw/+D9l2CI4rripCUsLSduE/mi0fnGKT16MFjt0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Exemplo do LSP funcionando com o Vim\"\n        title=\"Exemplo do LSP funcionando com o Vim\"\n        src=\"/static/b71dd9238b6c9316981247af00919559/6af66/vim-lsp-autocomplete.png\"\n        srcset=\"/static/b71dd9238b6c9316981247af00919559/8514f/vim-lsp-autocomplete.png 192w,\n/static/b71dd9238b6c9316981247af00919559/804b2/vim-lsp-autocomplete.png 384w,\n/static/b71dd9238b6c9316981247af00919559/6af66/vim-lsp-autocomplete.png 640w\"\n        sizes=\"(max-width: 640px) 100vw, 640px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Exemplo do LSP funcionando com o Vim</figcaption>\n  </figure></p>\n<p>Agora é só configurar os <em>key bindings</em> e correr para o abraço :)</p>\n<h2>Referências</h2>\n<ul>\n<li><a href=\"https://www.kieranbamforth.me/blog/vim-lsp.html\">kieranbamforth.me - Vim + Language Server Protocol—in 2019</a></li>\n<li><a href=\"https://langserver.org/\">Langserver.org - A community-driven source of knowledge</a></li>\n<li><a href=\"https://microsoft.github.io/language-server-protocol/\">Language Server Protocol official page</a></li>\n<li><a href=\"https://www.thisisvini.com/vim-better-go-to-definition-completion/\">This is Vini - Vim: Better \"Go to definition\" and completion using ALE</a></li>\n<li><a href=\"https://en.wikipedia.org/wiki/JSON-RPC\">Wikipedia - JSON-RPC</a></li>\n</ul>","excerpt":"Uma das virtudes do VS Code é como ele integra-se facilmente com diferentes linguagens.\nO esforço é pequeno, geralmente resumindo-se à…","frontmatter":{"date":"2019-05-24T10:53:00.000Z","title":"LSP e o PyLS","tags":["desenvolvimento-web","editores","ide","vscode","vim","python","pyls","lsp"],"thumbnail":{"childImageSharp":{"fixed":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAMCBP/EABYBAQEBAAAAAAAAAAAAAAAAAAABAv/aAAwDAQACEAMQAAAB7Kt3M2hHQsgn/8QAGhAAAwADAQAAAAAAAAAAAAAAAAECEBEhEv/aAAgBAQABBQKVzQ0LFCrnoqnv/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPwEf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPwEf/8QAFhAAAwAAAAAAAAAAAAAAAAAAASEw/9oACAEBAAY/Ago//8QAHBAAAgIDAQEAAAAAAAAAAAAAAAERMSFhkUFR/9oACAEBAAE/IUtwS/FwVNC4W0RothDI14N4pHMP/9oADAMBAAIAAwAAABDf177/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/EB//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/EB//xAAfEAEAAgEEAwEAAAAAAAAAAAABABEhMUFRgXGRoeH/2gAIAQEAAT8QopUDYl3r0SvQ6cfkI4AfkKtCqLGxx53g8eEHDl7lBp7T/9k=","width":180,"height":180,"src":"/static/f95de1d0643eac048d2811e349211e4e/a8ad2/python-code.jpg","srcSet":"/static/f95de1d0643eac048d2811e349211e4e/a8ad2/python-code.jpg 1x"}},"publicURL":"/static/f95de1d0643eac048d2811e349211e4e/python-code.jpg"}},"fields":{"readingTime":{"minutes":6.76},"slug":"/2019/05/24/lsp-e-o-pyls.html"}},"site":{"siteMetadata":{"author":{"name":"Klaus Peter Laube","gravatar":"https://en.gravatar.com/userimage/12163112/d3ae0c6239980b01ff1f1730b65c2ebe.jpg"},"siteUrl":"https://klauslaube.com.br"}}},"pageContext":{"slug":"/2019/05/24/lsp-e-o-pyls.html"}},"staticQueryHashes":["2831923220","4114525740"]}