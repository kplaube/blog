{"componentChunkName":"component---src-templates-blog-post-js","path":"/2015/06/29/os-testes-e-os-dubles-parte-2.html","result":{"data":{"markdownRemark":{"html":"<p>No <a href=\"/2014/08/07/os-testes-e-os-dubles-parte-1.html\" title=\"Os testes e os Dublês - Parte 1\"><em>post</em> anterior</a>, vimos um dos\ncenários de testes utilizados por times da <a href=\"http://globo.com\" title=\"Absolutamente tudo sobre notícias, esportes e entretenimento\"><em>Globo.com</em></a>, onde não escrevemos testes \"isolados\"\n(famigerados <em><a href=\"https://elearning.industriallogic.com/gh/submit?Action=AlbumContentsAction&#x26;album=theBasics&#x26;devLanguage=Java\" title=\"Testing Single Responsibilities at High Speed\">microtests</a></em>),\ne abusamos da integração entre classes e serviços.</p>\n<p>Mas até mesmo para nós existe um limite que não podemos ultrapassar: O caso\nde uma consulta a uma <em>API</em> externa, por exemplo. Nesse cenário, precisamos\nfingir que estamos fazendo isso, sem perder a segurança em nossas asserções.</p>\n<h2>Dublês ao resgate</h2>\n<p>Como já mencionado, os <em>test doubles</em> têm por finalidade substituir um objeto\nreal, afim de validar algum conceito em nossos testes.</p>\n<p>Para auxiliar-nos nessa demanda, vamos utilizar a <strong>Python Mock</strong>, biblioteca\nde <em>mocking</em> padrão do <em>Python 3</em>. Com ela, poderemos fingir integrações\ncomplexas da nossa aplicação, com o objetivo de testar um determinado\ncomportamento em \"custo\" e tempos atrativos.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6d2937bb703c3aaac5ccb2f7c3921185/41099/testing-vader.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 80.20833333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAQABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMEBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAcKmVgkA/8QAGRABAAIDAAAAAAAAAAAAAAAAAQIQABEh/9oACAEBAAEFAh0s4yozlf/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABwQAAAGAwAAAAAAAAAAAAAAAAABAhARMRIyYf/aAAgBAQAGPwKpEYILpNY2b//EABoQAQACAwEAAAAAAAAAAAAAAAEAIRExYXH/2gAIAQEAAT8hIFHDCN765jCLeERGtcjc/9oADAMBAAIAAwAAABArz//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABsQAAICAwEAAAAAAAAAAAAAAAERACExUXGB/9oACAEBAAE/EBMQcD2DLwKAUSsk05l5KNLYYbh09DdOESdz/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"&quot;I find your lack of tests disturbing (jasonpolites.github.io)&quot;\"\n        title=\"I find your lack of tests disturbing (jasonpolites.github.io)\"\n        src=\"/static/6d2937bb703c3aaac5ccb2f7c3921185/41099/testing-vader.jpg\"\n        srcset=\"/static/6d2937bb703c3aaac5ccb2f7c3921185/7809d/testing-vader.jpg 192w,\n/static/6d2937bb703c3aaac5ccb2f7c3921185/4ecad/testing-vader.jpg 384w,\n/static/6d2937bb703c3aaac5ccb2f7c3921185/41099/testing-vader.jpg 500w\"\n        sizes=\"(max-width: 500px) 100vw, 500px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">I find your lack of tests disturbing (jasonpolites.github.io)</figcaption>\n  </figure></p>\n<p>Se você (assim como eu) ainda está no <em>Python 2.7.X</em>, podemos instalar a <em>lib</em>\natravés do <code class=\"language-text\">pip</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ pip install mock</code></pre></div>\n<p><a href=\"http://www.voidspace.org.uk/python/mock/#installing\" title=\"Mock - Installing\">Mais instruções para instalação da <em>Mock</em></a>.</p>\n<p>Uma vez instalada, podemos partir para conceituar de forma prática cada um dos\ntipos de dublês listados no <em>post</em> anterior.</p>\n<h2>Dummys</h2>\n<p>Um <em>Dummy Object</em> é um tipo de dublê muito simples, que é usado apenas para\npreencher passagens de parâmetros:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Carro</span><span class=\"token punctuation\">:</span>\n    rodas <span class=\"token operator\">=</span> <span class=\"token number\">4</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> descricao<span class=\"token punctuation\">,</span> fabricante<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        self<span class=\"token punctuation\">.</span>descricao <span class=\"token operator\">=</span> descricao\n        self<span class=\"token punctuation\">.</span>fabricante <span class=\"token operator\">=</span> fabricante\n\n<span class=\"token comment\"># Teste</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">test_usando_dummy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    fabricante <span class=\"token operator\">=</span> <span class=\"token boolean\">None</span>\n    carro <span class=\"token operator\">=</span> Carro<span class=\"token punctuation\">(</span><span class=\"token string\">'Fusca'</span><span class=\"token punctuation\">,</span> fabricante<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">assert</span> carro<span class=\"token punctuation\">.</span>rodas <span class=\"token operator\">==</span> <span class=\"token number\">4</span></code></pre></div>\n<p>Como observado, um <em>Dummy</em> não precisa ser necessariamente um <em>mock</em>. Um valor\nem branco, nulo, uma string vazia, qualquer coisa usada para substituir um\nobjeto real em uma passagem de parâmetro, pode ser considerado um <em>Dummy</em>.</p>\n<h2>Fakes</h2>\n<p>Um <em>Fake</em> é um objeto com certa funcionalidade, muito útil para resolver\nalguma dependência em testes, mas que não é ideal para o ambiente de\nprodução:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Carro</span><span class=\"token punctuation\">:</span>\n    rodas <span class=\"token operator\">=</span> <span class=\"token number\">4</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> descricao<span class=\"token punctuation\">,</span> fabricante<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        self<span class=\"token punctuation\">.</span>descricao <span class=\"token operator\">=</span> descricao\n        self<span class=\"token punctuation\">.</span>fabricante <span class=\"token operator\">=</span> fabricante\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__str__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string\">\"{0} ({1})\"</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>\n            self<span class=\"token punctuation\">.</span>descricao<span class=\"token punctuation\">,</span>\n            self<span class=\"token punctuation\">.</span>fabricante<span class=\"token punctuation\">.</span>get_descricao<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Teste</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">FabricanteFake</span><span class=\"token punctuation\">:</span>\n    descricao <span class=\"token operator\">=</span> <span class=\"token string\">'Volkswagen'</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">get_descricao</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> self<span class=\"token punctuation\">.</span>descricao\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">test_usando_fake</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    fabricante <span class=\"token operator\">=</span> FabricanteFake<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    carro <span class=\"token operator\">=</span> Carro<span class=\"token punctuation\">(</span><span class=\"token string\">'Fusca'</span><span class=\"token punctuation\">,</span> fabricante<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">assert</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>carro<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token string\">'Fusca (Volkswagen)'</span></code></pre></div>\n<p>No exemplo acima, (ainda) não utilizamos nenhum recurso da <strong>Mock</strong>. Dependendo\ndo contexto, não precisamos de uma biblioteca para criarmos um <em>Fake</em>, e isso\npode ser encarado de forma positiva, pois fica muito clara a nossa intenção\nno teste.</p>\n<p>É relativamente comum vermos <em>Fakes</em> sendo utilizados para \"dublar\" acessos\na um banco de dados. Quando falamos de testes em <a href=\"/tag/django.html\" title=\"Leia mais sobre Django\"><em>Django</em></a>,\ngeralmente utilizamos uma persistência mais leve (como um banco <em>SQLite</em>, por exemplo)\nque substitui um banco mais complexo, tornando a nossa suíte de testes\nmais simples.</p>\n<h2>Mocks</h2>\n<p>Um tipo de dublê criado para um teste específico. Com ele, somos capazes\nde setar retornos de valores pré-definidos, bem como verificar se algum\nmétodo foi chamado durante a execução do teste:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Carro</span><span class=\"token punctuation\">:</span>\n    rodas <span class=\"token operator\">=</span> <span class=\"token number\">4</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> descricao<span class=\"token punctuation\">,</span> fabricante<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        self<span class=\"token punctuation\">.</span>descricao <span class=\"token operator\">=</span> descricao\n        self<span class=\"token punctuation\">.</span>fabricante <span class=\"token operator\">=</span> fabricante\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__str__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string\">\"{0} ({1})\"</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>\n            self<span class=\"token punctuation\">.</span>descricao<span class=\"token punctuation\">,</span>\n            self<span class=\"token punctuation\">.</span>fabricante<span class=\"token punctuation\">.</span>get_descricao<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Teste</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">test_usando_mock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    fabricante <span class=\"token operator\">=</span> MagicMock<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    fabricante<span class=\"token punctuation\">.</span>get_descricao<span class=\"token punctuation\">.</span>return_value <span class=\"token operator\">=</span> <span class=\"token string\">'Volkswagen'</span>\n    carro <span class=\"token operator\">=</span> Carro<span class=\"token punctuation\">(</span><span class=\"token string\">'Fusca'</span><span class=\"token punctuation\">,</span> fabricante<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">assert</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>carro<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token string\">'Fusca (Volkswagen)'</span>\n    fabricante<span class=\"token punctuation\">.</span>get_descricao<span class=\"token punctuation\">.</span>assert_called_once_with<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><em>Mocks</em> são fundamentais quando estamos lidando com interações\ndas quais não podemos (ou fica muito custoso) prever o comportamento.\nParticularmente, gosto de usar <em>Mocks</em> para garantir que o contrato entre o\nmeu método/classe e meu serviço/<em>API</em> esteja coerente.</p>\n<h2>Stubs</h2>\n<p>Semelhantes aos <em>Mocks</em>, com os <em>Stubs</em> temos a capacidade de retornar\nrespostas pré-definidas durante a execução de um teste. A principal diferença\nentre ambos é que com <em>Stubs</em>, não costumamos checar se eles foram propriamente\nexecutados:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Carro</span><span class=\"token punctuation\">:</span>\n    rodas <span class=\"token operator\">=</span> <span class=\"token number\">4</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> descricao<span class=\"token punctuation\">,</span> fabricante<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        self<span class=\"token punctuation\">.</span>descricao <span class=\"token operator\">=</span> descricao\n        self<span class=\"token punctuation\">.</span>fabricante <span class=\"token operator\">=</span> fabricante\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__str__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string\">\"{0} ({1})\"</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>\n            self<span class=\"token punctuation\">.</span>descricao<span class=\"token punctuation\">,</span>\n            self<span class=\"token punctuation\">.</span>fabricante<span class=\"token punctuation\">.</span>get_descricao<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Teste</span>\n\n<span class=\"token keyword\">from</span> mock <span class=\"token keyword\">import</span> MagicMock\n\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">test_usando_stub</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    fabricante <span class=\"token operator\">=</span> MagicMock<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    fabricante<span class=\"token punctuation\">.</span>get_descricao<span class=\"token punctuation\">.</span>return_value <span class=\"token operator\">=</span> <span class=\"token string\">'Volkswagen'</span>\n    carro <span class=\"token operator\">=</span> Carro<span class=\"token punctuation\">(</span><span class=\"token string\">'Fusca'</span><span class=\"token punctuation\">,</span> fabricante<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">assert</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>carro<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token string\">'Fusca (Volkswagen)'</span>\n\ntest_usando_stub<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><em>Stubs</em> são excelentes para fingir interações com bibliotecas <em>third-party</em>. Não\nprecisamos compreender a sua complexidade, apenas fingimos que ela está lá e\nretornando valores para os nossos <em>test cases</em>. Exemplo:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> datetime <span class=\"token keyword\">import</span> date\n<span class=\"token keyword\">with</span> patch<span class=\"token punctuation\">(</span><span class=\"token string\">'mymodule.date'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> mock_date<span class=\"token punctuation\">:</span>\n    mock_date<span class=\"token punctuation\">.</span>today<span class=\"token punctuation\">.</span>return_value <span class=\"token operator\">=</span> date<span class=\"token punctuation\">(</span><span class=\"token number\">2010</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span>\n    mock_date<span class=\"token punctuation\">.</span>side_effect <span class=\"token operator\">=</span> <span class=\"token keyword\">lambda</span> <span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kw<span class=\"token punctuation\">:</span> date<span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kw<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">assert</span> mymodule<span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">.</span>today<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> date<span class=\"token punctuation\">(</span><span class=\"token number\">2010</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">assert</span> mymodule<span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">(</span><span class=\"token number\">2009</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> date<span class=\"token punctuation\">(</span><span class=\"token number\">2009</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2>Spies</h2>\n<p>Com <em>Spies</em>, ao invés de setarmos expectativas, armazenamos as chamadas\nrealizadas por colaboradores:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Carro</span><span class=\"token punctuation\">:</span>\n    rodas <span class=\"token operator\">=</span> <span class=\"token number\">4</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> descricao<span class=\"token punctuation\">,</span> fabricante<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        self<span class=\"token punctuation\">.</span>descricao <span class=\"token operator\">=</span> descricao\n        self<span class=\"token punctuation\">.</span>fabricante <span class=\"token operator\">=</span> fabricante\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__str__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string\">\"{0} ({1})\"</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>\n            self<span class=\"token punctuation\">.</span>descricao<span class=\"token punctuation\">,</span>\n            self<span class=\"token punctuation\">.</span>fabricante<span class=\"token punctuation\">.</span>get_descricao<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Teste</span>\n\n<span class=\"token keyword\">from</span> mock <span class=\"token keyword\">import</span> MagicMock\n\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">test_usando_spy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    fabricante <span class=\"token operator\">=</span> MagicMock<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    fabricante<span class=\"token punctuation\">.</span>get_descricao<span class=\"token punctuation\">.</span>return_value <span class=\"token operator\">=</span> <span class=\"token string\">'Volkswagen'</span>\n\n    fusca <span class=\"token operator\">=</span> Carro<span class=\"token punctuation\">(</span><span class=\"token string\">'Fusca'</span><span class=\"token punctuation\">,</span> fabricante<span class=\"token punctuation\">)</span>\n    gol <span class=\"token operator\">=</span> Carro<span class=\"token punctuation\">(</span><span class=\"token string\">'Gol'</span><span class=\"token punctuation\">,</span> fabricante<span class=\"token punctuation\">)</span>\n\n    <span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>fusca<span class=\"token punctuation\">)</span>\n    <span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>gol<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">assert</span> fabricante<span class=\"token punctuation\">.</span>get_descricao<span class=\"token punctuation\">.</span>call_count <span class=\"token operator\">==</span> <span class=\"token number\">2</span></code></pre></div>\n<p>Costumo usar <em>Spies</em> com frequência em testes <em>front-end</em>,\nprincipalmente utilizando <a href=\"https://qunitjs.com/\" title=\"Conheça a suíte de testes JS, QUnit\"><em>QUnit</em></a> e <a href=\"http://sinonjs.org/\" title=\"Spies, stubs and mocks for Javascript\"><em>Sinon.JS</em></a>,\npara garantir a chamada de um determinado método dentro de eventos complexos,\nonde não consigo ter certeza sobre o resultado esperado.</p>\n<h2>Conclusão</h2>\n<p>Já dizia o filósofo que \"mockar é uma arte\". A verdade é que o uso de <em>doubles</em>\nnos ajuda muito quando estamos trabalhando dentro de um contexto de <em>TDD</em>,\nsimplificando assim um relacionamento complexo entre classes/objetos, afim de\nagilizar o nosso desenvolvimento e facilitar os nosso testes.</p>\n<p>Recentemente participei de um treinamento da <a href=\"http://www.industriallogic.com/\" title=\"Developing Software Doesn&#x27;t Have To Be Slow, Stressful And Filled With Unpleasant Surprises\"><em>Industrial Logic</em></a>, sobre <em>Refactoring</em>, e a lição que ficou foi:\nUse <em>mocks</em> moderadamente. Sempre dê preferência a uma alteração na arquitetura\ndo seu <em>software</em> (como por exemplo, o uso de <a href=\"https://pt.wikipedia.org/wiki/Inje%C3%A7%C3%A3o_de_depend%C3%AAncia\" title=\"Leia mais no Wikipedia\">Injeção de Dependência</a>).</p>\n<p>Se o uso de dublês for inevitável, prefira tipos mais simples\n(<em>Dummys</em> e <em>Fakes</em>). Dessa forma, os seus testes ficarão simples, legíveis e\nmais fáceis de manter.</p>\n<p>Até a próxima.</p>\n<h2>Referências</h2>\n<ul>\n<li><em><a href=\"https://nirajrules.wordpress.com/2011/08/27/dummy-vs-stub-vs-spy-vs-fake-vs-mock/\" title=\"Leia o artigo completo sobre as nomenclaturas\">Niraj Bhatt - Dummy vs. Stub vs. Spy vs. Fake vs. Mock</a></em></li>\n<li><em><a href=\"http://stackoverflow.com/questions/346372/whats-the-difference-between-faking-mocking-and-stubbing\" title=\"Leia mais no StackOverflow\">StackOverflow - What's the difference between faking, mocking, and stubbing?</a></em></li>\n<li><em><a href=\"http://code.tutsplus.com/articles/tdd-terminology-simplified--net-30626\" title=\"Leia mais sobre TDD no Tuts+\">Tuts+ - TDD Terminology Simplified</a></em></li>\n</ul>","excerpt":"No post anterior, vimos um dos\ncenários de testes utilizados por times da Globo.com, onde não escrevemos testes \"isolados\"\n(famigerados…","frontmatter":{"date":"2015-06-29T12:30:00.000Z","title":"Os testes e os dublês - Parte 2","tags":["testes","mock","python"],"thumbnail":{"childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEHElEQVQ4y3WUa1BUZRjHD0g6ZR8kJ/0QjoNT2GSZmEVjCsuSEBcBRVwSQWwUUEwkRAy5mdGIqDhYMWVTM5YUtwVS7oKDQsFA5KUmIGqmhOSSlz64Css5v949Z2F3m+mdec6+59nz/s7//77neSTEUBRFjZn51BSKLPN/w/KMLP53WGOdS44w8ZA8NbNwYuhXRqqKudN+nlHTBANjY9x+8MAB/F+oNJOwU3TnSg3du3Sc1S8ib+ls6k9m80e5kRaDgYb8fBpaWhgcHXUAT/9K9jBZ5H85so3ilY+z1dcX/027WBUUT0HJBUg/IPxIKLNmMezuTv3+/Vzq6UE2mx2gDpavHwgjZ8UC9IZkfKJS8d+8h9X+MRz/qgayMzELIAJoAVuiMyyMxvZ2oUS2KVSmtDf8+cURjr44D92WNPw2JQl1iQRYgAGxGjDzEFNWhbIIxclJhV6Ojqarr09zKMCq5YnxIar9FhISGoP3xiT8NiTgExaPX4SwrN9CgT3Q2VmzblVpnj2bmqIi7ppMmmXL5dY3Jzjo+RTR+4+TmXea9PeKSMk6SWpOITv25lJUWgdZmcgWkJcXSnAw6PXI8+ap0B/Efc/goA14/UA4W73XEBD3LjG7M3kzIYO4t3PV2Lw9zaowQwPOn4/i4aGFi4sK/GvxYprb2mzAjp1riVgXjHdkMrqwnfiEx+MrbFviGa9QTp2rhZxcHorFstWqYmf7nqsrjeXlmKc/m/Yda1SgzpBCQORu9XRfDd6OfkMiZ4or6Lw5wG+DP0LSOwLgpJ625XAU64mrwNJSJqeBV1NDiNH5oBcnvHb9W3gFxpGV+zG9P/XxyXAjCxtjmdsQQ95IE6bvxWcSFK4qNVsVjrq50djaarM8dPYDMl5ahGdwAglJh7lyuZfzo9283JGGVOqHZFyvxde+PP1dKiXjXVBZBc97qsCuoEC6+wdswIeiZitCPDhX0UzHaD+brx5DqngDqSwAqSpMwEKQKoM0qCVXtg7djQI6h6/CR2do+Oxzhv8en64U0RDEZFLsU21zLo9+u1Goeh3nqnBcaiJY0ZrM0uZEll3cw3MXk9Scc/UGpBJfpHoDxU0ZTA71MzlTKYpWNvfvDVO/dwGv5S9Bat6GU1UojwjoSgF85VIKQR056NrScRE5J2MoUlMsy08tw7h3PhP/jMx0K2tz0FrWg9s3qU9fgv59N6QLkUh1UUg1wnKVsGwUlquF5ToDUq2B1ceWULPvSUxDP2tlZy1hu/alJSxv6y0MJnvfY6w64cETZ32YUxbInPIgXL/UsaLwWQ6mzKXrqA+msd+1tVNmu+Zg3yStUMu4d62OG8VRVB9ezplD7nwqwpj7Atc+jOBOd6WtF9rBbP3QASozva+aZBPy3VsoInh437FbW7fKfv2/MdWV3iIVLCgAAAAASUVORK5CYII=","width":180,"height":180,"src":"/static/a49d9b360a156e7863294137d92b3161/d8216/tdd-red-green-refactor.png","srcSet":"/static/a49d9b360a156e7863294137d92b3161/d8216/tdd-red-green-refactor.png 1x"}},"publicURL":"/static/a49d9b360a156e7863294137d92b3161/tdd-red-green-refactor.png"}},"fields":{"readingTime":{"minutes":5.225},"slug":"/2015/06/29/os-testes-e-os-dubles-parte-2.html"}},"site":{"siteMetadata":{"author":{"name":"Klaus Peter Laube","gravatar":"https://en.gravatar.com/userimage/12163112/d3ae0c6239980b01ff1f1730b65c2ebe.jpg"},"siteUrl":"https://klauslaube.com.br"}}},"pageContext":{"slug":"/2015/06/29/os-testes-e-os-dubles-parte-2.html"}},"staticQueryHashes":["2831923220","4114525740"]}