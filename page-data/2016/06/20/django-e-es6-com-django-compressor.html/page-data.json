{"componentChunkName":"component---src-templates-blog-post-js","path":"/2016/06/20/django-e-es6-com-django-compressor.html","result":{"data":{"markdownRemark":{"html":"<p>No <a href=\"/2016/06/04/django-e-sass-com-django-compressor.html\" title=\"Django e Sass com django-compressor\"><em>post</em> anterior</a>,\nfalamos sobre como utilizar o <a href=\"/tag/sass.html\" title=\"Leia mais sobre Sass\"><em>Sass</em></a>\ncom o <em>framework</em> <a href=\"/tag/django.html\" title=\"Leia mais sobre Django\"><em>Django</em></a>\natravés da biblioteca <em>Compressor</em> (e sem necessitar de uma\nferramenta intermediária para <em>build</em>). Nesse artigo, vamos utilizar\no mesmo conceito e apresentar uma forma diferente de utilizar\na nova versão do <a href=\"/tag/javascript.html\" title=\"Leia mais sobre Javascript\"><em>Javascript</em></a>\ncom o <code class=\"language-text\">django-compressor</code>.</p>\n<h2>Instalando e configurando o Compressor</h2>\n<p>Vamos recaptular o processo de instalação do <code class=\"language-text\">django-compressor</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ pip install django-compressor</code></pre></div>\n<p>Não podemos esquecer de adicionar a <em>app</em> ao <code class=\"language-text\">INSTALLED_APPS</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># settings.py</span>\nINSTALLED_APPS <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token string\">'compressor'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>E para finalizar, precisamos fazer os estáticos serem \"encontráveis\":</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># settings.py</span>\nSTATICFILES_FINDERS <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token string\">'django.contrib.staticfiles.finders.FileSystemFinder'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'django.contrib.staticfiles.finders.AppDirectoriesFinder'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token string\">'compressor.finders.CompressorFinder'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>Para simplificar o nosso exemplo, vou reaproveitar o cenário criado no <em>post</em>\nanterior:</p>\n<div class=\"gatsby-highlight\" data-language=\"django-html\"><pre class=\"language-django-html\"><code class=\"language-django-html\">&lt;!-- index.html --&gt;\n\n{% load compress %}\n{% load staticfiles %}\n\n{% compress js %}\n    &lt;script src=&quot;{% static &#39;vendor/jquery/jquery.js&#39; %}&quot;&gt;&lt;/script&gt;\n    &lt;script src=&quot;{% static &#39;js/app.js&#39; %}&quot;&gt;&lt;/script&gt;\n{% endcompress %}</code></pre></div>\n<p>Imagine que o nosso arquivo <code class=\"language-text\">js/app.js</code> é um <em>Javascript</em>, mas escrito seguindo as\nespecificações do <a href=\"/tag/es6.html\" title=\"Leia mais sobre ES6\"><em>ES6</em></a>. Podendo ser algo\nsemelhante ao exemplo abaixo:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> createStore <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"redux\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> rootReducer <span class=\"token keyword\">from</span> <span class=\"token string\">\"./reducers\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> App <span class=\"token keyword\">from</span> <span class=\"token string\">\"./components/app\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> store <span class=\"token operator\">=</span> <span class=\"token function\">createStore</span><span class=\"token punctuation\">(</span>rootReducer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nstore<span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">.</span>subscriber<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>O bloco de <code class=\"language-text\">{% compress js %}</code> será responsável por minificar e concatenar os nossos <em>scripts</em>.\nSe executarmos o comando <code class=\"language-text\">manage.py compress</code>, provavelmente não teremos nenhum problema,\ne o <a href=\"/tag/html.html\" title=\"Leia mais sobre HTML\"><em>HTML</em></a> de resposta será algo parecido com isso:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token comment\">&lt;!-- index.html --></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>/static/CACHE/js/3ffb288f8747.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Mas o <em>ES6</em> ainda não é amplamente suportado pelos navegadores... logo, teremos\nque usar \"transpiladores\" para que o código seja traduzido em algo \"entendível\" pelos <em>browsers</em>.</p>\n<h2>Hello NPM my old friend</h2>\n<p>Eu sinceramente desconheço uma ferramenta que faça <a href=\"https://www.stevefenton.co.uk/2012/11/compiling-vs-transpiling/\" title=\"Compiling vs Transpiling\"><em>transpiling</em></a>\nde <em>ES6</em> para <em>ES5</em> melhor que o <a href=\"https://babeljs.io/\" title=\"Use next generation JavaScript, today\"><em>Babel</em></a>.</p>\n<p>E embora a gente \"torça o nariz\" para a necessidade de adicionar <a href=\"/tag/node.html\" title=\"Leia mais sobre Node\"><em>Node.js</em></a>\nà nossa <em>stack</em> <a href=\"/tag/python.html\" title=\"Leia mais sobre Python\"><em>Python</em></a>, o uso do <em>Babel</em> nessas condições faz\ncerto sentido. Primeiro, por nos permitir escrever <em>Javascript</em>\nnuma versão mais prática, legível e divertida. Segundo, que com o auxílio do\n<a href=\"http://browserify.org/\" title=\"Browserify lets you require modules in the browser\"><em>Browserify</em></a> (por exemplo),\npodemos deixar a resolução de <em>path</em> do <em>JS</em> nas mãos da tríade <em>NPM/Browserify/Babel</em>\n(ou você achou que aquele <code class=\"language-text\">import &#39;redux&#39;</code> veio de graça?).</p>\n<p>Isso nos permite escrever <em>Javascript</em> modular, utilizando recursos que já são <em>built-in</em>\n(na especificação) da linguagem, sem necessariamente nos preocuparmos em como resolveremos as\nquestões de importação (como por exemplo, se usaremos <a href=\"http://requirejs.org/\" title=\"RequireJS is a JavaScript file and module loader\"><em>RequireJS</em></a>\nou <a href=\"https://github.com/cujojs/curl\" title=\"curl.js is small, fast, extensible module loader\"><em>curl.js</em></a>)\ne deixamos toda essa responsabilidade nas mãos da ferramenta de <em>bundling</em> de sua escolha.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 620px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/dc950275e2c6d590b83a54d5a867fdc3/2a195/django-babel-auf-wiedersehen.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAABqElEQVQY00VQW0sbQRSey5mdnZ3d7G5izEZysQGVavGGSL1D+54SsGpSMSiojQ/SKFITqUalGMGoiOCDDyL4WihtH/rU39azKW0PB+Yb5rucM4RSKgAiyvIsHXPsVNSPKOVpXZiZblbenxQL80O5npivhNnbFXMtC7jBGKftIoQSCcJVOqqdwPUyMT+qrYTrflpb+XF5/lSrtor58ssRTyolTcYYpX+6LaYhZJwDcBBgmEJyJuKO3n6b/3lzeTD/5nR5KT86nPXcdiZy2f9kRjlesMNiILhBGXTa6rhc+nV3+1Dd+XJ8tPl69kWHL4XJwxiB7v+SUQo8NMMDDIH2kPQijfLS96uLr6eN85Xi5LNsrjNhWzbS2+S/YuDCAOlqJ+75jEK4BGGM0P5M6np//6yysf5qsjAykIonkEkIvqGSIwjFOCyioMPvz6UJ4Yl40BWkp8bGt0vLd81WY7f2YXWjsrCYCZKGtKRUuKGBn8Mxn5FwWwamEHPjE9Wtvd2t+vXB52+tZv1d6XCn9nj/+LFaHxwYNZWd7e7r6R163jecTqY97bim/g2WwkJ29mDhJgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"&quot;Django + Babel é como dar um Auf Wiedersehen para o ES5 (fallsdownz.blogspot.com.br)&quot;\"\n        title=\"Django + Babel é como dar um Auf Wiedersehen para o ES5 (fallsdownz.blogspot.com.br)\"\n        src=\"/static/dc950275e2c6d590b83a54d5a867fdc3/2a195/django-babel-auf-wiedersehen.png\"\n        srcset=\"/static/dc950275e2c6d590b83a54d5a867fdc3/8514f/django-babel-auf-wiedersehen.png 192w,\n/static/dc950275e2c6d590b83a54d5a867fdc3/804b2/django-babel-auf-wiedersehen.png 384w,\n/static/dc950275e2c6d590b83a54d5a867fdc3/2a195/django-babel-auf-wiedersehen.png 620w\"\n        sizes=\"(max-width: 620px) 100vw, 620px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Django + Babel é como dar um Auf Wiedersehen para o ES5 (fallsdownz.blogspot.com.br)</figcaption>\n  </figure></p>\n<p>Sem mais delongas, vamos instalar as dependências que precisaremos para o nosso exemplo:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">npm install --save-dev babelify babel-preset-es2015 redux</code></pre></div>\n<p>Dos pacotes acima, os mais fundamentais são:</p>\n<ul>\n<li><code class=\"language-text\">babelify</code>: Um <a href=\"http://babeljs.io/docs/plugins/#transform\" title=\"Babel plugins\"><em>transform</em></a> de <em>Babel</em> para o <em>Browserify</em>;</li>\n<li><code class=\"language-text\">babel-preset-es2015</code>: Um <em>preset</em> com um apanhado de <em>plugins</em> necessários para compilar <em>ES2015</em> para <em>ES5</em>;</li>\n</ul>\n<p>O pacote <code class=\"language-text\">redux</code> é apenas uma dependência utilizada pelo exemplo, e não\ninfluencia diretamente no processo de <em>build</em>.</p>\n<p>Para facilitar a comunicação entre o <em>Django</em> e o <em>Babel</em>, vamos criar um arquivo de configuração\n<code class=\"language-text\">.babelrc</code>, na raíz do nosso projeto, com a seguinte configuração:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"presets\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"es2015\"</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Voltamos ao <em>Django</em>, para terminar de configurar o nosso projeto.</p>\n<h2>Back to the Django</h2>\n<p>Como no exemplo do <em>post</em> anterior, vamos utilizar a capacidade de setarmos\ncompiladores/transpiladores, no <code class=\"language-text\">django-compressor</code>, e passaremos a interpretar\nos arquivos <em>Javascript</em> utilizando o <em>Babel</em>:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># settings.py</span>\nCOMPRESS_PRECOMPILERS <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">(</span><span class=\"token string\">'text/es6'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'./node_modules/.bin/browserify {infile} -t babelify --outfile {outfile}'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>O <em>path</em> <code class=\"language-text\">./node_modules/.bin/browserify</code> é onde está o binário após ser instalado\nvia <code class=\"language-text\">npm</code>. Os parâmetros <code class=\"language-text\">infile</code> e <code class=\"language-text\">outfile</code> dizem respeito ao arquivo de entrada e\nde saída, respectivamente.</p>\n<p>Agora basta voltarmos ao nosso <em>template</em>, e adicionarmos o atributo <code class=\"language-text\">type=&quot;text/es6</code> à\nnossa <em>tag</em> <code class=\"language-text\">&lt;script&gt;</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"django-html\"><pre class=\"language-django-html\"><code class=\"language-django-html\">&lt;!-- index.html --&gt;\n\n{% load compress %}\n{% load staticfiles %}\n\n{% compress js %}\n    &lt;script src=&quot;{% static &#39;vendor/jquery/jquery.js&#39; %}&quot;&gt;&lt;/script&gt;\n    &lt;script src=&quot;{% static &#39;js/app.js&#39; %}&quot; type=&quot;text/es6&quot;&gt;&lt;/script&gt;\n{% endcompress %}</code></pre></div>\n<p>Pronto! Agora é só ver o resultado através do comando <code class=\"language-text\">python manage.py compress</code>.</p>\n<h2>Considerações finais</h2>\n<p>Tratando-se de uma aplicação em produção, onde é recomendado utilizar o <code class=\"language-text\">django-compressor</code>\ncom <a href=\"http://django-compressor.readthedocs.io/en/latest/scenarios/#offline-compression\" title=\"Offline compression\"><em>offline compression</em></a>,\na adição do <em>Browserify</em> não impactará no tempo de resposta\ndo seu servidor. No entanto, é certo que o servidor local, levantado através do\n<code class=\"language-text\">manage.py runserver</code>, leve um tempo maior para responder depois dessa adição.</p>\n<p>Na dúvida, não custa testar...</p>\n<p>Inicie utilizando o <em>Django</em> com <em>Compressor</em>. A partir do momento onde os\ntempos de resposta tornem-se muito altos, opte por uma ferramenta que\n<a href=\"/2016/02/22/vivendo-sem-o-grunt.html\" title=\"Vivendo sem o Grunt\">execute o <em>build</em> em paralelo</a>.</p>\n<p>Até a próxima!</p>\n<h2>Referências</h2>\n<ul>\n<li><a href=\"https://github.com/babel/babelify\"><em>Babelify - Browserify transform for Babel</em></a></li>\n<li><a href=\"https://django-compressor.readthedocs.io/en/latest/\"><em>Django Compressor - Compresses linked and inline JavaScript or CSS into a single cached file</em></a></li>\n</ul>","excerpt":"No post anterior,\nfalamos sobre como utilizar o Sass\ncom o framework Django\natravés da biblioteca Compressor (e sem necessitar de uma…","frontmatter":{"date":"2016-06-20T23:04:00.000Z","title":"Django e ES6 com django-compressor","tags":["desenvolvimento-web","python","django","es6","javascript","babel","browserify"],"thumbnail":{"childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsSAAALEgHS3X78AAAD0ElEQVQ4y22TjU8adxjH+TOWxU3XVosWUOBAlKkcB8hB5Tho69ZOxPm6JmvssrXZsrqudbEY37auVfGlraCdmiamri9rlr2k2+qaNTWd7UB8AYc4rYBFpSDq7eHONi6TPOGe++X3ue/zyhJWKP5vSIUivRRNK34TDBw44Zhz0sxSbkku+KJKRYoJa+jWsnaE+WVytFp/6HQ5mKyahBPdJ0XGUyWak28jNHmuA4+4yR1gcVV+yjuSWlszRf9qe5oE5djc03nwHzhHk4vk56xA6gPjO8GSozjblP2FvYWBz/Y0IhXKQGgJ/PuOsfpOfM1DLLmIoOu/MGiKKlX8cizxLcHnVxq2lG1N6aWy4V9v/zj60DvduTqpXXLpg+PAb4ORSmVqsXSfOUf14cGc9wsaB1oZuK63JdWUxS3VnG1VhFy430nQ5DYYSAi1rP74vbE/FoKLz1ZCodXljc1NJmy2WTlyvzbiJp5NGANb5AtYVKVKNUlPtp2hL1ObzIOiNjbW4f/UpS8/+zov6jYsOnSgufiXLuB8AYNmRpk895jOu+CDq9HYmnXYRn5qtt8ZjH+Ioh6OWgIOZWzWuDylB2zNS4bdkLMuDoMsBHy0+QSjdvv3H/YcyUwsFJy+ZIm/3rT5RvHI3+RQj/LwIbFGjXx8XOr4Tbs8BZmTLHGVam9RVk2XhYGbBtp4pTKOOdfS395/dVCWl7boIH65oU7jpGdl8w+QolcSOB8dk0Zm6D4z8AcXahh46O7NpMIMthm9aD+skAnkKP/5DHmhXvbqa5z+LowKGodsStfI/uVJus+QM+/dPJg7qDDAa7FoXV9X8+X9/icauVyoUiArU/prlxUJSdxCo/jOgCo6S8Z8ZMCpW5rYVu3z1zqZCsVCtyKegrkxAkWFapVwfixe5Or3sl/fxX1jN5ckRD9fz98K+2WfYWNOtDc89fYGnarAuG72kQ5FBep8ZO7PglW3ftWjv25XlhRJUti8zEz+o5/wsMfAYhYws0rBLlbUnM+LeFTzj3Vhjx46KUeFuBpZeBJXfnxXS/kNVMDQcCY3IZHT/RW67jOyEHo/95qwOitOLRy40ZcvkwntbdhwrzJ1H++gQQztLS+RIKKMq1bswfc4xB8vXicGnWcxm23pwMPTBIT33aBKJMpI2s3dlcwDGC5t/kPaWzGAIec9KbyEJI75iARyCU2SrGR6s5+7Cf844acHyDWi7bko72hBR26pV6bjCxTzks572m+sWHsj+m2fEvLaGpKmbk2UzpDZFRhA0F/3kWDRGfLlYdhNMoexWTI0QTDj+S+Tu3oItOuiIAAAAABJRU5ErkJggg==","width":180,"height":180,"src":"/static/6fc314df29544a0b9256a3c82c66ecc8/d8216/django-js-logo.png","srcSet":"/static/6fc314df29544a0b9256a3c82c66ecc8/d8216/django-js-logo.png 1x"}},"publicURL":"/static/6fc314df29544a0b9256a3c82c66ecc8/django-js-logo.png"}},"fields":{"readingTime":{"minutes":4.325},"slug":"/2016/06/20/django-e-es6-com-django-compressor.html"}},"site":{"siteMetadata":{"author":{"name":"Klaus Peter Laube","gravatar":"https://en.gravatar.com/userimage/12163112/d3ae0c6239980b01ff1f1730b65c2ebe.jpg"},"siteUrl":"https://klauslaube.com.br"}}},"pageContext":{"slug":"/2016/06/20/django-e-es6-com-django-compressor.html"}}}