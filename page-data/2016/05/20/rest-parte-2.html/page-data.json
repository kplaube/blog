{"componentChunkName":"component---src-templates-blog-post-js","path":"/2016/05/20/rest-parte-2.html","result":{"data":{"markdownRemark":{"html":"<p>No <a href=\"/2016/01/06/rest-parte-1.html\" title=\"Leia a parte 1\"><em>post</em> anterior</a>, demos uma pequena introdução\nao conceito de <em>REST</em> e fizemos um raso comparativo com o seu \"rival\", o <em>SOAP</em>.\nNesse artigo falaremos mais sobre como interagir com <em>APIs</em> <em>REST</em> utilizando\nos verbos do protocolo <em>HTTP</em>, e a biblioteca <a href=\"http://www.hug.rest/\" title=\"Embrace APIs of the future\"><em>hug</em></a>,\nque nos ajudará a ilustrar como uma <em>API</em> funciona na prática.</p>\n<p>Segundo o <a href=\"https://www.infoq.com/br/articles/rest-introduction\" title=\"Introdução ao REST\"><em>InfoQ</em></a>,\no <em>REST</em> possui cinco princípios fundamentais:</p>\n<ul>\n<li>Dê a todas as coisas um identificador</li>\n<li>Vincule as coisas</li>\n<li>Utilize métodos padronizados</li>\n<li>Recursos com múltiplas representações</li>\n<li>Comunique sem estado</li>\n</ul>\n<p>Esses cinco itens nos guiarão daqui para frente.</p>\n<h2>O Uniform Resource Identifier</h2>\n<p>Você já parou para pensar que na <em>Internet</em> tudo tem um \"endereço único\"?\nDo formulário de contato do seu <em>blog</em> até um vídeo no <em>Youtube</em>?</p>\n<p>Todo recurso tem um nome e pode ser identificado de forma única.\nEsse conceito é conhecido por <em>Uniform Resource Identifier</em> (<em>URI</em>) e é\ncomposto pelo <em>Uniform Resource Locator</em> (<em>URL</em>) e <em>Uniform Resource Name</em> (<em>URN</em>).</p>\n<p>Logo, quando falamos do endereço <code class=\"language-text\">http://google.com/index.html</code>, podemos assumir a seguinte\nestrutura:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">http://google.com/index.html\n|------ URL -----|-- URN --|\n|----------- URI ----------|</code></pre></div>\n<p>Como uma <em>API</em> <em>REST</em> é um recurso disponível na <a href=\"/tag/desenvolvimento-web.html\" title=\"Leia mais sobre web\"><em>web</em></a>,\nessa regra não é diferente. Daremos identificadores únicos para cada recurso exposto.</p>\n<p>Utilizaremos o <code class=\"language-text\">localhost:8000</code> para os exemplos a seguir. Portanto, vamos imaginar que\ntemos uma <em>API</em> de filmes, e gostaríamos de listar todos os filmes. Uma boa prática\né utilizarmos o substantivo no plural. Exemplo:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">http://localhost:8000/movies/</code></pre></div>\n<p>Vamos supor que o filme \"The Matrix\", dentro da nossa base de dados, tenha o <em>ID</em> <code class=\"language-text\">20</code>.\nNa nossa <em>API</em> poderíamos acessá-lo através da seguinte <em>URI</em>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">http://localhost:8000/movies/20/</code></pre></div>\n<p>Consequentemente, outro filme teria um identificador diferente. Por exemplo, para acessarmos\no filme \"Swordfish\", que no nosso exemplo possui o <em>ID</em> <code class=\"language-text\">55</code>, temos:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">http://localhost:8000/movies/55/</code></pre></div>\n<p>Outra boa prática é utilizarmos <a href=\"https://en.wikipedia.org/wiki/Universally_unique_identifier\" title=\"Leia mais sobre UUID\"><em>UUIDs</em></a>\nao invés das chaves primárias do nosso banco de dados. Isso obscurece o funcionamento da\naplicação, tornando-a ligeiramente mais segura:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">http://localhost:8000/movies/DED621D5-08F4-4D32-ADFA-84375BA415B9/</code></pre></div>\n<p>Legal! Já tenho como acessar o filme <em>The Matrix</em>, dentro da nossa \"<em>API</em> imaginária\". Será\nque temos alguma maneira fácil de acessar, por exemplo, os atores que fazem parte desse\nfilme?</p>\n<h2>Hipermídia</h2>\n<p>O conceito de hipermídia pode ser bastante abstrato. Segundo o <em>Wikipedia</em>:</p>\n<blockquote>\n<p>Hipermídia é a reunião de várias mídias num ambiente computacional, suportada por sistemas eletrônicos\nde comunicação. Hipermídia, diferentemente de multimídia, não é a mera reunião dos meios existentes, e\nsim a fusão desses meios a partir de elementos não-lineares.</p>\n</blockquote>\n<p>A melhor forma de entender esse conceito é se olharmos para uma forma de hipermídia muito conhecida: o hipertexto (sim,\no \"H\" do <a href=\"/tag/html.html\" title=\"Leia mais sobre HTML\"><em>Hypertext Markup Language</em></a>). Nele, temos um \"texto interativo\",\nnão necessariamente linear e composto por diferentes outras mídias (como som, vídeo, imagens, etc).</p>\n<p>Mas o ponto que mais ilustra o que é um hipertexto é a capacidade de um texto referenciar a outro. Esse\nconceito, chamado de hiperlinks (ou somente <em>links</em>, para os mais jovens) permite com que eu seja capaz de navegar\nentre documentos apenas seguindo as suas referências, sem conhecer previamente o destino do meu passo seguinte.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 619px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3c33d9c73b53a52b480dad1527ce9c9d/a530b/social-network-movie.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAQBAwX/xAAWAQEBAQAAAAAAAAAAAAAAAAAAAQL/2gAMAwEAAhADEAAAAc8aRwgoK//EABsQAAEEAwAAAAAAAAAAAAAAAAABAxESAhAh/9oACAEBAAEFAqmaJFZHhzmv/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGRAAAgMBAAAAAAAAAAAAAAAAABABAhEx/9oACAEBAAY/AjanVC//xAAbEAEAAgIDAAAAAAAAAAAAAAABACERMUFhgf/aAAgBAQABPyHAzlJyoLUNgPZXVUTRKOots//aAAwDAQACAAMAAAAQH8//xAAWEQEBAQAAAAAAAAAAAAAAAAAAEQH/2gAIAQMBAT8Qq4//xAAWEQEBAQAAAAAAAAAAAAAAAAABABH/2gAIAQIBAT8QCxv/xAAaEAEBAAMBAQAAAAAAAAAAAAABEQAhMVFB/9oACAEBAAE/ECUtEiOkwC8HlddLksD4gjcM+gM1TCINHZoO8bs9c//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"&quot;Aqui de boas fazendo umas APIs com os meus amigos (cosmopolitan.com)&quot;\"\n        title=\"Aqui de boas fazendo umas APIs com os meus amigos (cosmopolitan.com)\"\n        src=\"/static/3c33d9c73b53a52b480dad1527ce9c9d/a530b/social-network-movie.jpg\"\n        srcset=\"/static/3c33d9c73b53a52b480dad1527ce9c9d/7809d/social-network-movie.jpg 192w,\n/static/3c33d9c73b53a52b480dad1527ce9c9d/4ecad/social-network-movie.jpg 384w,\n/static/3c33d9c73b53a52b480dad1527ce9c9d/a530b/social-network-movie.jpg 619w\"\n        sizes=\"(max-width: 619px) 100vw, 619px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Aqui de boas fazendo umas APIs com os meus amigos (cosmopolitan.com)</figcaption>\n  </figure></p>\n<p>Quando esse conceito é aplicado ao contexto de <em>REST</em>, temos o que chamamos de <em>Hypermedia as the Engine\nof Application State</em> (<a href=\"https://en.wikipedia.org/wiki/HATEOAS\" title=\"Leia mais sobre HATEOAS\"><em>HATEOAS</em></a>).\nSegundo ele, nosso cliente deve ser capaz de interagir com a nossa aplicação\n(e até mesmo demais aplicações vinculadas a ela) através de hipermídia. Dessa forma, eu não preciso necessariamente\nconhecer todos os <em>endpoints</em> de uma <em>API</em>, ela me informará dada uma determinada <em>URI</em>, para onde eu posso navegar.</p>\n<p>Pegando a nossa <em>API</em> de filmes, eu deveria ter dentro da resposta do filme \"The Matrix\" alguma informação me dizendo\nque para listar os atores desse filme, eu deveria acessar <code class=\"language-text\">http://localhost:8000/movies/DED621D5-08F4-4D32-ADFA-84375BA415B9/actors/</code>.\nE uma vez eu estando nessa listagem, deveria haver um <em>link</em> me dizendo que para ver os detalhes da\n<a href=\"http://www.imdb.com/name/nm0005251/\" title=\"Carrie-Anne Moss no IMDB\"><em>Carrie-Anne Moss</em></a>, por exemplo,\neu devo acessar a <em>URI</em> <code class=\"language-text\">http://localhost:8000/actors/A3531BF5-C089-4A44-8A92-5A5AC08261AA/</code>.</p>\n<p>Exemplo:</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>movie</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>uuid</span><span class=\"token punctuation\">></span></span>DED621D5-08F4-4D32-ADFA-84375BA415B9<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>uuid</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>The Matrix<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>actors<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>http://localhost:8000/movies/DED621D5-08F4-4D32-ADFA-84375BA415B9/actors/<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>movie</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Ou em uma resposta em <em>JSON</em>, poderíamos ter algo parecido com o exemplo abaixo:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"uuid\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"DED621D5-08F4-4D32-ADFA-84375BA415B9\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"The Matrix\"</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token property\">\"_links\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"actors\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://localhost:8000/movies/DED621D5-08F4-4D32-ADFA-84375BA415B9/actors/\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>Um pouquinho de prática</h2>\n<p>Antes de falarmos sobre os verbos <em>HTTP</em>, vamos utilizar o <em>hug</em> para uma abordagem um\npouco mais prática. Iniciamos com a instalação da biblioteca:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ pip3 install hug</code></pre></div>\n<p>Para tornar as coisas simples, vamos simular o acesso ao banco de dados com o uso de dicionários <em>Python</em>.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># api.py</span>\n\n<span class=\"token keyword\">import</span> hug\n\nMOVIES <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">'id'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'DED621D5-08F4-4D32-ADFA-84375BA415B9'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'title'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'The Matrix'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'description'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'A computer hacker learns from mysterious rebels about the true nature of his reality and his role in the war against its controllers.'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<p>A <em>URI</em> por si só não significa nada. Precisamos de métodos para acessá-la (e manipulá-la), e o protocolo <em>HTTP</em>\npossui alguns verbos que podem executar essas operações para nós.</p>\n<h3>Listagem e detalhes</h3>\n<p>O <em>GET</em> é sem dúvida o mais famoso deles. É através dele que somos capazes de \"pegar\" os recursos da <em>web</em>, incluindo\npáginas na Internet como essa que você está lendo. Com esse verbo, podemos listar e visualizar mais detalhes de um\ndeterminado recurso na <em>web</em>.</p>\n<p>Vamos começar retornando a listagem de filmes:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># api.py</span>\n\n<span class=\"token keyword\">import</span> hug\n\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\n<span class=\"token decorator annotation punctuation\">@hug<span class=\"token punctuation\">.</span>get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">movies</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">'objects'</span><span class=\"token punctuation\">:</span> MOVIES<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<p>Para executar a <em>API</em> no seu ambiente local, utilize o seguinte comando:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ hug -f api.py</code></pre></div>\n<p>Agora, ao acessar a <em>URI</em> <code class=\"language-text\">http://localhost:8000/movies/</code>, obtemos a seguinte resposta:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"objects\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"A computer hacker learns from mysterious rebels about the true nature of his reality and his role in the war against its controllers.\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"The Matrix\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"DED621D5-08F4-4D32-ADFA-84375BA415B9\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Vamos ilustrar como seria o acesso via <em>GET</em> para ver detalhes do recurso \"The Matrix\". Primeiro,\ncriamos o método na aplicação que é responsável por dar detalhes de um filme:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> hug\n<span class=\"token keyword\">from</span> falcon <span class=\"token keyword\">import</span> HTTP_404\n\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\n<span class=\"token decorator annotation punctuation\">@hug<span class=\"token punctuation\">.</span>get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/movies/{movie_id}/'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">movie</span><span class=\"token punctuation\">(</span>movie_id<span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n  movie_ids <span class=\"token operator\">=</span> <span class=\"token builtin\">map</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">lambda</span> x<span class=\"token punctuation\">:</span> x<span class=\"token punctuation\">[</span><span class=\"token string\">'id'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> MOVIES<span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">if</span> movie_id <span class=\"token keyword\">not</span> <span class=\"token keyword\">in</span> movie_ids<span class=\"token punctuation\">:</span>\n    response<span class=\"token punctuation\">.</span>status <span class=\"token operator\">=</span> HTTP_404\n    <span class=\"token keyword\">return</span> <span class=\"token string\">'Not found'</span>\n\n  movie <span class=\"token operator\">=</span> MOVIES<span class=\"token punctuation\">[</span>movie_ids<span class=\"token punctuation\">.</span>index<span class=\"token punctuation\">(</span>movie_id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p>Seguindo uma boa prática, visualizar detalhes de um determinado recurso deveria ter um endereço\ncomposto pelo seu nome (no caso, <code class=\"language-text\">movies</code>), mais o seu identificador (no caso, <code class=\"language-text\">DED621D5-08F4-4D32-ADFA-84375BA415B9</code>):</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ curl -i http://localhost:8000/movies/DED621D5-08F4-4D32-ADFA-84375BA415B9/\n\nHTTP/1.0 200 OK\nDate: Fri, 13 May 2016 00:58:57 GMT\nServer: WSGIServer/0.2 CPython/3.4.4\ncontent-type: application/json\ncontent-length: 221\n\n{&quot;description&quot;: &quot;A computer hacker learns from mysterious rebels about the true nature of his reality and his role in the war against its controllers.&quot;, &quot;title&quot;: &quot;The Matrix&quot;, &quot;id&quot;: &quot;DED621D5-08F4-4D32-ADFA-84375BA415B9&quot;}</code></pre></div>\n<h3>Adicionando</h3>\n<p>Outro verbo bem conhecido do protocolo é o <em>POST</em>. Quem aqui nunca submeteu um formulário <em>web</em>?</p>\n<p>O princípio desse método é o envio de dados, do cliente para o servidor. Vamos aproveitar dessa sua\nnatureza para adicionar o filme \"Swordish\" à nossa <em>API</em>. Para isso, precisamos alterar nossa função <code class=\"language-text\">movies</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> hug\n<span class=\"token keyword\">import</span> uuid\n<span class=\"token keyword\">from</span> falcon <span class=\"token keyword\">import</span> HTTP_201<span class=\"token punctuation\">,</span> HTTP_404\n\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\n<span class=\"token decorator annotation punctuation\">@hug<span class=\"token punctuation\">.</span>get_post</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">movies</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n  <span class=\"token keyword\">if</span> request<span class=\"token punctuation\">.</span>method <span class=\"token operator\">==</span> <span class=\"token string\">'GET'</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token string\">'objects'</span><span class=\"token punctuation\">:</span> MOVIES<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>  <span class=\"token comment\"># We are assuming it's a POST</span>\n    movie <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token string\">'uuid'</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>uuid<span class=\"token punctuation\">.</span>uuid4<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">'title'</span><span class=\"token punctuation\">:</span> request<span class=\"token punctuation\">.</span>get_param<span class=\"token punctuation\">(</span><span class=\"token string\">'title'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">'description'</span><span class=\"token punctuation\">:</span> request<span class=\"token punctuation\">.</span>get_param<span class=\"token punctuation\">(</span><span class=\"token string\">'description'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span>\n    MOVIES<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>movie<span class=\"token punctuation\">)</span>\n\n    response<span class=\"token punctuation\">.</span>status <span class=\"token operator\">=</span> HTTP_201\n    <span class=\"token keyword\">return</span> movie\n\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<p>Como é possível reparar no código acima, pretendemos adicionar um filme e o destino da nossa requisição\nserá o <code class=\"language-text\">/movies/</code>. Desse modo, o <em>GET</em> lista e o <em>POST</em> adiciona novos filmes:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ curl -i -XPOST -d &quot;title=Swordfish&amp;description=Some hackish description...&quot; http://localhost:8000/movies\n\nHTTP/1.0 201 Created\nDate: Fri, 13 May 2016 01:51:43 GMT\nServer: WSGIServer/0.2 CPython/3.4.4\ncontent-type: application/json\ncontent-length: 116\n\n{&quot;title&quot;: &quot;Swordfish&quot;, &quot;uuid&quot;: &quot;a96e7212-6a29-478a-a24e-07720a286944&quot;, &quot;description&quot;: &quot;Some hackish description...&quot;}</code></pre></div>\n<p>Agora temos dois filmes cadastrados na nossa API:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"objects\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"A computer hacker learns from mysterious rebels about the true nature of his reality and his role in the war against its controllers.\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"The Matrix\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"DED621D5-08F4-4D32-ADFA-84375BA415B9\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Some hackish description...\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Swordfish\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"a96e7212-6a29-478a-a24e-07720a286944\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>Atualizando e removendo</h3>\n<p>Uma vez que <em>POST</em> e <em>GET</em> acontecem no <em>endpoint</em> responsável por \"listar\" os nossos filmes,\né natural assumirmos que o <em>PUT</em> e <em>DELETE</em> acontecerão no <em>endpoint</em> responsável por\n\"detalhar\" determinado filme.</p>\n<p>O <em>PUT</em> é o método <em>HTTP</em> responsável por atualizar um determinado recurso. Assim como o <em>POST</em>,\nele permite a passagem de parâmetros que podem ser interpretados como \"campos\".</p>\n<p>Já o <em>DELETE</em>, como o nome sugere, é o método padrão quando insinuamos a remoção de um determinado\nrecurso à nossa <em>API</em>.</p>\n<p>Na prática, para suportar esses dois verbos, nossa função <code class=\"language-text\">movie</code> ficará assim:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token decorator annotation punctuation\">@hug<span class=\"token punctuation\">.</span>http</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/movies/{movie_id}/'</span><span class=\"token punctuation\">,</span> accept<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token string\">'get'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'put'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'delete'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">movie</span><span class=\"token punctuation\">(</span>movie_id<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n  movie_ids <span class=\"token operator\">=</span> <span class=\"token builtin\">map</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">lambda</span> x<span class=\"token punctuation\">:</span> x<span class=\"token punctuation\">[</span><span class=\"token string\">'id'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> MOVIES<span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">if</span> movie_id <span class=\"token keyword\">not</span> <span class=\"token keyword\">in</span> movie_ids<span class=\"token punctuation\">:</span>\n    response<span class=\"token punctuation\">.</span>status <span class=\"token operator\">=</span> HTTP_404\n    <span class=\"token keyword\">return</span> <span class=\"token string\">'Not found'</span>\n\n  movie <span class=\"token operator\">=</span> MOVIES<span class=\"token punctuation\">[</span>movie_ids<span class=\"token punctuation\">.</span>index<span class=\"token punctuation\">(</span>movie_id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n\n  <span class=\"token keyword\">if</span> request<span class=\"token punctuation\">.</span>method <span class=\"token operator\">==</span> <span class=\"token string\">'DELETE'</span><span class=\"token punctuation\">:</span>\n    MOVIES<span class=\"token punctuation\">.</span>remove<span class=\"token punctuation\">(</span>movie<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token string\">'Deleted'</span>\n\n  <span class=\"token keyword\">if</span> request<span class=\"token punctuation\">.</span>method <span class=\"token operator\">==</span> <span class=\"token string\">'PUT'</span><span class=\"token punctuation\">:</span>\n    movie<span class=\"token punctuation\">[</span><span class=\"token string\">'title'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span>get_param<span class=\"token punctuation\">(</span><span class=\"token string\">'title'</span><span class=\"token punctuation\">)</span>\n    movie<span class=\"token punctuation\">[</span><span class=\"token string\">'description'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span>get_param<span class=\"token punctuation\">(</span><span class=\"token string\">'description'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> movie\n\n  <span class=\"token keyword\">return</span> movie</code></pre></div>\n<p>Agora podemos atualizar o filme \"Swordfish\":</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">curl -i -XPUT -d &quot;title=A Senha&amp;description=Um filme sobre Hackers&quot; http://localhost:8000/movies/a96e7212-6a29-478a-a24e-07720a286944/\n\nHTTP/1.0 200 OK\nDate: Fri, 13 May 2016 02:25:42 GMT\nServer: WSGIServer/0.2 CPython/3.4.4\ncontent-type: application/json\ncontent-length: 107\n\n{&quot;title&quot;: &quot;A Senha&quot;, &quot;id&quot;: &quot;a96e7212-6a29-478a-a24e-07720a286944&quot;, &quot;description&quot;: &quot;Um filme sobre Hackers&quot;}</code></pre></div>\n<p>E até mesmo apagá-lo:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">curl -i -XDELETE http://localhost:8000/movies/a96e7212-6a29-478a-a24e-07720a286944/\n\nHTTP/1.0 200 OK\nDate: Fri, 13 May 2016 02:26:52 GMT\nServer: WSGIServer/0.2 CPython/3.4.4\ncontent-type: application/json\ncontent-length: 9\n\n&quot;Deleted&quot;</code></pre></div>\n<p>E com isso fechamos as operações de <em>CRUD</em> através dos métodos <em>POST</em>, <em>GET</em>, <em>PUT</em> e <em>DELETE</em>.</p>\n<h2>Ser JSON, ou não ser...</h2>\n<p>Uma das premissas do <em>REST</em> é que um recurso possa ser apresentado de diferentes maneiras.\nPor exemplo, o nosso filme se acessado pelo navegador, poderia ser representado através de\num <em>HTML</em>. Por outro lado, se ele fosse acessado por uma requisição <em>Ajax</em>, ele poderia\nser representado por um <em>JSON</em>.</p>\n<p>Uma terceira modalidade de entrega poderia ser em <em>XML</em>, ou em qualquer formato\nque tanto cliente quanto fornecedor entendam. Esse \"acordo\" entre as partes é realizado\natravés do cabeçalho de requisição <code class=\"language-text\">Accept</code>, e pelo cabeçalho de resposta <code class=\"language-text\">content-type</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ curl -v -H &quot;Accept: application/json&quot; http://localhost:8000/movies/DED621D5-08F4-4D32-ADFA-84375BA415B9/\n\nGET /movies/DED621D5-08F4-4D32-ADFA-84375BA415B9/ HTTP/1.1\nHost: localhost:8000\nUser-Agent: curl/7.43.0\nAccept: application/json\n\nHTTP/1.0 200 OK\nDate: Fri, 13 May 2016 02:41:07 GMT\nServer: WSGIServer/0.2 CPython/3.4.4\ncontent-length: 221\ncontent-type: application/json</code></pre></div>\n<p>Com isso, permitimos que tanto cliente quanto fornecedor conversem livremente,\ndesde que em um mesmo dialeto. Embora não haja um padrão formal, é comum vermos\n<em>APIs</em> dando suporte a renderizações em <em>JSON</em> e <em>XML</em>.</p>\n<p>Isso pode parecer até um exagero, e uma complexidade questionável na sua aplicação.\nA boa notícia é que a maioria das bibliotecas <em>REST</em> dão suporte <em>built-in</em> a essa\nfuncionalidade.</p>\n<h2>Stateless</h2>\n<p>Uma das premissas do <em>REST</em> é a comunicação sem estados. Isso significa que,\nassim como o próprio <a href=\"/2012/04/05/entendendo-os-cookies-e-sessoes.html\" title=\"Leia mais sobre stateless, Cookies e Sessions\">protocolo <em>HTTP</em></a>,\nnão \"conserva-se informações\" entre as requisições.</p>\n<p>Na prática, isso significa que cliente pode enviar múltiplas requisições\npara o servidor, no entanto, cada uma delas deve ser independente. Cada uma\ndeve possuir toda a informação necessária para que o servidor possa interpretá-las\ncompletamente (e separadamente).</p>\n<p>Isso facilita o <a href=\"/2012/05/14/o-cache-e-o-http.html\" title=\"O Cache e o HTTP\"><em>caching</em></a> e\nescalabilidade da sua solução.</p>\n<p>Caso estados precisem ser armazenados, é uma responsabilidade do cliente fazê-los.</p>\n<h2>Considerações finais</h2>\n<p>Chegamos ao fim desse artigo, e uma pergunta fica: Mas o que é <em>RESTful</em>?</p>\n<p>Uma <em>API RESTful</em> na verdade é uma <em>API</em> que segue os princípios do <em>REST</em> de\nforma mais \"fiel\". Enquadrando-se plenamente nas seguintes regras:</p>\n<ul>\n<li>Cliente/servidor</li>\n<li><em>Stateless</em></li>\n<li>Cacheável</li>\n<li>Interface uniforme para comunicação entre o cliente e o servidor</li>\n<li>Uso de camadas (facilitando escalabilidade, confiabilidade e segurança)</li>\n</ul>\n<p>No fim das contas, sendo <em>REST</em> ou <em>RESTful</em>, utilizar os conceitos\né uma boa forma de criar serviços (de baixo custo) para as suas aplicações,\nque podem ser aplicados, por exemplo, dentro de uma arquitetura de microserviços.</p>\n<p>Até a próxima.</p>\n<h2>Referências</h2>\n<ul>\n<li><a href=\"http://www.hug.rest/website/quickstart\"><em>Hug - Embrace APIs from the future</em></a></li>\n<li><a href=\"http://imasters.expert/rest-architecture-model-definition-constraints-benefits/\"><em>iMasters - REST Architecture Model: Definition, Constraints and Benefits</em></a></li>\n<li><a href=\"https://www.infoq.com/br/articles/rest-introduction\"><em>InfoQ - REST Introduction</em></a></li>\n<li><a href=\"https://en.wikipedia.org/wiki/HATEOAS\"><em>Wikipedia - HATEOAS</em></a></li>\n<li><a href=\"https://pt.wikipedia.org/wiki/Hiperm%C3%ADdia\"><em>Wikipedia</em> - Hipermídia</a></li>\n<li><a href=\"https://pt.wikipedia.org/wiki/Hipertexto\"><em>Wikipedia</em> - Hipertexto</a></li>\n<li><a href=\"https://pt.wikipedia.org/wiki/URI\"><em>Wikipedia - URI</em></a></li>\n</ul>","excerpt":"No post anterior, demos uma pequena introdução\nao conceito de REST e fizemos um raso comparativo com o seu \"rival\", o SOAP.\nNesse artigo…","frontmatter":{"date":"2016-05-20T12:35:00.000Z","title":"REST - Parte 2","tags":["desenvolvimento-web","rest","microservices","api"],"thumbnail":{"childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsSAAALEgHS3X78AAABeElEQVQ4y+1TS0vDQBDun/UHePGqgiDoTUG99FJpC+LBi6+LaEFpFYqtovYR0jRJmyZp0zTPzT7ibLYHDxUVj7oMw8fs983M7uzm0l+s3N8VM8a+rwEqzfgLKn/MIzBL2aeVI4JbnpVm+UJMSdZGRChYtksR5SFEWEJ5Fp+gtm/PxXfjflFtAihJ5lZTP9ccaRZtPGqHXbNqevnWqCxZYOt1da3eN8IEWtmVqpMk5OLLUefG6gEoSmaha+2/GqqPVh6Uziy6HrrbT/qF5mgBKnTMiuEmlLdTUhtKOOXiM6NdsRUAJ8p46VYCfUjocq0nzeJBgK6G7mZDcxA+lu3WNBSnLaoNOZhwccWWj/RnAAdvQygCfd5b3mq9X5bsU9XJt0c7L0M7xpDiauCKq9mTaxYKuHiaRLWJygHCPiZeQsDD2fQAQRC8E2MAVpTAFgAXx4L/xSPJrhn84llxMU0ZZlRQhYECBkayKYsIAMLB/JEIfu7/S/5svQNm2ofsEtTfigAAAABJRU5ErkJggg==","width":180,"height":180,"src":"/static/e2c923a2910d4262b7b9beabf394f4c6/d8216/rest-logo.png","srcSet":"/static/e2c923a2910d4262b7b9beabf394f4c6/d8216/rest-logo.png 1x"}},"publicURL":"/static/e2c923a2910d4262b7b9beabf394f4c6/rest-logo.png"}},"fields":{"readingTime":{"minutes":10.19},"slug":"/2016/05/20/rest-parte-2.html"}},"site":{"siteMetadata":{"author":{"name":"Klaus Peter Laube","gravatar":"https://en.gravatar.com/userimage/12163112/d3ae0c6239980b01ff1f1730b65c2ebe.jpg"},"siteUrl":"https://klauslaube.com.br"}}},"pageContext":{"slug":"/2016/05/20/rest-parte-2.html"}}}