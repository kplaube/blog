{"componentChunkName":"component---src-templates-blog-post-js","path":"/2018/06/11/tchau-requirements-ola-pipfile.html","result":{"data":{"markdownRemark":{"html":"<p>Admito que no começo fui cético em relação ao <a href=\"https://github.com/pypa/pipfile\" title=\"The replacement for requirements.txt\"><em>Pipfile</em></a>. Pode ser a idade, mas questionei a real necessidade do mesmo. Para mim era muito óbvio! Eu já tinha o <a href=\"/tag/pip.html\" title=\"Leia mais sobre pip\"><em>pip</em></a>, o <a href=\"/tag/virtualenv.html\" title=\"Leia mais sobre virtualenv\"><em>virtualenv</em></a> e até mesmo o <a href=\"%7Btag%7D\" title=\"Leia mais sobre Pyenv\"><em>pyenv</em></a>. Hoje, após ler alguns artigos e debater com alguns colegas, fico até envergonhado de não ter visto o potencial da ferramenta no seu primeiro momento.</p>\n<p>Se você está na dúvida, assim como eu estive, vem comigo que te mostro as principais vantagens do <em>Pipfile</em> (e do <em>Pipenv</em>).</p>\n<h2>O que há de errado com o requirements.txt?</h2>\n<p>Esse foi o meu \"turning point\" em relação ao <em>Pipfile</em>. E foi o <a href=\"https://twitter.com/rcmachado\" title=\"Perfil no Twitter\"><em>@rcmachado</em></a> quem respondeu essa pergunta:</p>\n<blockquote>\n<p>O build não é determinístico.</p>\n</blockquote>\n<p>Vamos supor que estamos desenvolvendo um projeto em <a href=\"/tag/django.html\" title=\"Leia mais sobre Django\"><em>Django</em></a>. Instalamos via <code class=\"language-text\">pip install Django</code>, e jogamos a dependência no <code class=\"language-text\">requirements.txt</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># requirements.txt\n\nDjango</code></pre></div>\n<p>Como você garante que a mesma versão do <em>Django</em> está instalada nos diferentes ambientes do projeto (dev, qa, staging, production, etc)? Da forma acima, você não garante. O <code class=\"language-text\">pip</code> instalará a última versão do pacote disponível no <a href=\"https://pypi.org/\" title=\"The Python Package Index\"><em>PyPI</em></a>.</p>\n<p>Para minimizar esse problema, podemos \"pinar\" a versão do <em>Django</em>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># requirements.txt\n\nDjango==2.0.6</code></pre></div>\n<p>Agora garantimos a versão do <em>framework</em> em todos os ambientes do projeto. Sabemos que o <em>Django</em> tem uma dependência, o <a href=\"http://pytz.sourceforge.net/\" title=\"World Timezone Definitions for Python\"><em>pytz</em></a>, o que acontece com ela?</p>\n<p>Bem... se o <em>framework</em> estabelecer exatamente qual versão da dependência ele utiliza, não será um problema. Mas <a href=\"https://github.com/django/django/blob/master/setup.py#L86\">nem sempre isso acontece</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># django/setup.py</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span>\n\nsetup<span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span>\n    install_requires<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token string\">'pytz'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Para garantir que a mesma versão do <em>pytz</em> está sendo instalada nos diferentes ambientes do projeto, podemos \"pinar\" a sua versão no <code class=\"language-text\">requirements.txt</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># requirements.txt\n\nDjango==2.0.6\npytz==2018.4</code></pre></div>\n<p>E por fim, adicionar um <code class=\"language-text\">--no-deps</code> ao comando <code class=\"language-text\">pip</code>, assim ele se manterá fiel às dependências descritas no <code class=\"language-text\">requirements.txt</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ pip install -r requirements.txt --no-deps</code></pre></div>\n<p>Note que você virou responsável por uma função que deveria ser desempenhada pelo <em>package manager</em>. Com o passar do tempo, esse tipo de gestão passa a ser árdua e suscetível a erros.</p>\n<h2>Pipfile to the rescue</h2>\n<p>Segundo o <a href=\"https://github.com/pypa/pipfile\" title=\"the replacement for requirements.txt\">repositório oficial</a>, o <em>Pipfile</em> é:</p>\n<blockquote>\n<p>(...) a replacement for the existing standard pip's requirements.txt file.</p>\n</blockquote>\n<p>Como esperado, o padrão traz melhorias em relação ao <code class=\"language-text\">requirements.txt</code>. O já citado \"ambientes determinísticos\" é alcançado através do <code class=\"language-text\">Pipfile.lock</code>, um conceito usado em gerenciadores de pacotes de outras linguagens, como <a href=\"http://bundler.io/\" title=\"Package manager do Ruby\"><em>Bundler</em></a>, <a href=\"https://crates.io/\" title=\"Package manager do Rust\"><em>Cargo</em></a> ou <a href=\"https://yarnpkg.com/en/\" title=\"Package manager do Node\"><em>Yarn</em></a>, onde as versões das dependências são \"congeladas\", garantindo que você obtenha o mesmo resultado em qualquer ambiente, e executando quantas vezes quiser.</p>\n<p>Outra vantagem é o uso de um único arquivo para diferentes ambientes. Com o uso de <em>requirements</em>, geralmente acabamos com um arquivo de texto específico para cada ambiente:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># requirements.txt\n\nDjango</code></pre></div>\n<p>Mais um para dependências exclusivas do ambiente de desenvolvimento:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># requirements-dev.txt\n\n-r requirements.txt\n\ndjango-debug-toolbar\npytest</code></pre></div>\n<p>Com o <em>Pipfile</em>, é possível utilizar o mesmo arquivo:</p>\n<div class=\"gatsby-highlight\" data-language=\"ini\"><pre class=\"language-ini\"><code class=\"language-ini\"><span class=\"token comment\"># Pipfile</span>\n\n<span class=\"token header\"><span class=\"token punctuation\">[</span><span class=\"token section-name selector\">[source</span><span class=\"token punctuation\">]</span></span>]\n<span class=\"token key attr-name\">url</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">\"<span class=\"token inner-value\">https://pypi.org/simple</span>\"</span>\n<span class=\"token key attr-name\">verify_ssl</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">true</span>\n<span class=\"token key attr-name\">name</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">\"<span class=\"token inner-value\">pypi</span>\"</span>\n\n<span class=\"token header\"><span class=\"token punctuation\">[</span><span class=\"token section-name selector\">dev-packages</span><span class=\"token punctuation\">]</span></span>\n<span class=\"token key attr-name\">pytest</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">\"<span class=\"token inner-value\">*</span>\"</span>\n\n<span class=\"token header\"><span class=\"token punctuation\">[</span><span class=\"token section-name selector\">packages</span><span class=\"token punctuation\">]</span></span>\n<span class=\"token key attr-name\">Django</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">\"<span class=\"token inner-value\">*</span>\"</span>\n\n<span class=\"token header\"><span class=\"token punctuation\">[</span><span class=\"token section-name selector\">requires</span><span class=\"token punctuation\">]</span></span>\n<span class=\"token key attr-name\">python_version</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">\"<span class=\"token inner-value\">3.6</span>\"</span></code></pre></div>\n<h2>Pipfile != Pipenv</h2>\n<p>Grande parte dos artigos que lí sobre <em>Pipfile</em> começavam com algum comando como o abaixo:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ pipenv install django</code></pre></div>\n<p>Uma coisa que tem que ficar clara é: O <em>Pipenv</em> está para o <em>pip</em>, assim como o <em>Pipfile</em> está para o <em>requirements</em>.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ecdabcffb739710e8a9a1ab2a1eae89a/c08c5/rambo-knife.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.4375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAUDBAb/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAv/aAAwDAQACEAMQAAABXzlGWhFIn//EABoQAAICAwAAAAAAAAAAAAAAAAECAxARITP/2gAIAQEAAQUC2GUkLEcxnglf/8QAFREBAQAAAAAAAAAAAAAAAAAAEEH/2gAIAQMBAT8Bh//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAECAQE/AVf/xAAZEAEAAgMAAAAAAAAAAAAAAAABABAhQZH/2gAIAQEABj8CHcXsM0V//8QAGhAAAwADAQAAAAAAAAAAAAAAAAERIUFRYf/aAAgBAQABPyGdIGud1keJKDNWnGZuumkf/9oADAMBAAIAAwAAABAXH//EABcRAAMBAAAAAAAAAAAAAAAAAAABETH/2gAIAQMBAT8QS2U//8QAFhEAAwAAAAAAAAAAAAAAAAAAARAx/9oACAECAQE/EBE//8QAHBABAAMBAAMBAAAAAAAAAAAAAQARITFBUXGh/9oACAEBAAE/EAa1Y21ZSDaza2m35v5PEvsJBbrHRp5EhVjy/GK9Hk//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"&quot;Rambo segurando sua faca&quot;\"\n        title=\"Pipenv é tipo a faca do Rambo. Resolve qualquer parada (mann.tv)\"\n        src=\"/static/ecdabcffb739710e8a9a1ab2a1eae89a/c08c5/rambo-knife.jpg\"\n        srcset=\"/static/ecdabcffb739710e8a9a1ab2a1eae89a/7809d/rambo-knife.jpg 192w,\n/static/ecdabcffb739710e8a9a1ab2a1eae89a/4ecad/rambo-knife.jpg 384w,\n/static/ecdabcffb739710e8a9a1ab2a1eae89a/c08c5/rambo-knife.jpg 640w\"\n        sizes=\"(max-width: 640px) 100vw, 640px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Pipenv é tipo a faca do Rambo. Resolve qualquer parada (mann.tv)</figcaption>\n  </figure></p>\n<p>Até o momento da publicação desse artigo, o <code class=\"language-text\">pip</code> não suporta o formato do <em>Pipfile</em> (ou pelo menos a versão que tenho instalada aqui). Portanto, a maneira mais conveniente de utilizar o <em>Pipfile</em> hoje é através do utilitário de linha de comando <code class=\"language-text\">pipenv</code>.</p>\n<p>Segundo o <a href=\"https://github.com/pypa/pipenv\" title=\"Python Development Workflow for Humans\">repositório oficial</a>, o <em>Pipenv</em> é:</p>\n<blockquote>\n<p>(...) a tool that aims to bring the best of all packaging worlds (bundler, composer, npm, cargo, yarn, etc.) to the Python world. Windows is a first–class citizen, in our world.</p>\n</blockquote>\n<p>Através do <em>parsing</em> do <em>Pipfile</em>, a ferramenta resolve dependências do projeto (através dos parâmetros <code class=\"language-text\">install</code>, <code class=\"language-text\">uninstall</code> ou <code class=\"language-text\">update</code>), exibe a árvore de dependências (através do parâmetro <code class=\"language-text\">graph</code>) e analisa as mesmas (através do <code class=\"language-text\">check</code>). Mas além de atuar como um gerenciador de pacotes, o <em>Pipenv</em> tem uma funcionalidade fantástica: Cria e gerencia <em>virtualenvs</em> de forma automática.</p>\n<h2>Virtualização out of the box</h2>\n<p>Já escrevi sobre virtualização com <a href=\"/2015/07/23/virtualenvwrapper-o-basico-para-um-bom-ambiente-de-desenvolvimento-python.html\" title=\"Artigo sobre Virtualenvwrapper\"><em>virtualenv</em></a> e <a href=\"/2016/04/26/o-simples-e-poderoso-pyenv.html\" title=\"Artigo sobre pyenv\"><em>pyenv</em></a>. Com o <em>Pipenv</em>, a coisa fica significativamente mais simples.</p>\n<p>Ao executar o comando <code class=\"language-text\">pipenv install</code>, por exemplo, a ferramenta automaticamente criará um <em>virtualenv</em> (caso não exista) para o projeto no qual você está trabalhando. Por exemplo:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ mkdir -p ~/workspace/test-pipenv\n$ cd ~/workspace/test-pipenv/\n$ pipenv install django\n\nCreating a virtualenv for this project…\nUsing /home/klaus/.pyenv/versions/2.7.14/bin/python2.7 (2.7.14) to create virtualenv…</code></pre></div>\n<p>Caso você esteja curioso para saber aonde o seu <em>virtualenv</em> foi parar, o comando abaixo pode ajudar:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ pipenv --venv\n\n/home/klaus/.local/share/virtualenvs/test-pipenv-BzNa0eOE</code></pre></div>\n<p>Mas você não precisa se preocupar em saber onde o <code class=\"language-text\">activate.sh</code> está. Para ativar o <em>virtualenv</em> criado, o parâmetro <code class=\"language-text\">shell</code> é a melhor saída:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ pipenv shell\n\nSpawning environment shell (/bin/zsh). Use 'exit' to leave.\n. /home/klaus/.local/share/virtualenvs/test-pipenv-BzNa0eOE/bin/activate</code></pre></div>\n<p>Frustrado com o <em>Python 2.7</em>? Sem problemas! Vamos transformar o projeto em <em>Python 3</em>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ pipenv install --three</code></pre></div>\n<p>O comando criará um novo <em>virtualenv</em>, dessa vez com a versão mais recente da linguagem. Não esqueça de atualizar o <code class=\"language-text\">python_version</code> do <code class=\"language-text\">Pipfile</code>.</p>\n<h2>Considerações finais</h2>\n<p>Com o <a href=\"https://devcenter.heroku.com/articles/python-support\" title=\"Python Support - Heroku\"><em>Heroku</em> adotando <em>Pipfile</em></a>, me senti mais motivado a migrar alguns projetos para o padrão.</p>\n<p>Como resultado, tenho simplificado a <em>stack</em> dos mesmos. Antes, eu gerenciava os ambientes virtuais com um <em>mix</em> de <em>virtualenvwrapper</em> e <em>pyenv</em>. Hoje, com apenas um utilitário de linha de comando, sou capaz de gerenciar dependências e virtualização. Além disso, acredito que o <em>setup</em> de um projeto <em>Python</em> fique mais homogêneo, uma vez que não há necessidade de um combo <code class=\"language-text\">pip + {virtualenv,virtualenvwrapper,pyenv}</code>.</p>\n<p>Até a próxima.</p>\n<h2>Referências</h2>\n<ul>\n<li><a href=\"https://www.mattlayman.com/2017/using-pipfile-for-fun-and-profit.html\">mattlayman - Using Pipfile for fun and profit</a></li>\n<li><a href=\"https://medium.com/grupy-rn/gerenciando-suas-depend%C3%AAncias-e-ambientes-python-com-pipenv-9e5413513fa6\">Medium - Gerenciando suas dependências e ambientes python com pipenv</a></li>\n<li><a href=\"https://docs.pipenv.org\">Pipenv - Python Dev Workflow for Humans</a></li>\n<li><a href=\"https://realpython.com/pipenv-guide/\">Real Python - Pipenv: A Guide to the New Python Packaging Tool</a></li>\n</ul>","excerpt":"Admito que no começo fui cético em relação ao Pipfile. Pode ser a idade, mas questionei a real necessidade do mesmo. Para mim era muito…","frontmatter":{"date":"2018-06-11T16:40:00.000Z","title":"Tchau, requirements. Olá, Pipfile!","tags":["python","pip","virtualenv","pipfile","pipenv"],"thumbnail":{"childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAADT0lEQVQ4y4WU+09UVxDH9y9pY1KrhaX6Q3UtaCGYGE2spvqD8dGmglJFl5UGtCQqpiY0MdTXFZTnEl/4aFXESAGDSKMReSpoQSMLVLE+ipooMeu95+Pcvfcuu2vESSZnN3fO53xn5sxxKaX4kOuGEe26gSGraU5MrLkmAn7IjIhvsXGu2ODIgKabQxRf6GTP2Vb2nLmOv76L3sDjiRXGwnQ7pcNNt8nQ6vmhsJbJ6QeJzzjI1DSN6T8V0dw9EIoxY8NQew2lbNgfzICgbgHT99VT2dhDycUuJv1YROKmSmZvqmDq6n1srWy0gPpb2Sd7baDJCNfQMKLlm7AVu2rJ2F9H2u7aENDjLSM+fT/5VZcsoMlxYPYaStmB3Rp8Rt6Ra2RXXGGzv4Ut/ivk+ZvJLmkgKduPZ2OpADXy/Rfh0V70O17U/812ypZSl9OxR6OvSdlew+cbjuL2HiUuswp3ph/3+nIS1pXiyaogyVeOe43G1rLz0LcM/e/PUDeSUW9G7DIauJwmnLk+wBRvNUl5fzBr80m+zj3OdK+fhPVlAiwhfm0xCWs1Pl11gJKzUsO+peitSairbtSTWhuom0BL4YG6XuJ8J5i15TQzcqqZ5jvG8sJL+Epb8B66TNahJjK1BnafusxY/05om4lqSwYTOFxs11AfV1j0lwVM/OU0X/qq0Wpa4L+9MJwjngtDP8Og+L3voT1RYN8IdI4FHNLeB55vG+SLrGo8uSdYWNDI2L/l0JvM2+55GF2pGJ0pGO1z0AWkOuYKNEWg4lfjo1N2mvL4xRip+TV8sqaSbwsaeBP4TYALULeXoHoWorpTUZ3SgPbZcEPSbf1K1MXJ/3mo4PPxpkRem+7AU7Ydv4ZW109wuFCA81G9i8S/QwV2QGAn6n4+akBqOFAgv39FvewIw8KTEjvwIXvwuyhbINDFsor3r4O7cu/urIaRKgsSHlnrDkZNiqPUHCfzLPVAFN6aKykvDUHp8MCTPwV2GHU3x4IZwajRC0+KA7Tg9mmvelB9K1E3U6UW4h3S2X/SJM1tkmb7uLLYx+G95ytiNlVwFDXagBqpsPzpOZmKh1GjNuHz5chW9gbnABVRr8iaOfEff2AdhSZU7pbjKuTRz1WsvQOAZnfm2TGBHwAAAABJRU5ErkJggg==","width":180,"height":180,"src":"/static/7f2a92f8e64d5340552525c4391133b2/d8216/python-logo.png","srcSet":"/static/7f2a92f8e64d5340552525c4391133b2/d8216/python-logo.png 1x"}},"publicURL":"/static/7f2a92f8e64d5340552525c4391133b2/python-logo.png"}},"fields":{"readingTime":{"minutes":5.385},"slug":"/2018/06/11/tchau-requirements-ola-pipfile.html"}},"site":{"siteMetadata":{"author":{"name":"Klaus Peter Laube","gravatar":"https://en.gravatar.com/userimage/12163112/d3ae0c6239980b01ff1f1730b65c2ebe.jpg"},"siteUrl":"https://klauslaube.com.br"}}},"pageContext":{"slug":"/2018/06/11/tchau-requirements-ola-pipfile.html"}},"staticQueryHashes":["2831923220","4114525740"]}