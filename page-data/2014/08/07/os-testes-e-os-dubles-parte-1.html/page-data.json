{"componentChunkName":"component---src-templates-blog-post-js","path":"/2014/08/07/os-testes-e-os-dubles-parte-1.html","result":{"data":{"markdownRemark":{"html":"<p>Em tempos onde <a href=\"http://martinfowler.com/articles/is-tdd-dead/\" title=\"Is TDD dead?\">discussões envolvendo a relevância</a> dos <a href=\"/tag/testes.html\" title=\"Leia mais sobre testes\">testes</a> têm\ncausado furor nos diferentes campos da área do desenvolvimento de <em>software</em>,\nnada mais justo do que \"chovermos no molhado\", e falarmos sobre testes, <em>mocks</em>,\n<em>stubs</em> e todos os seus primos menos famosos.</p>\n<p>Nessa primeira parte, vamos conceituar toda essa \"sopa de letrinhas\" e detalhar\na forma peculiar como os testes são tratados dentro de um dos times\nda <a href=\"http://globo.com\" title=\"Absolutamente tudo sobre notícias, esportes e entretenimento\"><em>Globo.com</em></a>.</p>\n<h2>Qual causa, motivo, razão ou circunstância?</h2>\n<p>Eu gosto muito da linha de pensamento que colegas como <em><a href=\"http://twitter.com/rafael_mws\" title=\"Siga o Cabra no Twitter\">Rafael Martins</a></em> e\n<em><a href=\"https://twitter.com/romulojales\" title=\"Siga o Rômulo\">Rômulo Jales</a></em>, têm em relação a testes automatizados: Pare de perder tempo\nseparando-os em unitários, funcionais, aceitação ou regressão, e vá escrevê-los.</p>\n<p>Particularmente, acho vantajoso praticar o <a href=\"/tag/tdd.html\" title=\"Leia mais sobre TDD\"><em>TDD</em></a>, deixando com que os\ntestes me ajudem a montar a arquitetura da aplicação. Quando roubamos um pouco\nda filosofia do parágrafo anterior, temos um foco maior na resolução de um\nrequisito do que na \"minúcia\" de uma classe/módulo/pacote. Organicamente\nconseguimos atingir um desenvolvimento focado no funcional, muito próximo de\npropostas como a do <a href=\"/tag/bdd.html\" title=\"Leia mais sobre BDD\"><em>BDD</em></a>, sem precisar recorrer a artifícios\ncomo <em>user stories</em>.</p>\n<p>Ok... deixamos de ser tão \"unitários\", e aprendemos a lidar com o todo. Mas e\nos acessos ao banco de dados? Ao <em><a href=\"/tag/memcached.html\" title=\"Leia mais sobre Memcached\">Memcached</a></em> ou <em>Redis</em>? E as interações\nentre meus serviços e <em>APIs</em> internas? E as escritas em disco? E as sessões\ndo usuário?</p>\n<p>Como lidar com tudo isso?</p>\n<h2>O Case de Esportes 1</h2>\n<p>O <em>Esportes 1</em> é um dos 3 times que compõe o núcleo de desenvolvimento da área\nde esportes, da <em>Globo.com</em>.</p>\n<p>No time, decidimos que a maioria dessas interações deve estar lá em tempo de\nexecução dos testes. Ou seja, (<a href=\"https://docs.djangoproject.com/en/dev/topics/testing/tools/\" title=\"Testing Tools\">com uma ajudinha do <em>Django</em></a>) nossos testes\nconsultam o banco de dados, interagem com a camada de cache, escrevem em\ndisco, etc.</p>\n<p>Somos tão preguiçosos que os testes chegam a consultar os ambientes de\nteste/desenvolvimento dos serviços criados por outros times, como dados\nsemânticos, de dados esportivos, de vídeos, etc.</p>\n<p>Obviamente temos o <em>trade-off</em> dos tempos de execução, que até o momento não\nchegaram a ser um problema tão grande para a equipe.</p>\n<h3>Um lugar escuro e frio</h3>\n<p>Concluímos que nossos testes não são nem de longe isolados. Estamos mais\npreocupados em validar o comportamento de uma funcionalidade do que de um\nobjeto em específico.</p>\n<p>Batemos no peito, orgulhosos de nossa decisão, e começamos a encarar o mundo\ncom olhos marejados pelo árduo caminho que percorremos para chegar até aqui.</p>\n<p>Mas existe a \"borda\" da aplicação. Dali para fora, você não tem controle algum\nsobre o que acontece. Você apenas tem a promessa de que aquela <em>API</em> vai\nfuncionar. Deixar com que os testes batam nesses serviços \"estrangeiros\" pode\ncustar muito tempo (e claro, dinheiro), tornando inviável a execução dos mesmos\nem tempo de desenvolvimento.</p>\n<p>E é aí meu amigo, depois dessa justificativa gigante, que entram os <em>mocks</em>,\n<em>stubs</em>, <em>spies</em>, etc.</p>\n<h2>Don't mock me!</h2>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 612px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/09fe506dca4f5502d60a2e5374b42e52/a18e1/dubles.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 65.10416666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIEA//EABYBAQEBAAAAAAAAAAAAAAAAAAECA//aAAwDAQACEAMQAAABxmRjVCgZ/8QAGhAAAgMBAQAAAAAAAAAAAAAAAQIDERIAIv/aAAgBAQABBQI5McYMbvH6rsWA9L//xAAXEQADAQAAAAAAAAAAAAAAAAAAARJR/9oACAEDAQE/AYJWn//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABsQAAMAAgMAAAAAAAAAAAAAAAABMQKRESIj/9oACAEBAAY/Al6Vway6jujkors//8QAGhABAAMBAQEAAAAAAAAAAAAAAQARITFBUf/aAAgBAQABPyHFK+Ih26Oyxq2wVNPajoX92bSyl+J//9oADAMBAAIAAwAAABAD/wD/xAAXEQEBAQEAAAAAAAAAAAAAAAABACHw/9oACAEDAQE/EMA3Iv/EABgRAAMBAQAAAAAAAAAAAAAAAAABESFR/9oACAECAQE/EKnTeH//xAAcEAEBAAIDAQEAAAAAAAAAAAABEQAhMUFRYYH/2gAIAQEAAT8QCuz2PcC++S5OAU3Lt1HsyUjRu4/ROnCkGSBkZpxAYUuLbvG5bRGOfPzP/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"&quot;Entram os dublês!&quot;\"\n        title=\"Entram os dublês!\"\n        src=\"/static/09fe506dca4f5502d60a2e5374b42e52/a18e1/dubles.jpg\"\n        srcset=\"/static/09fe506dca4f5502d60a2e5374b42e52/7809d/dubles.jpg 192w,\n/static/09fe506dca4f5502d60a2e5374b42e52/4ecad/dubles.jpg 384w,\n/static/09fe506dca4f5502d60a2e5374b42e52/a18e1/dubles.jpg 612w\"\n        sizes=\"(max-width: 612px) 100vw, 612px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Entram os dublês!</figcaption>\n  </figure></p>\n<p>Vamos abrir um parênteses aqui para esclarecer o conceito de \"mock\".\nNa <a href=\"http://www.voidspace.org.uk/python/mock/#terminology\" title=\"Biblioteca de mock do Python\">documentação da biblioteca de <em>mock</em> do <em>Python</em></a>, temos a seguinte\n(e incrivelmente sucinta) definição:</p>\n<blockquote>\n<p>A “mock object” is an object used to replace a real one in a system under test.</p>\n</blockquote>\n<p>Ou, <a href=\"http://www.infoq.com/br/articles/mocks-Arent-Stubs\" title=\"A diferença entre Mocks e Stubs\">nas palavras de <em>Martin Fowler</em></a>:</p>\n<blockquote>\n<p>(...) objetos pré-programados com informações que formam uma especificação das chamadas que esperam receber.</p>\n</blockquote>\n<p>O termo <em>mock</em> faz parte de um conceito mais genérico, conhecido por\n<em>Test Double</em>. Segundo <em>Fowler</em>, esse termo é usado para qualquer objeto que\ntem por finalidade, em um teste, substituir um objeto real.</p>\n<p>Logo, quando em <em>Esportes1</em> consumimos um recurso externo, \"mentimos\" para o\nsistema. Além do <strong>Mock</strong>, existem outros dublês que nos ajudam nessa tarefa:</p>\n<ul>\n<li><strong>Dummy:</strong> Objetos com o propósito apenas de \"ocupar espaço\", geralmente usados em passagens de parâmetros;</li>\n<li><strong>Fake:</strong> Objetos funcionais, mas inadequados para um ambiente de produção;</li>\n<li><strong>Stubs:</strong> Providenciam respostas pré-configuradas, e normalmente não respondem a nada que não esteja programado para o teste;</li>\n<li><strong>Spies:</strong> Você pega um objeto real, substituindo o comportamento apenas de alguns métodos.</li>\n</ul>\n<p>O <em>InfoQ</em> possui um artigo do <em>Martin Fowler</em>, <a href=\"http://www.infoq.com/br/articles/mocks-Arent-Stubs\" title=\"Mocks não são Stubs\">traduzido para o Português</a>,\nonde ele conceitua bem os diferentes tipos de dublês, principalmente o <em>mock</em>\ne <em>stub</em>. Vale a leitura.</p>\n<p>Na segunda parte deste <em>post</em>, utilizaremos cada conceito de forma prática, e\ndiscutiremos um pouco mais sobre o grande dilema: Mockar ou não mockar.</p>\n<p>Até a próxima.</p>\n<h2>Referências</h2>\n<ul>\n<li><a href=\"http://www.infoq.com/br/articles/mocks-Arent-Stubs\" title=\"Leia o artigo do Martin Fowler, traduzido para pt-BR\"><em>Info Q</em> - <em>Mocks</em> não são <em>Stubs</em></a></li>\n<li><a href=\"http://www.voidspace.org.uk/python/mock/#terminology\" title=\"Leia sobre a terminologia usada pela lib mock\"><em>Mock</em> - <em>Mocking and Testing Library</em></a></li>\n<li><a href=\"http://docs.mockito.googlecode.com/hg/latest/org/mockito/Mockito.html#13\" title=\"Definição de Spies pela Mockito\"><em>Mockito</em> - <em>Spying on real objects</em></a></li>\n</ul>","excerpt":"Em tempos onde discussões envolvendo a relevância dos testes têm\ncausado furor nos diferentes campos da área do desenvolvimento de software…","frontmatter":{"date":"2014-08-07T23:00:00.000Z","title":"Os testes e os dublês - Parte 1","tags":["testes","mock","python"],"thumbnail":{"childImageSharp":{"fixed":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAQFA//EABYBAQEBAAAAAAAAAAAAAAAAAAIBAP/aAAwDAQACEAMQAAABztCSsXNdTMVAbGFv/8QAGhAAAgMBAQAAAAAAAAAAAAAAAQMAAgQSI//aAAgBAQABBQLPTssQKjmYT6utCQIthWWNJrP/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AR//xAAWEQEBAQAAAAAAAAAAAAAAAAAQAUH/2gAIAQIBAT8Bpp//xAAbEAACAgMBAAAAAAAAAAAAAAABEAAREjFxgf/aAAgBAQAGPwKn5MQrEGhxf//EABwQAAICAgMAAAAAAAAAAAAAAAABESExQRBRYf/aAAgBAQABPyGPwWxgxmo4XFMBHr2PoKK2oaaKuA23s//aAAwDAQACAAMAAAAQgyBA/8QAFhEBAQEAAAAAAAAAAAAAAAAAARBB/9oACAEDAQE/EAmT/8QAFxEBAQEBAAAAAAAAAAAAAAAAARARMf/aAAgBAgEBPxBu4R4n/8QAHBABAQEBAAIDAAAAAAAAAAAAAREAQSExUZGx/9oACAEBAAE/EAUSFSyGCF5Ly53NNmmsilvT41jQR6nL6X70CaBMnv8AYITQylrCfrlKpd//2Q==","width":180,"height":180,"src":"/static/0aaf99220e3bd94ca9d1e67b400bed38/a8ad2/test-double.jpg","srcSet":"/static/0aaf99220e3bd94ca9d1e67b400bed38/a8ad2/test-double.jpg 1x"}},"publicURL":"/static/0aaf99220e3bd94ca9d1e67b400bed38/test-double.jpg"}},"fields":{"readingTime":{"minutes":4.255},"slug":"/2014/08/07/os-testes-e-os-dubles-parte-1.html"}},"site":{"siteMetadata":{"author":{"name":"Klaus Peter Laube","gravatar":"https://en.gravatar.com/userimage/12163112/d3ae0c6239980b01ff1f1730b65c2ebe.jpg"},"siteUrl":"https://klauslaube.com.br"}}},"pageContext":{"slug":"/2014/08/07/os-testes-e-os-dubles-parte-1.html"}}}