{"componentChunkName":"component---src-templates-blog-post-js","path":"/2017/01/06/construindo-apis-em-django-com-restless.html","result":{"data":{"markdownRemark":{"html":"<p>Construir <em>APIs</em> <a href=\"/tag/rest.html\" title=\"Leia mais sobre REST\"><em>REST</em></a> em\n<a href=\"/tag/django.html\" title=\"Leia mais sobre Django\"><em>Django</em></a> nos dias atuais é uma\ntarefa no máximo corriqueira. Com a ajuda de bibliotecas consagradas, como\n<a href=\"http://www.django-rest-framework.org/\"><em>Django REST Framework</em></a> e\n<a href=\"https://django-tastypie.readthedocs.io/en/latest/\"><em>Tastypie</em></a>,\ne utilizando toda a abstração que envolve os <em>Models</em> do <em>framework</em>, é\npossível ter <em>endpoints</em> respondendo em questão de minutos.</p>\n<p>Mas existem alternativas que são capazes de tornar esse processo ainda\nmais prático, e com uma curva de aprendizado um pouquinho menor. Nesse\nseleto grupo, uma biblioteca que me agrada é o <a href=\"https://github.com/toastdriven/restless\"><em>Restless</em></a>.</p>\n<h2>Por que Restless (e não as outras)?</h2>\n<p><a href=\"https://github.com/toastdriven\"><em>Daniel Lindsley</em></a> (também conhecido como <em>Toast Driven</em>),\num dos criadores do <em>Tastypie</em> (famosa biblioteca <em>Django</em> para construção de <em>APIs RESTful</em>),\ntambém é criador do <em>Restless</em>. Segundo ele, o que o motivou a escrever uma alternativa ao <em>Tastypie</em> foi:</p>\n<blockquote>\n<p>Quite simply, I care about creating flexible &#x26; RESTFul APIs. In building Tastypie, I tried\nto create something extremely complete &#x26; comprehensive. The result was writing a lot of hook\nmethods (for easy extensibility) &#x26; a lot of (perceived) bloat, as I tried to accommodate for\neverything people might want/need in a flexible/overridable manner.</p>\n</blockquote>\n<p>Não há dúvidas que as duas bibliotecas citadas no início desse artigo são extremamente completas.\nSe você estiver procurando um <em>engine</em> poderoso para a criação de <em>APIs</em> em <em>Django</em>, pule logo\npara a <a href=\"http://www.django-rest-framework.org/tutorial/quickstart/\" title=\"Comece agora com o REST Framework\">documentação do <em>Django REST Framework</em></a>.</p>\n<p>Mas nem sempre precisamos de todo esse poderio para dar vida ao nosso projeto. E é exatamente\ncom esse posicionamento que <em>Daniel</em> fecha o seu argumento:</p>\n<blockquote>\n<p>But in reality, all I really ever personally want are the RESTful verbs, JSON serialization &#x26;\nthe ability of override behavior.</p>\n</blockquote>\n<p>Se assim como o autor você só precisa dos verbos <em>HTTP</em>, serialização <em>JSON</em> e uma leve camada\nde customização, talvez o <em>Restless</em> seja tudo o que você necessita.</p>\n<p>Por último mas não menos importante: O <em>Restless</em>, é \"framework agnostic\" e funciona com <em>Django</em>,\n<em>Flask</em>, <em>Pyramid</em> e <em>Tornado</em>.</p>\n<h2>Mão na massa</h2>\n<p>Lembra do nosso \"mini IMDB\", lá do <a href=\"/2016/05/20/rest-parte-2.html\" title=\"Leia mais sobre REST\"><em>post</em> sobre <em>REST</em></a>? Vamos aproveitar a temática para exemplificar\no uso de <em>Restless</em> com <em>Django</em>. Mas antes, aquele <code class=\"language-text\">pip</code> \"de leve\" para instalar o pacote:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ pip install restless</code></pre></div>\n<p>Não é necessária a adição da biblioteca ao <code class=\"language-text\">settings.py</code>.</p>\n<p>Relembrando o exemplo do <em>post</em> anterior, precisaremos construir os seguintes recursos:</p>\n<ul>\n<li><code class=\"language-text\">GET /movies</code>: Trará uma lista de filmes</li>\n<li><code class=\"language-text\">POST /movies</code>: Adicionará um novo filme ao banco de dados</li>\n<li><code class=\"language-text\">GET /movies/{id}</code>: Trará um filme específico</li>\n<li><code class=\"language-text\">PUT /movies/{id}</code>: Atualizará um filme específico</li>\n<li><code class=\"language-text\">DELETE /movies/{id}</code>: Removerá um filme específico do banco de dados</li>\n</ul>\n<p>Para tanto, teremos um <em>model</em> <em>Django</em> similar ao abaixo:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># movies/models.py</span>\n\n<span class=\"token keyword\">import</span> uuid\n<span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>db <span class=\"token keyword\">import</span> models\n\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Movie</span><span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">.</span>Model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token builtin\">id</span> <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>UUIDField<span class=\"token punctuation\">(</span>primary_key<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> default<span class=\"token operator\">=</span>uuid<span class=\"token punctuation\">.</span>uuid4<span class=\"token punctuation\">,</span> editable<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">)</span>\n    title <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>CharField<span class=\"token punctuation\">(</span>max_length<span class=\"token operator\">=</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span>\n    description <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>TextField<span class=\"token punctuation\">(</span>blank<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> null<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Podemos partir agora para a criação dos <em>resources</em>.</p>\n<h2>Resourcers e Preparers</h2>\n<p><em>Resources</em> são classes que descrevem um recurso <em>REST</em>, dentro do <em>Restless</em>. É através deles\nque definiremos <em>endpoints</em> e todos os verbos suportados. Já os <em>Preparers</em> fazem\no papel do \"mapping\" do objeto que você está expondo na API.</p>\n<p>Para começar, vamos criar um arquivo <code class=\"language-text\">api.py</code> dentro do nosso <em>app</em>:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># movies/api.py</span>\n\n<span class=\"token keyword\">from</span> restless<span class=\"token punctuation\">.</span>dj <span class=\"token keyword\">import</span> DjangoResource\n<span class=\"token keyword\">from</span> restless<span class=\"token punctuation\">.</span>preparers <span class=\"token keyword\">import</span> FieldsPreparer\n\n<span class=\"token keyword\">from</span> movies<span class=\"token punctuation\">.</span>models <span class=\"token keyword\">import</span> Movie\n\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">MovieResource</span><span class=\"token punctuation\">(</span>DjangoResource<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    preparer <span class=\"token operator\">=</span> FieldsPreparer<span class=\"token punctuation\">(</span>fields<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>\n        <span class=\"token string\">'id'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'id'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'title'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'title'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'description'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'description'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">list</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> Movie<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>O <code class=\"language-text\">DjangoResource</code> é um <em>Resource</em> <em>Restless</em> com algumas \"facilidades\" para funcionar dentro do\nframework <em>Django</em>. Uma dessas facilidades é o roteamento (que veremos logo abaixo).</p>\n<p>Todo recurso precisa de um atributo <code class=\"language-text\">preparer</code>, é através dele que o <em>Resource</em> fará o \"de-para\"\ndos campos no seu banco dados, e os campos que serão exibidos em sua <em>API</em>. Nesse caso\nestamos utilizando o <code class=\"language-text\">FieldsPreparer</code>, e através de um dicionário (onde a chave é o nome do campo\nna <em>API</em> e o valor é o caminho para o dado) fazemos o mapeamento necessário para expor os\ndados do recurso.</p>\n<p>O método <code class=\"language-text\">list</code> será o responsável por responder uma rota <code class=\"language-text\">GET /movies/</code> em nosso projeto. Aqui já\npodemos ver o conceito de <em>BYOD</em> (<em>Bring Your Own Data</em>) em ação. O <em>Restless</em> não \"introspecta\"\nos seus <em>models</em> <em>Django</em> para entender o que e como ele deve expor dados. É necessário que\nvocê faça isso explicitamente... é esse princípio que torna fácil o trabalho da biblioteca com outros\n<em>frameworks</em> e bancos de dados.</p>\n<p>Falta atualizar o <code class=\"language-text\">urls.py</code> para que o <em>Django</em> possa fazer o roteamento dos endereços\ncom as <em>views</em>:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># urls.py</span>\n\n<span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>conf<span class=\"token punctuation\">.</span>urls <span class=\"token keyword\">import</span> url<span class=\"token punctuation\">,</span> include\n\n<span class=\"token keyword\">from</span> movies<span class=\"token punctuation\">.</span>api <span class=\"token keyword\">import</span> MovieResource\n\nurlpatterns <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    url<span class=\"token punctuation\">(</span><span class=\"token string\">r'movies/'</span><span class=\"token punctuation\">,</span> include<span class=\"token punctuation\">(</span>MovieResource<span class=\"token punctuation\">.</span>urls<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<p>Aquele <code class=\"language-text\">.urls()</code> é uma das facilidades que o <code class=\"language-text\">DjangoResource</code> oferece. Caso você esteja trabalhando\ncom algum outro <em>framework</em>, você pode estender o comportamento de <code class=\"language-text\">Resource</code> e resolver o roteamento\nmanualmente.</p>\n<p>Pronto! O <em>endpoint</em> <code class=\"language-text\">movies/</code> já está respondendo:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ curl -X GET http://localhost:8000/movies/ | json_pp\n\n{\n   \"objects\" : [\n      {\n         \"description\" : \"The Rebel Alliance makes a risky move to steal the plans for the Death Star, setting up the epic saga to follow. (133 mins.)\",\n         \"id\" : \"7e383f9c-5dc4-4b0d-9864-71e05a5d271b\",\n         \"title\" : \"Rogue One\"\n      },\n      (...)\n   ]\n}</code></pre></div>\n<h2>Criação e autorização</h2>\n<p>Para adicionar um filme, faremos um POST em <code class=\"language-text\">movies/</code>, para isso, precisamos adicionar um método <code class=\"language-text\">create</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># movies/api.py</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">MovieResource</span><span class=\"token punctuation\">(</span>DjangoResource<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">list</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> Movie<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">create</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> Movie<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span>create<span class=\"token punctuation\">(</span>\n            title<span class=\"token operator\">=</span>self<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">[</span><span class=\"token string\">'title'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            description<span class=\"token operator\">=</span>self<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">[</span><span class=\"token string\">'description'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">)</span></code></pre></div>\n<p>Mais uma vez o <em>Restless</em> não introspecta o modelo, logo, é necessário fazer a validação e criação do objeto\nem banco \"na mão\".</p>\n<p>Vamos testar se o comportamento é o esperado:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ curl -X POST -H \"Content-Type: application/json\" -d '{\"title\": \"just a test\", \"description\": \"foo bar\"}' http://localhost:8000/movies/</code></pre></div>\n<p>Provavelmente retornará um <em>exception</em> dizendo que o acesso não foi autorizado. O <em>Restless</em> por padrão espera\nque todo o <code class=\"language-text\">POST</code>, <code class=\"language-text\">PUT</code> e <code class=\"language-text\">DELETE</code> seja realizado através de uma requisição autenticada. Para isso, antes\nde executar cada verbo, ele consulta o método <code class=\"language-text\">is_authenticated</code>.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4e027daa42357f668194d325afbcf154/b4294/deathstar.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.60416666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAABQADBP/EABYBAQEBAAAAAAAAAAAAAAAAAAIBA//aAAwDAQACEAMQAAABL7idqX4eWf8A/8QAGRAAAwADAAAAAAAAAAAAAAAAAAECAxET/9oACAEBAAEFAsThPtJD2iR0z//EABYRAAMAAAAAAAAAAAAAAAAAAAIQMf/aAAgBAwEBPwEov//EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAECAQE/ASf/xAAbEAACAgMBAAAAAAAAAAAAAAAAAgERECEiMf/aAAgBAQAGPwLpbIVdQXn0/8QAFxABAQEBAAAAAAAAAAAAAAAAAQAxEf/aAAgBAQABPyFRUQDw0g6HWNsdujV//9oADAMBAAIAAwAAABDz/wD/xAAWEQEBAQAAAAAAAAAAAAAAAAAAATH/2gAIAQMBAT8Q0SP/xAAVEQEBAAAAAAAAAAAAAAAAAAAQMf/aAAgBAgEBPxCj/8QAGRABAAMBAQAAAAAAAAAAAAAAAQAhMRFB/9oACAEBAAE/EERA1XKJuRwHBYnQLObGiJVDX2F4AAMZ/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"&quot;is_authenticated retornando True é pior que o problema de segurança na Estrela da Morte (movieweb.com)&quot;\"\n        title=\"is_authenticated retornando True é pior que o problema de segurança na Estrela da Morte (movieweb.com)\"\n        src=\"/static/4e027daa42357f668194d325afbcf154/b4294/deathstar.jpg\"\n        srcset=\"/static/4e027daa42357f668194d325afbcf154/7809d/deathstar.jpg 192w,\n/static/4e027daa42357f668194d325afbcf154/4ecad/deathstar.jpg 384w,\n/static/4e027daa42357f668194d325afbcf154/b4294/deathstar.jpg 600w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">is_authenticated retornando True é pior que o problema de segurança na Estrela da Morte (movieweb.com)</figcaption>\n  </figure></p>\n<p>Para fins educacionais, vamos informar à biblioteca que todas as requisições são aceitas:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># movies/api.py</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">MovieResource</span><span class=\"token punctuation\">(</span>DjangoResource<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">create</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> Movie<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span>create<span class=\"token punctuation\">(</span>\n            title<span class=\"token operator\">=</span>self<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">[</span><span class=\"token string\">'title'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            description<span class=\"token operator\">=</span>self<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">[</span><span class=\"token string\">'description'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">is_authenticated</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">True</span></code></pre></div>\n<p>Mais uma vez executamos o <em>POST</em> via <code class=\"language-text\">curl</code>, e <em>voilà</em>:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"just a test\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"bd02d0eb-4b75-4bfe-8222-ba24f7a1cad4\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"foo bar\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>Verbos por ID</h2>\n<p>Já listamos e criamos novos filmes. Como fazemos para ver os detalhes de um filme através do\nseu <em>ID</em>? Simples! O método <code class=\"language-text\">detail</code> resolve essa para a gente:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># movies/api.py</span>\n\n<span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>shortcuts <span class=\"token keyword\">import</span> get_object_or_404\n\n<span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">MovieResource</span><span class=\"token punctuation\">(</span>DjangoResource<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">detail</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> pk<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> get_object_or_404<span class=\"token punctuation\">(</span>Movie<span class=\"token punctuation\">,</span> pk<span class=\"token operator\">=</span>pk<span class=\"token punctuation\">)</span></code></pre></div>\n<p>Um <code class=\"language-text\">GET</code> para <code class=\"language-text\">movies/{id}</code> retornará os detalhes do recurso:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ curl -X GET http://localhost:8000/movies/7e383f9c-5dc4-4b0d-9864-71e05a5d271b/\n\n{\n  \"description\": \"The Rebel Alliance makes a risky move to steal the plans for the Death Star, setting up the epic saga to follow. (133 mins.)\",\n  \"id\": \"7e383f9c-5dc4-4b0d-9864-71e05a5d271b\",\n  \"title\": \"Rogue One\"\n}</code></pre></div>\n<p>Note que o <code class=\"language-text\">DjangoResource</code> resolveu a passagem do parâmetro <code class=\"language-text\">pk</code>.</p>\n<p>Para finalizar, vamos criar os métodos <code class=\"language-text\">update</code> e <code class=\"language-text\">delete</code>, que serão responsáveis\npor atualizar e remover o recurso:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># movies/api.py</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span>\n\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">MovieResource</span><span class=\"token punctuation\">(</span>DjangoResource<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">detail</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> pk<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> get_object_or_404<span class=\"token punctuation\">(</span>Movie<span class=\"token punctuation\">,</span> pk<span class=\"token operator\">=</span>pk<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">update</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> pk<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        movie <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>detail<span class=\"token punctuation\">(</span>pk<span class=\"token punctuation\">)</span>\n\n        movie<span class=\"token punctuation\">.</span>title <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">[</span><span class=\"token string\">'title'</span><span class=\"token punctuation\">]</span>\n        movie<span class=\"token punctuation\">.</span>description <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">[</span><span class=\"token string\">'description'</span><span class=\"token punctuation\">]</span>\n        movie<span class=\"token punctuation\">.</span>save<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">return</span> movie\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> pk<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        movie <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>detail<span class=\"token punctuation\">(</span>pk<span class=\"token punctuation\">)</span>\n        movie<span class=\"token punctuation\">.</span>delete<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Assim como o método <code class=\"language-text\">create</code>, não há nenhuma \"mágica\" resolvendo a operação para a gente.\nPrecisamos explicitamente realizar a atualização e remoção do dado através do <em>ORM</em> do <em>Django</em>.</p>\n<p>Agora somos capazes de atualizar:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ curl -X PUT -H \"Content-Type: application/json\" -d '{\"title\": \"Zombieland\", \"description\": \"So much fun\"}' http://localhost:8000/movies/bd02d0eb-4b75-4bfe-8222-ba24f7a1cad4/\n\n{\n  \"title\": \"Zombieland\",\n  \"description\": \"So much fun\",\n  \"id\": \"bd02d0eb-4b75-4bfe-8222-ba24f7a1cad4\"\n}</code></pre></div>\n<p>E remover um filme através da API:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">curl -X DELETE http://localhost:8000/movies/bd02d0eb-4b75-4bfe-8222-ba24f7a1cad4/</code></pre></div>\n<h2>Considerações finais</h2>\n<p>Gosto bastante do <em>Restless</em> pela sua filosofia de manter-se simples. Mas nem tudo são rosas!\nA falta de autorização, <em>HATEOAS</em> e saídas em outros formatos (como <em>XML</em>, por exemplo)\npodem ser argumentos decisivos para a escolha de uma biblioteca mais completa.</p>\n<p>Eu costumo utilizar o <em>Restless</em> em projetos muito específicos, onde sei que a <em>API</em> será sempre\n<em>JSON</em>, e integrações com o <em>ORM</em> trarão mais dores de cabeça do que soluções (em um cenário\nonde há interação com bancos <em>NoSQL</em>, o <em>Restless</em> se mostra uma ferramenta muito útil).</p>\n<p><a href=\"https://github.com/kplaube/post-django-restless\" title=\"Veja o exemplo completo no Github\">Confira o exemplo desse <em>post</em> no Github</a>.</p>\n<p>Até a próxima.</p>","excerpt":"Construir APIs REST em\nDjango nos dias atuais é uma\ntarefa no máximo corriqueira. Com a ajuda de bibliotecas consagradas, como\nDjango REST…","frontmatter":{"date":"2017-01-06T10:45:00.000Z","title":"Construindo APIs em Django com Restless","tags":["desenvolvimento-web","api","python","django","rest","restless"],"thumbnail":{"childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAADCklEQVQ4y9VTW0tUURj9zpneegmCXvoNBUEXSPCll56jiLRCsAR90TDLF0s0FUMbUicdde6emUmn0fEy3uZ+rnPTDLpIUGA/wB6kC+VMa5+Ok2EP9uiGxf7Od/Zee33r25vowI+qe03U7nBSh8tNLUNWfW7s6aUms5ma+/r3T9Rms5NlLkzm4CQ9eRGkkWjMFHq3zheLRfLn8ibr0jLP1l2+dZueToWopuXhXpLa1lbqGhOo2+en3okACekM9c/Mkrb1hUYiUZp685YYoS+bp6GFRfJmsnz1/Wbq9vroWXh+L+Hg/AL1jE/ocMuKCRsOsXz4w0eCoqu2eCJkTySl0Vh8DARlHlWjxY1PXFXjXX3/Ewj5a/SFpumR00WV9Q3kkmTy5fKsPAKB1SlKReRKcKbEIlTXumSFPIqqWwERpMu1J1NkSyTJEp7nhEzWxH4OR6J18K1rNBrrMEi+A19Ls6wU2SFQfmJ4OUJYx+ObyB5PEEphKriL1yoIJbH4+o4iYy7sVmdgm82OZKqTKXMrqon5ypiZ4RxOYh09al2O1DtS4mu22KtqbR5ZSSDe9ClqgyDLdWOKuoScgNx7nViULE4QArygqMS6xZlxLdDVw1CX31HgluQNS3DymCslVmOT7IjFT0ON6E6mTo1GomegXDQUDnqZ1yurfMvAABHUmABWaoVBtsVmqOh1JVM1blGqBKFdkOSzz7V0Paq5CUsuIacZlvxErgw5Zh2vXw/dA0m+YRAy47c9onTOHo1dsUWi572SXGaLxsqxYQ3dLeDwCyCMl/xMiXdYtwET+VWNC2ayNJXLHYGqdcOXb7ZY3M0aAvWfR5Yj7SAJ42CdAMQB/Ns0rPkBjpPwmOAhTziRBZwPl3R29eVxv5Z+jFgAAj4t7QIENGcSGEfs0HOqNsHygD2QzZazCkHOdeKp6oTsEuMkLpjLkYeVr0PWY89vO3SUvnfNEEBD8QRnwW3pYIQLa6/IgQvJSMfTGW4MPnj+A1DLt83O0YPpGZpZWfnz7Njr2C8KhcI/8wdj/AKntL7KvC1KaQAAAABJRU5ErkJggg==","width":180,"height":180,"src":"/static/1687332eae560a06832bd1ddedfce261/d8216/rest-api-logo.png","srcSet":"/static/1687332eae560a06832bd1ddedfce261/d8216/rest-api-logo.png 1x"}},"publicURL":"/static/1687332eae560a06832bd1ddedfce261/rest-api-logo.png"}},"fields":{"readingTime":{"minutes":7.08},"slug":"/2017/01/06/construindo-apis-em-django-com-restless.html"}},"site":{"siteMetadata":{"author":{"name":"Klaus Peter Laube","gravatar":"https://en.gravatar.com/userimage/12163112/d3ae0c6239980b01ff1f1730b65c2ebe.jpg"},"siteUrl":"https://klauslaube.com.br"}}},"pageContext":{"slug":"/2017/01/06/construindo-apis-em-django-com-restless.html"}},"staticQueryHashes":["2831923220","4114525740"]}