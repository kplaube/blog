{"componentChunkName":"component---src-templates-blog-post-js","path":"/2017/01/31/ramilificando-as-suas-apis.html","result":{"data":{"markdownRemark":{"html":"<p>Você já tem a sua <a href=\"/tag/api.html\" title=\"Leia mais sobre APIs\"><em>API</em></a>! Ela é <a href=\"/tag/rest.html\" title=\"Leia mais sobre REST\"><em>REST</em></a>,\nperforma muito bem, e todos os seus aplicativos estão\nconversando com a mesma. Vem uma oportunidade de negócio de abrí-la para consumo\nde parceiros. Agora não basta só a técnica perfeita, você precisa de especificação, documentações,\nexemplos de uso e validadores para garantir que os contratos da sua <em>API</em> não sofram alterações drásticas,\ndeixando seu cliente na mão.</p>\n<p>Essa é a realidade da <a href=\"http://loadsmart.com\" title=\"Book a truck with Loadsmart\"><em>Loadsmart</em></a> no momento da\npublicação desse <em>post</em>. Lá, optamos por seguir os mesmos passos do <a href=\"http://spotify.com\" title=\"Você já sabe o que é isso :)\"><em>Spotify</em></a>\ne utilizar o <em>RAML</em> para descrever as nossas <em>APIs</em>.</p>\n<h2>RAML é quase YAML</h2>\n<p>O <em>RAML</em> (RESTful API Modeling Language) é uma maneira simples\nde descrever/projetar suas <em>APIs</em>. Através de uma linguagem concisa, baseada\nem YAML, você é capaz de escrever especificações que podem ser usadas como\ndocumentação, ferramenta de <em>build</em> e de testes automatizados.</p>\n<p>Ao invés de tentar cultivar a motivação para a utilização do <em>RAML</em>, vou descrever\nde forma prática os principais aspectos do padrão. Para tanto, já começo\nrecomendando a instalação do <a href=\"http://apiworkbench.com/\" title=\"IDE for designing APIs\"><em>API Workbench</em></a>,\num excelente <em>plugin</em> para o <em>Atom</em> que facilita (e muito) a escrita de documentos <em>RAML</em>.</p>\n<h2>Como começar?</h2>\n<p>Vamos voltar ao nosso \"mini IMDB\", exemplo utilizado em <a href=\"/tag/rest.html\" title=\"Veja os posts sobre REST\">alguns <em>posts</em></a> aqui do <em>blog</em>.\nOs principais <em>endpoints</em> que temos são:</p>\n<ul>\n<li><code class=\"language-text\">GET /movies</code>: Listagem de filmes;</li>\n<li><code class=\"language-text\">POST /movies</code>: Adição de um filme;</li>\n<li><code class=\"language-text\">GET /movies/{id}</code>: Detalhes de um filme;</li>\n<li><code class=\"language-text\">PUT /movies/{id}</code>: Atualização de um filme;</li>\n<li><code class=\"language-text\">DELETE /movies/{id}</code>: Remoção de um filme.</li>\n</ul>\n<p>Podemos começar criando um arquivo <code class=\"language-text\">api.raml</code> com o seguinte conteúdo:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\">#%RAML 1.0</span>\n<span class=\"token key atrule\">title</span><span class=\"token punctuation\">:</span> Movies API</code></pre></div>\n<p>No momento desse artigo, o <em>RAML</em> possui duas especificações ativas: a <code class=\"language-text\">0.8</code> e a <code class=\"language-text\">1.0</code>. Dependendo\ndas ferramentas que você for utilizar posteriormente, talvez seja interessante optar pela especificação <code class=\"language-text\">0.8</code>.\nNesse exemplo utilizaremos a <code class=\"language-text\">1.0</code>.</p>\n<p>Vamos continuar descrevendo a nossa <em>API</em>:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\">#%RAML 1.0</span>\n<span class=\"token key atrule\">title</span><span class=\"token punctuation\">:</span> Movies API\n<span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">baseUri</span><span class=\"token punctuation\">:</span> https<span class=\"token punctuation\">:</span>//api.movies.com/<span class=\"token punctuation\">{</span>version<span class=\"token punctuation\">}</span>\n<span class=\"token key atrule\">mediaType</span><span class=\"token punctuation\">:</span> application/json</code></pre></div>\n<p>Setamos a versão da <em>API</em> como <code class=\"language-text\">v1</code>, atendendo pelo endereço <code class=\"language-text\">https://api.movies.com/v1</code>. Trabalharemos\ncom objetos <em>JSON</em>. Caso a <em>API</em> necessite trabalhar com mais de um tipo (<em>XML</em>, por exemplo),\né possível declará-lo no <code class=\"language-text\">mediaType</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">mediaType</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>application/json<span class=\"token punctuation\">,</span> application/xml<span class=\"token punctuation\">]</span></code></pre></div>\n<h2>Descrevendo os dados</h2>\n<p>Se você optar pela versão <code class=\"language-text\">0.8</code> do padrão, a palavra <code class=\"language-text\">schemas</code> aparecerá com certa frequência durante\na construção do documento. Com a <code class=\"language-text\">1.0</code>, a comunidade depreciou o termo em prol da palavra-chave <code class=\"language-text\">types</code>, e é com\nela que descreveremos o tipo <code class=\"language-text\">Movie</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">(<span class=\"token punctuation\">...</span>)\n\n<span class=\"token key atrule\">types</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">Movie</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">properties</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> string\n      <span class=\"token key atrule\">title</span><span class=\"token punctuation\">:</span> string\n      <span class=\"token key atrule\">description?</span><span class=\"token punctuation\">:</span> string</code></pre></div>\n<p><code class=\"language-text\">Movie</code> possui três propriedades do tipo <code class=\"language-text\">string</code>: <code class=\"language-text\">id</code>, <code class=\"language-text\">title</code> e <code class=\"language-text\">description</code>. O <code class=\"language-text\">?</code> em <code class=\"language-text\">description?</code>\nindica que essa última é uma propriedade opcional (ao contrário de <code class=\"language-text\">id</code> e <code class=\"language-text\">title</code> que são obrigatórias).</p>\n<p>O <em>RAML</em> suporta uma série de tipos <em>built-in</em>, para saber mais, leia sobre <a href=\"https://github.com/raml-org/raml-spec/blob/master/versions/raml-10/raml-10.md/#defining-types\">definição de tipos</a>.</p>\n<h2>Descrevendo os endpoints</h2>\n<p>Agora que temos um tipo definido, podemos partir para a descrição dos nossos <em>endpoints</em>. Em <em>RAML</em>,\na semântica correta é chamarmos um <em>endpoint</em> de <em>Resource</em>. Vamos iniciar pelo <code class=\"language-text\">/movies</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">(<span class=\"token punctuation\">...</span>)\n\n<span class=\"token key atrule\">/movies</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">description</span><span class=\"token punctuation\">:</span> A set of movies.\n\n  <span class=\"token key atrule\">get</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">description</span><span class=\"token punctuation\">:</span> Get a list of movies.\n    <span class=\"token key atrule\">responses</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">200</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">body</span><span class=\"token punctuation\">:</span> Movie<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  <span class=\"token key atrule\">post</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">description</span><span class=\"token punctuation\">:</span> Add a new movie to the set.\n    <span class=\"token key atrule\">body</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> Movie\n    <span class=\"token key atrule\">responses</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">201</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">description</span><span class=\"token punctuation\">:</span> Returns the new movie.\n        <span class=\"token key atrule\">body</span><span class=\"token punctuation\">:</span> Movie</code></pre></div>\n<p>Começamos ao criar um bloco <code class=\"language-text\">/movies</code>. Nele, além de adicionarmos uma descrição através da propriedade\n<code class=\"language-text\">description</code>, também deixamos explícito a possibilidade de enviarmos dois métodos: <code class=\"language-text\">get</code> e <code class=\"language-text\">post</code>.\nEm <code class=\"language-text\">get</code>, podemos ter como resposta um <em>status code</em> <code class=\"language-text\">200</code> e uma lista de <code class=\"language-text\">Movie</code> (por isso o sufixo <code class=\"language-text\">[]</code>).</p>\n<p>Já em <code class=\"language-text\">post</code>, além de deixar claro que retornaremos o objeto recém criado, apontamos que a resposta\nserá um <code class=\"language-text\">201</code> com um único <code class=\"language-text\">Movie</code>. Note que nesse caso descrevemos que o <code class=\"language-text\">post</code> também possui um tipo,\natravés da palavra-chave <code class=\"language-text\">body</code>. Isso quer dizer que, ao fazermos <code class=\"language-text\">POST /movies/</code>, precisamos\npassar um objeto que atenda as especificações do tipo <code class=\"language-text\">Movie</code>.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 640px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e838b044ee5537cedc7d18d8a7c0d732/c08c5/raml-vogons.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 67.70833333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMEAv/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAGJ0FEZEB//xAAbEAABBAMAAAAAAAAAAAAAAAAAAQIDERITIv/aAAgBAQABBQKOZ6j22UpGvWyjM//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABoQAAICAwAAAAAAAAAAAAAAAAABAhEQITH/2gAIAQEABj8Cim9WXA6IpY//xAAZEAADAQEBAAAAAAAAAAAAAAABESEAQWH/2gAIAQEAAT8hKeLgaQQsXMXUcuUxIUSrEjS3v//aAAwDAQACAAMAAAAQ/wD/AP/EABURAQEAAAAAAAAAAAAAAAAAABBB/9oACAEDAQE/EKf/xAAWEQEBAQAAAAAAAAAAAAAAAAAAASH/2gAIAQIBAT8QrX//xAAcEAEAAwACAwAAAAAAAAAAAAABABEhMUGBofH/2gAIAQEAAT8Qw/A1Aq9sOfMV0rgYntPWRq0GYWQgNrJU4cKg7VfZRokavc//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"&quot;RAML pode parecer poesia Vogon, mas não entre em pânico! (fundividedattention)&quot;\"\n        title=\"RAML pode parecer poesia Vogon, mas não entre em pânico! (fundividedattention)\"\n        src=\"/static/e838b044ee5537cedc7d18d8a7c0d732/c08c5/raml-vogons.jpg\"\n        srcset=\"/static/e838b044ee5537cedc7d18d8a7c0d732/7809d/raml-vogons.jpg 192w,\n/static/e838b044ee5537cedc7d18d8a7c0d732/4ecad/raml-vogons.jpg 384w,\n/static/e838b044ee5537cedc7d18d8a7c0d732/c08c5/raml-vogons.jpg 640w\"\n        sizes=\"(max-width: 640px) 100vw, 640px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">RAML pode parecer poesia Vogon, mas não entre em pânico! (fundividedattention)</figcaption>\n  </figure></p>\n<p>Caso a sua regra de negócio vá além da criação de um elemento, é possível descrevê-la\ntambém. Por exemplo, vamos imaginar que exista a necessidade de verificar se o filme já existe no\nbanco de dados:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">(<span class=\"token punctuation\">...</span>)\n\n      <span class=\"token key atrule\">201</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">description</span><span class=\"token punctuation\">:</span> Returns the new movie.\n        <span class=\"token key atrule\">body</span><span class=\"token punctuation\">:</span> Movie\n      <span class=\"token key atrule\">409</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">description</span><span class=\"token punctuation\">:</span> The movie already exists in our database.\n        <span class=\"token key atrule\">body</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">properties</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">error</span><span class=\"token punctuation\">:</span> string</code></pre></div>\n<p>Note que o padrão <em>RAML</em> é flexível. Nesse caso não criamos um tipo <code class=\"language-text\">Error</code>, apenas descrevemos o corpo\nda resposta através das palavras-chave <code class=\"language-text\">body</code> e <code class=\"language-text\">properties</code>.</p>\n<p>Vamos finalizar descrevendo os dois métodos restantes:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">(<span class=\"token punctuation\">...</span>)\n\n  /<span class=\"token punctuation\">{</span>id<span class=\"token punctuation\">}</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">uriParameters</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">description</span><span class=\"token punctuation\">:</span> The Movie identifier.\n        <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> string\n\n     <span class=\"token key atrule\">get</span><span class=\"token punctuation\">:</span>\n       <span class=\"token key atrule\">description</span><span class=\"token punctuation\">:</span> Gets a specific movie.\n       <span class=\"token key atrule\">responses</span><span class=\"token punctuation\">:</span>\n         <span class=\"token key atrule\">200</span><span class=\"token punctuation\">:</span>\n           <span class=\"token key atrule\">description</span><span class=\"token punctuation\">:</span> Returns the specific movie.\n           <span class=\"token key atrule\">body</span><span class=\"token punctuation\">:</span> Movie\n\n    <span class=\"token key atrule\">put</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">body</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> Movie\n      <span class=\"token key atrule\">description</span><span class=\"token punctuation\">:</span> Updates an already created movie.\n      <span class=\"token key atrule\">responses</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">200</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">description</span><span class=\"token punctuation\">:</span> Returns the updated movie.\n          <span class=\"token key atrule\">body</span><span class=\"token punctuation\">:</span> Movie\n\n    <span class=\"token key atrule\">delete</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">description</span><span class=\"token punctuation\">:</span> Deletes the movie.\n      <span class=\"token key atrule\">responses</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">204</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">description</span><span class=\"token punctuation\">:</span> Confirms the deletion.</code></pre></div>\n<p>Dentro de <code class=\"language-text\">/movies</code>, criamos um novo bloco chamado <code class=\"language-text\">/{id}</code>. Através da propriedade <code class=\"language-text\">uriParameters</code> deixamos\nclaro que <code class=\"language-text\">id</code> é na verdade uma <code class=\"language-text\">string</code> (no nosso caso, estamos usando um <code class=\"language-text\">uuid</code>). Além disso, descrevemos\nos métodos <code class=\"language-text\">get</code>, <code class=\"language-text\">put</code> e <code class=\"language-text\">delete</code> para <code class=\"language-text\">/movies/{id}</code>, que não diferem tanto assim dos demais explicados\nanteriormente.</p>\n<h2>Descrevendo sem se repetir</h2>\n<p>No nosso <a href=\"/2017/01/06/construindo-apis-em-django-com-restless.html\" title=\"Construindo APIs em Django com Restless\">exemplo utilizando <em>Restless</em></a>,\nao fazer um <code class=\"language-text\">POST</code> ou <code class=\"language-text\">PUT</code> com dados inválidos, retornamos um <code class=\"language-text\">BadRequest</code>. Podemos especificar esse\ncomportamento para o recurso <code class=\"language-text\">POST movies/</code> e <code class=\"language-text\">PUT movies/{id}</code>.</p>\n<p>Logo após o bloco <code class=\"language-text\">types</code>, vamos adicionar um novo bloco chamado <code class=\"language-text\">traits</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">(<span class=\"token punctuation\">...</span>)\n\n<span class=\"token key atrule\">mediaType</span><span class=\"token punctuation\">:</span> application/json\n\n<span class=\"token key atrule\">types</span><span class=\"token punctuation\">:</span>\n(<span class=\"token punctuation\">...</span>)\n\n<span class=\"token key atrule\">traits</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">dataValidation</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">responses</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">400</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">description</span><span class=\"token punctuation\">:</span> A BadRequest happens when data validation fails.\n        <span class=\"token key atrule\">body</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">properties</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">error</span><span class=\"token punctuation\">:</span> string</code></pre></div>\n<p>Através de <code class=\"language-text\">traits</code> somos capazes de escrever regras de uso que podem ser reaproveitadas por dados e recursos.\nNo exemplo acima, dizemos que recursos que utilizarem esse <em>trait</em> terão como resposta o <em>status code</em> <code class=\"language-text\">400</code>.</p>\n<p>Agora basta apontarmos nossos recursos ao <em>trait</em> de nome <code class=\"language-text\">dataValidation</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">(<span class=\"token punctuation\">...</span>)\n\n<span class=\"token key atrule\">/movies</span><span class=\"token punctuation\">:</span>\n(<span class=\"token punctuation\">...</span>)\n\n  <span class=\"token key atrule\">post</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">is</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>dataValidation<span class=\"token punctuation\">]</span>\n\n  (<span class=\"token punctuation\">...</span>)\n\n  /<span class=\"token punctuation\">{</span>id<span class=\"token punctuation\">}</span><span class=\"token punctuation\">:</span>\n  (<span class=\"token punctuation\">...</span>)\n\n    <span class=\"token key atrule\">put</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">is</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>dataValidation<span class=\"token punctuation\">]</span>\n\n(<span class=\"token punctuation\">...</span>)</code></pre></div>\n<p><em>Traits</em> são extremamente úteis para descrever comportamentos que são comuns entre recursos (por exemplo, listagens\nque possuem paginação). Outro conceito similar é o <em>Resource Types</em>, no qual você pode ler mais sobre na <a href=\"https://github.com/raml-org/raml-spec/blob/master/versions/raml-10/raml-10.md/#declaration-resource-types-and-traits\" title=\"Resource Types and Traits\">documentação oficial</a>.</p>\n<h2>Descrevendo a segurança</h2>\n<p>Para finalizar nosso exemplo. Vamos supor que o acesso à <em>API</em> é limitado, e o usuário precisa ter uma\nconta para acessá-la. Para não reinventar a roda, vamos supor que optamos pelo padrão <a href=\"https://aaronparecki.com/oauth-2-simplified/\" title=\"OAuth 2 simplified\"><em>OAuth 2</em></a>\npara autenticação e autorização.</p>\n<p>Abaixo da propriedade <code class=\"language-text\">mediaType</code> vamos criar um novo bloco chamado <code class=\"language-text\">securitySchemes</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">(<span class=\"token punctuation\">...</span>)\n\n<span class=\"token key atrule\">securitySchemes</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">oauth_2_0</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">description</span><span class=\"token punctuation\">:</span> We support OAuth 2.0 for authenticating all API requests.\n    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> OAuth 2.0\n    <span class=\"token key atrule\">describedBy</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">headers</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">Authorization</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">description</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n             Used to send a valid OAuth 2 access token. Do not use\n             with the \"access_token\" query string parameter.</span>\n          <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> string\n      <span class=\"token key atrule\">queryParameters</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">access_token</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">description</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n             Used to send a valid OAuth 2 access token.\n             Do not use with the \"Authorization\" header.</span>\n          <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> string\n      <span class=\"token key atrule\">responses</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">401</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">description</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n              Bad or expired token. This can happen if the\n              user or Movie API revoked or expired an access\n              token. To fix, re-authenticate the user.</span>\n        <span class=\"token key atrule\">403</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">description</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n              Bad OAuth request (wrong consumer key, bad nonce,\n              expired timestamp...). Unfortunately,\n              re-authenticating the user won't help here.</span>\n    <span class=\"token key atrule\">settings</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">authorizationUri</span><span class=\"token punctuation\">:</span> https<span class=\"token punctuation\">:</span>//www.movies.com/1/oauth2/authorize\n      <span class=\"token key atrule\">accessTokenUri</span><span class=\"token punctuation\">:</span> https<span class=\"token punctuation\">:</span>//api.movies.com/1/oauth2/token\n      <span class=\"token key atrule\">authorizationGrants</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> authorization_code<span class=\"token punctuation\">,</span> implicit <span class=\"token punctuation\">]</span></code></pre></div>\n<p>Serei sincero com você, caro leitor, o código acima é uma receita de bolo para descrever\no <code class=\"language-text\">securitySchemes</code> do tipo <em>OAuth 2</em>. Nada de muito diferente do que a gente viu até aqui,\ncom exceção do uso do <code class=\"language-text\">|</code>, que nesse caso serve para fazer textos em bloco, e da\npropriedade <code class=\"language-text\">type</code> com valor <code class=\"language-text\">OAuth 2.0</code>.</p>\n<p>No nosso cenário, apenas temos intenção de proteger a escrita de dados na <em>API</em>. Para tanto,\nVamos adicionar a propriedade <code class=\"language-text\">securedBy</code> aos blocos <code class=\"language-text\">post</code> e <code class=\"language-text\">put</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">(<span class=\"token punctuation\">...</span>)\n\n  <span class=\"token key atrule\">post</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">is</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>dataValidation<span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">securedBy</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>oauth_2_0<span class=\"token punctuation\">]</span>\n\n(<span class=\"token punctuation\">...</span>)\n\n    <span class=\"token key atrule\">put</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">is</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>dataValidation<span class=\"token punctuation\">]</span>\n      <span class=\"token key atrule\">securedBy</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>oauth_2_0<span class=\"token punctuation\">]</span>\n\n(<span class=\"token punctuation\">...</span>)</code></pre></div>\n<p>Pronto! A especificação da nossa <em>API</em> está completa! Temos uma documentação forte, que pode ser lida\npor humanos e máquinas. Para fins didáticos não utilizei recursos\ninteressantes como a propriedade <code class=\"language-text\">example</code> ou a ferramenta <code class=\"language-text\">!include</code>. Mas você pode ler sobre\neles na <a href=\"https://github.com/raml-org/raml-spec/blob/master/versions/raml-10/raml-10.md\">especificação do <em>RAML</em> 1.0</a>.</p>\n<h2>Considerações finais</h2>\n<p><a href=\"https://github.com/kplaube/post-raml/blob/8e580fa4d328a3f5f9e89e23d8b283ec04cf9637/api.raml\">Veja como ficou a versão final do nosso arquivo api.raml</a>.</p>\n<p>Através de uma linguagem clara fomos capazes de construir uma especificação legível para a nossa <em>API</em>.\nCom isso, outros desenvolvedores (ou até mesmo máquinas) serão capazes de entender como funciona cada <em>endpoint</em>.\nCom a adição de ferramentas como o <a href=\"https://github.com/cybertk/abao\" title=\"REST API automated testing tool\"><em>Abao</em></a>\ne <a href=\"https://github.com/raml2html/raml2html\" title=\"RAML to HTML documentation generator\"><em>raml2html</em></a>, os resultados\ndo uso do <em>RAML</em> podem ser surpreendentes, como no exemplo abaixo:</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 640px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7ff9fbba0eafbab830fbc156798eb2bd/6af66/example-raml.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 59.895833333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAABp0lEQVQoz4WSTVOCUBiF+actayYBv0AQP9Df0qZFOxct2pTi2KTZrhpScXIYBRoDgUAEOkgLi6bO3GHgcp/3PefeSxSLxXK5zLJsqVTCO0Xmzs4vLu/km9v7+9GdLMsvGWFyNpsNh0OCoqhcLkeSJE3T+Xyepsira+nVjXV76/l+FP+iKEqmdV0nWq0Wz/Mcx/EcL4pivV6/liTFCh7U9wfVfDLc57ePHwOT8nvwOFeJWq0GstFoAGs2mxxX6Un9jbfTzY293blBmB3OdreNY3WlESALhQKeqAKeYRhJkuDsw3XiKIyi8C/bAIS90Ba2EQGwbduaphuGrq2dIExWHyoMk4qaphFgGJYVhLq4VwobhuE4ju/7ruumS7OdE7gliiel6hFZqWDP+CRCr9dbLpeKoqiqalnWP/BphT5mTqtVXqgKOOput2uaJv55npea3H1XEASAV6tVYhuBcUmw4e12G7b7/b692YyGo/F4PJlOkR+1rAPhE6EWi0UCQyAROD3zwWCQulqv1yDDjND8y7Z4IMBw0el0UFXZC9dwmtFkMpnP5/D1CVzWOmRB+U3BAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"&quot;Exemplo de documentação gerada pelo raml2html&quot;\"\n        title=\"Exemplo de documentação gerada pelo raml2html\"\n        src=\"/static/7ff9fbba0eafbab830fbc156798eb2bd/6af66/example-raml.png\"\n        srcset=\"/static/7ff9fbba0eafbab830fbc156798eb2bd/8514f/example-raml.png 192w,\n/static/7ff9fbba0eafbab830fbc156798eb2bd/804b2/example-raml.png 384w,\n/static/7ff9fbba0eafbab830fbc156798eb2bd/6af66/example-raml.png 640w\"\n        sizes=\"(max-width: 640px) 100vw, 640px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Exemplo de documentação gerada pelo raml2html</figcaption>\n  </figure></p>\n<p>Até a próxima.</p>\n<h2>Referências</h2>\n<ul>\n<li><a href=\"https://github.com/raml-org/raml-spec/blob/master/versions/raml-10/raml-10.md\">Github: RAML Version 1.0 specification</a></li>\n<li><a href=\"https://www.sitepoint.com/raml-restful-api-modeling-language/\">Sitepoint: RAML, the RESTful API modeling language</a></li>\n</ul>","excerpt":"Você já tem a sua API! Ela é REST,\nperforma muito bem, e todos os seus aplicativos estão\nconversando com a mesma. Vem uma oportunidade de…","frontmatter":{"date":"2017-01-31T21:30:00.000Z","title":"Ramilificando as suas APIs","tags":["desenvolvimento-web","rest","microservices","api","raml"],"thumbnail":{"childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsSAAALEgHS3X78AAABgElEQVQ4y+1Ty07CUBC9j76pBbHQaqkQNAZTCGhaQ0BjTFz4LC5USGWjCHGhiY+45Atc+Atu/E/nthXoUrfaTG7nnDvnzsztFCHM/97+rhhTEVMJcxImAmOIGPMRDANm4UTMIUzR9CGMQTjmMQ7jvhm20nArNIimglzePawcnDunQdoqAWVWXUHVqKiYNRcgr6i2twOOvurwisZSsCMoe2HKa1ZJWyqmC2Xv+hG2Sq19pxOA4w1elAWj2Nzz3z8BNrpD1SiE9XGxOCob8ii66d08gQOwfjFQsrlUzmzfj7cGz43eCEjHv1INmyWeiDGB1pFRdU/ePuYWl8HP2CvN4Wv7YQz++nHXdredsz5EVjv9lG4kyp7oK0eX0BU40IW+VtsI7vKVOitKkOrdW1Z2b+T4ATQlz+fR9Ax2DOFlVc4yFmMS3ZOYzgIPlyIxB6t5y9psgUkZPSmO8oMsvELCSYQTIhhVGK/TL0oTEwYzkBiDGRgPCRUJJ4PF/P8v+TP7Am5TK5VUhLpaAAAAAElFTkSuQmCC","width":180,"height":180,"src":"/static/2fad6ed54e5652c2f2ce8d9326f63fa1/d8216/raml-logo.png","srcSet":"/static/2fad6ed54e5652c2f2ce8d9326f63fa1/d8216/raml-logo.png 1x"}},"publicURL":"/static/2fad6ed54e5652c2f2ce8d9326f63fa1/raml-logo.png"}},"fields":{"readingTime":{"minutes":7.5},"slug":"/2017/01/31/ramilificando-as-suas-apis.html"}},"site":{"siteMetadata":{"author":{"name":"Klaus Peter Laube","gravatar":"https://en.gravatar.com/userimage/12163112/d3ae0c6239980b01ff1f1730b65c2ebe.jpg"},"siteUrl":"https://klauslaube.com.br"}}},"pageContext":{"slug":"/2017/01/31/ramilificando-as-suas-apis.html"}}}