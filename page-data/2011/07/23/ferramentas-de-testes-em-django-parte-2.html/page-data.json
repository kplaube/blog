{"componentChunkName":"component---src-templates-blog-post-js","path":"/2011/07/23/ferramentas-de-testes-em-django-parte-2.html","result":{"data":{"markdownRemark":{"html":"<p>No <a href=\"/2011/07/18/ferramentas-de-testes-em-django-parte-1.html\" title=\"Ferramentas de testes em Django - Parte 1\"><em>post</em> anterior</a>,\nconhecemos as ferramentas <em>default</em> para construção de testes\nautomatizados em <a href=\"/tag/django.html\" title=\"Leia mais sobre Django\"><em>Django</em></a>. Acontece que você pode “sair um pouco da\ncaixa” e usufruir de ferramentas “third-party“, que enriquecerão o seu\nambiente de desenvolvimento e lhe trarão maior segurança em seus <a href=\"/tag/testes.html\" title=\"Leia mais sobre testes\">testes\nde <em>software</em></a>.</p>\n<h2>splinter – Testando a sua aplicação com um navegador</h2>\n<p>É perfeitamente possível criar testes de aceitação em <em>Django</em> com a\n<a href=\"https://docs.djangoproject.com/en/dev/topics/testing/#module-django.test.client\" title=\"Testando aplicações web com test client em Django\"><em>TestClient</em></a> e <a href=\"http://lxml.de/\" title=\"Faça parser XML e HTML com lxml\"><em>lxml</em></a>. Mas vamos ser sinceros, é deveras\ntrabalhoso “parsear” os resultados das suas <em>views</em>.</p>\n<p>Com a <a href=\"http://splinter.cobrateam.info/\" title=\"Visite a documentação oficial da Splinter\"><em>Splinter</em></a>, uma ferramenta para testes de aplicações\n<a href=\"/tag/desenvolvimento-web.html\" title=\"Leia mais sobre Web\"><em>web</em></a>, você pode automatizar ações executadas por navegadores, como\nvisitar uma página, preencher um formulário ou clicar em um <em>link</em>; tudo\nisso sem preocupar-se com <em>parsing</em>, nós, <em>DOM</em>, nem nada do tipo:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> splinter<span class=\"token punctuation\">.</span>browser\n<span class=\"token keyword\">import</span> Browser\n\nbrowser <span class=\"token operator\">=</span> Browser<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Visitar uma URL</span>\nurl <span class=\"token operator\">=</span> <span class=\"token string\">\"http://search.twitter.com\"</span>\nbrowser<span class=\"token punctuation\">.</span>visit<span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span>\nbrowser<span class=\"token punctuation\">.</span>fill<span class=\"token punctuation\">(</span><span class=\"token string\">'q'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#cobrateam\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Procurar e clicar no botão 'search'</span>\nbutton <span class=\"token operator\">=</span> browser<span class=\"token punctuation\">.</span>find_by_css<span class=\"token punctuation\">(</span><span class=\"token string\">\"#searchButton input\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>first\n\n<span class=\"token comment\"># Interagir com os elementos</span>\nbutton<span class=\"token punctuation\">.</span>click<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">if</span> browser<span class=\"token punctuation\">.</span>is_text_present<span class=\"token punctuation\">(</span><span class=\"token string\">\"No results for #cobrateam\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span> <span class=\"token string\">\"nobody likes us =(\"</span>\n<span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span> <span class=\"token string\">\"we're popular =)\"</span></code></pre></div>\n<p>O que eu acho mais bacana nesta ferramenta são os seletores, facilitam\nmuito na hora de checar resultados e comportamentos.</p>\n<p>A comunidade em volta desta ferramenta está em constante crescimento e\natividade. Portanto, caso você queira contribuir com o projeto, vá agora\nmesmo para o <a href=\"https://github.com/cobrateam/splinter\" title=\"Repositório da Splinter no GitHub\">repositório no <em>GitHub</em> e colabore</a>.</p>\n<h2>nose – Caçando testes em seu projeto (Python)</h2>\n<p>E quando queremos fugir da regra? Aposto que chegará um momento em que a\nestrutura de diretórios padrão, necessária para a execução dos seus\ntestes em <em>Django</em>, não te satisfará mais. O que fazer neste caso?\nSimples, recorra ao <em>Nose</em>!</p>\n<p>O <a href=\"http://somethingaboutorange.com/mrl/projects/nose/1.0.0/\" title=\"Nose - is nicer testing for Python\"><em>Nose</em></a> estende os recursos da <em>unittest</em> e facilita a escrita\ne carregamento dos testes em projetos <a href=\"/tag/python.html\" title=\"Leia mais sobre Python\"><em>Python</em></a>. De uma forma mais\ndetalhada, ele percorre o seu projeto (ou uma determinada região de seu\nescolha) executando subclasses da <code class=\"language-text\">unittest.TestCase</code> ou funções que\ncontenham “test”. Por exemplo:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># test_subclasse.py</span>\n<span class=\"token keyword\">import</span> unittest\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">SubclasseTest</span><span class=\"token punctuation\">(</span>unittest<span class=\"token punctuation\">.</span>TestCase<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">test_um_eh_verdadeiro</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        self<span class=\"token punctuation\">.</span>assertTrue<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># test_funcao.py</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">test_zero_eh_falso</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">assert</span> <span class=\"token number\">0</span> <span class=\"token operator\">==</span> <span class=\"token boolean\">False</span></code></pre></div>\n<p>Ao executar o comando <strong>nosetests</strong> o <em>nose</em> se encarregará de procurar\ne carregar os testes:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ nosetests\n..\n----------------------------------------------------------------------\nRan 2 tests in 0.005s\n\nOK</code></pre></div>\n<p>É claro que existe uma “mágica” aí. Na verdade o <em>nose</em> pesquisará por\n<strong>arquivos</strong> <em>Python</em> com “test” em seu nome, por <strong>funções</strong> com “test”\nem seu enunciado, e por <strong>classes</strong> com métodos “test” em sua\ndeclaração. Ele age mesmo como um “runner“, tendo a capacidade de lidar\ncom testes escritos com <em>unittest</em> ou não.</p>\n<p>Essa é só a ponta do <em>iceberg</em>. É possível construir <em>plugins</em> para o\n<em>nose</em>, permitindo melhorar ainda mais o seu ambiente de testes (como\npor exemplo, permitir que o <a href=\"http://pypi.python.org/pypi/nosepipe/\" title=\"Conheça o nosepipe\"><em>nose</em> funcione em <em>subprocess</em>\nseparados</a>).</p>\n<h3>Caçando testes em seu projeto (Django)</h3>\n<p>Para facilitar ainda mais a escrita de testes em <em>Django</em> existem\n<em>plugins</em> como o <a href=\"http://pypi.python.org/pypi/django-nose\" title=\"Utilize o nose em seus projetos Django\"><em>django-nose</em></a>, que permite que você substitua o\n<em>Test Runner</em> padrão da <em>framework</em> por um específico que utiliza o\n<em>nose</em>, unindo assim a facilidade e “add-ons” do <em>nose</em> com o ambiente\nde testes do <em>Django</em>.</p>\n<h2>lettuce – BDD em Django</h2>\n<p>E se você estava se perguntando sobre <a href=\"/tag/bdd.html\" title=\"Leia mais sobre BDD\"><em>BDD</em></a> em <em>Django</em>, eu\napresento a <a href=\"http://lettuce.it/intro/overview.html#intro-overview\" title=\"Saiba mais sobre a lettuce\"><em>Lettuce</em></a>!</p>\n<p>Esta ferramenta, baseada na <a href=\"http://cukes.info/\" title=\"Cucumber - Making BDD fun\"><em>Cucumber</em></a>, permite com que você escreva\nhistórias utilizando linguagem ubíqua, mais próxima da área de negócios\ndo que da área técnica, e automatize a validação delas.</p>\n<p>O mais bacana é que ela já vem preparada para o <em>Django</em>, permitindo que\na gente execute os testes de comportamento de forma fácil e rápida:</p>\n<div class=\"gatsby-highlight\" data-language=\"gherkin\"><pre class=\"language-gherkin\"><code class=\"language-gherkin\"><span class=\"token feature\"><span class=\"token keyword\">Feature:</span><span class=\"token important\"> Rocking with lettuce and django</span>\n</span>\n    <span class=\"token scenario\"><span class=\"token keyword\">Scenario:</span><span class=\"token important\"> Simple Hello World</span></span>\n        <span class=\"token atrule\">Given</span> <span class=\"token atrule\">I</span> access the url <span class=\"token string\">\"/\"</span>\n        <span class=\"token atrule\">Then</span> <span class=\"token atrule\">I</span> see the header <span class=\"token string\">\"Hello World\"</span>\n\n    <span class=\"token scenario\"><span class=\"token keyword\">Scenario:</span><span class=\"token important\"> Hello + capitalized name</span></span>\n        <span class=\"token atrule\">Given</span> <span class=\"token atrule\">I</span> access the url <span class=\"token string\">\"/some-name\"</span>\n        <span class=\"token atrule\">Then</span> <span class=\"token atrule\">I</span> see the header <span class=\"token string\">\"Hello Some Name\"</span></code></pre></div>\n<p>História escrita, vamos escrever o <em>script</em> <em>Python</em> que validará se está\ntudo de acordo:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> lettuce <span class=\"token keyword\">import</span> <span class=\"token operator\">*</span>\n<span class=\"token keyword\">from</span> lxml <span class=\"token keyword\">import</span> html\n<span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>test<span class=\"token punctuation\">.</span>client <span class=\"token keyword\">import</span> Client\n\n<span class=\"token decorator annotation punctuation\">@before<span class=\"token punctuation\">.</span>all</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">set_browser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    world<span class=\"token punctuation\">.</span>browser <span class=\"token operator\">=</span> Client<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token decorator annotation punctuation\">@step</span><span class=\"token punctuation\">(</span><span class=\"token string\">r'I access the url \"(.*)\"'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">access_url</span><span class=\"token punctuation\">(</span>step<span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    response <span class=\"token operator\">=</span> world<span class=\"token punctuation\">.</span>browser<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span>\n    world<span class=\"token punctuation\">.</span>dom <span class=\"token operator\">=</span> html<span class=\"token punctuation\">.</span>fromstring<span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>content<span class=\"token punctuation\">)</span>\n\n<span class=\"token decorator annotation punctuation\">@step</span><span class=\"token punctuation\">(</span><span class=\"token string\">r'I see the header \"(.*)\"'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">see_header</span><span class=\"token punctuation\">(</span>step<span class=\"token punctuation\">,</span> text<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    header <span class=\"token operator\">=</span> world<span class=\"token punctuation\">.</span>dom<span class=\"token punctuation\">.</span>cssselect<span class=\"token punctuation\">(</span><span class=\"token string\">'h1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">assert</span> header<span class=\"token punctuation\">.</span>text <span class=\"token operator\">==</span> text</code></pre></div>\n<p>Basta executá-lo da seguinte maneira:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ python manage.py harvest</code></pre></div>\n<p><a href=\"http://lettuce.it/recipes/django-lxml.html#recipes-django-lxml\" title=\"Django + Lettuce, uma dupla interessante!\">Confira mais informações sobre como utilizar o <em>lettuce</em> com <em>Django</em></a>.</p>\n<h2>fudge – Ajude o Python a mentir</h2>\n<p>O <a href=\"http://farmdev.com/projects/fudge/\" title=\"Fudge, criando objetos mentirosos\"><em>Fudge</em></a> é um módulo <em>Python</em> que auxilia na construção de\nobjetos “dublês” (<a href=\"http://www.infoq.com/br/articles/mocks-Arent-Stubs\" title=\"Mocks não são Stubs\"><em>mocks</em> e <em>stubs</em></a>), que permitem escrever testes\nsem necessariamente possuir um serviço ativo ou um objeto construído.</p>\n<p>Um caso comum: Você está construindo uma <em>API</em> que autentica via <em>OAuth</em>\nao <em>Twitter</em> e está utilizando testes para guiar o seu desenvolvimento.\nNão é interessante que nossos testes sejam dependentes da\ndisponibilidade do serviço do <em>Twitter</em>, portanto, escrevemos um “objeto\nmentiroso”, que simulará este serviço, aceitando uma entrada e gerando\num saída:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> fudge\n\n<span class=\"token decorator annotation punctuation\">@fudge<span class=\"token punctuation\">.</span>patch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'oauthtwitter.OAuthApi'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span>FakeOAuthApi<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">(</span>FakeOAuthApi<span class=\"token punctuation\">.</span>expects_call<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span>with_args<span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">''</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span>returns_fake<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span>expects<span class=\"token punctuation\">(</span><span class=\"token string\">'UpdateStatus'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>with_arg_count<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\npost_msg_to_twitter<span class=\"token punctuation\">(</span><span class=\"token string\">\"hey there fellow testing freaks!\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Pronto! Sabendo que valores serão passados, e quais os resultados,\npodemos simular o comportamento daquele serviço. Prático, não?</p>\n<h2>Considerações finais</h2>\n<p>Estas são as ferramentas que eu costumo utilizar em meus projetos\n<em>Python/Django</em>. É claro que existem outras, na verdade existem várias.\nTenha em mente que a ferramenta é apenas um meio de garantir, através de\ntestes, que você está guiando a sua aplicação para o lugar certo. Os\ntestes automatizados no final servem para garantir que ela ainda segue\neste caminho, que contribuições realizadas tardiamente não “quebraram” o\ncomportamento que você escreveu no início do desenvolvimento.</p>\n<p>Tenho a intenção de escrever um <em>post</em> mais prático sobre testes e\n<em>Django</em>. Fiquem no aguardo ;)</p>\n<p>E você? Tem alguma ferramenta para recomendar? Utilize os comentários\nabaixo para compartilhá-la.</p>\n<h2>Referências</h2>\n<ul>\n<li><a href=\"http://cilliano.com/blog/2011/02/07/django-bdd-with-lettuce-and-splinter/\" title=\"Leia sobre Django, BDD, Lettuce e Splinter\"><em>CillianO – Django Full Stack Testing and BDD with Lettuce and Splinter</em></a></li>\n<li><a href=\"http://www.dtsato.com/blog/work/introduzindo_desenvolvimento_orientado_comportamento_bdd/\" title=\"Não sabe o que é BDD? Conheça neste artigo de Danilo Sato\"><em>Danilo Sato</em> – Introduzindo Desenvolvimento Orientado por Comportamento <em>BDD</em></a></li>\n<li><a href=\"https://github.com/jbalogh/django-nose\" title=\"Visite o repositório do django-nose no GitHub\"><em>django-nose – GitHub repository</em></a></li>\n<li><a href=\"http://farmdev.com/projects/fudge/using-fudge.html#fudging-a-web-service\" title=\"Documentação oficial do Fudge\"><em>Fudge – Using Fudge</em></a></li>\n<li><a href=\"http://jpz-log.info/archives/2010/06/08/nose-testing-in-python-made-easy/\" title=\"Testes em Python passam a ser mais fáceis com nose\"><em>JPz’log – nose: Testing in Python made easy</em></a></li>\n<li><a href=\"http://somethingaboutorange.com/mrl/projects/nose/1.0.0/writing_tests.html\" title=\"Aprenda a escrever testes Python com o Nose\"><em>Nose – Writing tests</em></a></li>\n<li><a href=\"http://splinter.cobrateam.info/\" title=\"Conheça o projeto Splinter, e envolva-se\"><em>Splinter – Test framework for web applications</em></a></li>\n</ul>\n<p>Até a próxima…</p>","excerpt":"No post anterior,\nconhecemos as ferramentas default para construção de testes\nautomatizados em Django. Acontece que você pode “sair um pouco…","frontmatter":{"date":"2011-07-23T18:00:00.000Z","title":"Ferramentas de testes em Django - Parte 2","tags":["desenvolvimento-web","python","django","bdd","tdd","testes"],"thumbnail":{"childImageSharp":{"fixed":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAUBAwT/xAAYAQADAQEAAAAAAAAAAAAAAAAAAQIDBP/aAAwDAQACEAMQAAAB9W853NdMbxkYFaA//8QAHhAAAQMEAwAAAAAAAAAAAAAAAQACEQMEEBITIST/2gAIAQEAAQUCETyMw49B21woBVM+tf/EABYRAQEBAAAAAAAAAAAAAAAAAAEgIf/aAAgBAwEBPwHAj//EABcRAAMBAAAAAAAAAAAAAAAAAAECEBH/2gAIAQIBAT8BOs2CCf/EABoQAAICAwAAAAAAAAAAAAAAAAEQACERUYH/2gAIAQEABj8CuEaYGaVzpX//xAAaEAACAwEBAAAAAAAAAAAAAAABEQAQMSFB/9oACAEBAAE/IfQjSDdUiCLBDgomBGpkq//aAAwDAQACAAMAAAAQ68f8/8QAFREBAQAAAAAAAAAAAAAAAAAAASD/2gAIAQMBAT8QACx//8QAFhEAAwAAAAAAAAAAAAAAAAAAARBB/9oACAECAQE/ECNkqX//xAAdEAEBAAEFAQEAAAAAAAAAAAABETEAECFBUZGx/9oACAEBAAE/EEAQP3U1lAonKde7LInrpkq0IqcVjjOzAPRcfNIRAM33b//Z","width":180,"height":180,"src":"/static/5735a1cfb51adcf5189982c630641405/a8ad2/crash-test-2.jpg","srcSet":"/static/5735a1cfb51adcf5189982c630641405/a8ad2/crash-test-2.jpg 1x"}},"publicURL":"/static/5735a1cfb51adcf5189982c630641405/crash-test-2.jpg"}},"fields":{"readingTime":{"minutes":6.355},"slug":"/2011/07/23/ferramentas-de-testes-em-django-parte-2.html"}},"site":{"siteMetadata":{"author":{"name":"Klaus Peter Laube","gravatar":"https://en.gravatar.com/userimage/12163112/d3ae0c6239980b01ff1f1730b65c2ebe.jpg"},"siteUrl":"https://klauslaube.com.br"}}},"pageContext":{"slug":"/2011/07/23/ferramentas-de-testes-em-django-parte-2.html"}},"staticQueryHashes":["2831923220","4114525740"]}