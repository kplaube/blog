{"componentChunkName":"component---src-templates-blog-post-js","path":"/2011/07/18/ferramentas-de-testes-em-django-parte-1.html","result":{"data":{"markdownRemark":{"html":"<p>Dando continuidade à série\n“<a href=\"/2011/03/03/montando-seu-ambiente-de-desenvolvimento-django.html\" title=\"Veja outros posts desta série\">Montando seu ambiente de desenvolvimento <em>Django</em> no <em>Linux</em></a>“, vou\nindicar algumas ferramentas de testes para que você também possa deixar\ncom que os <a href=\"/2011/01/27/tdd-desenvolvimento-orientado-testes.html\" title=\"TDD: Desenvolvimento Orientado a Testes\">testes guiem o desenvolvimento de suas aplicações</a>.</p>\n<p>Afinal, testar é preciso ;)</p>\n<h2>Testar em Django é possível?</h2>\n<p>Sem dúvida nenhuma! Mas não espere que o <em>framework</em> adeque-se a você,\nvocê precisa ter a iniciativa de tentar compreender as melhores maneiras\npara escrever testes em <a href=\"/tag/django.html\" title=\"Leia mais sobre Django\"><em>Django</em></a>.</p>\n<p>Por exemplo, se você tem por hábito isolar os modelos para <a href=\"/tag/testes.html\" title=\"Leia mais sobre testes\">testá-los</a>\nde forma unitária, pode passar por certa dor de cabeça com o\n<a href=\"/tag/python.html\" title=\"Leia mais sobre Python\"><em>Python</em></a> / <em>Django</em>. Não que seja impossível, mas o comportamento\n<em>default</em> do <em>framework</em> é criar uma base de dados “fake” para você não\nprecisar ter este trabalho.</p>\n<p>Enfim, talvez a forma de <strong>utilizar</strong> estas ferramentas <strong>caiba em um\noutro <em>post</em></strong>, o objetivo deste é <strong>apenas apresentá-las</strong>.</p>\n<h2>unittest – Testando unidades através de classes</h2>\n<p>A <a href=\"http://docs.python.org/library/unittest.html\" title=\"unittest — Unit testing framework\"><em>unittest</em></a> é uma biblioteca padrão do <em>Python</em> que ajuda (e muito)\na escrever testes automatizados com a linguagem.</p>\n<p>Os testes são escritos através de classes, onde utilizamos os esquemas\nde <a href=\"http://docs.python.org/library/unittest.html#assert-methods\" title=\"Veja a lista de asserts da unittest\"><em>assertions</em></a> para garantir o comportamento do código testado\n(nenhuma novidade até aqui). Para quem utiliza testes unitários no\n<em>Java</em> não vai sentir grandes mudanças na abordagem, já que a <em>unittest</em>\né inspirada na <a href=\"http://javafree.uol.com.br/wiki/JUnit\" title=\"Leia mais sobre a JUnit\"><em>JUnit</em></a> (sendo muitas vezes até chamada de <em>PyUnit</em>):</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> unittest\n<span class=\"token keyword\">from</span> myapp<span class=\"token punctuation\">.</span>models <span class=\"token keyword\">import</span> Animal\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">AnimalTestCase</span><span class=\"token punctuation\">(</span>unittest<span class=\"token punctuation\">.</span>TestCase<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n  <span class=\"token keyword\">def</span> <span class=\"token function\">setUp</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    self<span class=\"token punctuation\">.</span>lion <span class=\"token operator\">=</span> Animal<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span>create<span class=\"token punctuation\">(</span>name<span class=\"token operator\">=</span><span class=\"token string\">\"lion\"</span><span class=\"token punctuation\">,</span> sound<span class=\"token operator\">=</span><span class=\"token string\">\"roar\"</span><span class=\"token punctuation\">)</span>\n    self<span class=\"token punctuation\">.</span>cat <span class=\"token operator\">=</span> Animal<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span>create<span class=\"token punctuation\">(</span>name<span class=\"token operator\">=</span><span class=\"token string\">\"cat\"</span><span class=\"token punctuation\">,</span> sound<span class=\"token operator\">=</span><span class=\"token string\">\"meow\"</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">def</span> <span class=\"token function\">testSpeaking</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    self<span class=\"token punctuation\">.</span>assertEquals<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>lion<span class=\"token punctuation\">.</span>speak<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'The lion says \"roar\"'</span><span class=\"token punctuation\">)</span>\n    self<span class=\"token punctuation\">.</span>assertEquals<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>cat<span class=\"token punctuation\">.</span>speak<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'The cat says \"meow\"'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>O <em>test runner</em> padrão do <em>Django</em> irá procurar por subclasses de\n<code class=\"language-text\">unittest.TestCase</code> nos arquivos <code class=\"language-text\">models.py</code> e <code class=\"language-text\">tests.py</code>. A suíte\nde testes tenta facilitar ao máximo a sua vida… execute a seguinte\ninstrução e confira se a sua aplicação está <em>ok</em> ou não:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ python manage.py test</code></pre></div>\n<h3>Peraí que não acabou! Apresentando a TestCase</h3>\n<p>Testar aplicações <a href=\"/tag/desenvolvimento-web.html\" title=\"Leia mais sobre Web\"><em>Web</em></a> com a <em>unittest</em> pode ser dureza. Pensando\nnisso o <em>Django</em> disponibiliza a <code class=\"language-text\">TestCase</code>, que estende a <em>unittest</em>\nadicionando funcionalidades como carregamento de <em>fixtures</em>, roteamento\nde <em>urls</em> e um <em>client</em> para fazer requisições <em>Web</em> e testar as suas\n<em>views</em> (o <em>TestClient</em>, detalhado mais abaixo).</p>\n<h2>doctest – Testando através de docstrings</h2>\n<p>Admito que escrever documentação de <em>software</em> não é o meu forte… mas\ncom <em>doctests</em> pode-se documentar métodos ao mesmo tempo em que\nescreve-se testes!</p>\n<p>A <a href=\"http://docs.python.org/library/doctest.html\" title=\"Leia mais sobre a doctest\"><em>doctest</em></a> é uma biblioteca padrão do <em>Python</em> que procura e\ninterpreta <a href=\"http://www.python.org/dev/peps/pep-0257/\" title=\"Entenda o que é uma docstring\"><em>docstrings</em></a> na aplicação. A sintaxe nesses trechos de\n<em>docstrings</em> é diferenciada, simulando um interpretador interativo do\n<em>Python</em>:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># models.py</span>\n<span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>db <span class=\"token keyword\">import</span> models\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Animal</span><span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">.</span>Model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n  <span class=\"token triple-quoted-string string\">\"\"\"\n  An animal that knows how to make noise\n\n  # Create some animals\n  >>> lion = Animal.objects.create(name=\"lion\", sound=\"roar\")\n  >>> cat = Animal.objects.create(name=\"cat\", sound=\"meow\")\n\n  # Make 'em speak\n  >>> lion.speak()\n  'The lion says \"roar\"'\n  >>> cat.speak()\n  'The cat says \"meow\"'\n  \"\"\"</span>\n  name <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>CharField<span class=\"token punctuation\">(</span>max_length<span class=\"token operator\">=</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span>\n  sound <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>CharField<span class=\"token punctuation\">(</span>max_length<span class=\"token operator\">=</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">def</span> <span class=\"token function\">speak</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> <span class=\"token string\">'The %s says \"%s\"'</span> <span class=\"token operator\">%</span> <span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>sound<span class=\"token punctuation\">)</span></code></pre></div>\n<p>Assim como com a <em>unittest</em>, o <em>test runner</em> padrão do <em>Django</em>\nprocurará por ocorrências de <em>docstests</em> em <code class=\"language-text\">models.py</code> e\n<code class=\"language-text\">tests.py</code>.</p>\n<h2>Django Test Client – Testando a sua aplicação como se fosse um navegador</h2>\n<p>E como fazer para testar requisições <em>Web</em>? Por exemplo, você não quer\ntestar a sua <em>view</em> de forma isolada, quer testar desde a parte de\nroteamento ao comportamento com o banco de dados, como se você se\nestivesse realmente visitando a página. Neste caso entra a <a href=\"https://docs.djangoproject.com/en/dev/topics/testing/#module-django.test.client\" title=\"Testando aplicações Django com requisições Web falsas\"><em>test\nclient</em></a>.</p>\n<p>Toda a classe <code class=\"language-text\">TestCase</code> possui uma instância da <strong>Django Test\nClient</strong>. Então escrever testes com requisições à sua aplicação fica\nmuito simples utilizando classes:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>test <span class=\"token keyword\">import</span> TestCase\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">SimpleTest</span><span class=\"token punctuation\">(</span>TestCase<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n  <span class=\"token keyword\">def</span> <span class=\"token function\">test_details</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    response <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'/customer/details/'</span><span class=\"token punctuation\">)</span>\n    self<span class=\"token punctuation\">.</span>assertEqual<span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>status_code<span class=\"token punctuation\">,</span> <span class=\"token number\">200</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">def</span> <span class=\"token function\">test_index</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    response <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'/customer/index/'</span><span class=\"token punctuation\">)</span>\n    self<span class=\"token punctuation\">.</span>assertEqual<span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>status_code<span class=\"token punctuation\">,</span> <span class=\"token number\">200</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>É perfeitamente possível utilizar a <strong>test client</strong> em <em>doctests</em>\ntambém:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token triple-quoted-string string\">\"\"\"\n>>> from django.test.client import Client\n>>> c = Client()\n>>> response = c.post('/login/', {'username': 'john',\n...        'password': 'smith'})\n>>> response.status_code\n200\n\"\"\"</span></code></pre></div>\n<h2>Considerações finais</h2>\n<p>Particularmente, tive a oportunidade de implementar testes unitários já\nno início do meu aprendizado em <em>Django</em>. Deixar os testes te guiarem é\numa prática excelente!</p>\n<p>Tudo parte do bom senso, óbvio. Nenhum processo ou ferramenta deveria\nsubstituir o “feeling” do profissional… também não é muito sadio ser\nextremamente “by the book“. Mas se puder utilizar testes para guiar o\nseu desenvolvimento, use-os!</p>\n<p>Na segunda parte deste <em>post</em> pretendo apresentar algumas ferramentas\nque irão turbinar ainda mais o seu desenvolvimento orientado a testes.</p>\n<p>Até lá!</p>\n<h2>Referências</h2>\n<ul>\n<li><a href=\"https://docs.djangoproject.com/en/1.1/topics/testing/#writing-unit-tests\" title=\"Leia direto da fonte como escrever testes em Django\"><em>Django Documentation – Writing unit tests</em></a></li>\n<li><a href=\"https://docs.djangoproject.com/en/1.1/topics/testing/#writing-doctests\" title=\"Leia direto da fonte sobre como escrever testes com docstrings\"><em>Django Documentation – Writing doctests</em></a></li>\n<li><a href=\"https://docs.djangoproject.com/en/1.1/topics/testing/#testcase\" title=\"Entenda a diferença entre unittest do Python e o TestCase do Django\"><em>Django Documentation – TestCase</em></a></li>\n<li><a href=\"http://docs.python.org/library/unittest.html\" title=\"Leia sobre a unittest direto da documentação do Python\"><em>Python Documentation – unittest: Unit testing framework</em></a></li>\n<li><a href=\"http://dougalmatthews.com/articles/2010/jan/20/testing-your-first-django-app/\" title=\"Aprenda a testar a sua primeira aplicação em Django\"><em>Dougal Matthews – Testing your first Django app</em></a></li>\n<li><a href=\"http://kokoko.fluxionary.net/testing-django-part-1-nose\" title=\"O Konrad apresenta algumas ferramentas muito boas para testes com Django\"><em>Konrad’s Kode, Konfigs &#x26; Konstructions – Testing Django</em></a></li>\n<li><a href=\"http://www.marinhobrandao.com/blog/programacao-dirigida-a-testes-no-django/\" title=\"Aprenda Django de uma forma divertida com o Marinho\"><em>Marinho Brandão</em> – Programação dirigida a testes no <em>Django</em></a></li>\n</ul>","excerpt":"Dando continuidade à série\n“Montando seu ambiente de desenvolvimento Django no Linux“, vou\nindicar algumas ferramentas de testes para que…","frontmatter":{"date":"2011-07-18T22:06:00.000Z","title":"Ferramentas de testes em Django - Parte 1","tags":["desenvolvimento-web","python","django","testes","bdd","tdd"],"thumbnail":{"childImageSharp":{"fixed":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIBBP/EABYBAQEBAAAAAAAAAAAAAAAAAAEAAv/aAAwDAQACEAMQAAABvORl7FGjQqCf/8QAGxAAAgMBAQEAAAAAAAAAAAAAAQIAAxIRITH/2gAIAQEAAQUCDgl3yqHS1kzNlj/JwLB7OT//xAAYEQADAQEAAAAAAAAAAAAAAAAAAREQQf/aAAgBAwEBPwFOohzP/8QAFhEAAwAAAAAAAAAAAAAAAAAAABAR/9oACAECAQE/ASv/xAAbEAACAwADAAAAAAAAAAAAAAAAEQECECEiMf/aAAgBAQAGPwIY0iVDO8KuOvB7n//EABoQAQADAQEBAAAAAAAAAAAAAAEAESFBUTH/2gAIAQEAAT8hCBe9gdvg5FF6cgsSTsSbPCWYjdCz9hRqgPJ//9oADAMBAAIAAwAAABAzB8L/xAAYEQADAQEAAAAAAAAAAAAAAAAAAREQIf/aAAgBAwEBPxBVYUJtcZ//xAAXEQEBAQEAAAAAAAAAAAAAAAARAAEQ/9oACAECAQE/ENWEY8//xAAeEAEAAwACAgMAAAAAAAAAAAABABEhMUFRYZGhsf/aAAgBAQABPxChoJ3h8ym7CYFL43iXqhvV5KBfyhed/sXxLdDDPuO2ccRQVWjuWl/q6h7A0M//2Q==","width":180,"height":180,"src":"/static/57eb6b50e90dab78ab505a82c29fc740/a8ad2/crash-test.jpg","srcSet":"/static/57eb6b50e90dab78ab505a82c29fc740/a8ad2/crash-test.jpg 1x"}},"publicURL":"/static/57eb6b50e90dab78ab505a82c29fc740/crash-test.jpg"}},"fields":{"readingTime":{"minutes":5.055},"slug":"/2011/07/18/ferramentas-de-testes-em-django-parte-1.html"}},"site":{"siteMetadata":{"author":{"name":"Klaus Peter Laube","gravatar":"https://en.gravatar.com/userimage/12163112/d3ae0c6239980b01ff1f1730b65c2ebe.jpg"},"siteUrl":"https://klauslaube.com.br"}}},"pageContext":{"slug":"/2011/07/18/ferramentas-de-testes-em-django-parte-1.html"}}}