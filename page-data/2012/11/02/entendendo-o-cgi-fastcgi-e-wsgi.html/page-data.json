{"componentChunkName":"component---src-templates-blog-post-js","path":"/2012/11/02/entendendo-o-cgi-fastcgi-e-wsgi.html","result":{"data":{"markdownRemark":{"html":"<p>Pelos vários anos que programei com o <a href=\"/tag/php.html\" title=\"Conheça mais sobre o Hypertext PreProcessor\"><em>PHP</em></a> e <em>Apache</em>,\nnunca precisei me preocupar com o que acontecia entre esses dois. Para\nmim, era tudo uma “mágica” maravilhosa, que entregava as minhas páginas\n<a href=\"/tag/desenvolvimento-web.html\" title=\"Leia mais sobre Web\"><em>web</em></a> de forma dinâmica. Era uma troca justa: Eles não me traziam\npreocupação, logo, eu não me preocupava.</p>\n<p>Com o passar do tempo, o uso do <a href=\"/2011/12/19/nginx-poderoso-rapido-facil.html\" title=\"Conheça o Nginx\"><em>Nginx</em></a> e a necessidade de aprender\n<a href=\"/tag/python.html\" title=\"Leia mais sobre Python\"><em>Python</em></a>, comecei a me deparar com o famoso <code class=\"language-text\">cgi-bin</code>, e\nentender que os truques que o <a href=\"http://stackoverflow.com/questions/2712825/what-is-mod-php\" title=\"Não conhece o módulo do PHP para o Apache?\"><strong>mod_php</strong></a> ocultava iam muito além\ndo que eu imaginava.</p>\n<h2>O Common Gateway Interface</h2>\n<p>De um modo bem simples, podemos dizer que o <em>Common Gateway Interface</em> é\num “acordo” entre os servidores <a href=\"/tag/http.html\" title=\"Leia mais sobre HTTP\"><em>HTTP</em></a> e as aplicações <em>web</em>. Por\nbaixo dos panos, o servidor <em>web</em> vai informar uma série de parâmetros\npara o seu programa, e é dever do seu programa entregar uma resposta\n“bem formada” para o servidor <em>web</em>.</p>\n<p>Isso quer dizer que, para o <em>CGI</em>, não importa qual linguagem ou banco\nde dados o seu programa está usando. Para ele, importa a passagem dos\nparâmetros e a resposta. Logo, é perfeitamente possível desenvolvermos\nnossas páginas até mesmo com a linguagem <em>C</em>:</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h></span></span>\n\n<span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> argc<span class=\"token punctuation\">,</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>argv<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Content-type:text/html\\n\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"&lt;html>\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"&lt;body bgcolor=\\\"%s\\\">\\n\"</span><span class=\"token punctuation\">,</span> argv<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"&lt;/body>\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"&lt;/html>\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Basta compilar o código acima, jogar no <code class=\"language-text\">cgi-bin</code> do seu <em>Apache</em>, e\nvocê verá a flexibilidade do protocolo em ação. Neste exemplo, acessando\nnosso programa através da <em>URL</em> <code class=\"language-text\">http://localhost/cgi-bin/exemplo?red</code>\n(por exemplo), veremos apenas uma página com o fundo vermelho. Mas é\nimportante reparar que, o parâmetro passado na URL (<code class=\"language-text\">?red</code>) está acessível através do\n<code class=\"language-text\">argv</code>, ou seja, o protocolo está passando para o nosso programa os\nparâmetros através da <code class=\"language-text\">STDIN</code>.</p>\n<p>Através da <code class=\"language-text\">STDOUT</code>, estamos respondendo ao <em>Apache</em> utilizando de\nartifícios do protocolo. A nossa mensagem é composta por um cabeçalho\ninformando o tipo da mensagem e o conteúdo. Neste exemplo, trata-se de\num <em>HTML</em> extremamente simples, <em>James Marshall</em> <a href=\"http://www.jmarshall.com/easy/cgi/portuguese/getcgi.c.txt\" title=\"Veja outro exemplo de C com CGI\">escreveu um bom exemplo um pouco mais complexo utilizando a linguagem <em>C</em></a>.</p>\n<p>Outro comportamento fundamental do <em>CGI</em> é a criação de variáveis de\nambiente. Variáveis que você já deve ter usado, como <code class=\"language-text\">REMOTE_HOST</code>,\n<code class=\"language-text\">REMOTE_ADDR</code>, <code class=\"language-text\">REQUEST_METHOD</code> e <code class=\"language-text\">QUERY_STRING</code>, são\npreenchidas pelo servidor <em>Web</em> e passadas ao seu programa através do\nprotocolo:</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdlib.h></span></span>\n\n<span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> argc<span class=\"token punctuation\">,</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>argv<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>addr<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>method<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>query_string<span class=\"token punctuation\">;</span>\n\n    addr <span class=\"token operator\">=</span> <span class=\"token function\">getenv</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"REMOTE_ADDR\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    method <span class=\"token operator\">=</span> <span class=\"token function\">getenv</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"REQUEST_METHOD\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    query_string <span class=\"token operator\">=</span> <span class=\"token function\">getenv</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"QUERY_STRING\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Content-type:text/html\\n\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Remote address: %s&lt;br/>\"</span><span class=\"token punctuation\">,</span> addr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Method: %s&lt;br/>\"</span><span class=\"token punctuation\">,</span> method<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Query string: %s&lt;br/>\"</span><span class=\"token punctuation\">,</span> query_string<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>O FastCGI</h2>\n<p>O <em>FastCGI</em> segue o mesmo princípio do <em>CGI</em>, mas possui uma série de\nparticularidades (e vantagens) em relação ao seu “primogênito”. Para\ncompreender a diferença entre eles, vamos analisar o ciclo de vida de\numa requisição utilizando o <em>CGI</em>:</p>\n<ul>\n<li>A cada requisição, o servidor <em>web</em> <strong>cria um novo processo</strong>;</li>\n<li>Através deste processo, o servidor <em>web</em> passa informações para o\n“programa <em>CGI</em>“ utilizando <strong>variáveis de ambiente</strong>;</li>\n<li>O servidor <em>web</em> também passa qualquer <em>input</em> de dados do usuário\natravés da <strong><em>STDIN</em></strong>;</li>\n<li>O programa retorna uma saída ao servidor <em>web</em> através do protocolo\n<em>CGI</em> (utilizando a <strong><em>STDOUT</em></strong>);</li>\n<li>Quando o <strong>programa acabar</strong>, a requisição é finalizada.</li>\n</ul>\n<p>Em um cenário com poucas requisições, este fluxo atende perfeitamente.\nOs problemas começam a aparecer quando temos que lidar com <strong>alto\nconsumo</strong> (algo comum hoje em dia, mas nem tão comum quando conceberam o\nprotocolo <em>CGI</em>). Dentre os principais problemas, temos:</p>\n<ul>\n<li>Criar e destruir um processo a cada requisição aumenta o <em>load</em> do\nseu servidor, o que fatalmente degrada performance;</li>\n<li>Não há reúso de recursos, como conexões com banco de dados e\n<em>caches</em> em memória (já que a cada nova requisição é iniciado um\nnovo processo);</li>\n<li>Não é trivial separar a sua aplicação do seu servidor <em>Web</em>.</li>\n</ul>\n<p>Foi pensando em performance e escalabilidade que o <em>FastCGI</em> foi criado.\nAo contrário do <em>CGI</em>, ele utiliza “processos persistentes”, onde o\nservidor <em>web</em> é capaz de iniciar um processo que responde a uma série\nde requisições. Além disso, ele usa <a href=\"http://pt.wikipedia.org/wiki/Multiplexador\" title=\"Leia mais sobre Multiplexadores na Wikipedia\">multiplexação</a> para transmitir e\nreceber informações dentro de uma única conexão, que pode ser um\n<em>socket</em> ou uma conexão <em>TCP</em>. Desse modo, você pode ter o seu servidor\n<em>web</em> e o seu processo <em>FastCGI</em> em máquinas diferentes.</p>\n<p>O ciclo de vida de uma requisição <em>FastCGI</em>, é basicamente composto por:</p>\n<ul>\n<li>O servidor <em>web</em> <strong>cria um processo <em>FastCGI</em></strong> para receber\nrequisições;</li>\n<li>A sua aplicação é inicializada, e <strong>aguarda por uma nova conexão</strong>\nvinda do servidor <em>web</em>;</li>\n<li>Quando o cliente envia uma requisição, o servidor <em>web</em> abre uma\n<strong>conexão com o processo <em>FastCGI</em></strong>. O servidor envia as variáveis\nde ambiente e entradas de dados através desta conexão;</li>\n<li>O processo <em>FastCGI</em> retorna a <strong>saída através desta mesma\nconexão</strong>;</li>\n<li>O processo <em>FastCGI</em> fecha a conexão, e a <strong>requisição é\nconcluída</strong>, porém, o <strong>processo fica “vivo”</strong>, esperando por outra\nrequisição do servidor <em>web</em>.</li>\n</ul>\n<p>É claro que para atingir este resultado, aplicações <em>FastCGI</em> possuem\numa arquitetura mais “rebuscada” que aplicações <em>CGI</em>. Por exemplo, para\nsuportar a <a href=\"http://www.nongnu.org/fastcgi/#multiplexing\" title=\"The wonders of multiplexing\">multiplexação</a>, o servidor <em>web</em> e o processo <em>FastCGI</em>\nse comunicam através de mensagens. Nestas mensagens (<code class=\"language-text\">BEGIN_REQUEST</code>,\n<code class=\"language-text\">ABORT_REQUEST</code>, <code class=\"language-text\">END_REQUEST</code>, <code class=\"language-text\">PARAMS</code>, <code class=\"language-text\">STDIN</code> e\n<code class=\"language-text\">STDOUT</code>) possuímos um cabeçalho chamado <code class=\"language-text\">Request ID</code>, que é\nresponsável por identificar a qual requisição o pacote pertence.</p>\n<p>Essa mudança de arquitetura acaba influenciando na escrita das\naplicações <em>web</em>, trazendo alterações marcantes em comparação aos\nprogramas escritos para o bom e velho <em>CGI</em>. Por exemplo, você terá que\n<a href=\"http://redmine.lighttpd.net/projects/1/wiki/Docs_ModFastCGI#FastCGI-and-Programming-Languages\" title=\"Lighttp - the FastCGI Interface\">recompilar o seu <em>PHP</em></a> com a <em>flag</em> <code class=\"language-text\">—enable-fast-cgi</code>.</p>\n<p>O site oficial do <em>FastCGI</em> possui um bom exemplo de implementação de\numa <a href=\"http://www.fastcgi.com/devkit/doc/fastcgi-prog-guide/ch2c.htm\" title=\"Developing FastCGI Applications in C\">aplicação em <em>C</em> com <em>FastCGI</em></a>.</p>\n<h2>O Web Server Gateway Interface</h2>\n<p>No universo <em>Python</em> começaram a aparecer diferentes formas de\ncomunicação entre servidor e aplicação, seja com <em>CGI</em>, <em>FastCGI</em>, <a href=\"http://www.modpython.org/\" title=\"Leia mais sobre o mod_python\"><em>mod\npython</em></a> ou até mesmo com <em>APIs</em> próprias e não padronizadas. Isso\nacarretou no seguinte cenário: A escolha de um <em>framework</em> influenciava\ndiretamente na escolha do servidor <em>web</em>, e geralmente o <em>framework</em>\nescolhido era “incompatível” com os demais disponíveis para uso.</p>\n<p>O <em>WSGI</em> é uma <a href=\"http://www.python.org/dev/peps/pep-0333/\" title=\"Leia a PEP 333, especificação do WSGI\">especificação</a> que tem por objetivo garantir que o\ndesenvolvedor da aplicação não se preocupe com qual servidor <em>web</em> será\nescolhido, bem como o profissional responsável pelo servidor <em>web</em> não\nse preocupe com a arquitetura escolhida pela aplicação. Uma forma\n“universal” de proporcionar interoperabilidade entre servidores e\naplicações escritas em <em>Python</em>.</p>\n<p>Veja um exemplo de <em>script Python</em> utilizando o protocolo <em>CGI</em>:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\">#!/usr/bin/python</span>\n\n<span class=\"token keyword\">from</span> os <span class=\"token keyword\">import</span> environ\n\n\n<span class=\"token keyword\">print</span> <span class=\"token string\">\"Content-Type: text/html\\n\\n\"</span>\n<span class=\"token keyword\">print</span> <span class=\"token string\">\"&lt;html>&lt;body>Hello %s!&lt;/body>&lt;/html>\"</span> <span class=\"token operator\">%</span> environ<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'REMOTE_ADDR'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Seguindo a especificação do <em>WSGI</em>, devemos servir nossa aplicação da\nseguinte maneira:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\">#!/usr/bin/python</span>\n\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">application</span><span class=\"token punctuation\">(</span>environ<span class=\"token punctuation\">,</span> start_response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    start_response<span class=\"token punctuation\">(</span><span class=\"token string\">'200 OK'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Content-Type'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'text/html'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'&lt;html>&lt;body>Hello %s&lt;/body>&lt;/html>'</span> <span class=\"token operator\">%</span> environ<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'REMOTE_ADDR'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p>Encapsulamos a nossa entrega em uma função chamada <code class=\"language-text\">application</code>, e\nnela possuímos dois parâmetros: <code class=\"language-text\">environ</code> e <code class=\"language-text\">start_response</code>. O\nprimeiro é responsável por informar quais as variáveis ambientais que\ntemos à nossa disposição. O segundo, nomeado como <code class=\"language-text\">start_response</code>, é\nna verdade uma função de <em>callback</em> onde informamos o <em>status code</em> e\ndemais cabeçalhos para resposta.</p>\n<p>Por fim, retornamos ao servidor <em>web</em> o nosso <a href=\"/tag/html.html\" title=\"Leia mais sobre HTML\"><em>HTML</em></a>. O servidor\n<em>web</em> pode “iterar” sobre a aplicação, retornando conteúdo ao usuário\nconforme a aplicação for retornando conteúdo para ele. Neste caso,\nutilizamos na resposta um tipo <a href=\"http://docs.python.org/2/library/stdtypes.html#sequence-types-str-unicode-list-tuple-bytearray-buffer-xrange\" title=\"Leia sobre tipos sequenciais no Python\">sequencial</a>.</p>\n<p>Agora somos capazes de servir a aplicação através de <em>CGI</em>:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> wsgiref<span class=\"token punctuation\">.</span>handlers <span class=\"token keyword\">import</span> CGIHandler\n\nCGIHandler<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>run<span class=\"token punctuation\">(</span>application<span class=\"token punctuation\">)</span></code></pre></div>\n<p>E até mesmo <em>FastCGI</em>:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> flup<span class=\"token punctuation\">.</span>server<span class=\"token punctuation\">.</span>fcgi <span class=\"token keyword\">import</span> WSGIServer\n\nWSGIServer<span class=\"token punctuation\">(</span>application<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>run<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>A biblioteca <a href=\"http://docs.python.org/2/library/wsgiref.html\" title=\"Saiba mais direto da documentação do Python\"><em>wsgiref</em></a> implementa as especificações do <em>WSGI</em> e\nprovê ferramentas para a comunicação entre servidores e aplicações. No\nsegundo exemplo utilizamos a <a href=\"http://trac.saddi.com/flup\" title=\"Saiba mais sobre\"><em>flup</em></a>, uma biblioteca com algumas\nsoluções <em>WSGI</em>, incluindo a possibilidade de servir aplicações\n<em>FastCGI</em>.</p>\n<p>Com esse “código de cola”, basta <a href=\"http://docs.python.org/2/howto/webservers.html\" title=\"HOWTO Use Python in the web\">configurar o seu servidor <em>Web</em></a>\nfavorito para servir a sua aplicação.</p>\n<h3>mod_wsgi</h3>\n<p>Uma vez construída a interface para a sua aplicação através do padrão\n<em>WSGI</em>, você pode serví-la em um servidor <em>Apache</em> através do\n<a href=\"http://code.google.com/p/modwsgi/\" title=\"Página do módulo no Google Code\">mod_wsgi</a>. Existem soluções equivalentes para outros servidores,\ncomo por exemplo, no <a href=\"http://klauslaube.com.br/tags/nginx/\" title=\"Leia mais sobre Nginx\"><em>Nginx</em></a> temos o <a href=\"http://wiki.nginx.org/NgxWSGIModule\" title=\"Veja mais na documentação do Nginx\"><em>NgxWSGIModule</em></a>.</p>\n<p>Com o <em>mod</em>wsgi<em>, você não precisa de nenhum “código de cola” (como\napresentado nos exemplos de _CGI</em> e <em>FastCGI</em>), basta <a href=\"http://code.google.com/p/modwsgi/wiki/QuickConfigurationGuide\" title=\"Veja instruções para configurar o Apache com mod_wsgi\">configurar o seu <em>Apache</em></a>\ne apontar o seu script <em>WSGI</em> através da instrução <code class=\"language-text\">WSGIScriptAlias</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&lt;VirtualHost *:80&gt;\n\n    ServerName www.example.com\n    ServerAlias example.com\n    ServerAdmin webmaster@example.com\n\n    DocumentRoot /usr/local/www/documents\n\n    Alias /robots.txt /usr/local/www/documents/robots.txt\n    Alias /favicon.ico /usr/local/www/documents/favicon.ico\n\n    Alias /media/ /usr/local/www/documents/media/\n\n    &lt;Directory /usr/local/www/documents&gt;\n    Order allow,deny\n    Allow from all\n    &lt;/Directory&gt;\n\n    WSGIScriptAlias / /usr/local/www/wsgi-scripts/wsgi.py\n\n    &lt;Directory /usr/local/www/wsgi-scripts&gt;\n    Order allow,deny\n    Allow from all\n    &lt;/Directory&gt;\n\n&lt;/VirtualHost&gt;</code></pre></div>\n<p>Uma particularidade do mod_wsgi é a escolha de execução no modo\n<code class=\"language-text\">daemon</code>, que opera de uma forma <a href=\"http://code.google.com/p/modwsgi/#Server_Performance\" title=\"Leia mais sobre performance com mod_wsgi\">similar ao esquema utilizado pelo\n<em>FastCGI</em></a>.</p>\n<h3>Servidores WSGI</h3>\n<p>Você pode utilizar servidores especialmente escritos para servir as suas\naplicações <em>WSGI</em>, como por exemplo o <a href=\"http://gunicorn.org/\" title=\"Veja mais sobre este servidor WSGI\"><em>Gunicorn</em></a>, o <a href=\"http://projects.unbit.it/uwsgi/\" title=\"Um rápido servidor WSGI escrito em C\"><em>uWSGI</em></a> ou\naté mesmo o <a href=\"http://www.tornadoweb.org/documentation/wsgi.html\" title=\"Saiba mais sobre o suporte do Tornado ao WSGI\"><em>Tornado</em></a>. Além da versatilidade e performance, a\nfacilidade é outra característica marcante em muitas dessas ferramentas:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ gunicorn -w 4 -b 127.0.0.1:5000 wsgi:application</code></pre></div>\n<p>No exemplo acima, levantamos o <em>Gunicorn</em> na <code class=\"language-text\">porta 5000</code>, e\nreservamos <code class=\"language-text\">4 workers</code> para servir a nossa aplicação.</p>\n<p>Além de diminuirmos a carga do servidor <em>web</em>, e ganharmos um controle\nmais apurado de memória e processos, ganhamos também o uso de <em>workers</em>.\nPor exemplo, o <em>Gunicorn</em> trabalha com <em>pre-fork</em> de <em>workers</em>, onde um\nprocesso “master” gerencia um conjunto de processos que são de fato os\nresponsáveis por servir a sua aplicação. Ganhamos mais uma ferramenta de\nbaixo custo para lidar com concorrência.</p>\n<p>Servidores <em>WSGI</em> conseguem servir as aplicações sem o auxílio de um\n<em>Apache</em> ou <em>Nginx</em>, mas uma prática muito comum hoje em dia é, “na\nfrente” de um <em>Gunicorn</em> (por exemplo), termos um <em>Nginx</em> servindo\nestáticos, fazendo <em>caching</em> e “aguentando porrada”, enquanto que o\nservidor <em>WSGI</em> está totalmente focado em servir o conteúdo dinâmico. O\nservidor <em>web</em> acaba fazendo uma espécie de <a href=\"http://pt.wikipedia.org/wiki/Proxy_reverso\" title=\"Leia mais sobre Proxy Reverso na Wikipedia\"><em>proxy</em> reverso</a> e até\nmesmo servindo como <a href=\"http://wiki.nginx.org/LoadBalanceExample\" title=\"Veja exemplo de uso do Nginx como balanceador\">balanceador</a>.</p>\n<p>A comunicação entre servidores pode ser feita via <em>TCP</em> ou <em>socket</em>.\nIsso nos dá uma série de vantagens, que vão desde a facilidade em\n<a href=\"http://docs.gunicorn.org/en/latest/design.html#how-many-workers\" title=\"Veja como utilizar workers com Gunicorn\">escalar</a> e distribuir, até o <em>restart</em> individual de serviços (por\nexemplo, se a sua aplicação travar, você pode reiniciar apenas o\nservidor <em>WSGI</em> e não perder o <em>caching</em> do servidor <em>web</em>).</p>\n<p>Um exemplo muito interessante de uso de servidores <em>WSGI</em> é fazendo\n<a href=\"https://devcenter.heroku.com/articles/python#using-a-different-wsgi-server\" title=\"Using a different WSGI server - Heroku\"><em>deploy</em> de aplicações <em>Python</em> para o <em>Heroku</em></a>. Configurar um\nservidor <a href=\"http://mirobetm.blogspot.com.br/2012/03/ive-been-lighttpd-fastcgi-django-user.html\" title=\"Gunicorn + Nginx - a much better way to deploy your Django website\"><em>Nginx</em> para se comunicar com servidores <em>WSGI</em></a> também é\nrelativamente simples.</p>\n<h2>Considerações finais</h2>\n<p>Um assunto muito interessante e que pretendo explorar mais aqui no\n<em>blog</em>, principalmente em relação a processos e <em>workers</em>.</p>\n<p>Servir aplicações <em>Python</em> para a <em>web</em> é algo relativamente simples,\nlimpo e elegante. Através do <em>WSGI</em>, escalar aplicações passou a ser\nalgo quase trivial, que demanda pouco esforço. Combiná-los com o <em>Nginx</em>\ndão mais fôlego a sua aplicação (principalmente se estivermos falando do\n<em>uWSGI</em> ou <a href=\"http://www.gevent.org/gevent.wsgi.html\" title=\"Servindo aplicações WSGI com gevent\"><em>gevent</em></a>), e com um <a href=\"http://puppetlabs.com/\" title=\"IT Automation Software for System Administrators\">sistema de provisionamento automático</a>\npodem facilitar e muito o seu trabalho de infraestrutura quando o consumo se tornar um problema.</p>\n<h2>Referências</h2>\n<ul>\n<li><a href=\"https://docs.djangoproject.com/en/dev/howto/deployment/fastcgi/\" title=\"Exemplo de uso do Django com FastCGI\"><em>Django Documentation – How to use Django with FastCGI, SCGI, or AJP</em></a></li>\n<li><a href=\"http://www.nongnu.org/fastcgi/\" title=\"Material muito interessante sobre o protocolo FastCGI e seu uso com C++\"><em>FastCGI – The Forgotten Treasure</em></a></li>\n<li><a href=\"http://www.fastcgi.com/drupal/node/6?q=node/15\" title=\"Um documento bem objetivo, detalhando os diferenciais em usar o FastCGI\"><em>FastCGI – A High-Performance Web Server Interface</em></a></li>\n<li><a href=\"http://gunicorn.org/\" title=\"Conheça o Gunicorn e descubra as vatangens de possuir um servidor WSGI\"><em>Gunicorn – Python WSGI HTTP Server for Unix</em></a></li>\n<li><a href=\"http://www.irt.org/articles/js172/\" title=\"Artigo de 1999 detalhando algumas características do CGI e do FastCGI\"><em>irt.org – Speed Thrills: CGI Please... and Fast!</em></a></li>\n<li><a href=\"http://www.jmarshall.com/easy/cgi/portuguese/\" title=\"Bom artigo, resumindo muito bem o funcionamento do CGI\"><em>James Marshal</em> – <em>CGI</em> realmente fácil</a></li>\n<li><a href=\"http://code.google.com/p/modwsgi/\" title=\"Veja a página oficial do projeto\"><em>modwsgi – Python WSGI adapter module for Apache</em></a></li>\n<li><a href=\"http://www.python.org/dev/peps/pep-0333/\" title=\"Leia a especificação direto do portal da linguagem Python\"><em>PEP 333 – Python Web Server Gateway Interface</em></a></li>\n<li><a href=\"http://docs.python.org/howto/webservers.html\" title=\"Compreenda a diferença do uso do Python com CGI, FastCGI, mod_python, mod_wsgi e servidores WSGI\"><em>Python Documentation – HOWTO Use Python in the web</em></a></li>\n<li><a href=\"http://www.w3.org/CGI/\" title=\"Leia mais sobre a especificação do CGI\"><em>W3C – Common Gateway Interface</em></a></li>\n<li><a href=\"http://en.wikipedia.org/wiki/Common_Gateway_Interface\" title=\"Leia mais no artigo da Wikipedia\"><em>Wikipedia – Common Gateway Interface</em></a></li>\n<li><a href=\"http://en.wikipedia.org/wiki/FastCGI\" title=\"Leia mais no artigo da Wikipedia\"><em>Wikipedia – FastCGI</em></a></li>\n<li><a href=\"http://en.wikipedia.org/wiki/Web_Server_Gateway_Interface\" title=\"Leia mais no artigo da Wikipedia\"><em>Wikipedia – Web Server Gateway Interface</em></a></li>\n<li><a href=\"http://www.xml.com/pub/a/2006/09/27/introducing-wsgi-pythons-secret-web-weapon.html\" title=\"Artigo de 2006 explicando os principais benefícios do uso do WSGI\"><em>XML.com – Introducing WSGI: Python’s Secret Web Weapon</em></a></li>\n</ul>","excerpt":"Pelos vários anos que programei com o PHP e Apache,\nnunca precisei me preocupar com o que acontecia entre esses dois. Para\nmim, era tudo uma…","frontmatter":{"date":"2012-11-02T15:09:19.000Z","title":"Entendendo o CGI, FastCGI e WSGI","tags":["desenvolvimento-web","infraestrutura","python","cgi","fastcgi","wsgi","gunicorn"],"thumbnail":{"childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsSAAALEgHS3X78AAADrElEQVQ4y42SeUyTdxjHfzuSHc55bMqKIBq2kWVxiUeiSzQGj3KDbd+2lrWlUgp9oS324qgRZMYNo6AkHnGbM4FsI3FuyxwLxplRFJQe79Xrfd9WWw+UFQQt6t8+LyzMZIdLvu+b3+95Ps/zPseL3PkV/0Nad6FuYLv60iaFO087Z0eDhbrn6nJxpXtr+TCGx3vODStN7jzNYJFgR16F8TlS1o6U6YkK67h7KBXmvErcK6+ZdSFGa/kPBXS7aRXO2tsmh0ZSdIDf004pjYyuftaLInpbWG+L/E2Cscoe1tWzpuapq55pKpD8sS+krosY7HMMYqsd/ybO4IhUWid/G5gaHJpmgjFHG6u3cTXOOQDxNc5/lrEhojUnz51/MHTtERMaPXGGrbDweOOzDOINDr7a+aeeiWR19Xc6Tz6OcA8uD09eHGC1Zh5v+AuY4VHU0hw1N0VNTXxdE1/bKBBGUCOnt6V85MNhzxM+dsP1GVyFz4ILAMDqGiEEBTdWhguMEczMqq3cLjtncALEGWyJ/R0PR3yPgqGJvn7OYI1aXEKMsYGrcgDGaqwQgsg0KSWSUekyKhOjsxVMjopZpaGyZbf3nZomguO9/cxabWCdNrBaE/hIzXxYTueo6GwlwBCCqEw5vUJJZSmp5Qo4C4lAaVImR50wdYQ3moiFxTPZMUEZcmqZ8KazFFQGhuAhFpcQb5eSS8qIxcVUhozKUpDvSMh0if/NAt+8PGoFJMUEIG2Hf2ERmS4ll86SGKJX7ozK9vIlzaCorIVaLieWlDHvq8EY39Uew1pIkRQ4Vmznd7hi5Z9CRexWW0zeCvUi/4LCiW8v3rIfp98t58tcgIbWVSe/PM/mOSKbzKP7zgRX6e62fxNTtTEfaG5ausIf44m6I1M/XyEWFSPfa+Kxru/vtJwOb8A5sd37yraJngtxvNP78hYoHq4QkDzd530pd6aoUuglXnVwvLvf/0Y+gq7Gjv0AX2C3WGOKVg/anLoS4MQOSAy1eF7YPLq/+96h7zwv5gbXVI11nY1K9lzXHpjovgBZkO91cfKrX+KGQ75Xt4fXG+mVyj9O/jT+9a8wGxgsm7v7pvloapBm3vvEPz//fu+lGLb3+s62+2d/988vQKRIcu9w723XF6H1NYnajqjERWer7h7oueU8cUP3eQLvhGnFjR1C2/LWhOkoZInrD8JQYAvCnom3SmH61DIZtCQsSST1LyiCDmdcJWS6jFhUBHb4EYSrSAJnYVWZ8qe/tYHiJKyh0gAAAABJRU5ErkJggg==","width":180,"height":180,"src":"/static/f798fc4168c6d5790e187d07b0ac21ef/d8216/apache-fcgi-logo.png","srcSet":"/static/f798fc4168c6d5790e187d07b0ac21ef/d8216/apache-fcgi-logo.png 1x"}},"publicURL":"/static/f798fc4168c6d5790e187d07b0ac21ef/apache-fcgi-logo.png"}},"fields":{"readingTime":{"minutes":12.285},"slug":"/2012/11/02/entendendo-o-cgi-fastcgi-e-wsgi.html"}},"site":{"siteMetadata":{"author":{"name":"Klaus Peter Laube","gravatar":"https://en.gravatar.com/userimage/12163112/d3ae0c6239980b01ff1f1730b65c2ebe.jpg"},"siteUrl":"https://klauslaube.com.br"}}},"pageContext":{"slug":"/2012/11/02/entendendo-o-cgi-fastcgi-e-wsgi.html"}}}