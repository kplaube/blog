{"componentChunkName":"component---src-templates-blog-post-js","path":"/2012/02/26/automatize-o-deploy-dos-seus-projetos-com-fabric.html","result":{"data":{"markdownRemark":{"html":"<p>Durante a minha árdua trajetória com o <a href=\"/tag/php.html\" title=\"Leia mais sobre PHP\"><em>PHP</em></a>,\nsempre fiz “subidas” de projetos utilizando um cliente <a href=\"http://pt.wikipedia.org/wiki/File_Transfer_Protocol\" title=\"Leia mais sobre File Transfer Protocol\"><em>FTP</em></a>. Um\nprocesso manual, extremamente repetitivo (e chato).</p>\n<p>Já com <a href=\"/tag/python.html\" title=\"Leia mais sobre Python\"><em>Python</em></a>, pude utilizar o <a href=\"http://pt.wikipedia.org/wiki/SSH\" title=\"Leia mais sobre Secure Shell\"><em>SSH</em></a>, que me proporcionou\nmaior agilidade e liberdade dentro do ambiente de produção. Mas que não\ndeixou de ser um processo manual, extremamente repetitivo, chato e muito\nsuscetível a falhas.</p>\n<p>Foi utilizando o <a href=\"/tag/django.html\" title=\"Leia mais sobre Django\"><em>Django</em></a> que conheci o <a href=\"http://docs.fabfile.org/en/1.4.0/index.html\" title=\"A library and command-line tool for streamlining the use of SSH for application deployment or systems administration tasks\"><em>Fabric</em></a>, e percebi\nquanto tempo podemos economizar automatizando o processo de <em>deploy</em> de\nnossos projetos.</p>\n<h2>O agile e o deploy contínuo</h2>\n<p>Todo e qualquer procedimento de <em>upload</em> do seu projeto para o ambiente\nde produção corre algum tipo de risco. Com o <em>deploy</em> automatizado,\na tendência é que este risco seja reduzido, e que você possa fazer a\nentrega do seu projeto para <a href=\"/2011/03/07/diferentes-ambientes.html\" title=\"Diferentes ambientes: Development, Testing, Staging e Production\">diversos ambientes</a> com o menor esforço\npossível.</p>\n<p>Logo, não consigo imaginar um cenário eficiente de <em>deploy</em>\ncontínuo, sem a utilização de alguma ferramenta de automatização. É\natravés destas que respeitamos uma das premissas do <a href=\"/tag/agile.html\" title=\"Leia mais sobre Agile\"><em>agile</em></a>, e\ndiminuímos a incidência de falha humana.</p>\n<h2>Mas o que é o Fabric?</h2>\n<p>O <strong><em>Fabric</em></strong> é uma <em>lib</em> <em>Python</em>, e ferramenta de linha de comando,\npara auxiliá-lo em seu <em>deploy</em> e na administração remota dos seus\nsistemas.</p>\n<p>Embora seja feita em <em>Python</em>, pode ser utilizada em projetos escritos\nem qualquer linguagem. Equivale ao <a href=\"http://en.wikipedia.org/wiki/Capistrano\" title=\"Leia mais sobre o Capistrano\"><em>Capistrano</em></a>, alternativa mais\nfamosa, escrita em <em>Ruby</em>.</p>\n<h2>Em casa de ferreiro, espeto de ferro</h2>\n<p>Para dar um exemplo de uso do <em>Fabric</em>, podemos utilizar o esquema de\n<em>deploy</em> deste <em>blog</em>. Sim! O processo está automatizado, e você pode\n<a href=\"https://bitbucket.org/kplaube/klauslaube.com.br/src/d579e9d81641/fabfile.py\" title=\"Confira o script Fabric no repositório do BitBucket\">conferí-lo no <em>BitBucket</em></a>.</p>\n<p>Antes de mais nada, é necessário ter o <em>Fabric</em> instalado:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ pip install fabric</code></pre></div>\n<p>Todo o procedimento será escrito em um arquivo chamado <strong>fabfile.py</strong>.\nCom o comando <strong>fab</strong>, a ferramenta carregará este arquivo e permitirá a\nexecução de todos os métodos públicos definidos dentro dele.</p>\n<p>Vamos listar todos os métodos que <a href=\"https://bitbucket.org/kplaube/klauslaube.com.br/src/d579e9d81641/fabfile.py\" title=\"Veja no BitBucket\">criei no <strong>fabfile.py</strong> do <em>blog</em></a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ fab -l\n\nAvailable commands:\n\nbootstrap            Initialize remote host environment.\ncollect_static       Collect all static files from Django apps and copy ...\ncreate_virtualenv    Setup virtualenv on remote host.\ndatabase_restart     Restart the database server on remote server.\ndeploy               Send the code to the remote host.\nhttp_restart         Restart the HTTP server on remote server.\nmigrate              Execute South on remote host, to update the databas...\nproduction           Use production environment on remote host.\nstaging              Use staging environment on remote host.\nsyncdb               Execute syncdb on remote host.\nupdate_apache_conf   Move apache and fastcgi files to the public html.\nupdate_requirements  Update Python dependencies on remote host.</code></pre></div>\n<p>Como é possível notar na listagem acima, temos operações de <em>deploy</em>\n(<strong>deploy</strong>, <strong>syncdb</strong>, <strong>update_requirements</strong> e\n<strong>update<em>apache</em>conf</strong>) e operações de administração remota\n(<strong>database_restart</strong>, <strong>http_restart</strong>, <strong>migrate</strong>, etc). Os métodos\n<strong>production</strong> e <strong>staging</strong> são basicamente para “setar” para qual\nambiente o <em>deploy</em> será realizado. Por exemplo, a cada nova subida de\n<em>release</em>, executo o seguinte comando:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ fab production deploy http_restart</code></pre></div>\n<p>Onde basicamente:</p>\n<ul>\n<li>Defino o usuário, <em>IP</em>, e <em>paths</em> para o ambiente de produção através do método <strong>production</strong>.</li>\n<li>Executo o envio dos arquivos através de <a href=\"http://pt.wikipedia.org/wiki/Rsync\" title=\"Leia mais sobre Rsync\"><strong>Rsync</strong></a> para o servidor, com o método <strong>deploy</strong>.</li>\n<li>Reinicio o <em>Apache</em> através do método <strong>http_restart</strong>.</li>\n</ul>\n<p>Se olharmos atentamente o <a href=\"https://bitbucket.org/kplaube/klauslaube.com.br/src/d579e9d81641/fabfile.py#cl-101\" title=\"Veja em detalhes o método deploy\">método <strong>deploy</strong></a>, utilizamos uma <em>lib</em>\n(importada no início do arquivo) chamada <strong>rsync_project</strong>. Que\ncorresponde a ferramenta de linha de comando (encontrada em sistemas\nbaseados em <em>Unix</em>) chamada <strong>rsync</strong>. O que o <em>Fabric</em> faz (com\nmaestria) é “abstrair” essas operações para que possamos fazer os nossos\nprocedimentos através de uma interface simples (outros comandos, como\n<strong>scp</strong> e <strong>sudo</strong> também são utilizados pelo <em>Fabric</em>).</p>\n<p>A função <a href=\"https://bitbucket.org/kplaube/klauslaube.com.br/src/d579e9d81641/fabfile.py#cl-199\" title=\"Veja um exemplo de uso no fabfile.py\"><strong>run</strong></a> faz grande parte da magia acontecer. Com ela,\nabrimos uma conexão <em>SSH</em> com o nosso servidor, e executamos comandos\ncomo se estívessemos em um terminal. Extremamente útil para fazer\n<em>restart</em> de serviços, escalonamento de <em>logs</em>, limpeza de temporários,\netc.</p>\n<h2>Considerações finais</h2>\n<p>O <em>Fabric</em> é muito simples de usar. Lendo o básico da documentação, já\nsomos capazes de automatizar os processos mais triviais.</p>\n<p>Recomendo o <a href=\"https://bitbucket.org/copelco/caktus-deployment/src/6ad8ad84a938/example-django-project/caktus_website/fabfile.py\" title=\"Veja-o no BitBucket\"><strong>fabfile.py</strong></a> da <a href=\"http://www.caktusgroup.com/\" title=\"Visite o site da Caktus\"><em>Caktus Consulting Group</em></a>. Simples\ne bem escrito, foi nele que me baseei para escrever o <em>script</em>\napresentado neste <em>post</em>.</p>\n<h2>Referências</h2>\n<ul>\n<li><a href=\"http://docs.fabfile.org/en/1.4.0/index.html\" title=\"Fabric: a library and command-line tool for streamlining the use of SSH for application deployment or systems administration tasks\"><em>Fabric – Documentation</em></a></li>\n<li><a href=\"http://yuji.wordpress.com/2011/04/09/django-python-fabric-deployment-script-and-example/\" title=\"Excelente exemplo de uso do Fabric\"><em>Useful Stuff – Fabric Deployment Script and Example</em></a></li>\n</ul>","excerpt":"Durante a minha árdua trajetória com o PHP,\nsempre fiz “subidas” de projetos utilizando um cliente FTP. Um\nprocesso manual, extremamente…","frontmatter":{"date":"2012-02-26T19:40:13.000Z","title":"Automatize o deploy dos seus projetos com Fabric","tags":["desenvolvimento-web","python","django","fabric","deploy"],"thumbnail":{"childImageSharp":{"fixed":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGQABAAMBAQAAAAAAAAAAAAAAAAECBAUD/8QAFgEBAQEAAAAAAAAAAAAAAAAAAAEC/9oADAMBAAIQAxAAAAHpevOtEMg1QZVFf//EABsQAAMAAgMAAAAAAAAAAAAAAAECAwAEEBES/9oACAEBAAEFAnklSERcOtK5Q+TQlppEKGHXP//EABYRAAMAAAAAAAAAAAAAAAAAAAAQEf/aAAgBAwEBPwEr/8QAGBEAAgMAAAAAAAAAAAAAAAAAABEBEDH/2gAIAQIBAT8BjGK//8QAHBAAAgICAwAAAAAAAAAAAAAAAAECESAhMkJR/9oACAEBAAY/At9TihzhKiQ16bu8P//EABoQAQADAQEBAAAAAAAAAAAAAAEAESExQVH/2gAIAQEAAT8hL2dcGEtBfZRQXSB7MU3bc0XiVF6XjARXyG9WM//aAAwDAQACAAMAAAAQyPf8/8QAGREAAgMBAAAAAAAAAAAAAAAAABEBECFB/9oACAEDAQE/EHLRg7X/xAAYEQEBAAMAAAAAAAAAAAAAAAAAEQEhQf/aAAgBAgEBPxCMjZxX/8QAHRABAAMAAQUAAAAAAAAAAAAAAQARITFBUWGBof/aAAgBAQABPxC+cldbzT1lM2rVZ94hf3ZukOpFtCJL3h3phe5EqiSyJoksK3yy40e5hn//2Q==","width":180,"height":180,"src":"/static/00c36ca77d965baa0ced04d4e5fbfcb4/a8ad2/deploy.jpg","srcSet":"/static/00c36ca77d965baa0ced04d4e5fbfcb4/a8ad2/deploy.jpg 1x"}},"publicURL":"/static/00c36ca77d965baa0ced04d4e5fbfcb4/deploy.jpg"}},"fields":{"readingTime":{"minutes":4.325},"slug":"/2012/02/26/automatize-o-deploy-dos-seus-projetos-com-fabric.html"}},"site":{"siteMetadata":{"author":{"name":"Klaus Peter Laube","gravatar":"https://en.gravatar.com/userimage/12163112/d3ae0c6239980b01ff1f1730b65c2ebe.jpg"},"siteUrl":"https://klauslaube.com.br"}}},"pageContext":{"slug":"/2012/02/26/automatize-o-deploy-dos-seus-projetos-com-fabric.html"}},"staticQueryHashes":["2831923220","4114525740"]}