<!DOCTYPE html><html lang=pt-br> <head><meta charset=utf-8><title>API-First: Processo e ferramentas | Klaus Laube</title><meta name=author content="Klaus Peter Laube"><meta name=description content="No post anterior tive a oportunidade de falar de uma forma mais abrangente sobre o API-First. O exercício é interessante, uma vez que é possível focar no..."><meta name=robots content=index,follow><meta property=og:site_name content="Klaus Laube"><meta property=og:type content=website><meta name=keywords content="desenvolvimento, web, rest, prism, dredd, apis, api-first, swagger, drf, oai"><meta property=og:title content="API-First: Processo e ferramentas"><meta property=og:description content="No post anterior tive a oportunidade de falar de uma forma mais abrangente sobre o API-First. O exercício é interessante, uma vez que é possível focar no..."><meta property=og:url content=https://klauslaube.com.br/2020/03/02/api-first-processo-e-ferramentas.html><meta property=og:image content=https://klauslaube.com.br//images/blog/api-first-flow.png><meta property=fb:app_id content=262757647133878><meta name=google-site-verification content=xCq0H3B3JhkPcAdZ03J0vayijvH_g1rQVMZ_DVcMsQY><meta name=viewport content="width=device-width, initial-scale=1.0"><link rel=icon type=image/x-icon href=https://klauslaube.com.br/favicon.ico><link rel=alternate type=application/rss+xml title="Klaus Laube » Feed" href=https://klauslaube.com.br/feed/rss.xml><link rel=canonical href=https://klauslaube.com.br/2020/03/02/api-first-processo-e-ferramentas.html><link rel=stylesheet href=https://unpkg.com/purecss@1.0.0/build/pure-min.css integrity=sha384-nn4HPE8lTHyVtfCBi5yW9d20FjT8BJwUXyWZT9InLYax14RDjBj46LmSztkmNP9w crossorigin=anonymous><link rel=stylesheet href=https://klauslaube.com.br/theme/css/styles.min.css?0830b1e2></head> <body> <div class="Page pure-g is-fullEntry"> <div class="PageHeader pure-u-1"> <nav class="pure-menu pure-menu-open pure-menu-horizontal"> <a href=https://klauslaube.com.br/index.html title="Home page" class="PageHeader-link pure-menu-heading pure-menu-link">Klaus<span class=u-highlighted>Laube</a> <ul class="PageHeader-menu pure-menu-list"> <li class=pure-menu-item> <a href=https://about.me/klauslaube class="PageHeader-menu-link pure-menu-link">Contato</a> </li> </ul> </nav> </div> <div class="PageContent pure-u-1"> <article class="Article u-box" itemscope itemtype=http://schema.org/BlogPosting> <div itemprop=image itemscope itemtype=http://schema.org/ImageObject> <meta itemprop=url content=https://klauslaube.com.br//images/blog/api-first-flow.png> </div> <span itemprop=mainEntityOfPage> <header> <h1 class=Article-title itemprop="headline name"> API-First: Processo e ferramentas </h1> <p class=Article-meta> Por <span class=Article-author itemprop=author>Klaus Peter Laube</span>. <span class=Article-pubDate> Publicado em <time datetime=2020-03-02T10:15:00-03:00 itemprop=datePublished>02 Mar, 2020</time> </span> </p> </header> <div class=Article-content itemprop=articleBody> <img src=/images/blog/swaggerhub-logo.png alt="Logotipo do Swagger" class=representative-image width=180 height=180> <p>No <a href=https://klauslaube.com.br/2020/02/21/o-api-first.html title="O API-First"><em>post</em> anterior</a> tive a oportunidade de falar de uma forma mais abrangente sobre o <a href=https://klauslaube.com.br/tag/api-first.html title="Leia mais sobre API-First"><em>API-First</em></a>. O exercício é interessante, uma vez que é possível focar no conceito, ao invés de ferramentas e processos. Mas o objetivo desse artigo é cairmos de cabeça em como exercitar a ideia de forma prática.</p> <!-- PELICAN_END_SUMMARY --> <p>O problema a ser solucionado será explicado mais abaixo, mas antes de cairmos na tentação de pensar no <em>framework <a href=https://klauslaube.com.br/tag/web.html title="Leia mais sobre web">web</a></em>, na modelagem de dados, em qual servidor de aplicação usar, ou em virtualizar com <a href=https://klauslaube.com.br/tag/docker.html title="Leia mais sobre Docker"><em>Docker</em></a> e <em>Kubernetes</em>, vamos focar primeiro na especificação.</p> <p><img class=align-center-keep-size src=/images/blog/api-first-flow.png width=422 height=296 title="Diferença de fluxos" alt="Diferença de fluxos"></p> <p>Com sorte seremos capazes de produzir uma <a href=https://klauslaube.com.br/tag/apis.html title="Leia mais sobre APIs"><em>API</em></a> que atenda a necessidade dos nossos <em>stakeholders</em>.</p> <h2>O problema</h2> <p>Vamos "reciclar" o problema proposto no <em>post</em> sobre <a href=https://klauslaube.com.br/2020/02/13/construindo-apis-em-django-com-django-rest-framework.html title="Construindo APIs em Django com DRF"><em>Django REST Framework</em></a> e construir um "Feedly-clone". Então, partiremos da análise do seguinte requisito funcional:</p> <div class=highlight><pre><span></span>Eu como usuário,
Quero poder visualizar notícias recentes de websites que me cadastrei,
Para que assim eu fique atualizado sobre assuntos de meu interesse
</pre></div> <p>Com essa <em>user story</em>, podemos pensar no processo que envolve a prática do <em>API-First</em>.</p> <h2>O processo</h2> <p>No <a href=https://klauslaube.com.br/2020/02/21/o-api-first.html title="O API-First"><em>post</em> anterior</a> mencionei alguns passos que não podem faltar em um contexto de <em>API-First</em>. <em>Jennifer Riggins</em>, no <a href=https://www.programmableweb.com/news/how-to-design-great-apis-api-first-design-and-raml/how-to/2015/07/10 title="Leia o artigo na íntegra">"How to Design Great APIs with Api-First Design"</a> traz uma visão mais prática sobre como o processo pode ser definido:</p> <ul> <li><strong>Planeje:</strong> Mesmo antes de começar, decida o propósito do produto e comece a esboçar a <em>API</em>;</li> <li><strong>Projete e valide:</strong> Debata o conceito com outros <em>stakeholders</em> e progrida com o <em>design</em> da <em>API</em>. Prove o conceito através de <em>mocks</em> (mais a seguir) e compreenda como a <em>API</em> será utilizada;</li> <li><strong>Oficialize a especificação:</strong> Construa a especificação de acordo com o planejamento e <em>design</em>. Gere a documentação baseada na <em>spec</em>, enriqueça o <em>mock</em> com os casos de uso e faça o <em>release</em> da mesma;</li> <li><strong>Teste:</strong> Teste para garantir que a <em>API</em> funcione. Teste para garantir que os casos de uso são atendidos. Teste para se assegurar que nenhuma nova alteração quebrou o contrato estabelecido. E considere testes automatizados sempre que possível;</li> <li><strong>Implemente:</strong> Não apenas você (<em>backend</em>), é hora de outros <em>stakeholders</em> (<em>mobile</em>, por exemplo) fazerem parte do processo de concepção. Quanto antes interagirem, mais cedo e (teoricamente) mais fácil será a reação à mudança;</li> <li><strong>Opere e engage:</strong> Publique-a! Interaja com seus clientes, aprenda com necessidades que ainda precisam ser atendidas, e repita o processo. <em>API-First</em> é tão sobre negócios quanto é sobre tecnologia.</li> </ul> <p><img class=align-center-keep-size src=/images/blog/api-first-processo.png width=740 height=133 title="Exemplo de processo com o API-First" alt="Exemplo de processo com o API-First"></p> <p>Vamos esmiuçar de forma prática cada um dos passos acima.</p> <h3>Antes de ir: Single source of truth</h3> <p>A abordagem adotada nesse <em>post</em> seguirá valores apresentados no <a href='https://medium.com/adobetech/three-principles-of-api-first-design-fa6666d9f694 "Leia o artigo na íntegra'>"Three Principles of API First Design"</a>. Mais especificamente:</p> <blockquote> <p>Your API comes first, then the implementation</p> </blockquote> <p>E nesse exemplo vamos separar especificação da implementação de forma "concreta". Ou seja, serão dois artefatos independentes.</p> <p>Existem alternativas a esse <em>approach</em>, por exemplo, o uso do <a href=https://github.com/axnsan12/drf-yasg title="Yet another Swagger generator"><em>drf-yasg</em></a>. Esta é uma ferramenta que gera a especificação (<a href=https://klauslaube.com.br/tag/swagger.html title="Leia mais sobre Swagger"><em>Swagger</em></a> e <a href=https://klauslaube.com.br/tag/oai.html title="Leia mais sobre OpenApi"><em>OpenAPI Spec</em></a>) automaticamente de acordo com o código fonte do seu projeto <a href=https://klauslaube.com.br/tag/django.html title="Leia mais sobre Django"><em>Django</em></a> (com <em>REST Framework</em>).</p> <p>Algo deve ser muito claro independente do que optar: Só deve haver uma verdade absoluta; No caso desse artigo, será a especificação escrita à parte.</p> <h2>1: Planeje</h2> <p>Vamos usar <a href=https://klauslaube.com.br/tag/rest.html title="Leia mais sobre REST"><em>REST</em></a> como padrão de comunicação entre o nosso servidor e os clientes. Portanto, poderemos utilizar <em>Open API Spec</em> para especificar a <em>API</em>. Caso a solução fosse a adoção de outra tecnologia (por exemplo, <em>GraphQL</em> ou <em>gRPC</em>), alternativas para o passo de descrição e documentação da interface devem ser aplicadas.</p> <p>Além disso, seremos o mais "compliant" possível com o <em>RESTful</em>, ou seja, seguiremos à risca recomendações em relação a <em>path</em>, <em>status codes</em> e verbos. O versionamento da <em>API</em> acontecerá via fragmento no <em>path</em> (ex.: <code>/v1/</code>), e a princípio apresentaremos apenas respostas em <em>JSON</em>.</p> <p>Imaginemos que depois de ponderar com outros <em>stakeholders</em>, chegamos à seguinte conclusão:</p> <div class=highlight><pre><span></span><span class=p>[</span>
  <span class=p>{</span>
    <span class=nt>&quot;id&quot;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
    <span class=nt>&quot;title&quot;</span><span class=p>:</span> <span class=s2>&quot;Título do artigo publicado no canal ABC&quot;</span><span class=p>,</span>
    <span class=nt>&quot;pub_date&quot;</span><span class=p>:</span> <span class=s2>&quot;data-com-timezone-incluso&quot;</span><span class=p>,</span>
    <span class=nt>&quot;summary&quot;</span><span class=p>:</span> <span class=s2>&quot;Resumo do artigo&quot;</span><span class=p>,</span>
    <span class=nt>&quot;content&quot;</span><span class=p>:</span> <span class=s2>&quot;Conteúdo completo do artigo&quot;</span><span class=p>,</span>
    <span class=nt>&quot;image&quot;</span><span class=p>:</span> <span class=s2>&quot;imagem-principal-do-artigo.png&quot;</span><span class=p>,</span>
    <span class=nt>&quot;channel&quot;</span><span class=p>:</span> <span class=s2>&quot;ABC&quot;</span><span class=p>,</span>
    <span class=nt>&quot;url&quot;</span><span class=p>:</span> <span class=s2>&quot;http://article-1.html&quot;</span>
  <span class=p>},</span>
  <span class=p>{</span>
    <span class=nt>&quot;id&quot;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
    <span class=nt>&quot;title&quot;</span><span class=p>:</span> <span class=s2>&quot;Título do artigo publicado no canal XYZ&quot;</span><span class=p>,</span>
    <span class=nt>&quot;pub_date&quot;</span><span class=p>:</span> <span class=s2>&quot;data-com-timezone-incluso&quot;</span><span class=p>,</span>
    <span class=nt>&quot;summary&quot;</span><span class=p>:</span> <span class=s2>&quot;Resumo do artigo (2)&quot;</span><span class=p>,</span>
    <span class=nt>&quot;content&quot;</span><span class=p>:</span> <span class=s2>&quot;Conteúdo completo do artigo&quot;</span><span class=p>,</span>
    <span class=nt>&quot;image&quot;</span><span class=p>:</span> <span class=s2>&quot;imagem-principal-do-artigo-2.png&quot;</span><span class=p>,</span>
    <span class=nt>&quot;channel&quot;</span><span class=p>:</span> <span class=s2>&quot;XYZ&quot;</span><span class=p>,</span>
    <span class=nt>&quot;url&quot;</span><span class=p>:</span> <span class=s2>&quot;http://article-2.html&quot;</span>
  <span class=p>}</span>
<span class=p>]</span>
</pre></div> <p>Além disso, esboçamos as seguintes rotas:</p> <ul> <li><code>GET /api/v1/channels/&lt;id-do-channel&gt;</code>: Pega a lista de artigos</li> <li><code>GET /api/v1/articles/&lt;id-do-artigo&gt;</code>: Pega o artigo completo</li> </ul> <p>Vamos ocultar complexidades fora do escopo da <em>user story</em> apresentada (como por exemplo, paginação e autenticação). Além disso, propositalmente não definimos um formato "oficial" para <code>pub_date</code>, apenas determinamos que deverá ser uma data em <em>UTC</em>.</p> <p>Por tratar-se de um esboço inicial que gerará material para a definição do <em>style guide</em> da <em>API</em> e dos <em>endpoints</em> em si, é natural deixarmos passar alguns detalhes que podem gerar problemas de integração.</p> <h2>2: Projete e valide</h2> <p>Abaixo, o documento representando exatamente o que foi acordado na seção anterior, com <em>OpenApi Specification</em>:</p> <div class=highlight><pre><span></span><span class=nt>openapi</span><span class=p>:</span> <span class=s>&quot;3.0.2&quot;</span>
<span class=nt>info</span><span class=p>:</span>
  <span class=nt>title</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Feedly-clone</span>
  <span class=nt>version</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class=nt>paths</span><span class=p>:</span>
  <span class=nt>/channels</span><span class=p>:</span>
    <span class=nt>summary</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Set of channels, e.g. blogs, websites or podcasts</span>
    <span class=nt>get</span><span class=p>:</span>
      <span class=nt>responses</span><span class=p>:</span>
        <span class=s>&quot;200&quot;</span><span class="p p-Indicator">:</span>
          <span class=nt>description</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">List of channels</span>
          <span class=nt>content</span><span class=p>:</span>
            <span class=nt>application/json</span><span class=p>:</span>
              <span class=nt>schema</span><span class=p>:</span>
                <span class=nt>type</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">array</span>
                <span class=nt>items</span><span class=p>:</span>
                  <span class=nt>$ref</span><span class=p>:</span> <span class=s>&quot;#/components/schemas/Channel&quot;</span>

  <span class="l l-Scalar l-Scalar-Plain">/channels/{id}</span><span class="p p-Indicator">:</span>
    <span class=nt>parameters</span><span class=p>:</span>
      <span class="p p-Indicator">-</span> <span class=nt>$ref</span><span class=p>:</span> <span class=s>&quot;#/components/parameters/id&quot;</span>
    <span class=nt>summary</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Details of a channel</span>
    <span class=nt>get</span><span class=p>:</span>
      <span class=nt>responses</span><span class=p>:</span>
        <span class=s>&quot;200&quot;</span><span class="p p-Indicator">:</span>
          <span class=nt>description</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Channel detail response</span>
          <span class=nt>content</span><span class=p>:</span>
            <span class=nt>application/json</span><span class=p>:</span>
              <span class=nt>schema</span><span class=p>:</span>
                <span class=nt>$ref</span><span class=p>:</span> <span class=s>&quot;#/components/schemas/Channel&quot;</span>

  <span class=nt>/articles</span><span class=p>:</span>
    <span class=nt>summary</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Set of items</span>
    <span class=nt>get</span><span class=p>:</span>
      <span class=nt>responses</span><span class=p>:</span>
        <span class=s>&quot;200&quot;</span><span class="p p-Indicator">:</span>
          <span class=nt>description</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">List of articles</span>
          <span class=nt>content</span><span class=p>:</span>
            <span class=nt>application/json</span><span class=p>:</span>
              <span class=nt>schema</span><span class=p>:</span>
                <span class=nt>type</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">array</span>
                <span class=nt>items</span><span class=p>:</span>
                  <span class=nt>$ref</span><span class=p>:</span> <span class=s>&quot;#/components/schemas/Article&quot;</span>

  <span class="l l-Scalar l-Scalar-Plain">/articles/{id}</span><span class="p p-Indicator">:</span>
    <span class=nt>parameters</span><span class=p>:</span>
      <span class="p p-Indicator">-</span> <span class=nt>$ref</span><span class=p>:</span> <span class=s>&quot;#/components/parameters/id&quot;</span>
    <span class=nt>summary</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Details of an article</span>
    <span class=nt>get</span><span class=p>:</span>
      <span class=nt>responses</span><span class=p>:</span>
        <span class=s>&quot;200&quot;</span><span class="p p-Indicator">:</span>
          <span class=nt>description</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Article detail response</span>
          <span class=nt>content</span><span class=p>:</span>
            <span class=nt>application/json</span><span class=p>:</span>
              <span class=nt>schema</span><span class=p>:</span>
                <span class=nt>$ref</span><span class=p>:</span> <span class=s>&quot;#/components/schemas/Article&quot;</span>

<span class=nt>components</span><span class=p>:</span>
  <span class=nt>parameters</span><span class=p>:</span>
    <span class=nt>id</span><span class=p>:</span>
      <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">id</span>
      <span class=nt>in</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">path</span>
      <span class=nt>required</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
      <span class=nt>schema</span><span class=p>:</span>
        <span class=nt>type</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">integer</span>
  <span class=nt>schemas</span><span class=p>:</span>
    <span class=nt>Channel</span><span class=p>:</span>
      <span class=nt>properties</span><span class=p>:</span>
        <span class=nt>id</span><span class=p>:</span>
          <span class=nt>type</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">integer</span>
        <span class=nt>name</span><span class=p>:</span>
          <span class=nt>type</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>

    <span class=nt>Article</span><span class=p>:</span>
      <span class=nt>properties</span><span class=p>:</span>
        <span class=nt>id</span><span class=p>:</span>
          <span class=nt>type</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">integer</span>
        <span class=nt>title</span><span class=p>:</span>
          <span class=nt>type</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
        <span class=nt>pub_date</span><span class=p>:</span>
          <span class=nt>type</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
        <span class=nt>summary</span><span class=p>:</span>
          <span class=nt>type</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
        <span class=nt>content</span><span class=p>:</span>
          <span class=nt>type</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
        <span class=nt>image</span><span class=p>:</span>
          <span class=nt>type</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
        <span class=nt>channel</span><span class=p>:</span>
          <span class=nt>type</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
        <span class=nt>url</span><span class=p>:</span>
          <span class=nt>type</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
</pre></div> <p>O artigo <a href=https://klauslaube.com.br/2018/03/15/swagger-na-pratica.html title="Leia o artigo na íntegra">"Swagger na prática"</a> pode ser de ajuda caso você não esteja familiarizado com a síntaxe acima.</p> <h3>Projete</h3> <p>A partir daqui podemos pensar sob a ótica de casos de uso. <a href=https://klauslaube.com.br/2020/01/07/software-design-software-architecture.html title="Software Design x Software Architecture">Práticas e ferramentas podem variar</a> dependendo da sua criatividade e do seu time. Para fins didáticos vamos manter esse passo o mais simples possível.</p> <p>Para início de conversa o <em>path</em> <code>articles/</code> não está alinhado o suficiente com a semântica por trás do problema. O formato <em>RSS</em> chama o que estamos chamando de <code>Article</code> de <code>Item</code>, logo, se quisermos manter uma linguagem ubíqua é fundamental renomearmos esse elemento.</p> <p><img class=align-center src=/images/blog/deathstar.jpg width=600 height=317 title="Projetar é uma arte, desconhecida pelo Império (movieweb.com)" alt="Projetar é uma arte, desconhecida pelo Império (movieweb.com)"></p> <p>Outro ponto de controvérsia em nosso esboço é que o recurso <code>articles/</code> poderia ser um <em>nested resource</em> de <code>channels/{id}/</code>:</p> <ul> <li><code>channels/{id}</code>: Detalhes do <em>channel</em></li> <li><code>channels/{id}/items</code>: Lista de <em>items</em> daquele <em>channel</em></li> <li><code>channels/{channel-id}/items/{item-id}</code>: Detalhes do <em>item</em></li> </ul> <p>Digamos que após consultar os <em>stakeholders</em> de <em>mobile</em> e <em>web</em>, eles concordem com a alteração. É exatamente esse tipo de questionamento que esse passo deve trazer, além de instigar a discussão com demais interessados.</p> <p>Por último, mas não menos importante, vamos supor que nossos possíveis clientes não estejam propensos a mostrar o conteúdo completo dos artigos em sua listagem. Logo, eles estariam fazendo "over-fetching" de informação. Podemos remover esse campo (<code>content</code>) de <code>channels/{id}/items/{id}</code>.</p> <p>A especificação final você pode <a href=https://gist.github.com/kplaube/d9c16eec70895349c48f9e8ec9e3e5be title="Veja mais no Gist">conferir aqui</a>.</p> <h4>Antes de ir: Over-fetching e Under-fetching</h4> <p><em>Over-fetching</em> (trazer mais conteúdo do que o necessário em um <em>request</em>) e <em>under-fetching</em> (trazer menos conteúdo do que o necessário) são problemas comuns em <em>APIs</em> <em>REST</em> que possuem pluralidade de clientes.</p> <p>Soluções variam, das mais ingênuas (criar um <em>endpoint</em> para <em>mobile</em> e um para <em>web</em>, por exemplo) até as mais rebuscadas (como deixar o <em>REST</em> de lado e adotar <em>GraphQL</em>). O "meio-termo" seria a adoção de algum mecanismo que permita ao cliente especificar quais campos ele deseja carregar na requisição.</p> <p>E é exatamente isso que o <a href=https://github.com/rsinger86/drf-flex-fields title="Veja o repositório no Github"><em>FlexFields</em></a> faz para soluções escritas em <em>REST Framework</em>.</p> <h3>Valide</h3> <p>É hora de validarmos o contrato.</p> <p>Poderíamos escrever <em>views</em> muito simples em <em>Django</em> (por exemplo) que atendam a especificação ao responder conteúdo estático. Mas possivelmente a melhor forma de executarmos esse passo seja através de ferramentas chamadas <a href=https://openapi.tools/#mock title="Veja uma lista de mock servers"><em>mock servers</em></a>.</p> <p>As opções são as mais variadas, em diferentes linguagens. A minha sugestão é o <a href=https://github.com/stoplightio/prism title="Veja o repositório no Github"><em>Prism</em></a>, uma ferramenta escrita em <em>Javascript</em>, fácil de instalar e usar.</p> <p><a href="https://stoplight.io/p/docs/gh/stoplightio/prism/docs/getting-started/01-installation.md?srn=gh/stoplightio/prism/docs/getting-started/01-installation.md" title="Documentação oficial do Prism">Veja como instalar o <em>Prism</em></a>.</p> <p>Executando o <em>Prism</em> com a especificação passada como argumento, temos um servidor fornecendo o contrato via <em>REST</em>:</p> <div class=highlight><pre><span></span>$ prism mock openapi.yml

› <span class=o>[</span>CLI<span class=o>]</span> …  awaiting  Starting Prism…
› <span class=o>[</span>CLI<span class=o>]</span> ℹ  info      GET        http://127.0.0.1:4010/channels
› <span class=o>[</span>CLI<span class=o>]</span> ℹ  info      GET        http://127.0.0.1:4010/channels/869
› <span class=o>[</span>CLI<span class=o>]</span> ℹ  info      GET        http://127.0.0.1:4010/channels/857/items
› <span class=o>[</span>CLI<span class=o>]</span> ℹ  info      GET        http://127.0.0.1:4010/channels/226/items/12
› <span class=o>[</span>CLI<span class=o>]</span> ▶  start     Prism is listening on http://127.0.0.1:4010

$ curl http://127.0.0.1:4010/channels/1/items/1

<span class=o>{</span><span class=s2>&quot;id&quot;</span>:1,<span class=s2>&quot;title&quot;</span>:<span class=s2>&quot;Anthony Mackie fala sobre se tornar o Capitão América&quot;</span>,<span class=s2>&quot;pub_date&quot;</span>:<span class=s2>&quot;Sat, 29 Feb 2020 19:21:37 +0000&quot;</span>,<span class=s2>&quot;summary&quot;</span>:<span class=s2>&quot;Quero que o meu Capitão América represente todo mundo, não só um grupo específico de pessoas&quot;</span>,<span class=s2>&quot;image&quot;</span>:<span class=s2>&quot;https://uploads.jovemnerd.com.br/wp-content/uploads/2020/02/anthony-mackie-capitao-america.jpg&quot;</span>,<span class=s2>&quot;content&quot;</span>:<span class=s2>&quot;Conteúdo completo&quot;</span>,<span class=s2>&quot;url&quot;</span>:<span class=s2>&quot;https://jovemnerd.com.br/nerdbunker/anthony-mackie-fala-sobre-se-tornar-o-capitao-america/&quot;</span><span class=o>}</span>
</pre></div> <p>Isso permite que novas avaliações sejam realizadas, modificações aconteçam com antecedência, casos de uso sejam testados, e até mesmo que outros <em>stakeholders</em> comecem a desenvolver a parte deles sem precisar esperar pelo <em>backend</em> todo estar pronto.</p> <h2>3: Oficialize a especificação</h2> <p>Nesse passo estruturamos o <em>release</em> da especificação, gerenciamos o processo e futuras iterações, e (claro) versionamos o arquivo.</p> <p>Enquanto trabalhei na <a href=https://loadsmart.com/ title="Book a truck in seconds"><em>Loadsmart</em></a>, mantínhamos a especificação em um repositório <em>Git</em> e tínhamos um <em>build</em> no <em>CI</em> para publicar a documentação baseada na versão do arquivo que encontrava-se no <code>master</code>.</p> <p>Possuímos várias opções para esse passo. Talvez o <a href=https://github.com/Redocly/redoc title="Visite o repositório no Github"><em>ReDoc</em></a> seja a ferramenta mais estilosa para gerar documentação a partir do <em>OpenAPI</em>.</p> <p>Para fins didáticos vou usar a ferramenta do <em>Swagger</em> e expor a documentação no <a href=https://swagger.io/tools/swagger-ui/ title="Teste na nuvem"><em>SwaggerHub</em></a>: <a href=https://app.swaggerhub.com/apis-docs/kplaube/feedly-clone/v1>https://app.swaggerhub.com/apis-docs/kplaube/feedly-clone/v1</a></p> <p><img class=align-center-keep-size src=/images/blog/api-first-swagger-ui.png width=740 height=277 title="Documentação publicada no Swagger UI" alt="Documentação publicada no Swagger UI"></p> <h2>4: Teste</h2> <p>Teste sempre. Automatize sempre que possível.</p> <p>Nessa etapa validaremos e garantiremos o funcionamento do contrato. Casos de uso podem ser necessários para estressar a coerência da <em>API</em>. Particularmente, não acho que essa seja a camada mais interessante para testar coisas além do contrato estabelecido (como por exemplo, a própria lógica de negócio). Pode tornar-se uma linha tênue em sua <a href=https://martinfowler.com/articles/practical-test-pyramid.html title="The Practical Test Pyramid">pirâmide de testes</a>.</p> <p>O <a href=https://dredd.org/en/latest/quickstart.html title="Documentação do Dredd"><em>Dredd</em></a> é uma ferramenta bem interessante para testar a especificação construída. Ela utiliza um servidor como alvo, portanto, podemos adicioná-la ao <em>build pipeline</em>, levantarmos o nosso serviço, e ela operará como uma espécie de <em>Component Test</em>.</p> <p>Executando contra o nosso servidor <em>mockado</em>, tudo deveria funcionar "out of the box":</p> <div class=highlight><pre><span></span>$ dredd ./openapi.yml http://127.0.0.1:4010

warn: API description parser warning in /Users/klaus/Desktop/openapi.yml:66 <span class=o>(</span>from line <span class=m>66</span> column <span class=m>7</span> to column <span class=m>13</span><span class=o>)</span>: <span class=s1>&#39;Parameter Object&#39;</span> contains unsupported key <span class=s1>&#39;schema&#39;</span>
warn: API description parser warning in /Users/klaus/Desktop/openapi.yml:73 <span class=o>(</span>from line <span class=m>73</span> column <span class=m>7</span> to column <span class=m>13</span><span class=o>)</span>: <span class=s1>&#39;Parameter Object&#39;</span> contains unsupported key <span class=s1>&#39;schema&#39;</span>
warn: API description parser warning in /Users/klaus/Desktop/openapi.yml:102 <span class=o>(</span>from line <span class=m>102</span> column <span class=m>7</span> to column <span class=m>12</span><span class=o>)</span>: <span class=s1>&#39;Schema Object&#39;</span> contains unsupported key <span class=s1>&#39;allOf&#39;</span>
pass: GET <span class=o>(</span><span class=m>200</span><span class=o>)</span> /channels duration: 63ms
pass: GET <span class=o>(</span><span class=m>200</span><span class=o>)</span> /channels/1 duration: 20ms
pass: GET <span class=o>(</span><span class=m>200</span><span class=o>)</span> /channels/1/items duration: 14ms
pass: GET <span class=o>(</span><span class=m>200</span><span class=o>)</span> /channels/1/items/1 duration: 11ms
complete: <span class=m>4</span> passing, <span class=m>0</span> failing, <span class=m>0</span> errors, <span class=m>0</span> skipped, <span class=m>4</span> total
complete: Tests took 116ms
</pre></div> <p>Um outro extra muito interessante é a <a href=https://dredd.org/en/latest/hooks/python.html title="Leia mais na documentação do Dredd">possibilidade de escrever <em>hooks</em> em <em>Python</em></a>, o que nos permite criar casos de uso de acordo com diferentes aspectos e contextos.</p> <h2>5: Implemente</h2> <p>Agora sim! Finalmente a parte divertida.</p> <p>Agora é correr para o <em>Django</em> e implementar a <em>API</em>. Se você estiver interessado no <em>Django REST Framework</em>, escrevi sobre ele recentemente no <a href=https://klauslaube.com.br/2020/02/13/construindo-apis-em-django-com-django-rest-framework.html title="Leia o artigo na íntegra">"Construindo APIs em Django com Django REST Framework"</a>. Não perca.</p> <p>Ao fim do desenvolvimento, não esqueça de executar o <em>Dredd</em> apontando para o serviço <em>Django</em>. Aliás, colocar essa checagem em um <em>CI</em> é uma excelente ideia! Dependendo do seu <em>release train</em>, a falha dessa checagem pode inclusive bloquear o seu <em>Continuous Delivery</em>.</p> <h2>6: Opere e engage</h2> <p>A sua funcionalidade está pronta. O seu produto está documentado. Agora é hora de "ir para a rua".</p> <p>Com essa ideia de "uma <em>API</em> para todos governar", fica mais fácil ser adepto da corrente do "eat your own dog food". Tendo outros times da sua própria organização como usuários fica mais fácil coletar <em>feedbacks</em> e reiniciar todo o processo descrito com novas demandas e possíveis correções.</p> <p>Para terceiros, é fundamental tratar a <em>API</em> como parte do negócio, e ela (e sua documentação) precisa ter espaço de destaque no <em>website</em> da sua empresa. O <a href=https://www.twilio.com/ title="Communication APIs for SMS, Voice and Video"><em>Twillio</em></a> faz isso muito bem:</p> <p><img class=align-center-keep-size src=/images/blog/api-first-engage.png width=740 height=198 title="Exemplo de exposição de documentação" alt="Exemplo de exposição de documentação"></p> <p>Além disso, existem <em>marketplaces</em> de <em>APIs</em> espalhados pela <em>web</em> que podem servir como canal de propaganda da sua <em>API</em>. O <a href=https://rapidapi.com/ title="Find and Connect to Thousands of APIs">RapidAPI</a> é um bom exemplo de plataforma para conectar-se com possíveis consumidores.</p> <p>Não esqueça que propiciar <em>SDKs</em> para os seus consumidores faz parte dessa etapa. Não basta apenas escrevermos o <em>backend</em>, precisamos nos engajar em escrever clientes para diferentes linguagens. O <a href=https://swagger.io/tools/swagger-codegen/ title="Generate server stubs and client SDKs for any API"><em>Swagger Codegen</em></a> pode ajudar nessa tarefa, gerando <em>SDKs</em> a partir da especificação da sua <em>API</em>.</p> <h2>Considerações finais</h2> <p>Abordamos o processo, os passos, e quais ferramentas podemos utilizar para atender os requisitos necessários em cada etapa. Faltou abordar de forma prática como "colocar isso tudo junto para funcionar". O <em>post</em> ficou gigante, e possivelmente abordaremos em uma parte 2 como colocar isso tudo em um <em>CI</em>, e em como orquestrar <em>release</em> de especificação e <em>deploy</em> de aplicação.</p> <p>Há uma pluralidade interessante de ferramentas e serviços que giram em torno do conceito de <em>API-First</em>. Se por um lado isso pode significar aumentar a complexidade do seu processo de desenvolvimento, por outro é também uma certa garantia de que existem outros <em>players</em> investindo nessa prática, e que se você tem na sua <em>API</em> o seu principal produto, talvez ficar por fora possa ocasionar um problema de estratégia.</p> <p>Até a próxima.</p> <h2>Referências</h2> <ul> <li><a href=https://dredd.org/en/latest/index.html>Dredd - HTTP API Testing Framework</a></li> <li><a href=https://openapi.tools/ >OpenAPI.Tools</a></li> <li><a href=https://www.programmableweb.com/news/how-to-design-great-apis-api-first-design-and-raml/how-to/2015/07/10>ProgrammableWeb - How To Design Great APIs With API-First Design</a></li> <li><a href=https://stoplight.io/p/docs/gh/stoplightio/prism>Stoplightio - Prism</a></li> <li><a href=https://medium.com/trimble-maps-engineering-blog/api-first-development-and-openapi-835afb46b7f1>Trimble MAPS Engineering Blog - API-First Development and OpenAPI</a></li> </ul> </div> </span> <div class=Article-tags> <span class=Article-tagLabel>Tags:</span> <span itemprop=keywords> <a href=https://klauslaube.com.br/tag/desenvolvimento.html title="Leia mais sobre" class=Article-tagLink>desenvolvimento</a> <a href=https://klauslaube.com.br/tag/web.html title="Leia mais sobre" class=Article-tagLink>web</a> <a href=https://klauslaube.com.br/tag/rest.html title="Leia mais sobre" class=Article-tagLink>rest</a> <a href=https://klauslaube.com.br/tag/prism.html title="Leia mais sobre" class=Article-tagLink>prism</a> <a href=https://klauslaube.com.br/tag/dredd.html title="Leia mais sobre" class=Article-tagLink>dredd</a> <a href=https://klauslaube.com.br/tag/apis.html title="Leia mais sobre" class=Article-tagLink>apis</a> <a href=https://klauslaube.com.br/tag/api-first.html title="Leia mais sobre" class=Article-tagLink>api-first</a> <a href=https://klauslaube.com.br/tag/swagger.html title="Leia mais sobre" class=Article-tagLink>swagger</a> <a href=https://klauslaube.com.br/tag/drf.html title="Leia mais sobre" class=Article-tagLink>drf</a> <a href=https://klauslaube.com.br/tag/oai.html title="Leia mais sobre" class=Article-tagLink>oai</a> </span> </div> <div class=Article-comments> <div id=disqus_thread></div> <script type=text/javascript>
        var disqus_shortname = "klauslaube";
        var disqus_identifier = "2020/03/02/api-first-processo-e-ferramentas.html";

        (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script> <noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript rel=nofollow>comments powered by Disqus.</a></noscript> </div> </article> </div> <footer class="PageFooter pure-u-1"> <div class=u-box> <p>O conteúdo deste blog está sob a licença <a class=PageFooter-link href=http://creativecommons.org/licenses/by/3.0/deed.pt_BR title="Distribua, adapte, use. Mas mencione o autor." rel=nofollow>Creative Commons Attribution 3.0</a>.</p> <p>O código está disponível em <a class=PageFooter-link href=https://github.com/kplaube/blog/ title=Contribute! rel=nofollow>GitHub</a>.</p> </div> </footer> </div> <script>
        (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
        function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
        e=o.createElement(i);r=o.getElementsByTagName(i)[0];
        e.src='//www.google-analytics.com/analytics.js';
        r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
        ga('create','UA-19657400-1');ga('send','pageview');
    </script> </body> </html>