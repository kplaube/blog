<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Klaus Laube - wsgi]]></title><description><![CDATA[Python, Django e desenvolvimento Web]]></description><link>https://klauslaube.com.br</link><generator>RSS for Node</generator><lastBuildDate>Wed, 20 Oct 2021 18:01:17 GMT</lastBuildDate><author><![CDATA[Klaus Peter Laube]]></author><item><title><![CDATA[Do WSGI ao ASGI - Parte 1]]></title><description><![CDATA[O Django 3 veio para sacudir as estruturas! Parece que foi ontem, mas
a versão já está aí desde 2019. Entre todas as suas adições,
a de maior destaque certamente é a adoção de capacidades async através do ASGI (Asynchronous Server Gateway Interface). Se você, assim como eu, não vê motivos para…]]></description><link>https://klauslaube.com.br/2021/03/01/do-wsgi-ao-asgi-parte-1.html</link><guid isPermaLink="false">https://klauslaube.com.br/2021/03/01/do-wsgi-ao-asgi-parte-1.html</guid><dc:creator><![CDATA[Klaus Peter Laube]]></dc:creator><pubDate>Mon, 01 Mar 2021 17:45:00 GMT</pubDate><content:encoded>&lt;p&gt;O &lt;a href=&quot;/tag/django.html&quot; title=&quot;Leia mais sobre Django&quot;&gt;&lt;em&gt;Django 3&lt;/em&gt;&lt;/a&gt; veio para sacudir as estruturas! Parece que foi ontem, mas
a versão já está aí desde 2019. Entre todas as suas adições,
a de maior destaque certamente é a adoção de capacidades &lt;em&gt;async&lt;/em&gt; através do &lt;em&gt;ASGI&lt;/em&gt; (&lt;em&gt;Asynchronous Server Gateway Interface&lt;/em&gt;).&lt;/p&gt;
&lt;p&gt;Se você, assim como eu, não vê motivos para largar o &lt;a href=&quot;/2012/11/02/entendendo-o-cgi-fastcgi-e-wsgi.html&quot; title=&quot;Entendendo o CGI, FastCGI e WSGI&quot;&gt;&lt;em&gt;WSGI&lt;/em&gt;&lt;/a&gt; (&lt;em&gt;Web Server Gateway Interface&lt;/em&gt;),
e ainda tem dificuldades para compreender o que é de fato esse novo &lt;em&gt;Gateway Interface&lt;/em&gt;, vem comigo!&lt;/p&gt;
&lt;p&gt;Mas antes de mergulhar na prática, essa é uma boa oportunidade para falarmos sobre &lt;em&gt;async&lt;/em&gt;, &lt;em&gt;threads&lt;/em&gt;, concorrência e paralelismo.&lt;/p&gt;
&lt;h2&gt;CPU, cores, processos e threads&lt;/h2&gt;
&lt;p&gt;O &lt;em&gt;CPU&lt;/em&gt; é a cabeça por trás de todo o processamento. Ele funciona em ciclos que correspondem ao tempo necessário para a execução de uma operação. Um
&lt;em&gt;CPU&lt;/em&gt; pode ter múltiplos &lt;em&gt;cores&lt;/em&gt;, e cada &lt;em&gt;core&lt;/em&gt; é capaz de executar múltiplos processos.&lt;/p&gt;
&lt;p&gt;No caso dos processos &lt;em&gt;Python&lt;/em&gt;, cada um possui um interpretador &lt;em&gt;Python&lt;/em&gt;, &lt;em&gt;memory space&lt;/em&gt;, e o famigerado &lt;em&gt;GIL&lt;/em&gt; (mais a seguir).&lt;/p&gt;
&lt;p&gt;Quando executamos o processo &lt;em&gt;Python&lt;/em&gt;, ele:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Pode executar múltiplos subprocessos.&lt;/li&gt;
&lt;li&gt;A partir da &lt;em&gt;main thread&lt;/em&gt;, pode iniciar múltiplas &lt;em&gt;threads&lt;/em&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;figure class=&quot;gatsby-resp-image-figure&quot; style=&quot;&quot;&gt;
    &lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/9be65b84d1ac7c8037599acba7d77908/5205c/python-thread-multiprocessing.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 43.75%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA/klEQVQoz5WRiYrFMAhF8///WEppS3e674szR7CEGXjwAhKN5lxNnPyu53nYZBxHieNYsiyTdV3Fz9lua5omrU3TVM7zfM8dhT6wLEupqkqWZXlBPnTfdzmOQ/N936tt26YG2PnKbdtKURSSJIl0XfcPeN+3dk4MKM9zbQCB67pUTIEUckCCUVDH5xzzgeSBsgNF2O5w7owMgJbnedYYnzPryIA8CzUGAFbXtQzDoL5DhQIAwP/GdECMD5C3MjhCVkcT5FwURRIEgV7CwjB8YxQttl+nM/swdmAYnTORg0rCRvwU05GNyGqaRoUA8kEKlC8WQHs7RsRHkJiJAP4AvrS9ZXpY3AUAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;&amp;quot;Diagrama mostrando a diferença entre multithreading e multiprocessing&amp;quot;&quot;
        title=&quot;Multithreading vs. Multiprocessing&quot;
        src=&quot;/static/9be65b84d1ac7c8037599acba7d77908/e5715/python-thread-multiprocessing.png&quot;
        srcset=&quot;/static/9be65b84d1ac7c8037599acba7d77908/8514f/python-thread-multiprocessing.png 192w,
/static/9be65b84d1ac7c8037599acba7d77908/804b2/python-thread-multiprocessing.png 384w,
/static/9be65b84d1ac7c8037599acba7d77908/e5715/python-thread-multiprocessing.png 768w,
/static/9be65b84d1ac7c8037599acba7d77908/5205c/python-thread-multiprocessing.png 833w&quot;
        sizes=&quot;(max-width: 768px) 100vw, 768px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&quot;gatsby-resp-image-figcaption&quot;&gt;Multithreading vs. Multiprocessing&lt;/figcaption&gt;
  &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;Uma &lt;em&gt;thread&lt;/em&gt; é uma unidade de execução dentro de um processo. Cada &lt;em&gt;thread&lt;/em&gt; utiliza o espaço de memória do mesmo, compartilhando-o com as demais.&lt;/p&gt;
&lt;h2&gt;Concorrência e paralelismo&lt;/h2&gt;
&lt;p&gt;A motivação por trás do uso de &lt;em&gt;threads&lt;/em&gt; e subprocessos é permitir que diferentes tarefas aconteçam ao mesmo tempo. E &quot;ao mesmo tempo&quot; pode significar
que a intenção seja de um resultado simultâneo, mas na prática, não necessariamente ocorrendo no mesmo instante.&lt;/p&gt;
&lt;p&gt;Complicado? Para fins didáticos
vamos utilizar o exemplo proposto pelo &lt;a href=&quot;https://medium.com/fintechexplained/advanced-python-concurrency-and-parallelism-82e378f26ced&quot; title=&quot;Advanced Python: Concurrency And Parallelism&quot;&gt;&lt;em&gt;FinTechExplained&lt;/em&gt;&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Eu estou esperando 10 amigos para almoçar, e eu tenho 3 horas para cozinhar o suficiente para 10 pessoas.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Os passos para um prato são:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Começo lavando os vegetais (~5 minutos);&lt;/li&gt;
&lt;li&gt;Corto os vegetais (~13 minutos);&lt;/li&gt;
&lt;li&gt;Cozinho os mesmos (~30 minutos);&lt;/li&gt;
&lt;li&gt;Sirvo (~2 minutos).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;figure class=&quot;gatsby-resp-image-figure&quot; style=&quot;&quot;&gt;
    &lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 623px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/e1761b77eba92b809d031991a52c7821/6114d/cooking-sync.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 37.5%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABIklEQVQoz52RWW/CMBCE8/9/WIVatX3olUIOjkDuCEJJbMfxdJwAgj6AVEsbeb/ZjNdeB3+WuZNfsr5tYPp+ZGakjgVDaD2KFK6YLbxktuZoohZzyM8PmK47mzrKm6GnYEOHAeTUhZ6HzEOY5QJyNh3ixCTrxbcLFfjQ5O3rC8T7G/q6HjvcJwnKokCy2aBKUzQ0KbIMOXkcx/hZLdFtt6jKEjl1dThAkCkph5qOXclohWbygC6J4dTWIIoQBwEq7huenPOHjB1v2PGeucpSlOs1GTuuSggyudsNuWoaSNa1z0/Q1Jwu9NHTyNBE2zcJvCE/MUVd2usdmd1L34PiE2hevX2cQLhfMEKMV7413XsTV+toOPCs26HYz79DqSszu34B8IhnljykTsAAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Fluxograma mostrando os passos iniciando pela lavagem e terminando em servir&quot;
        title=&quot;O fluxo de forma linear&quot;
        src=&quot;/static/e1761b77eba92b809d031991a52c7821/6114d/cooking-sync.png&quot;
        srcset=&quot;/static/e1761b77eba92b809d031991a52c7821/8514f/cooking-sync.png 192w,
/static/e1761b77eba92b809d031991a52c7821/804b2/cooking-sync.png 384w,
/static/e1761b77eba92b809d031991a52c7821/6114d/cooking-sync.png 623w&quot;
        sizes=&quot;(max-width: 623px) 100vw, 623px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&quot;gatsby-resp-image-figcaption&quot;&gt;O fluxo de forma linear&lt;/figcaption&gt;
  &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;Imagine que temos apenas uma boca no fogão, e que só conseguimos cozinhar um prato por vez.
Se pensarmos de forma linear, um prato leva aproximadamente 50 minutos para ficar pronto. Se multiplicarmos
pelo número de amigos, precisaremos de &lt;code class=&quot;language-text&quot;&gt;8 horas&lt;/code&gt; cozinhando para atender a demanda.&lt;/p&gt;
&lt;h3&gt;Concorrência&lt;/h3&gt;
&lt;p&gt;Para reduzir o tempo total, uma possibilidade é adquirirmos outro fogão. Continuamos
a cortar os vegetais de forma sequencial, mas o passo de cozimento pode acontecer de uma
maneira na qual eu possa ter as duas bocas funcionando, e checar periodicamente o estado de cozimento
de cada prato.&lt;/p&gt;
&lt;p&gt;&lt;figure class=&quot;gatsby-resp-image-figure&quot; style=&quot;&quot;&gt;
    &lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 623px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/6447e2ceb197d9da597ce04369a68e21/6114d/concurrency.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 37.5%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABQElEQVQoz41Rf2vCMBTs9/9YQ0Rw2x9jw632l05sq22mtbRN0uR2Ta2M4WCBBy/3Xu4u73n4dSzuH3unZpoG1pixbq0LbwBc9P1YHAoTZkbMaO1wR8J8ItGfW8jVG4ySNxFPBWuYTeKijyNI/x19EvMew24TyMCHqmsIIVAUBTQJO/8D8mOF7vUFzfMj9NoH2haGprxLlqFkY7bfQ+Q5mu0GxeGAI/E0TVHThWZd5BlyiqrTCe3TEu185sgsBURZ4kLcKAWvGgh2O6RRBMG8iUIcSXJIEuzjGHW4RruYQy4X0GGAtjiiJbn6EmjZ25/PEDRTidKRezoOYUhkSdLTgYwCd58wxTEo9kh+S5cFKi4ipHjVddAkqmcP6PkGUo5f/mu7d7dKB0Z2sNfHchgBBX/2edO6/xM3oSnnzG4Grj3fJ7FnumutUyAAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;&amp;quot;Com duas bocas, consigo ter concorrência no cozimento&amp;quot;&quot;
        title=&quot;Com duas bocas, consigo ter concorrência no cozimento&quot;
        src=&quot;/static/6447e2ceb197d9da597ce04369a68e21/6114d/concurrency.png&quot;
        srcset=&quot;/static/6447e2ceb197d9da597ce04369a68e21/8514f/concurrency.png 192w,
/static/6447e2ceb197d9da597ce04369a68e21/804b2/concurrency.png 384w,
/static/6447e2ceb197d9da597ce04369a68e21/6114d/concurrency.png 623w&quot;
        sizes=&quot;(max-width: 623px) 100vw, 623px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&quot;gatsby-resp-image-figcaption&quot;&gt;Com duas bocas, consigo ter concorrência no cozimento&lt;/figcaption&gt;
  &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://diogommartins.wordpress.com/2017/04/07/concorrencia-e-paralelismo-threads-multiplos-processos-e-asyncio-parte-1/&quot; title=&quot;CONCORRÊNCIA E PARALELISMO – THREADS, MÚLTIPLOS PROCESSOS E ASYNCIO – PARTE 1&quot;&gt;&lt;em&gt;Diogo M. Martins&lt;/em&gt; define concorrência como&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Quando duas ou mais tarefas podem começar a ser executadas e terminar em espaços de tempo que se sobrepõem,
não significando que elas precisam estar em execução necessariamente no mesmo instante.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Logo, ao invés de 60 minutos (2 pratos x 30 minutos de cozimento) podemos alcançar um tempo menor.&lt;/p&gt;
&lt;h3&gt;Paralelismo&lt;/h3&gt;
&lt;p&gt;Com dois cozinheiros, cada um trabalhando de sua casa, conseguimos dividir a carga, e portanto, em &lt;code class=&quot;language-text&quot;&gt;4 horas&lt;/code&gt; seremos capazes de atender a demanda.&lt;/p&gt;
&lt;p&gt;&lt;figure class=&quot;gatsby-resp-image-figure&quot; style=&quot;&quot;&gt;
    &lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 623px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/f80ff0676dbbd83c47510ccda5d70ff9/6114d/parallelism.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 77.60416666666667%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAACU0lEQVQ4y5VU2VLjMBDM/3/XLlA87Am5E9s57JiQy5csWXJvj0yOheIBVXVpRp6MWupWem3b4hYyijxHGIaI4xjb7Rar1crHMvsaqUU3bn8ncw8341yktEbKRofTyWO722F/OPq1c42rFVyefWjac0UOD7JyZUGUaAko1UHXQP0Wc5ZvrarQbBKoxwc0SXwlJAz1dAy7jIgF9GQMNRqgWYREBBPMUfWfUAczmDCAJlT/GfV0AhOF/rt6/gszn6Ftmo7hnsdJ9ntEmw1OPFLGOWa+4JykKZrXLQpjEPEOS+tgWOOcQ3o4oLAWbV2juvsGPR52DIvxCDl3OHHXknHFDzl3PpFtzjU1HECRbca44iy5jgIUwo6nqicj6GEfrqo6hnb3CrffXWDJzu3OcQdhKWsy+7XDHs1qCXX/3R8bn6n8leEokuUmt4J4hi3v4wrrF4+8n0G/j/lshjAIMJ1MEDAeDXlPvDe81b9v9ilDKa0ohKJymg2UaXxc0Z+XGlrM0A0fGNr1Co6eEjTx2kNivKRo0w0sfXbJpYb1DRVvKIx6vEc9ePZKXxgW9FO+XuNIxUpecDmbIpN8sUAWUVX6VLHxUeKXF+YT6CRBzqaKAmkR59cPiLidD8VvRMgGRxZmZBAzXyyXSPh2DZsVRYmIDQsKYfjN8sWkbJ5Xyr+y6uGuM7cwNPSe5QtwPIIWT9GHPicsX4jikQxZS27mU+Z9772GsX76g+r3TzTc9Dx6oprA8dIvaktum6ui73IZ4teazVz2/x/El314+dui4i2d8P7f5h9rncwIsLK7IgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;&amp;quot;Com dois cozinheiros, consigo paralelizar o trabalho&amp;quot;&quot;
        title=&quot;Com dois cozinheiros, consigo paralelizar o trabalho&quot;
        src=&quot;/static/f80ff0676dbbd83c47510ccda5d70ff9/6114d/parallelism.png&quot;
        srcset=&quot;/static/f80ff0676dbbd83c47510ccda5d70ff9/8514f/parallelism.png 192w,
/static/f80ff0676dbbd83c47510ccda5d70ff9/804b2/parallelism.png 384w,
/static/f80ff0676dbbd83c47510ccda5d70ff9/6114d/parallelism.png 623w&quot;
        sizes=&quot;(max-width: 623px) 100vw, 623px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&quot;gatsby-resp-image-figcaption&quot;&gt;Com dois cozinheiros, consigo paralelizar o trabalho&lt;/figcaption&gt;
  &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;E talvez essa seja a forma mais simplista de definir paralelismo: Quando duas ou mais tarefas são executadas literalmente ao mesmo tempo.&lt;/p&gt;
&lt;p&gt;Bom... se a motivação por trás das &lt;em&gt;threads&lt;/em&gt; e subprocessos é permitir que tarefas aconteçam ao mesmo tempo, podemos
utilizar qualquer um deles para alcançar paralelismo, certo?&lt;/p&gt;
&lt;p&gt;&lt;figure class=&quot;gatsby-resp-image-figure&quot; style=&quot;&quot;&gt;
    &lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 510px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/34c33f191a9ad0f896382106ff682d5c/18815/concurrency-parallelism.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 53.645833333333336%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAIBAwX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHchlLAD//EABcQAQEBAQAAAAAAAAAAAAAAAAEQACH/2gAIAQEAAQUCXdiF/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGBAAAgMAAAAAAAAAAAAAAAAAEDEAAUH/2gAIAQEABj8CdTAj/8QAGxAAAwACAwAAAAAAAAAAAAAAAAERECFBgaH/2gAIAQEAAT8hk/BlJWbnQ9tpTnH/2gAMAwEAAgADAAAAEBDP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAHRABAAICAgMAAAAAAAAAAAAAAQARITFBkVGhsf/aAAgBAQABPxBKAOz7KHXbfuNDZ0mQDyTMApjmABQVP//Z&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;&amp;quot;Diagrama com a diferença de execução entre concorrência e paralelismo&amp;quot;&quot;
        title=&quot;Uma imagem pode valer mais que mil palavras (stackoverflow.com)&quot;
        src=&quot;/static/34c33f191a9ad0f896382106ff682d5c/18815/concurrency-parallelism.jpg&quot;
        srcset=&quot;/static/34c33f191a9ad0f896382106ff682d5c/7809d/concurrency-parallelism.jpg 192w,
/static/34c33f191a9ad0f896382106ff682d5c/4ecad/concurrency-parallelism.jpg 384w,
/static/34c33f191a9ad0f896382106ff682d5c/18815/concurrency-parallelism.jpg 510w&quot;
        sizes=&quot;(max-width: 510px) 100vw, 510px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&quot;gatsby-resp-image-figcaption&quot;&gt;Uma imagem pode valer mais que mil palavras (stackoverflow.com)&lt;/figcaption&gt;
  &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;Não necessariamente.&lt;/p&gt;
&lt;h2&gt;GIL (Global Interpreter Lock)&lt;/h2&gt;
&lt;p&gt;O &lt;em&gt;Python Global Interpreter Lock&lt;/em&gt; (ou &lt;em&gt;GIL&lt;/em&gt;) é uma &quot;trava&quot; que permite que apenas uma &lt;em&gt;thread&lt;/em&gt; tenha controle sobre o interpretador. Ou seja,
apenas uma &lt;em&gt;thread&lt;/em&gt; executa por vez, mesmo em uma arquitetura &lt;em&gt;multi-thread&lt;/em&gt; com mais de um &lt;em&gt;core&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Infame? No mínimo. Mas há uma boa motivação para essa trava existir. De forma resumida, ela está relacionada
com a forma como a linguagem &lt;a href=&quot;https://stackify.com/python-garbage-collection/&quot; title=&quot;Leia sobre o gerenciamento de memória em Python&quot;&gt;gerencia memória&lt;/a&gt;, e previne
problemas de &lt;em&gt;memory leak&lt;/em&gt; e &lt;em&gt;deadlocks&lt;/em&gt;, ao mesmo tempo que oferece números interessantes de performance.&lt;/p&gt;
&lt;p&gt;O artigo do &lt;em&gt;RealPython&lt;/em&gt;,
&lt;a href=&quot;https://realpython.com/python-gil/&quot; title=&quot;Leia o artigo na íntegra&quot;&gt;&quot;What Is the Python Global Interpreter Lock (GIL)?&quot;&lt;/a&gt;,
é uma excelente referência para você saber tudo a respeito.&lt;/p&gt;
&lt;p&gt;Para o bem ou para o mal, na prática você não consegue atingir paralelismo utilizando &lt;em&gt;threads&lt;/em&gt; em &lt;em&gt;Python&lt;/em&gt; (e note, essa é uma realidade específica da linguagem).
Ainda assim, fazer &lt;code class=&quot;language-text&quot;&gt;multithreading&lt;/code&gt; te dará o resultado concorrente que você deseja.&lt;/p&gt;
&lt;p&gt;&lt;figure class=&quot;gatsby-resp-image-figure&quot; style=&quot;&quot;&gt;
    &lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 553px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/fe93b4fbfc08ea6eb2319840fce81a40/74cfa/gil-lock.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 72.39583333333333%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACcElEQVQ4y3VUaVPbQAzN//8tHT60U2Y69IDSDuTgSEtIAiQhhxPbSbC9l6/dfdUaHCgt8mi8llZv9SStG9ZaODHGIIqiau1spS6hMgmpBFQqya8rX5GnUJIjI59SHLrMq/0u3knDfdSqlEItaaYwmY4wvB3gbjJCacrKzlmEm2EP49EQM/JnKd8lVAHihUgpUegcuc5Q2Jy0gCoS2q1gSsqydAdmpJRtSWyMhNWKskxhnpg2iqIAYwxlUUIIjmE4QOuuiebNCc7nXYTrNpC0YdkZTNxGvDhCND9EsT2tbDZpwbDfsE8laeR5Dt/3KfUMgmozCPs4ujrEQfsTWpMOttszAmxSYBs6asIb7mN2/QEqOAYYHRSfEmD3GfA1ZUe3pMcQrcxkWK89mDyBLVmlj5QLV2WiLGALBl0IqqH9uymuqGlKHRQxwtUC62AFFq0R0lupvNqsKeYhieGvQ3j+itYRHIzD+qfLNSCjLs7nUyy9GbabEAmLKdjfsWD0vVx5mM4miJNoZ3+zyzBuDKizduuGBFkUQnoech4jSiPwnEFqAa4TCKIaqQewNHkGdFl5FCCErAbWxB14g/cYdfcgg2+IL7/i5t0e7k6+oBv8wuXiAp8vDrB/+hHtSQvd5QX6fg/6aU4bWuvH+aPxkQRoRQ/C/4nE+4Ey6UAMm9h8P8byqoP+po9BcI3L6TnOxh1cr67QD3oYbW6pbP+hzLkgUEEjJOlqqUpTuj25axYdKsjnVKVkJ3VrqWSlnPPXVw+75tQaBCHG4wk1hu0K78aj9j8mwXF/f4/FYlHZdhnWP4mX4srgMjRa4y2pp8NdEIfxB0keMRpuQNCqAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;&amp;quot;Fluxograma de como a GIL funciona&amp;quot;&quot;
        title=&quot;GIL e o gerenciamento de threads&quot;
        src=&quot;/static/fe93b4fbfc08ea6eb2319840fce81a40/74cfa/gil-lock.png&quot;
        srcset=&quot;/static/fe93b4fbfc08ea6eb2319840fce81a40/8514f/gil-lock.png 192w,
/static/fe93b4fbfc08ea6eb2319840fce81a40/804b2/gil-lock.png 384w,
/static/fe93b4fbfc08ea6eb2319840fce81a40/74cfa/gil-lock.png 553w&quot;
        sizes=&quot;(max-width: 553px) 100vw, 553px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&quot;gatsby-resp-image-figcaption&quot;&gt;GIL e o gerenciamento de threads&lt;/figcaption&gt;
  &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;E como conseguimos de fato paralelismo então? Utilizando processos!&lt;/p&gt;
&lt;p&gt;Com a biblioteca de &lt;code class=&quot;language-text&quot;&gt;multiprocessing&lt;/code&gt;, ao invés de iniciarmos
uma &lt;em&gt;thread&lt;/em&gt;, iniciamos um novo processo &lt;em&gt;Python&lt;/em&gt; que se encarregará de executar o que for requisitado. E citando o início desse artigo:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;No caso dos processos Python, cada um possui um interpretador Python, memory space, e o famigerado GIL.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Logo, não sofremos a limitação da trava uma vez que estamos
falando de processos à parte, gerenciados pelo Sistema Operacional.&lt;/p&gt;
&lt;h2&gt;Multithreading e Multiprocessing&lt;/h2&gt;
&lt;p&gt;Para ficar um pouco mais claro, vamos a um exemplo prático. Verificaremos o tamanho de alguns sites.&lt;/p&gt;
&lt;p&gt;A forma mais recomendada de dar os primeiros passos com &lt;em&gt;threads&lt;/em&gt; em &lt;em&gt;Python&lt;/em&gt; é através da biblioteca &lt;code class=&quot;language-text&quot;&gt;concurrent.futures&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# thread.py&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; concurrent&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;futures
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; urllib&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;request

URLS &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;http://www.foxnews.com/&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token string&quot;&gt;&apos;http://www.cnn.com/&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token string&quot;&gt;&apos;http://www.bbc.co.uk/&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;load_url&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;url&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; timeout&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; urllib&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;urlopen&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;url&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; timeout&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;timeout&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; conn&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; conn&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;read&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; concurrent&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;futures&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ThreadPoolExecutor&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;max_workers&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; executor&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        future_to_url &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;executor&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;submit&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;load_url&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; url&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;60&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; url &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; url &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; URLS&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; future &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; concurrent&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;futures&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;as_completed&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;future_to_url&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            url &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; future_to_url&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;future&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
            data &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; future&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;result&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;%r tem %d bytes&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;url&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;


&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; __name__ &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;__main__&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    main&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Caso você queira saber mais sobre a sintaxe, vale a pena conferir a &lt;a href=&quot;https://docs.python.org/3.6/library/concurrent.futures.html#concurrent.futures.ThreadPoolExecutor&quot; title=&quot;Leia sobre ThreadPoolExecutor&quot;&gt;documentação
oficial do &lt;em&gt;Python&lt;/em&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;A execução deve apresentar um resultado parecido com o abaixo:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;&apos;http://www.bbc.co.uk/&apos; tem 361696 bytes
&apos;http://www.cnn.com/&apos; tem 1143256 bytes
&apos;http://www.foxnews.com/&apos; tem 334772 bytes&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;O &lt;code class=&quot;language-text&quot;&gt;ThreadPoolExecutor&lt;/code&gt; estende do tipo &lt;code class=&quot;language-text&quot;&gt;Executor&lt;/code&gt;. Possuímos também o filho &lt;code class=&quot;language-text&quot;&gt;ProcessPoolExecutor&lt;/code&gt;, que tem uma interface semelhante, mas utiliza o módulo &lt;code class=&quot;language-text&quot;&gt;multiprocessing&lt;/code&gt;
por baixo dos panos:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# process.py&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; concurrent&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;futures
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; urllib&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;request

URLS &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;http://www.foxnews.com/&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token string&quot;&gt;&apos;http://www.cnn.com/&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token string&quot;&gt;&apos;http://www.bbc.co.uk/&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;load_url&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;url&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; timeout&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; urllib&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;urlopen&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;url&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; timeout&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;timeout&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; conn&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; conn&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;read&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; concurrent&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;futures&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ProcessPoolExecutor&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;max_workers&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; executor&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        future_to_url &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;executor&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;submit&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;load_url&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; url&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;60&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; url &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; url &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; URLS&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; future &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; concurrent&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;futures&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;as_completed&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;future_to_url&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            url &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; future_to_url&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;future&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
            data &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; future&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;result&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;%r tem %d bytes&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;url&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;


&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; __name__ &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;__main__&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    main&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Para maiores detalhes sobre a implementação, &lt;a href=&quot;https://docs.python.org/3.6/library/concurrent.futures.html#concurrent.futures.ProcessPoolExecutor&quot; title=&quot;Leia mais sobre&quot;&gt;confira a documentação do &lt;em&gt;ProcessPoolExecutor&lt;/em&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Com auxílio da ferramenta de linha de comando &lt;code class=&quot;language-text&quot;&gt;time&lt;/code&gt;, podemos calcular quanto tempo
cada &lt;em&gt;script&lt;/em&gt; leva para executar as tarefas concorrentemente:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ time python thread.py
&apos;http://www.bbc.co.uk/&apos; tem 360652 bytes
&apos;http://www.foxnews.com/&apos; tem 336778 bytes
&apos;http://www.cnn.com/&apos; tem 1143341 bytes
python thread.py  0.15s user 0.06s system 38% cpu 0.555 total

$ time python process.py
&apos;http://www.bbc.co.uk/&apos; tem 360652 bytes
&apos;http://www.cnn.com/&apos; tem 1143341 bytes
&apos;http://www.foxnews.com/&apos; tem 336779 bytes
python process.py  0.41s user 0.12s system 74% cpu 0.715 total&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;E surpreendentemente vemos que o exemplo com &lt;em&gt;threads&lt;/em&gt; (&lt;code class=&quot;language-text&quot;&gt;0.15s&lt;/code&gt;) leva
menos tempo que o com subprocessos (&lt;code class=&quot;language-text&quot;&gt;0.41s&lt;/code&gt;).&lt;/p&gt;
&lt;h2&gt;I/O-bound e CPU-bound&lt;/h2&gt;
&lt;p&gt;Pela ideia de que &lt;em&gt;threads&lt;/em&gt; em &lt;em&gt;Python&lt;/em&gt; não são paralelas, podemos chegar erroneamente à conclusão de que &lt;em&gt;multiprocessing&lt;/em&gt; é a solução
definitiva.&lt;/p&gt;
&lt;p&gt;Depende do tipo de problema que estamos tentando resolver. Há duas categorias distintas
que influenciam na decisão:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Problemas &lt;em&gt;CPU-bound&lt;/em&gt;: Onde o progresso do processo é limitado pela velocidade da &lt;em&gt;CPU&lt;/em&gt; .&lt;/li&gt;
&lt;li&gt;Problemas &lt;em&gt;I/O-bound&lt;/em&gt;: O progresso é limitado pela velocidade do subsistema de entrada/saída.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Um exemplo do primeiro é um conjunto de operações matemáticas complexas, que dependem exclusivamente do uso da &lt;em&gt;CPU&lt;/em&gt;. O código
da seção anterior é um exemplo de &lt;em&gt;I/O-bound&lt;/em&gt;.&lt;/p&gt;
&lt;h3&gt;Threads e I/O&lt;/h3&gt;
&lt;p&gt;O Sistema Operacional é responsável pelo gerenciamento de uma &lt;em&gt;thread&lt;/em&gt;. &lt;a href=&quot;https://en.wikipedia.org/wiki/Preemption_%28computing%29#Preemptive_multitasking&quot; title=&quot;Preemption (computing)&quot;&gt;Ele a interrompe a qualquer momento, salva o seu estado, e executa qualquer outra em seu lugar,
podendo resumi-la ao fim do processo&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Larry Hastings&lt;/em&gt;, no &lt;a href=&quot;https://www.youtube.com/watch?t=11m40s&amp;#x26;v=4zeHStBowEk&amp;#x26;feature=youtu.be&quot; title=&quot;Veja o talk no Youtube&quot;&gt;&quot;Python&apos;s Infamous GIL&quot;&lt;/a&gt;, descreve
como o gerenciamento da &lt;em&gt;GIL&lt;/em&gt; funciona do ponto de vista da linguagem:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The way Python threads work with the GIL is with a simple counter. With every 100 byte codes executed the
GIL is supposed to be released by the thread currently executing in order to give other threads a chance to execute code.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Quando acessamos um banco de dados em outro servidor, um serviço &lt;em&gt;web&lt;/em&gt;, ou um arquivo em um sistema de arquivos, estamos
realizando uma operação &lt;em&gt;I/O-bound&lt;/em&gt;. Qualquer ação que demande comunicação com o &lt;em&gt;hardware&lt;/em&gt; (como os &lt;em&gt;sockets&lt;/em&gt;), envolve comunicação
com o &lt;em&gt;kernel&lt;/em&gt; da máquina, e essa operação é mais lenta que as operações de uma &lt;em&gt;CPU&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;&lt;figure class=&quot;gatsby-resp-image-figure&quot; style=&quot;&quot;&gt;
    &lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/a3efed2b8019b2972a3207772d1cdbab/d326d/iobound.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 44.79166666666667%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABnUlEQVQoz2WSYU/bMBCG8///ycY0oX1jFULbgIlWTKQEWAWUZk0a1qRNnMSOHdd5d3baUrSTTokvd8/dvbEHsqZpsLOu65y7eF2jGA2RX57j9ugD7shfTweoL35AJAmMbPa5u1qvqir4vo+iKP4D1gRkeQ7JGPLRFTICjQkafPqIZHACQY1ENIcRHEZrV+O1besKd1PugNa13rgY5xwVNZRlD07PvyP4cozx8Wcsvp1BXI+g1qseiAM7HH8bgVIKm80buMzXULxGRQCjJCQNoxsBuR3IeyvtLa81bp8z/HqY4/4l3cY7tATWtJY9K9oqmKZgnIAEc3rLFilT8GzXKIqoe/9hsbbJKwSPCwyGL/jpz3A/Xe7BWrfuLc4asEpg/Ji4p5UtTAkYxzFmsxnCMERnNJJcgUvTF6U1/EmEr1dTDIM/uJksIKR+J0qUCQI2uPkdYxKL9xpaY7wFb1oYY/ax+bLE3VOCB5JA0GokNulqtjn97OHfigbg8A7/qjVN+pRl6Zwx64zkqElDifUqQ0L3z161wxx3ZgWydIl/E0quQBrr7F0AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;&amp;quot;Diagrama de tempo comparando I/O waiting e CPU processing com Threads&amp;quot;&quot;
        title=&quot;I/O e CPU em um contexto I/O-Bound com Threads (realpython.com)&quot;
        src=&quot;/static/a3efed2b8019b2972a3207772d1cdbab/e5715/iobound.png&quot;
        srcset=&quot;/static/a3efed2b8019b2972a3207772d1cdbab/8514f/iobound.png 192w,
/static/a3efed2b8019b2972a3207772d1cdbab/804b2/iobound.png 384w,
/static/a3efed2b8019b2972a3207772d1cdbab/e5715/iobound.png 768w,
/static/a3efed2b8019b2972a3207772d1cdbab/4ad3a/iobound.png 1152w,
/static/a3efed2b8019b2972a3207772d1cdbab/d326d/iobound.png 1197w&quot;
        sizes=&quot;(max-width: 768px) 100vw, 768px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&quot;gatsby-resp-image-figcaption&quot;&gt;I/O e CPU em um contexto I/O-Bound com Threads (realpython.com)&lt;/figcaption&gt;
  &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;Como resultado, a maioria das operações &lt;em&gt;I/O-bound&lt;/em&gt; ficará em um estado de &quot;espera&quot; até o momento em que ela receba um resultado. E como afirma &lt;em&gt;Cody Piersall&lt;/em&gt;,
nessa &lt;a href=&quot;https://stackoverflow.com/questions/32256775/how-does-the-gil-in-python-affect-the-downloading-of-webpages-in-parallel&quot; title=&quot;How does the GIL in python affect the downloading of webpages in parallel?&quot;&gt;incrivelmente simples resposta no &lt;em&gt;Stackoverflow&lt;/em&gt;&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The GIL won&apos;t hurt you here.&lt;/p&gt;
&lt;p&gt;For I/O bound tasks (like downloading webpages), the GIL is not a problem. Python releases the GIL when I/O is happening,
which means all the threads will be able execute the requests in parallel.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Em outras palavras, a &lt;em&gt;thread&lt;/em&gt; que necessita pegar dados de uma fonte externa irá adquirir a &lt;em&gt;GIL&lt;/em&gt;. Subseqüentemente o &lt;em&gt;lock&lt;/em&gt; é liberado
e é adquirido por outra &lt;em&gt;thread&lt;/em&gt; que inicia outro código &lt;em&gt;I/O-bound&lt;/em&gt; (por exemplo). Quando a &lt;em&gt;GIL&lt;/em&gt; é adquirida novamente pela primeira &lt;em&gt;thread&lt;/em&gt;, possivelmente
ela já tenha recebido os dados.&lt;/p&gt;
&lt;p&gt;&lt;figure class=&quot;gatsby-resp-image-figure&quot; style=&quot;&quot;&gt;
    &lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/9936bc4be1cba43e506c44266381f21d/264eb/gil-lock-threads.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 78.125%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsTAAALEwEAmpwYAAABkElEQVQoz4VSy26DMBDk/z+rl15atVKlRomCSiAgAtiAwS8wpoMt0UalYQ+wLJ6d2fEGdV2P4zjPMyEEubXWGNO2bZ7nyFGf8XTvvxForZum+QpDKYRUKk3TcxgWeS6EmPciEC56QkGYp1kURVLKgXN84vfUMoNfJbFO3WzvNARKqWmavOwkjoFEvuCHAYk+ndXLm/74tJxvM+MoWkB8RUjf97CA99wboV7fxdOzPpyGw2m8lVbrOzBojYvj8UgJhUnAo5txYENqW1Qmv011Y6HFzfIDXrOyLOmtgHj4XBQFZAvOR2NQ6ni/bdiawfa+6ymlrQvwozJozRgzo9kBY0jtRsL8cRyDf5FtjLdwB4xznHPpAnjIlkp2zr9Vmr+CDfAafrGwbfHlIlumlVp0DUMcRZCDBDT+doP/JMG/ilQLNWNKa8E6IxZJ0IW3X6FtsHWxbItSfqcIpUmSwMjfKxQ83l4M77cIdsD2rutQwUU8Yl4D5wCDClABBvP8FaILijtgsGFQ3+V6va5ysixDo2/02aWkjKljGgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;&amp;quot;Fluxograma com threads e os passos de acquire GIL, waiting for GIL, e releasing GIL&amp;quot;&quot;
        title=&quot;Exemplo onde a GIL é aquirida e liberada em diferentes threads (medium.com/fintechexplained)&quot;
        src=&quot;/static/9936bc4be1cba43e506c44266381f21d/e5715/gil-lock-threads.png&quot;
        srcset=&quot;/static/9936bc4be1cba43e506c44266381f21d/8514f/gil-lock-threads.png 192w,
/static/9936bc4be1cba43e506c44266381f21d/804b2/gil-lock-threads.png 384w,
/static/9936bc4be1cba43e506c44266381f21d/e5715/gil-lock-threads.png 768w,
/static/9936bc4be1cba43e506c44266381f21d/264eb/gil-lock-threads.png 867w&quot;
        sizes=&quot;(max-width: 768px) 100vw, 768px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&quot;gatsby-resp-image-figcaption&quot;&gt;Exemplo onde a GIL é aquirida e liberada em diferentes threads (medium.com/fintechexplained)&lt;/figcaption&gt;
  &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;Some isso ao fato de que &lt;a href=&quot;https://stackoverflow.com/questions/3044580/multiprocessing-vs-threading-python%5D&quot; title=&quot;Multiprocessing vs Threading Python [duplicate]&quot;&gt;criar novos processos é normalmente mais caro do que &lt;em&gt;threads&lt;/em&gt;&lt;/a&gt;, e temos uma resposta satisfatória aos números
apresentados no experimento anterior.&lt;/p&gt;
&lt;p&gt;Portanto, se:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;CPU-bound&lt;/em&gt;: Use &lt;em&gt;multiprocessing&lt;/em&gt;;&lt;/li&gt;
&lt;li&gt;&lt;em&gt;I/O-bound&lt;/em&gt;: Use &lt;em&gt;threads&lt;/em&gt; ou &lt;em&gt;asyncio&lt;/em&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Ah! Claro! asyncio!&lt;/h2&gt;
&lt;p&gt;E voltamos ao &lt;em&gt;asynchronous&lt;/em&gt;, afinal esse é um &lt;em&gt;post&lt;/em&gt; sobre &lt;em&gt;ASGI&lt;/em&gt; :)&lt;/p&gt;
&lt;p&gt;Segundo &lt;em&gt;Miguel Grinberg&lt;/em&gt;, no &lt;em&gt;talk&lt;/em&gt; &lt;a href=&quot;https://www.youtube.com/watch?v=iG6fr81xHKA&quot; title=&quot;Veja a apresentação na íntegra&quot;&gt;&quot;Asynchronous Python for the Complete Beginner&quot;&lt;/a&gt;, &lt;em&gt;async&lt;/em&gt;
é:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;A style of concurrent programming in which tasks release the CPU during waiting
periods, so that other tasks can use it.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;É importante salientar que:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;Async&lt;/em&gt; (&lt;em&gt;async IO&lt;/em&gt;, &lt;em&gt;asynchoronous&lt;/em&gt;, ou &lt;em&gt;asynchronous IO&lt;/em&gt;) e &lt;em&gt;asyncio&lt;/em&gt; não são exatamente a mesma coisa;&lt;/li&gt;
&lt;li&gt;O &lt;em&gt;asynchronous IO&lt;/em&gt;, de forma geral, é um estilo de programação concorrente;&lt;/li&gt;
&lt;li&gt;Já o &lt;a href=&quot;https://docs.python.org/3/library/asyncio.html&quot; title=&quot;Leia mais na documentação oficial&quot;&gt;&lt;em&gt;asyncio&lt;/em&gt;&lt;/a&gt; é uma das implementações &lt;em&gt;Python&lt;/em&gt; desse estilo (há outras implementações,
como o &lt;a href=&quot;http://github.com/MagicStack/uvloop&quot; title=&quot;Veja o repositório&quot;&gt;&lt;em&gt;uvloop&lt;/em&gt;&lt;/a&gt;).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Continuamos dentro dos domínios da concorrência, mas ainda assim, apresentando uma técnica completamente diferente.&lt;/p&gt;
&lt;h3&gt;Event loop&lt;/h3&gt;
&lt;p&gt;De forma simplista, imagine que há um objeto &lt;em&gt;Python&lt;/em&gt; chamado de &lt;em&gt;event loop&lt;/em&gt;, e esse camarada é
quem controla como e quando cada &lt;em&gt;task&lt;/em&gt; irá rodar. Ele é consciente de cada &lt;em&gt;task&lt;/em&gt;,
e sabe em qual estado cada uma está.&lt;/p&gt;
&lt;p&gt;&lt;figure class=&quot;gatsby-resp-image-figure&quot; style=&quot;&quot;&gt;
    &lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/868e2dbfba60262f09a26c4b9517c56a/e8950/python-event-loop.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 60.9375%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACZUlEQVQoz21S20sUURyev6FnY8vSxIJywQxJQguj6EGLwAdB0h6kngJDeuwtiEgDJSqELj4UYl62HkTUNS287Mraiqvb7Nnd2Zndndmdvcxt58y5dDTCNfo4D+f8fpzf+c73fRwlhGBIKSX76wCkbHOocQCO2PrkpxdiXGQHB+Oyu5hNZZMJRX8qFsKCLCG7RBxkKVmCMIcISUX5gpqNm06kYKD9R2AJqT9JeMoKTWnKKrUUJBvmWlL1x6WtqBQRYx/nJ6Btc9Qx52bey0rWoDSgFGVNRxCFp+zBXs+tlt72lu5HHcNgLZ22jNmdmFayIaFKPrsOggghDmG8G/DnY2EB+P3JPOOQ89FnPdOuqurKM3UVpxuPHHXdu9ufXsTfgvFAQt77EabExthxOC3Gry6Ni8mUd+Ld8lZYsFBo1Lh9qae2/qL7zvPu/r6rzWdPVjXOP41GI/oiEORiQZCEuZUFaFmcllF8y94MCDPlQEHbTCu+N/mbTZ2V568Nvb6/PX35RmvD8Wr35OONtIhErZAsWjsJMLk+C6HDUWj+Cv0QReB5O7Cyy49HNsIe1Nf+xFVT29XZ3NXWVHXqXMuFNv/LXEo1Y0V9j/Zf8zgI7YWvYxKIGrohZNV1JRNPmKEVcP1KR8WJumM17ob61pEHi+omNanzPZYuaoahayC0jZlg1LHl5I4OnaCOQTG3lBBCOZlPSoEP6qv+meGHXxYGhUwAI7LnNsjrASnLJ6Ij3rGSVeJgSf88OpTgI6wJEWZ0eFWMFyQWDStFTJFZyWji8pDZtq3kMhhjjhWZ6AQ5hzP5f/yT1N9+UVqiDH6zPwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Ilustração mostrando de forma subjetiva como o event loop funciona&quot;
        title=&quot;O event loop é um pouco abstrato, e não consegui pensar em nenhum diagrama para explicá-lo (fadeevab.com)&quot;
        src=&quot;/static/868e2dbfba60262f09a26c4b9517c56a/e5715/python-event-loop.png&quot;
        srcset=&quot;/static/868e2dbfba60262f09a26c4b9517c56a/8514f/python-event-loop.png 192w,
/static/868e2dbfba60262f09a26c4b9517c56a/804b2/python-event-loop.png 384w,
/static/868e2dbfba60262f09a26c4b9517c56a/e5715/python-event-loop.png 768w,
/static/868e2dbfba60262f09a26c4b9517c56a/4ad3a/python-event-loop.png 1152w,
/static/868e2dbfba60262f09a26c4b9517c56a/71c1d/python-event-loop.png 1536w,
/static/868e2dbfba60262f09a26c4b9517c56a/e8950/python-event-loop.png 2000w&quot;
        sizes=&quot;(max-width: 768px) 100vw, 768px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&quot;gatsby-resp-image-figcaption&quot;&gt;O event loop é um pouco abstrato, e não consegui pensar em nenhum diagrama para explicá-lo (fadeevab.com)&lt;/figcaption&gt;
  &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;Por exemplo, o estado &quot;pronto&quot; indica que a tarefa tem trabalho a fazer e está pronta para rodar. O &quot;esperando&quot; indica
que a tarefa está esperando que alguma coisa externa termine, como as &lt;em&gt;I/O-bounds operations&lt;/em&gt; que discutimos anteriormente.&lt;/p&gt;
&lt;p&gt;Para deixar as coisas simples, vamos imaginar que o &lt;em&gt;event loop&lt;/em&gt; mantenha uma lista para tarefas &quot;prontas para executar&quot;, e outra para &quot;esperando&quot;. Ele
pega uma das &lt;em&gt;tasks&lt;/em&gt; prontas para executar e bota para rodar. E aqui vai um detalhe importante: &lt;a href=&quot;https://en.wikipedia.org/wiki/Cooperative_multitasking&quot; title=&quot;Cooperative multitasking&quot;&gt;A tarefa terá total controle da execução até o momento que
ela, cooperativamente, devolve o controle para o &lt;em&gt;event loop&lt;/em&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Quando a tarefa devolve o controle para o &lt;em&gt;event loop&lt;/em&gt;, ele a coloca na determinada fila dependendo do seu estado. Ele (o &lt;em&gt;event loop&lt;/em&gt;) percorre a lista de tarefas &quot;esperando&quot;
para checar se o &lt;em&gt;I/O&lt;/em&gt; de alguma delas já acabou, e portanto, se o seu estado agora é &quot;pronta para executar&quot;. Essa tarefa é então movida para a lista de prontos para executar,
e o &lt;em&gt;event loop&lt;/em&gt; pega a próxima tarefa dessa mesma lista.&lt;/p&gt;
&lt;p&gt;&lt;figure class=&quot;gatsby-resp-image-figure&quot; style=&quot;&quot;&gt;
    &lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/2a93ebfd4c3925f285434e70ae26e35a/dc616/iobound-asyncio.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 57.8125%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACCUlEQVQoz21SaXPTMBD1//8ZDPQihWH6CVpa6BRKSpoSkri5yFUrPnPZjWRblh+SHQcH2Jmd1Ui7b/ftk4atpWm6i+n27vl7FZvrK3TfVFB/+QLNo4PsHNxcY/3xHNR4ymuE2NVrQRCAEPIHbPvAKMXgrgqut+BdXqB39g6N18foy0guPsCVd/5DHZFlojyUpus6Go0GbNvemzSKIiwl6Go0wnP1FuuvN2hWTlA/PED7tAJy/h6LT5fwZdNo7iFNeD4hYwxUFqpYBhSSBo9jTKZTrIgBevcNoVyB/vYUP06OcH/4Ci0J7H2+gn/7BbFkmgGiZGXKCrBoYkhQZzgEXy5BHRuBacKfzbCRrJjryAnnSHicAxYgZVGESBFzDioBGQux9n0kaVruDRqGMGYmnsgMxLRgWvb+hGXgXxZDh4R4NCg6BkNrEoBzobIyRYsd6+MFHgZLNIYr/Byt0bdiaK7rYiopFaao9s0IXTNBz1IuoBsReCL+2nGKscvRs1P0t65qtE6ng3a7DRWLnfXNcAvGs6gb4T+AiWw8sovGfJerhXIXsVRT/UfOc+m7hKFtxNCJpEViNCdU7lTsGCjQJEkwMEt5Rp67p3Ixgb/hWFMBn0mnuf/PNlGa52W56pzsq7xTWiRYzF14noO552buOk72+Wu1GsbjsXzz4Mkvo3y1XKDbfYRjW/gN9KOMDP8ANGAAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;&amp;quot;Diagrama de tempo comparando I/O waiting e CPU processing com asyncio&amp;quot;&quot;
        title=&quot;I/O e CPU em um contexto I/O-Bound com asyncio (realpython.com)&quot;
        src=&quot;/static/2a93ebfd4c3925f285434e70ae26e35a/e5715/iobound-asyncio.png&quot;
        srcset=&quot;/static/2a93ebfd4c3925f285434e70ae26e35a/8514f/iobound-asyncio.png 192w,
/static/2a93ebfd4c3925f285434e70ae26e35a/804b2/iobound-asyncio.png 384w,
/static/2a93ebfd4c3925f285434e70ae26e35a/e5715/iobound-asyncio.png 768w,
/static/2a93ebfd4c3925f285434e70ae26e35a/dc616/iobound-asyncio.png 933w&quot;
        sizes=&quot;(max-width: 768px) 100vw, 768px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&quot;gatsby-resp-image-figcaption&quot;&gt;I/O e CPU em um contexto I/O-Bound com asyncio (realpython.com)&lt;/figcaption&gt;
  &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;E o processo se repete.&lt;/p&gt;
&lt;h3&gt;asyncio x multithreading&lt;/h3&gt;
&lt;p&gt;O &lt;em&gt;async&lt;/em&gt; e &lt;em&gt;threads&lt;/em&gt; podem até parecer ter algumas semelhanças, mas há muitas diferenças. Para começar, as &quot;tarefas&quot; no contexto
do &lt;em&gt;asyncio&lt;/em&gt; são chamadas de &lt;em&gt;coroutines&lt;/em&gt;. Recorremos ao &lt;a href=&quot;https://stackoverflow.com/questions/1934715/difference-between-a-coroutine-and-a-thread&quot; title=&quot;Difference between a “coroutine” and a “thread”?&quot;&gt;&lt;em&gt;Stackoverflow&lt;/em&gt; para deixar as coisas mais claras&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;With threads, the operating system switches running threads preemptively according to its scheduler, which is an algorithm in
the operating system kernel. With coroutines, the programmer and programming language determine when to switch coroutines;
in other words, tasks are cooperatively multitasked by pausing and resuming functions at set points, typically (but not
necessarily) within a single thread.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Duas coisas importantes precisam ser observadas com essa afirmação:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Tarefas nunca são interrompidas no meio de uma operação, portanto, é mais fácil e seguro compartilhar recursos com &lt;em&gt;asyncio&lt;/em&gt; em comparação com &lt;em&gt;threads&lt;/em&gt;.&lt;/li&gt;
&lt;li&gt;É isso mesmo que você leu: Tipicamente (mas não necessariamente) dentro de uma única &lt;em&gt;thread&lt;/em&gt;.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Outro ponto importante é que assim como &lt;em&gt;threads&lt;/em&gt;, corrotinas são mais leves que subprocessos. Mas aposto que você ainda está chocado com o &lt;em&gt;single-thread&lt;/em&gt;, então
vamos voltar a ele.&lt;/p&gt;
&lt;h3&gt;O exemplo da enxadrista&lt;/h3&gt;
&lt;p&gt;O &lt;em&gt;asyncio&lt;/em&gt; é (&lt;a href=&quot;https://docs.python.org/3/library/asyncio-dev.html#concurrency-and-multithreading&quot; title=&quot;Concurrency and Multithreading&quot;&gt;por padrão&lt;/a&gt;) &lt;em&gt;single-threaded&lt;/em&gt; e &lt;em&gt;single-process&lt;/em&gt;. Como ele consegue ser uma alternativa tão interessante quanto os seus primos?&lt;/p&gt;
&lt;p&gt;&lt;figure class=&quot;gatsby-resp-image-figure&quot; style=&quot;&quot;&gt;
    &lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/c3bb25e3bbc3a415256c9afebe6b824d/b17f8/queens-gambit.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAABAABAv/EABcBAAMBAAAAAAAAAAAAAAAAAAABAgP/2gAMAwEAAhADEAAAAQ9j3O2RYf8A/8QAGxAAAQQDAAAAAAAAAAAAAAAAAgABA0EQEiL/2gAIAQEAAQUCGYmXO11j/8QAFREBAQAAAAAAAAAAAAAAAAAAARD/2gAIAQMBAT8BJ//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABsQAAEEAwAAAAAAAAAAAAAAAAEAAhEhAxIg/9oACAEBAAY/AriAg7GKR2rj/8QAGhABAAMBAQEAAAAAAAAAAAAAAQARQSExUf/aAAgBAQABPyELQ6bOb58sRusluguOtlpH2f/aAAwDAQACAAMAAAAQrA//xAAXEQEAAwAAAAAAAAAAAAAAAAAAAREh/9oACAEDAQE/EKQx/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAEh/9oACAECAQE/EK1//8QAHBABAAIDAAMAAAAAAAAAAAAAAQARITFBYZGh/9oACAEBAAE/EGt8T0ca9wMiTL6bo33PyIWf4BWr34jduS2xYAoCJEqVZ//Z&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;&amp;quot;Protagonista de Gambit&amp;#39;s Queen jogando xadresz&amp;quot;&quot;
        title=&quot;Achou que não ia ter referência ao Gambito? (lifestyleasia.com)&quot;
        src=&quot;/static/c3bb25e3bbc3a415256c9afebe6b824d/212bf/queens-gambit.jpg&quot;
        srcset=&quot;/static/c3bb25e3bbc3a415256c9afebe6b824d/7809d/queens-gambit.jpg 192w,
/static/c3bb25e3bbc3a415256c9afebe6b824d/4ecad/queens-gambit.jpg 384w,
/static/c3bb25e3bbc3a415256c9afebe6b824d/212bf/queens-gambit.jpg 768w,
/static/c3bb25e3bbc3a415256c9afebe6b824d/5ef17/queens-gambit.jpg 1152w,
/static/c3bb25e3bbc3a415256c9afebe6b824d/ac99c/queens-gambit.jpg 1536w,
/static/c3bb25e3bbc3a415256c9afebe6b824d/b17f8/queens-gambit.jpg 1600w&quot;
        sizes=&quot;(max-width: 768px) 100vw, 768px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&quot;gatsby-resp-image-figcaption&quot;&gt;Achou que não ia ter referência ao Gambito? (lifestyleasia.com)&lt;/figcaption&gt;
  &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;Voltamos a citar o &lt;em&gt;RealPython&lt;/em&gt;, &lt;a href=&quot;https://realpython.com/async-io-python/&quot; title=&quot;Async IO in Python&quot;&gt;trazendo o exemplo da enxadrista&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Chess master Judit Polgár hosts a chess exhibition in which she plays multiple amateur players.
She has two ways of conducting the exhibition: synchronously and asynchronously.&lt;/p&gt;
&lt;p&gt;Assumptions&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;24 opponents&lt;/li&gt;
&lt;li&gt;Judit makes each chess move in 5 seconds&lt;/li&gt;
&lt;li&gt;Opponents each take 55 seconds to make a move&lt;/li&gt;
&lt;li&gt;Games average 30 pair-moves (60 moves total)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Synchronous version:&lt;/strong&gt; Judit plays one game at a time, never two at the same time, until the game is complete.
Each game takes (55 + 5) * 30 == 1800 seconds, or 30 minutes. The entire exhibition takes 24 * 30 == 720 minutes, or &lt;strong&gt;12 hours&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Asynchronous version:&lt;/strong&gt; Judit moves from table to table, making one move at each table. She leaves the table and lets the opponent
make their next move during the wait time. One move on all 24 games takes Judit 24 * 5 == 120 seconds, or 2 minutes.
The entire exhibition is now cut down to 120 * 30 == 3600 seconds, or just &lt;strong&gt;1 hour&lt;/strong&gt;.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Temos apenas uma &lt;em&gt;Judit&lt;/em&gt;, que pode fazer um movimento por vez por ela mesma. Ela jogar cada jogo de forma síncrona limita ela
também ao tempo que o outro enxadrista tem para respondê-la. Mas de forma assíncrona, ela consegue lidar com múltiplas tarefas acontecendo concorrentemente,
em turnos que permitem que ao tempo que um enxadrista está pensando em uma resposta, ela se move para o próximo, e retorna quando o primeiro estiver pronto.&lt;/p&gt;
&lt;p&gt;Imagine que &lt;em&gt;Judit&lt;/em&gt; é o &lt;em&gt;event loop&lt;/em&gt;, e que as jogadas com os 24 oponentes são tarefas acontecendo concorrentemente.&lt;/p&gt;
&lt;h3&gt;async/await&lt;/h3&gt;
&lt;p&gt;Mas como?&lt;/p&gt;
&lt;p&gt;O &lt;em&gt;Python&lt;/em&gt; apresenta algumas palavras reservadas que permitem informar ao &lt;em&gt;event loop&lt;/em&gt; o estado da tarefa sendo executada.
Você provavelmente já ouviu falar das principais: &lt;code class=&quot;language-text&quot;&gt;async&lt;/code&gt; e &lt;code class=&quot;language-text&quot;&gt;await&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Com a primeira, indicamos ao &lt;em&gt;Python&lt;/em&gt; que uma função trata-se de uma corrotina (ou um &lt;a href=&quot;https://www.python.org/dev/peps/pep-0525/&quot; title=&quot;Leia a PEP 525&quot;&gt;&lt;em&gt;generator&lt;/em&gt; assíncrono&lt;/a&gt;).
Já com o &lt;code class=&quot;language-text&quot;&gt;await&lt;/code&gt;, estamos dando o controle de volta ao &lt;em&gt;event loop&lt;/em&gt;, e sinalizando que podemos esperar pelo resultado de determinada operação.&lt;/p&gt;
&lt;p&gt;Ou seja, com o código abaixo:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    r &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; f&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; r&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Queremos dizer:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Suspenda a execução de g(),
até que o que quer que a gente esteja esperando em f()
seja retornado.

Nesse meio tempo, vá executar alguma outra coisa...&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;E note que bibliotecas para &lt;em&gt;I/O&lt;/em&gt; precisam suportar essa forma de escrita, caso contrário não estaremos de fato fazendo uso das propriedades do &lt;em&gt;async&lt;/em&gt;.&lt;/p&gt;
&lt;h3&gt;Na prática&lt;/h3&gt;
&lt;p&gt;Voltamos ao mesmo exemplo usado com &lt;em&gt;threads&lt;/em&gt; e &lt;em&gt;multiprocessing&lt;/em&gt;, mas agora reescrito para utilizar a biblioteca &lt;code class=&quot;language-text&quot;&gt;asyncio&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# async.py&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; asyncio
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; httpx
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; itertools

URLS &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;http://www.foxnews.com/&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token string&quot;&gt;&apos;http://www.cnn.com/&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token string&quot;&gt;&apos;http://www.bbc.co.uk/&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;


&lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;measure_url&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;client&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; url&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    resp &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; client&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;get&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;url&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    length &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;resp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;text&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;url&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; length&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;


&lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; httpx&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;AsyncClient&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; client&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        results &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; asyncio&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;gather&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
            &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;measure_url&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; itertools&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;repeat&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;client&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; URLS&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;url&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; length&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; results&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-interpolation&quot;&gt;&lt;span class=&quot;token string&quot;&gt;f&quot;&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;url&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt; tem &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;length&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt; bytes&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;


&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; __name__ &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;__main__&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    asyncio&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;main&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Note o uso das palavras reservadas &lt;code class=&quot;language-text&quot;&gt;async&lt;/code&gt; e &lt;code class=&quot;language-text&quot;&gt;await&lt;/code&gt;, e do inicializador do &lt;em&gt;event loop&lt;/em&gt;. Além, claro,
do uso de bibliotecas não bloqueantes como o caso da &lt;a href=&quot;https://www.python-httpx.org&quot; title=&quot;A next-generation HTTP client for Python&quot;&gt;&lt;em&gt;httpx&lt;/em&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;E como fica o comparativo com &lt;em&gt;threads&lt;/em&gt; e processos? Mais uma vez rodando com &lt;code class=&quot;language-text&quot;&gt;time&lt;/code&gt;, temos:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ time python async.py
http://www.foxnews.com/ tem 339756 bytes
http://www.cnn.com/ tem 1145150 bytes
http://www.bbc.co.uk/ tem 317556 bytes
python async.py  0.22s user 0.07s system 13% cpu 2.151 total&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Nada mal. Quase metade do tempo usando &lt;code class=&quot;language-text&quot;&gt;multiprocessing&lt;/code&gt;, e um pouco mais que usando &lt;em&gt;threads&lt;/em&gt;. Isso não quer
dizer que &lt;em&gt;asyncio&lt;/em&gt; é necessariamento mais lento, &lt;a href=&quot;https://stackoverflow.com/questions/8546273/is-non-blocking-i-o-really-faster-than-multi-threaded-blocking-i-o-how&quot; title=&quot;Is non-blocking I/O really faster than multi-threaded blocking I/O? How?&quot;&gt;apenas que o contexto desse experimento favoreceu o exemplo com &lt;em&gt;threads&lt;/em&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;O propósito do comparativo com &lt;code class=&quot;language-text&quot;&gt;time&lt;/code&gt; nesse artigo é apenas ilustrar que há diferença entre as opções possíveis. Mas se
você não está satisfeito com o resultado, o &lt;em&gt;Stackoverflow&lt;/em&gt; &lt;a href=&quot;https://stackoverflow.com/questions/27435284/multiprocessing-vs-multithreading-vs-asyncio-in-python-3&quot; title=&quot;multiprocessing vs multithreading vs asyncio in Python 3&quot;&gt;pode ajudar novamente&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;CPU Bound =&gt; Multi Processing&lt;/li&gt;
&lt;li&gt;I/O Bound, Fast I/O, Limited Number of Connections =&gt; Multi Threading&lt;/li&gt;
&lt;li&gt;I/O Bound, Slow I/O, Many connections =&gt; Asyncio&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;Vai depender do contexto do problema sendo resolvido.&lt;/p&gt;
&lt;h2&gt;Considerações finais&lt;/h2&gt;
&lt;p&gt;Eu lembro de estar em mais de uma entrevista de emprego, e ser perguntado
sobre como fazer &lt;em&gt;CPU-bound&lt;/em&gt; e &lt;em&gt;IO-bound&lt;/em&gt; em &lt;em&gt;Python&lt;/em&gt;. &lt;/p&gt;
&lt;p&gt;Agora sabemos o básico sobre os principais conceitos relacionados à concorrência em &lt;em&gt;Python&lt;/em&gt;. Temos uma perspectiva
mais detalhada sobre a &lt;em&gt;GIL&lt;/em&gt;, e não entramos no mérito de debater se ela é boa ou ruim.
Entender a natureza das &lt;em&gt;threads&lt;/em&gt; na linguagem é mais importante, e é crucial para decidirmos da melhor forma como solucionar
problemas concorrentes.&lt;/p&gt;
&lt;p&gt;E optar pelo &lt;em&gt;async/ASGI&lt;/em&gt; faz parte disso também. Portanto, agora que temos todo o contexto de concorrência e paralelismo,
no próximo &lt;em&gt;post&lt;/em&gt; vamos revisitar o funcionamento do &lt;em&gt;WSGI&lt;/em&gt;, compará-lo com o seu primo mais novo, e compreender a motivação por trás da alternativa.&lt;/p&gt;
&lt;p&gt;Até a próxima.&lt;/p&gt;
&lt;h2&gt;Referências&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://callhub.io/understanding-python-gil/&quot;&gt;CallHub - Understanding Python GIL&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://dev.to/mervynlee94/multi-threading-vs-event-loop-in-python-1h4h&quot;&gt;Dev.to - Multi-threading vs Event Loop in Python&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://diogommartins.wordpress.com/2017/04/07/concorrencia-e-paralelismo-threads-multiplos-processos-e-asyncio-parte-1/&quot;&gt;Diogo M Martins - Concorrência e paralelismo: Threads, múltiplos processos e asyncio - Parte 1&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://medium.com/fintechexplained/advanced-python-concurrency-and-parallelism-82e378f26ced&quot;&gt;FinTechExplained - Advanced Python: Concurrency And Parallelism&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://medium.com/fullstackai/concurrency-in-python-cooperative-vs-preemptive-scheduling-5feaed7f6e53&quot;&gt;FullStackAI - Concurrency in Python: Cooperative vs Preemptive Scheduling&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://levelup.gitconnected.com/diy-multithreading-vs-multiprocessing-in-python-fb93698ca7f3&quot;&gt;Gitconnected - DIY: Multithreading vs Multiprocessing in Python&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://blog.miguelgrinberg.com/post/sync-vs-async-python-what-is-the-difference&quot;&gt;Miguel Grinberg - Sync vs. Async Python: What is the Difference?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.blopig.com/blog/2019/01/making-the-most-of-your-cpus-when-using-python/&quot;&gt;Oxford Protein Informatics Group - Making the most of your CPUs when using python&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://realpython.com/async-io-python/&quot;&gt;RealPython - Async IO in Python: A Complete Walkthrough&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://realpython.com/python-concurrency/&quot;&gt;RealPython - Speed Up Your Python Program With Concurrency&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://realpython.com/python-gil/&quot;&gt;RealPython - What Is the Python Global Interpreter Lock (GIL)?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://stackify.com/python-garbage-collection/&quot;&gt;Stackify - Python Garbage Collection: What It Is and How It Works&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://stackoverflow.com/questions/1934715/difference-between-a-coroutine-and-a-thread&quot;&gt;Stackoverflow - Difference between a “coroutine” and a “thread”?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://stackoverflow.com/questions/33352298/how-does-python-handle-thread-locking-context-switching&quot;&gt;Stackoverflow - How does python handle thread locking / context switching?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://stackoverflow.com/questions/8546273/is-non-blocking-i-o-really-faster-than-multi-threaded-blocking-i-o-how&quot;&gt;Stackoverflow - Is non-blocking I/O really faster than multi-threaded blocking I/O? How?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://stackoverflow.com/questions/27435284/multiprocessing-vs-multithreading-vs-asyncio-in-python-3&quot;&gt;Stackoverflow - multiprocessing vs multithreading vs asyncio in Python 3&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://stackoverflow.com/questions/3044580/multiprocessing-vs-threading-python&quot;&gt;Stackoverflow - Multiprocessing vs Threading Python [duplicate]&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://stackoverflow.com/questions/868568/what-do-the-terms-cpu-bound-and-i-o-bound-mean&quot;&gt;Stackoverflow - What do the terms “CPU bound” and “I/O bound” mean?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://stackoverflow.com/questions/1050222/what-is-the-difference-between-concurrency-and-parallelism&quot;&gt;Stackoverflow - What is the difference between concurrency and parallelism?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://testdriven.io/blog/python-concurrency-parallelism/&quot;&gt;Testdriven.io - Parallelism, Concurrency, and AsyncIO in Python - by example&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://timber.io/blog/multiprocessing-vs-multithreading-in-python-what-you-need-to-know/&quot;&gt;Timber - Multiprocessing Vs. Threading In Python: What You Need To Know.&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=iG6fr81xHKA&quot;&gt;Youtube - Miguel Grinberg Asynchronous Python for the Complete Beginner PyCon 2017&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Streamando dados no Django]]></title><description><![CDATA[Recentemente na Loadsmart,
houve a necessidade de lidar com um cenário onde se faz necessário acessar uma view
que retorna um CSV de tamanho considerável, gerado a partir de parâmetros dinâmicos,
no melhor esquema "imprima um relatório". Embora o Django seja desenhado para requisições curtas, existe…]]></description><link>https://klauslaube.com.br/2017/05/14/streaming-dados-django.html</link><guid isPermaLink="false">https://klauslaube.com.br/2017/05/14/streaming-dados-django.html</guid><dc:creator><![CDATA[Klaus Peter Laube]]></dc:creator><pubDate>Sun, 14 May 2017 15:45:00 GMT</pubDate><content:encoded>&lt;p&gt;Recentemente na &lt;a href=&quot;http://loadsmart.com/&quot; title=&quot;Book a truck with Loadsmart&quot;&gt;&lt;em&gt;Loadsmart&lt;/em&gt;&lt;/a&gt;,
houve a necessidade de lidar com um cenário onde se faz necessário acessar uma &lt;em&gt;view&lt;/em&gt;
que retorna um &lt;em&gt;CSV&lt;/em&gt; de tamanho considerável, gerado a partir de parâmetros dinâmicos,
no melhor esquema &quot;imprima um relatório&quot;.&lt;/p&gt;
&lt;p&gt;Embora o &lt;a href=&quot;/tag/django.html&quot; title=&quot;Leia mais sobre Django&quot;&gt;&lt;em&gt;Django&lt;/em&gt;&lt;/a&gt; seja desenhado para requisições curtas, existe a possibilidade
de fazer &lt;em&gt;streaming&lt;/em&gt; de grandes arquivos &lt;em&gt;CSVs&lt;/em&gt; através da classe &lt;code class=&quot;language-text&quot;&gt;StreamingHttpResponse&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Vale a nota: Esse artigo é sobre &lt;em&gt;CSVs&lt;/em&gt;, mas você também pode &lt;a href=&quot;http://stackoverflow.com/questions/30791228/serving-a-django-static-text-file&quot; title=&quot;Serving a django static text file&quot;&gt;&quot;streamar&quot; outros tipos de dados&lt;/a&gt;
através desse método supimpa.&lt;/p&gt;
&lt;h2&gt;Motivação&lt;/h2&gt;
&lt;p&gt;Em determinados cenários, precisamos retornar arquivos relativamente grandes para
o usuário. O exemplo acima, uma requisição com parâmetros que irão gerar um relatório
em &lt;em&gt;CSV&lt;/em&gt;, é um caso bem comum.&lt;/p&gt;
&lt;p&gt;O comportamento de resposta padrão do &lt;em&gt;Django&lt;/em&gt; é retornar uma instância de &lt;code class=&quot;language-text&quot;&gt;HttpResponse&lt;/code&gt;.
O problema é que nesse modo carregaremos o arquivo inteiro para a memória do
servidor, e só depois enviamos o arquivo para o cliente. Além de prejudicarmos o &lt;em&gt;Time To
First Byte&lt;/em&gt; (TTBT), podemos gerar picos de memória na máquina hospedeira (que podem afetar
demais requisições sendo processadas) e &lt;em&gt;timeouts&lt;/em&gt; de conexão.&lt;/p&gt;
&lt;p&gt;Um exemplo de como faríamos esse retorno através do &lt;code class=&quot;language-text&quot;&gt;HttpResponse&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; csv
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; django&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;http &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; HttpResponse
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; django&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;view &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; View


&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;CsvReportView&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;View&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;self&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;args&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;**&lt;/span&gt;kwargs&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;# Abstraindo a logica de filtro por parametros do request&lt;/span&gt;
        cargoes &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Cargoes&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;objects&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;filter_by_request_parms&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

        response &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; HttpResponse&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;content_type&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;text/csv&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        response&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Content-Disposition&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;attachment; filename=&quot;filtered_cargoes.csv&quot;&apos;&lt;/span&gt;

        writer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; csv&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;writer&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;response&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; row &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; cargoes&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;values_list&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;id&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;commodity&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;weight&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            writer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;writerow&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;row&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; response&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Se você tem certa intimidade com geradores, deve estar supondo que essa pode ser uma
maneira de solucionar esse problema... e você está certo!&lt;/p&gt;
&lt;h2&gt;Como funciona o StreamingHttpResponse?&lt;/h2&gt;
&lt;p&gt;O &lt;code class=&quot;language-text&quot;&gt;StreamingHttpResponse&lt;/code&gt; funciona com a ajuda do conceito de &lt;em&gt;generators&lt;/em&gt;. Achei
uma excelente definição no &lt;a href=&quot;http://stackoverflow.com/questions/1756096/understanding-generators-in-python&quot; title=&quot;Understanding Generators in Python&quot;&gt;&lt;em&gt;Stackoverflow&lt;/em&gt;&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;(...) is simply a function which returns an object on which you can
call next, such that for every call it returns some value, until it raises
a StopIteration exception, signaling that all values have been generated.
Such an object is called an iterator.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://www.slideshare.net/ramalho/iteraveis-e-geradores-em-python&quot; title=&quot;Iteraveis e geradores em Python&quot;&gt;Leia mais sobre iteráveis e geradores&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Para tanto, o uso da palavra reservada &lt;code class=&quot;language-text&quot;&gt;yield&lt;/code&gt; se faz necessário. Logo, ao invés de termos o exemplo abaixo:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;my_view&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    message &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Hello, there!&apos;&lt;/span&gt;
    response &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;  HttpResponse&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;message&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    response&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Content-Length&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;message&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; response&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Teremos:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;hello&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Hello,&apos;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;there!&apos;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;my_view&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; StreamingHttpResponse&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;hello&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;a href=&quot;https://andrewbrookins.com/django/how-does-djangos-streaminghttpresponse-work-exactly/&quot; title=&quot;How does Django’s StreamingHttpResponse work, exactly&quot;&gt;Leia mais no excelente &quot;How does Django&apos;s StreamingHttpResponse work, exactly?&quot;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Voltando ao exemplo do &lt;em&gt;CSV&lt;/em&gt;, teremos:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; csv
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; django&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;db &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; models
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; django&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;http &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; StreamingHttpResponse
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; django&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;views&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;generic &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; View

&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Echo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token triple-quoted-string string&quot;&gt;&quot;&quot;&quot;
    Interface parecida com a que usamos para escrever arquivos.
    &quot;&quot;&quot;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;self&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; value&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; value


&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;CsvReportView&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;View&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;self&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;args&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;**&lt;/span&gt;kwargs&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;# Abstraindo a logica de filtro por parametros do request&lt;/span&gt;
        cargoes &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Cargoes&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;objects&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;filter_by_request_parms&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

        &lt;span class=&quot;token comment&quot;&gt;# Usamos a mesma interface de buffer utilizada para escrever&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;# um arquivo. No entanto, apenas damos um `return value`&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;# aos inves de persistirmos o valor&lt;/span&gt;
        pseudo_buffer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Echo&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        writer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; csv&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;writer&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;pseudo_buffer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

        &lt;span class=&quot;token comment&quot;&gt;# Construimos o nosso gerador&lt;/span&gt;
        gen_func &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;writer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;writerow&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;row&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; row &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; cargos&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;values_list&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;id&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;commodity&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;weight&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

        response &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; StreamingHttpResponse&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;gen_func&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; content_type&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;text/csv&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        response&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Content-Disposition&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;attachment;filename=&quot;filtered_cargoes.csv&quot;&apos;&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; response&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Antes mesmo de termos todo o &lt;em&gt;CSV&lt;/em&gt; montado, já estamos retornando dados ao usuário.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.djangoproject.com/en/1.11/howto/outputting-csv/#streaming-large-csv-files&quot; title=&quot;Leia mais na documentação do Django&quot;&gt;Veja o exemplo da documentação ofical do &lt;em&gt;Django&lt;/em&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;É a melhor maneira de resolver esse problema?&lt;/h2&gt;
&lt;p&gt;Caso a sua única opção seja retornar o dado através de uma &lt;em&gt;view&lt;/em&gt; &lt;em&gt;Django&lt;/em&gt;, sim. Além
de um uso mais eficiente de memória, o retorno do &lt;code class=&quot;language-text&quot;&gt;StreamingHttpResponse&lt;/code&gt;
vai impedir que, por exemplo, um &lt;em&gt;load balancer&lt;/em&gt; feche a conexão do seu usuário pelo
fato de o serviço &lt;em&gt;Django&lt;/em&gt; estar levando muito tempo para montar a resposta.&lt;/p&gt;
&lt;p&gt;&lt;figure class=&quot;gatsby-resp-image-figure&quot; style=&quot;&quot;&gt;
    &lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 610px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/4b7ece8243cfe756552c9dfb41282281/5aae9/biznis-cat.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 42.708333333333336%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsTAAALEwEAmpwYAAACKElEQVQoz2NgAAEmBmZORjZ+Fh4xBgFJFesQ0+h6j4YNNUuvda643NixIbtiVlDuBPOkVgHrcCYxVSYBGUZeKWZ5QwYWHUcmfhlmFl4GBg5jYbUEdedcr5S8gPKi8IbU2adzll5Jnnc+tXdHVMcGnZzpvFZhrEpmzDJ6LGrWbI7xDKx6bmwWQZyWQQzCio7iqjOtQ3ssgytMfGK9Mxzbt+u27FZt2aVas0k+b7GIVz6zhCqjkAIDpyjQmUzSugxMUqbM6i5s5hEMKjYeMmoVBnYlBvZxBnZxgTn6dRtESjdIVG/Xbd0hkjxV0C6RmVecgV2IgZGTiZGF18ibgVnTnVPPm9sokEHdJVJW+aSz+25Pvz6f+LbM1sTO9VETdibPO1U494CRd4qsvgu3nAGjoAIDAzubsKyQQwQDg4IFs5YTp7K5oKQ6AyP3NH2LCabWhrYR+rGNFhm91hn9XgUzXCJKFdXMeRWMOCW1GLnEgG5mldZlYudhYOaTZxRRY+STYuSXY+CWWqyiXK9uranhZO0YnV42Ja5uSWTrOtvEJh4hRU5RVQZRNUZOMUZWYSYWfgZGRqATRBg4xdk5RDU5Rdy5xc5qClbae/n4ZOblTs7r35m++HzZ7mch7Wu4ZYy4VKwZBBQZmXkZmTgZGdlAUWzNyp3BwdvHytHOwpHEIRAmICQnrcyu5SjikqUUVCEX0yQb3ynlmcMopsHII83AxMXIyApKF2AAANqtfDsY9XT+AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;&amp;quot;O Django com StreamingHttpResponse fica mais biznis (thelegomovie.wikia.com)&amp;quot;&quot;
        title=&quot;O Django com StreamingHttpResponse fica mais biznis (thelegomovie.wikia.com)&quot;
        src=&quot;/static/4b7ece8243cfe756552c9dfb41282281/5aae9/biznis-cat.png&quot;
        srcset=&quot;/static/4b7ece8243cfe756552c9dfb41282281/8514f/biznis-cat.png 192w,
/static/4b7ece8243cfe756552c9dfb41282281/804b2/biznis-cat.png 384w,
/static/4b7ece8243cfe756552c9dfb41282281/5aae9/biznis-cat.png 610w&quot;
        sizes=&quot;(max-width: 610px) 100vw, 610px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&quot;gatsby-resp-image-figcaption&quot;&gt;O Django com StreamingHttpResponse fica mais biznis (thelegomovie.wikia.com)&lt;/figcaption&gt;
  &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;Mas segundo a recomendação da &lt;a href=&quot;https://docs.djangoproject.com/en/1.11/ref/request-response/#django.http.StreamingHttpResponse&quot; title=&quot;Veja mais na documentação do Django&quot;&gt;própria documentação&lt;/a&gt;
do &lt;code class=&quot;language-text&quot;&gt;StreamingHttpResponse&lt;/code&gt;, já que essa é uma &quot;operação bloqueante&quot;,
o ideal seria realizá-la em um &lt;em&gt;background job&lt;/em&gt; (por exemplo) e deixar com que o
usuário acesse essa informação quando ela já estiver pronta.&lt;/p&gt;
&lt;p&gt;O &lt;code class=&quot;language-text&quot;&gt;django-report-builder&lt;/code&gt; entrega essa &lt;a href=&quot;https://django-report-builder.readthedocs.io/en/latest/quickstart/#asynchronous-report-generation&quot; title=&quot;Leia mais na documentação da biblioteca&quot;&gt;modalidade de &quot;asynchronous reports&quot;&lt;/a&gt;
através do &lt;a href=&quot;http://www.celeryproject.org/&quot; title=&quot;Celery: Distributed Task Queue&quot;&gt;&lt;em&gt;Celery&lt;/em&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;Considerações finais&lt;/h2&gt;
&lt;p&gt;É fato que a &quot;mágica pesada&quot; fica no lado do &lt;a href=&quot;/tag/wsgi.html&quot; title=&quot;Leia mais sobre WSGI&quot;&gt;&lt;em&gt;WSGI&lt;/em&gt;&lt;/a&gt;, como você pode ver &lt;a href=&quot;https://andrewbrookins.com/django/how-does-djangos-streaminghttpresponse-work-exactly/#the-wsgi-server&quot; title=&quot;How does Django’s StreamingHttpResponse work, exactly?&quot;&gt;aqui&lt;/a&gt;.
O &lt;em&gt;Django&lt;/em&gt; &quot;faz o que pode&quot; quando o assunto é lidar com grandes volumes de dados. Mas
o ideal é sempre deixar essa carga de processamento fora do ciclo de vida da requisição do usuário.&lt;/p&gt;
&lt;p&gt;Mesmo assim, o &lt;code class=&quot;language-text&quot;&gt;StreamingHttpResponse&lt;/code&gt; vem como uma boa alternativa para resolver
alguns problemas de &lt;em&gt;views&lt;/em&gt; com tempos de resposta e consumo de recursos muito altos, podendo
ser a solução ideal para alguns relatórios que você emite em sua aplicação.&lt;/p&gt;
&lt;p&gt;Até a próxima.&lt;/p&gt;
&lt;h2&gt;Referências&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://blog.aeguana.com/2015/12/12/csv-export-data-for-django-model/&quot;&gt;&lt;em&gt;Aeguana - How to export data as a CSV – Django model&lt;/em&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://andrewbrookins.com/django/how-does-djangos-streaminghttpresponse-work-exactly/&quot;&gt;&lt;em&gt;Andrew Brookins - How does Django&apos;s StreamingHttpResponse work, exactly?&lt;/em&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://docs.djangoproject.com/en/1.11/ref/request-response/#streaminghttpresponse-objects&quot;&gt;&lt;em&gt;Django Documentation - StreamingHttpResponse&lt;/em&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.ericcarmichael.com/streaming-django-responses-on-heroku.html&quot;&gt;&lt;em&gt;nerdery - Streaming Django responses on Heroku&lt;/em&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.rodvdka.co.za/heroku/long-polling/h12/h18/django/2016/10/13/long-polling-heroku.html&quot;&gt;&lt;em&gt;rodvdka - Django long running report on Django&lt;/em&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://stackoverflow.com/questions/33208849/python-django-streaming-video-mp4-file-using-httpresponse&quot;&gt;&lt;em&gt;Stackoverflow - Streaming video/mp4 file using HttpResponse&lt;/em&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://stackoverflow.com/questions/1756096/understanding-generators-in-python&quot;&gt;&lt;em&gt;Stackoverflow - Understanding Generators in Python&lt;/em&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Entendendo o CGI, FastCGI e WSGI]]></title><description><![CDATA[Pelos vários anos que programei com o PHP e Apache,
nunca precisei me preocupar com o que acontecia entre esses dois. Para
mim, era tudo uma “mágica” maravilhosa, que entregava as minhas páginas
web de forma dinâmica. Era uma troca justa: Eles não me traziam
preocupação, logo, eu não me preocupava…]]></description><link>https://klauslaube.com.br/2012/11/02/entendendo-o-cgi-fastcgi-e-wsgi.html</link><guid isPermaLink="false">https://klauslaube.com.br/2012/11/02/entendendo-o-cgi-fastcgi-e-wsgi.html</guid><dc:creator><![CDATA[Klaus Peter Laube]]></dc:creator><pubDate>Fri, 02 Nov 2012 15:09:19 GMT</pubDate><content:encoded>&lt;p&gt;Pelos vários anos que programei com o &lt;a href=&quot;/tag/php.html&quot; title=&quot;Conheça mais sobre o Hypertext PreProcessor&quot;&gt;&lt;em&gt;PHP&lt;/em&gt;&lt;/a&gt; e &lt;em&gt;Apache&lt;/em&gt;,
nunca precisei me preocupar com o que acontecia entre esses dois. Para
mim, era tudo uma “mágica” maravilhosa, que entregava as minhas páginas
&lt;a href=&quot;/tag/desenvolvimento-web.html&quot; title=&quot;Leia mais sobre Web&quot;&gt;&lt;em&gt;web&lt;/em&gt;&lt;/a&gt; de forma dinâmica. Era uma troca justa: Eles não me traziam
preocupação, logo, eu não me preocupava.&lt;/p&gt;
&lt;p&gt;Com o passar do tempo, o uso do &lt;a href=&quot;/2011/12/19/nginx-poderoso-rapido-facil.html&quot; title=&quot;Conheça o Nginx&quot;&gt;&lt;em&gt;Nginx&lt;/em&gt;&lt;/a&gt; e a necessidade de aprender
&lt;a href=&quot;/tag/python.html&quot; title=&quot;Leia mais sobre Python&quot;&gt;&lt;em&gt;Python&lt;/em&gt;&lt;/a&gt;, comecei a me deparar com o famoso &lt;code class=&quot;language-text&quot;&gt;cgi-bin&lt;/code&gt;, e
entender que os truques que o &lt;a href=&quot;http://stackoverflow.com/questions/2712825/what-is-mod-php&quot; title=&quot;Não conhece o módulo do PHP para o Apache?&quot;&gt;&lt;strong&gt;mod_php&lt;/strong&gt;&lt;/a&gt; ocultava iam muito além
do que eu imaginava.&lt;/p&gt;
&lt;h2&gt;O Common Gateway Interface&lt;/h2&gt;
&lt;p&gt;De um modo bem simples, podemos dizer que o &lt;em&gt;Common Gateway Interface&lt;/em&gt; é
um “acordo” entre os servidores &lt;a href=&quot;/tag/http.html&quot; title=&quot;Leia mais sobre HTTP&quot;&gt;&lt;em&gt;HTTP&lt;/em&gt;&lt;/a&gt; e as aplicações &lt;em&gt;web&lt;/em&gt;. Por
baixo dos panos, o servidor &lt;em&gt;web&lt;/em&gt; vai informar uma série de parâmetros
para o seu programa, e é dever do seu programa entregar uma resposta
“bem formada” para o servidor &lt;em&gt;web&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Isso quer dizer que, para o &lt;em&gt;CGI&lt;/em&gt;, não importa qual linguagem ou banco
de dados o seu programa está usando. Para ele, importa a passagem dos
parâmetros e a resposta. Logo, é perfeitamente possível desenvolvermos
nossas páginas até mesmo com a linguagem &lt;em&gt;C&lt;/em&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c&quot;&gt;&lt;pre class=&quot;language-c&quot;&gt;&lt;code class=&quot;language-c&quot;&gt;&lt;span class=&quot;token macro property&quot;&gt;&lt;span class=&quot;token directive-hash&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;token directive keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;lt;stdio.h&gt;&lt;/span&gt;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; argc&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;argv&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Content-type:text/html\n\n&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&amp;lt;html&gt;\n&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&amp;lt;body bgcolor=\&quot;%s\&quot;&gt;\n&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; argv&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&amp;lt;/body&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&amp;lt;/html&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

	&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Basta compilar o código acima, jogar no &lt;code class=&quot;language-text&quot;&gt;cgi-bin&lt;/code&gt; do seu &lt;em&gt;Apache&lt;/em&gt;, e
você verá a flexibilidade do protocolo em ação. Neste exemplo, acessando
nosso programa através da &lt;em&gt;URL&lt;/em&gt; &lt;code class=&quot;language-text&quot;&gt;http://localhost/cgi-bin/exemplo?red&lt;/code&gt;
(por exemplo), veremos apenas uma página com o fundo vermelho. Mas é
importante reparar que, o parâmetro passado na URL (&lt;code class=&quot;language-text&quot;&gt;?red&lt;/code&gt;) está acessível através do
&lt;code class=&quot;language-text&quot;&gt;argv&lt;/code&gt;, ou seja, o protocolo está passando para o nosso programa os
parâmetros através da &lt;code class=&quot;language-text&quot;&gt;STDIN&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Através da &lt;code class=&quot;language-text&quot;&gt;STDOUT&lt;/code&gt;, estamos respondendo ao &lt;em&gt;Apache&lt;/em&gt; utilizando de
artifícios do protocolo. A nossa mensagem é composta por um cabeçalho
informando o tipo da mensagem e o conteúdo. Neste exemplo, trata-se de
um &lt;em&gt;HTML&lt;/em&gt; extremamente simples, &lt;em&gt;James Marshall&lt;/em&gt; &lt;a href=&quot;http://www.jmarshall.com/easy/cgi/portuguese/getcgi.c.txt&quot; title=&quot;Veja outro exemplo de C com CGI&quot;&gt;escreveu um bom exemplo um pouco mais complexo utilizando a linguagem &lt;em&gt;C&lt;/em&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Outro comportamento fundamental do &lt;em&gt;CGI&lt;/em&gt; é a criação de variáveis de
ambiente. Variáveis que você já deve ter usado, como &lt;code class=&quot;language-text&quot;&gt;REMOTE_HOST&lt;/code&gt;,
&lt;code class=&quot;language-text&quot;&gt;REMOTE_ADDR&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;REQUEST_METHOD&lt;/code&gt; e &lt;code class=&quot;language-text&quot;&gt;QUERY_STRING&lt;/code&gt;, são
preenchidas pelo servidor &lt;em&gt;Web&lt;/em&gt; e passadas ao seu programa através do
protocolo:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c&quot;&gt;&lt;pre class=&quot;language-c&quot;&gt;&lt;code class=&quot;language-c&quot;&gt;&lt;span class=&quot;token macro property&quot;&gt;&lt;span class=&quot;token directive-hash&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;token directive keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;lt;stdio.h&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token macro property&quot;&gt;&lt;span class=&quot;token directive-hash&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;token directive keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;lt;stdlib.h&gt;&lt;/span&gt;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; argc&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;argv&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;addr&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;method&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;query_string&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    addr &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getenv&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;REMOTE_ADDR&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    method &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getenv&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;REQUEST_METHOD&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    query_string &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getenv&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;QUERY_STRING&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token function&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Content-type:text/html\n\n&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Remote address: %s&amp;lt;br/&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; addr&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Method: %s&amp;lt;br/&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; method&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Query string: %s&amp;lt;br/&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; query_string&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;O FastCGI&lt;/h2&gt;
&lt;p&gt;O &lt;em&gt;FastCGI&lt;/em&gt; segue o mesmo princípio do &lt;em&gt;CGI&lt;/em&gt;, mas possui uma série de
particularidades (e vantagens) em relação ao seu “primogênito”. Para
compreender a diferença entre eles, vamos analisar o ciclo de vida de
uma requisição utilizando o &lt;em&gt;CGI&lt;/em&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;A cada requisição, o servidor &lt;em&gt;web&lt;/em&gt; &lt;strong&gt;cria um novo processo&lt;/strong&gt;;&lt;/li&gt;
&lt;li&gt;Através deste processo, o servidor &lt;em&gt;web&lt;/em&gt; passa informações para o
“programa &lt;em&gt;CGI&lt;/em&gt;“ utilizando &lt;strong&gt;variáveis de ambiente&lt;/strong&gt;;&lt;/li&gt;
&lt;li&gt;O servidor &lt;em&gt;web&lt;/em&gt; também passa qualquer &lt;em&gt;input&lt;/em&gt; de dados do usuário
através da &lt;strong&gt;&lt;em&gt;STDIN&lt;/em&gt;&lt;/strong&gt;;&lt;/li&gt;
&lt;li&gt;O programa retorna uma saída ao servidor &lt;em&gt;web&lt;/em&gt; através do protocolo
&lt;em&gt;CGI&lt;/em&gt; (utilizando a &lt;strong&gt;&lt;em&gt;STDOUT&lt;/em&gt;&lt;/strong&gt;);&lt;/li&gt;
&lt;li&gt;Quando o &lt;strong&gt;programa acabar&lt;/strong&gt;, a requisição é finalizada.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Em um cenário com poucas requisições, este fluxo atende perfeitamente.
Os problemas começam a aparecer quando temos que lidar com &lt;strong&gt;alto
consumo&lt;/strong&gt; (algo comum hoje em dia, mas nem tão comum quando conceberam o
protocolo &lt;em&gt;CGI&lt;/em&gt;). Dentre os principais problemas, temos:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Criar e destruir um processo a cada requisição aumenta o &lt;em&gt;load&lt;/em&gt; do
seu servidor, o que fatalmente degrada performance;&lt;/li&gt;
&lt;li&gt;Não há reúso de recursos, como conexões com banco de dados e
&lt;em&gt;caches&lt;/em&gt; em memória (já que a cada nova requisição é iniciado um
novo processo);&lt;/li&gt;
&lt;li&gt;Não é trivial separar a sua aplicação do seu servidor &lt;em&gt;Web&lt;/em&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Foi pensando em performance e escalabilidade que o &lt;em&gt;FastCGI&lt;/em&gt; foi criado.
Ao contrário do &lt;em&gt;CGI&lt;/em&gt;, ele utiliza “processos persistentes”, onde o
servidor &lt;em&gt;web&lt;/em&gt; é capaz de iniciar um processo que responde a uma série
de requisições. Além disso, ele usa &lt;a href=&quot;http://pt.wikipedia.org/wiki/Multiplexador&quot; title=&quot;Leia mais sobre Multiplexadores na Wikipedia&quot;&gt;multiplexação&lt;/a&gt; para transmitir e
receber informações dentro de uma única conexão, que pode ser um
&lt;em&gt;socket&lt;/em&gt; ou uma conexão &lt;em&gt;TCP&lt;/em&gt;. Desse modo, você pode ter o seu servidor
&lt;em&gt;web&lt;/em&gt; e o seu processo &lt;em&gt;FastCGI&lt;/em&gt; em máquinas diferentes.&lt;/p&gt;
&lt;p&gt;O ciclo de vida de uma requisição &lt;em&gt;FastCGI&lt;/em&gt;, é basicamente composto por:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;O servidor &lt;em&gt;web&lt;/em&gt; &lt;strong&gt;cria um processo &lt;em&gt;FastCGI&lt;/em&gt;&lt;/strong&gt; para receber
requisições;&lt;/li&gt;
&lt;li&gt;A sua aplicação é inicializada, e &lt;strong&gt;aguarda por uma nova conexão&lt;/strong&gt;
vinda do servidor &lt;em&gt;web&lt;/em&gt;;&lt;/li&gt;
&lt;li&gt;Quando o cliente envia uma requisição, o servidor &lt;em&gt;web&lt;/em&gt; abre uma
&lt;strong&gt;conexão com o processo &lt;em&gt;FastCGI&lt;/em&gt;&lt;/strong&gt;. O servidor envia as variáveis
de ambiente e entradas de dados através desta conexão;&lt;/li&gt;
&lt;li&gt;O processo &lt;em&gt;FastCGI&lt;/em&gt; retorna a &lt;strong&gt;saída através desta mesma
conexão&lt;/strong&gt;;&lt;/li&gt;
&lt;li&gt;O processo &lt;em&gt;FastCGI&lt;/em&gt; fecha a conexão, e a &lt;strong&gt;requisição é
concluída&lt;/strong&gt;, porém, o &lt;strong&gt;processo fica “vivo”&lt;/strong&gt;, esperando por outra
requisição do servidor &lt;em&gt;web&lt;/em&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;É claro que para atingir este resultado, aplicações &lt;em&gt;FastCGI&lt;/em&gt; possuem
uma arquitetura mais “rebuscada” que aplicações &lt;em&gt;CGI&lt;/em&gt;. Por exemplo, para
suportar a &lt;a href=&quot;http://www.nongnu.org/fastcgi/#multiplexing&quot; title=&quot;The wonders of multiplexing&quot;&gt;multiplexação&lt;/a&gt;, o servidor &lt;em&gt;web&lt;/em&gt; e o processo &lt;em&gt;FastCGI&lt;/em&gt;
se comunicam através de mensagens. Nestas mensagens (&lt;code class=&quot;language-text&quot;&gt;BEGIN_REQUEST&lt;/code&gt;,
&lt;code class=&quot;language-text&quot;&gt;ABORT_REQUEST&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;END_REQUEST&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;PARAMS&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;STDIN&lt;/code&gt; e
&lt;code class=&quot;language-text&quot;&gt;STDOUT&lt;/code&gt;) possuímos um cabeçalho chamado &lt;code class=&quot;language-text&quot;&gt;Request ID&lt;/code&gt;, que é
responsável por identificar a qual requisição o pacote pertence.&lt;/p&gt;
&lt;p&gt;Essa mudança de arquitetura acaba influenciando na escrita das
aplicações &lt;em&gt;web&lt;/em&gt;, trazendo alterações marcantes em comparação aos
programas escritos para o bom e velho &lt;em&gt;CGI&lt;/em&gt;. Por exemplo, você terá que
&lt;a href=&quot;http://redmine.lighttpd.net/projects/1/wiki/Docs_ModFastCGI#FastCGI-and-Programming-Languages&quot; title=&quot;Lighttp - the FastCGI Interface&quot;&gt;recompilar o seu &lt;em&gt;PHP&lt;/em&gt;&lt;/a&gt; com a &lt;em&gt;flag&lt;/em&gt; &lt;code class=&quot;language-text&quot;&gt;—enable-fast-cgi&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;O site oficial do &lt;em&gt;FastCGI&lt;/em&gt; possui um bom exemplo de implementação de
uma &lt;a href=&quot;http://www.fastcgi.com/devkit/doc/fastcgi-prog-guide/ch2c.htm&quot; title=&quot;Developing FastCGI Applications in C&quot;&gt;aplicação em &lt;em&gt;C&lt;/em&gt; com &lt;em&gt;FastCGI&lt;/em&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;O Web Server Gateway Interface&lt;/h2&gt;
&lt;p&gt;No universo &lt;em&gt;Python&lt;/em&gt; começaram a aparecer diferentes formas de
comunicação entre servidor e aplicação, seja com &lt;em&gt;CGI&lt;/em&gt;, &lt;em&gt;FastCGI&lt;/em&gt;, &lt;a href=&quot;http://www.modpython.org/&quot; title=&quot;Leia mais sobre o mod_python&quot;&gt;&lt;em&gt;mod
python&lt;/em&gt;&lt;/a&gt; ou até mesmo com &lt;em&gt;APIs&lt;/em&gt; próprias e não padronizadas. Isso
acarretou no seguinte cenário: A escolha de um &lt;em&gt;framework&lt;/em&gt; influenciava
diretamente na escolha do servidor &lt;em&gt;web&lt;/em&gt;, e geralmente o &lt;em&gt;framework&lt;/em&gt;
escolhido era “incompatível” com os demais disponíveis para uso.&lt;/p&gt;
&lt;p&gt;O &lt;em&gt;WSGI&lt;/em&gt; é uma &lt;a href=&quot;http://www.python.org/dev/peps/pep-0333/&quot; title=&quot;Leia a PEP 333, especificação do WSGI&quot;&gt;especificação&lt;/a&gt; que tem por objetivo garantir que o
desenvolvedor da aplicação não se preocupe com qual servidor &lt;em&gt;web&lt;/em&gt; será
escolhido, bem como o profissional responsável pelo servidor &lt;em&gt;web&lt;/em&gt; não
se preocupe com a arquitetura escolhida pela aplicação. Uma forma
“universal” de proporcionar interoperabilidade entre servidores e
aplicações escritas em &lt;em&gt;Python&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Veja um exemplo de &lt;em&gt;script Python&lt;/em&gt; utilizando o protocolo &lt;em&gt;CGI&lt;/em&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;#!/usr/bin/python&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; os &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; environ


&lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Content-Type: text/html\n\n&quot;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&amp;lt;html&gt;&amp;lt;body&gt;Hello %s!&amp;lt;/body&gt;&amp;lt;/html&gt;&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt; environ&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;get&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;REMOTE_ADDR&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Seguindo a especificação do &lt;em&gt;WSGI&lt;/em&gt;, devemos servir nossa aplicação da
seguinte maneira:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;#!/usr/bin/python&lt;/span&gt;


&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;application&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;environ&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; start_response&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    start_response&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;200 OK&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Content-Type&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;text/html&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;&amp;lt;html&gt;&amp;lt;body&gt;Hello %s&amp;lt;/body&gt;&amp;lt;/html&gt;&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt; environ&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;get&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;REMOTE_ADDR&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Encapsulamos a nossa entrega em uma função chamada &lt;code class=&quot;language-text&quot;&gt;application&lt;/code&gt;, e
nela possuímos dois parâmetros: &lt;code class=&quot;language-text&quot;&gt;environ&lt;/code&gt; e &lt;code class=&quot;language-text&quot;&gt;start_response&lt;/code&gt;. O
primeiro é responsável por informar quais as variáveis ambientais que
temos à nossa disposição. O segundo, nomeado como &lt;code class=&quot;language-text&quot;&gt;start_response&lt;/code&gt;, é
na verdade uma função de &lt;em&gt;callback&lt;/em&gt; onde informamos o &lt;em&gt;status code&lt;/em&gt; e
demais cabeçalhos para resposta.&lt;/p&gt;
&lt;p&gt;Por fim, retornamos ao servidor &lt;em&gt;web&lt;/em&gt; o nosso &lt;a href=&quot;/tag/html.html&quot; title=&quot;Leia mais sobre HTML&quot;&gt;&lt;em&gt;HTML&lt;/em&gt;&lt;/a&gt;. O servidor
&lt;em&gt;web&lt;/em&gt; pode “iterar” sobre a aplicação, retornando conteúdo ao usuário
conforme a aplicação for retornando conteúdo para ele. Neste caso,
utilizamos na resposta um tipo &lt;a href=&quot;http://docs.python.org/2/library/stdtypes.html#sequence-types-str-unicode-list-tuple-bytearray-buffer-xrange&quot; title=&quot;Leia sobre tipos sequenciais no Python&quot;&gt;sequencial&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Agora somos capazes de servir a aplicação através de &lt;em&gt;CGI&lt;/em&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; wsgiref&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;handlers &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; CGIHandler

CGIHandler&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;application&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;E até mesmo &lt;em&gt;FastCGI&lt;/em&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; flup&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;server&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;fcgi &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; WSGIServer

WSGIServer&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;application&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;A biblioteca &lt;a href=&quot;http://docs.python.org/2/library/wsgiref.html&quot; title=&quot;Saiba mais direto da documentação do Python&quot;&gt;&lt;em&gt;wsgiref&lt;/em&gt;&lt;/a&gt; implementa as especificações do &lt;em&gt;WSGI&lt;/em&gt; e
provê ferramentas para a comunicação entre servidores e aplicações. No
segundo exemplo utilizamos a &lt;a href=&quot;http://trac.saddi.com/flup&quot; title=&quot;Saiba mais sobre&quot;&gt;&lt;em&gt;flup&lt;/em&gt;&lt;/a&gt;, uma biblioteca com algumas
soluções &lt;em&gt;WSGI&lt;/em&gt;, incluindo a possibilidade de servir aplicações
&lt;em&gt;FastCGI&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Com esse “código de cola”, basta &lt;a href=&quot;http://docs.python.org/2/howto/webservers.html&quot; title=&quot;HOWTO Use Python in the web&quot;&gt;configurar o seu servidor &lt;em&gt;Web&lt;/em&gt;&lt;/a&gt;
favorito para servir a sua aplicação.&lt;/p&gt;
&lt;h3&gt;mod_wsgi&lt;/h3&gt;
&lt;p&gt;Uma vez construída a interface para a sua aplicação através do padrão
&lt;em&gt;WSGI&lt;/em&gt;, você pode serví-la em um servidor &lt;em&gt;Apache&lt;/em&gt; através do
&lt;a href=&quot;http://code.google.com/p/modwsgi/&quot; title=&quot;Página do módulo no Google Code&quot;&gt;mod_wsgi&lt;/a&gt;. Existem soluções equivalentes para outros servidores,
como por exemplo, no &lt;a href=&quot;http://klauslaube.com.br/tags/nginx/&quot; title=&quot;Leia mais sobre Nginx&quot;&gt;&lt;em&gt;Nginx&lt;/em&gt;&lt;/a&gt; temos o &lt;a href=&quot;http://wiki.nginx.org/NgxWSGIModule&quot; title=&quot;Veja mais na documentação do Nginx&quot;&gt;&lt;em&gt;NgxWSGIModule&lt;/em&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Com o &lt;em&gt;mod&lt;/em&gt;wsgi&lt;em&gt;, você não precisa de nenhum “código de cola” (como
apresentado nos exemplos de _CGI&lt;/em&gt; e &lt;em&gt;FastCGI&lt;/em&gt;), basta &lt;a href=&quot;http://code.google.com/p/modwsgi/wiki/QuickConfigurationGuide&quot; title=&quot;Veja instruções para configurar o Apache com mod_wsgi&quot;&gt;configurar o seu &lt;em&gt;Apache&lt;/em&gt;&lt;/a&gt;
e apontar o seu script &lt;em&gt;WSGI&lt;/em&gt; através da instrução &lt;code class=&quot;language-text&quot;&gt;WSGIScriptAlias&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;lt;VirtualHost *:80&gt;

    ServerName www.example.com
    ServerAlias example.com
    ServerAdmin webmaster@example.com

    DocumentRoot /usr/local/www/documents

    Alias /robots.txt /usr/local/www/documents/robots.txt
    Alias /favicon.ico /usr/local/www/documents/favicon.ico

    Alias /media/ /usr/local/www/documents/media/

    &amp;lt;Directory /usr/local/www/documents&gt;
    Order allow,deny
    Allow from all
    &amp;lt;/Directory&gt;

    WSGIScriptAlias / /usr/local/www/wsgi-scripts/wsgi.py

    &amp;lt;Directory /usr/local/www/wsgi-scripts&gt;
    Order allow,deny
    Allow from all
    &amp;lt;/Directory&gt;

&amp;lt;/VirtualHost&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Uma particularidade do mod_wsgi é a escolha de execução no modo
&lt;code class=&quot;language-text&quot;&gt;daemon&lt;/code&gt;, que opera de uma forma &lt;a href=&quot;http://code.google.com/p/modwsgi/#Server_Performance&quot; title=&quot;Leia mais sobre performance com mod_wsgi&quot;&gt;similar ao esquema utilizado pelo
&lt;em&gt;FastCGI&lt;/em&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;Servidores WSGI&lt;/h3&gt;
&lt;p&gt;Você pode utilizar servidores especialmente escritos para servir as suas
aplicações &lt;em&gt;WSGI&lt;/em&gt;, como por exemplo o &lt;a href=&quot;http://gunicorn.org/&quot; title=&quot;Veja mais sobre este servidor WSGI&quot;&gt;&lt;em&gt;Gunicorn&lt;/em&gt;&lt;/a&gt;, o &lt;a href=&quot;http://projects.unbit.it/uwsgi/&quot; title=&quot;Um rápido servidor WSGI escrito em C&quot;&gt;&lt;em&gt;uWSGI&lt;/em&gt;&lt;/a&gt; ou
até mesmo o &lt;a href=&quot;http://www.tornadoweb.org/documentation/wsgi.html&quot; title=&quot;Saiba mais sobre o suporte do Tornado ao WSGI&quot;&gt;&lt;em&gt;Tornado&lt;/em&gt;&lt;/a&gt;. Além da versatilidade e performance, a
facilidade é outra característica marcante em muitas dessas ferramentas:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ gunicorn -w 4 -b 127.0.0.1:5000 wsgi:application&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;No exemplo acima, levantamos o &lt;em&gt;Gunicorn&lt;/em&gt; na &lt;code class=&quot;language-text&quot;&gt;porta 5000&lt;/code&gt;, e
reservamos &lt;code class=&quot;language-text&quot;&gt;4 workers&lt;/code&gt; para servir a nossa aplicação.&lt;/p&gt;
&lt;p&gt;Além de diminuirmos a carga do servidor &lt;em&gt;web&lt;/em&gt;, e ganharmos um controle
mais apurado de memória e processos, ganhamos também o uso de &lt;em&gt;workers&lt;/em&gt;.
Por exemplo, o &lt;em&gt;Gunicorn&lt;/em&gt; trabalha com &lt;em&gt;pre-fork&lt;/em&gt; de &lt;em&gt;workers&lt;/em&gt;, onde um
processo “master” gerencia um conjunto de processos que são de fato os
responsáveis por servir a sua aplicação. Ganhamos mais uma ferramenta de
baixo custo para lidar com concorrência.&lt;/p&gt;
&lt;p&gt;Servidores &lt;em&gt;WSGI&lt;/em&gt; conseguem servir as aplicações sem o auxílio de um
&lt;em&gt;Apache&lt;/em&gt; ou &lt;em&gt;Nginx&lt;/em&gt;, mas uma prática muito comum hoje em dia é, “na
frente” de um &lt;em&gt;Gunicorn&lt;/em&gt; (por exemplo), termos um &lt;em&gt;Nginx&lt;/em&gt; servindo
estáticos, fazendo &lt;em&gt;caching&lt;/em&gt; e “aguentando porrada”, enquanto que o
servidor &lt;em&gt;WSGI&lt;/em&gt; está totalmente focado em servir o conteúdo dinâmico. O
servidor &lt;em&gt;web&lt;/em&gt; acaba fazendo uma espécie de &lt;a href=&quot;http://pt.wikipedia.org/wiki/Proxy_reverso&quot; title=&quot;Leia mais sobre Proxy Reverso na Wikipedia&quot;&gt;&lt;em&gt;proxy&lt;/em&gt; reverso&lt;/a&gt; e até
mesmo servindo como &lt;a href=&quot;http://wiki.nginx.org/LoadBalanceExample&quot; title=&quot;Veja exemplo de uso do Nginx como balanceador&quot;&gt;balanceador&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;A comunicação entre servidores pode ser feita via &lt;em&gt;TCP&lt;/em&gt; ou &lt;em&gt;socket&lt;/em&gt;.
Isso nos dá uma série de vantagens, que vão desde a facilidade em
&lt;a href=&quot;http://docs.gunicorn.org/en/latest/design.html#how-many-workers&quot; title=&quot;Veja como utilizar workers com Gunicorn&quot;&gt;escalar&lt;/a&gt; e distribuir, até o &lt;em&gt;restart&lt;/em&gt; individual de serviços (por
exemplo, se a sua aplicação travar, você pode reiniciar apenas o
servidor &lt;em&gt;WSGI&lt;/em&gt; e não perder o &lt;em&gt;caching&lt;/em&gt; do servidor &lt;em&gt;web&lt;/em&gt;).&lt;/p&gt;
&lt;p&gt;Um exemplo muito interessante de uso de servidores &lt;em&gt;WSGI&lt;/em&gt; é fazendo
&lt;a href=&quot;https://devcenter.heroku.com/articles/python#using-a-different-wsgi-server&quot; title=&quot;Using a different WSGI server - Heroku&quot;&gt;&lt;em&gt;deploy&lt;/em&gt; de aplicações &lt;em&gt;Python&lt;/em&gt; para o &lt;em&gt;Heroku&lt;/em&gt;&lt;/a&gt;. Configurar um
servidor &lt;a href=&quot;http://mirobetm.blogspot.com.br/2012/03/ive-been-lighttpd-fastcgi-django-user.html&quot; title=&quot;Gunicorn + Nginx - a much better way to deploy your Django website&quot;&gt;&lt;em&gt;Nginx&lt;/em&gt; para se comunicar com servidores &lt;em&gt;WSGI&lt;/em&gt;&lt;/a&gt; também é
relativamente simples.&lt;/p&gt;
&lt;h2&gt;Considerações finais&lt;/h2&gt;
&lt;p&gt;Um assunto muito interessante e que pretendo explorar mais aqui no
&lt;em&gt;blog&lt;/em&gt;, principalmente em relação a processos e &lt;em&gt;workers&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Servir aplicações &lt;em&gt;Python&lt;/em&gt; para a &lt;em&gt;web&lt;/em&gt; é algo relativamente simples,
limpo e elegante. Através do &lt;em&gt;WSGI&lt;/em&gt;, escalar aplicações passou a ser
algo quase trivial, que demanda pouco esforço. Combiná-los com o &lt;em&gt;Nginx&lt;/em&gt;
dão mais fôlego a sua aplicação (principalmente se estivermos falando do
&lt;em&gt;uWSGI&lt;/em&gt; ou &lt;a href=&quot;http://www.gevent.org/gevent.wsgi.html&quot; title=&quot;Servindo aplicações WSGI com gevent&quot;&gt;&lt;em&gt;gevent&lt;/em&gt;&lt;/a&gt;), e com um &lt;a href=&quot;http://puppetlabs.com/&quot; title=&quot;IT Automation Software for System Administrators&quot;&gt;sistema de provisionamento automático&lt;/a&gt;
podem facilitar e muito o seu trabalho de infraestrutura quando o consumo se tornar um problema.&lt;/p&gt;
&lt;h2&gt;Referências&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://docs.djangoproject.com/en/dev/howto/deployment/fastcgi/&quot; title=&quot;Exemplo de uso do Django com FastCGI&quot;&gt;&lt;em&gt;Django Documentation – How to use Django with FastCGI, SCGI, or AJP&lt;/em&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.nongnu.org/fastcgi/&quot; title=&quot;Material muito interessante sobre o protocolo FastCGI e seu uso com C++&quot;&gt;&lt;em&gt;FastCGI – The Forgotten Treasure&lt;/em&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.fastcgi.com/drupal/node/6?q=node/15&quot; title=&quot;Um documento bem objetivo, detalhando os diferenciais em usar o FastCGI&quot;&gt;&lt;em&gt;FastCGI – A High-Performance Web Server Interface&lt;/em&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://gunicorn.org/&quot; title=&quot;Conheça o Gunicorn e descubra as vatangens de possuir um servidor WSGI&quot;&gt;&lt;em&gt;Gunicorn – Python WSGI HTTP Server for Unix&lt;/em&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.irt.org/articles/js172/&quot; title=&quot;Artigo de 1999 detalhando algumas características do CGI e do FastCGI&quot;&gt;&lt;em&gt;irt.org – Speed Thrills: CGI Please... and Fast!&lt;/em&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.jmarshall.com/easy/cgi/portuguese/&quot; title=&quot;Bom artigo, resumindo muito bem o funcionamento do CGI&quot;&gt;&lt;em&gt;James Marshal&lt;/em&gt; – &lt;em&gt;CGI&lt;/em&gt; realmente fácil&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://code.google.com/p/modwsgi/&quot; title=&quot;Veja a página oficial do projeto&quot;&gt;&lt;em&gt;modwsgi – Python WSGI adapter module for Apache&lt;/em&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.python.org/dev/peps/pep-0333/&quot; title=&quot;Leia a especificação direto do portal da linguagem Python&quot;&gt;&lt;em&gt;PEP 333 – Python Web Server Gateway Interface&lt;/em&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://docs.python.org/howto/webservers.html&quot; title=&quot;Compreenda a diferença do uso do Python com CGI, FastCGI, mod_python, mod_wsgi e servidores WSGI&quot;&gt;&lt;em&gt;Python Documentation – HOWTO Use Python in the web&lt;/em&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.w3.org/CGI/&quot; title=&quot;Leia mais sobre a especificação do CGI&quot;&gt;&lt;em&gt;W3C – Common Gateway Interface&lt;/em&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://en.wikipedia.org/wiki/Common_Gateway_Interface&quot; title=&quot;Leia mais no artigo da Wikipedia&quot;&gt;&lt;em&gt;Wikipedia – Common Gateway Interface&lt;/em&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://en.wikipedia.org/wiki/FastCGI&quot; title=&quot;Leia mais no artigo da Wikipedia&quot;&gt;&lt;em&gt;Wikipedia – FastCGI&lt;/em&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://en.wikipedia.org/wiki/Web_Server_Gateway_Interface&quot; title=&quot;Leia mais no artigo da Wikipedia&quot;&gt;&lt;em&gt;Wikipedia – Web Server Gateway Interface&lt;/em&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.xml.com/pub/a/2006/09/27/introducing-wsgi-pythons-secret-web-weapon.html&quot; title=&quot;Artigo de 2006 explicando os principais benefícios do uso do WSGI&quot;&gt;&lt;em&gt;XML.com – Introducing WSGI: Python’s Secret Web Weapon&lt;/em&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item></channel></rss>