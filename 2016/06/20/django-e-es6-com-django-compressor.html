<!DOCTYPE html><html lang=pt-br> <head><meta charset=utf-8><title>Django e ES6 com django-compressor | Klaus Laube</title><meta name=author content="Klaus Peter Laube"><meta name=description content="Vamos falar sobre como utilizar o Django e o django-compressor para transpilar scripts ES6 em ES5, com ajuda do Node.js e Babelify."><meta name=robots content=index,follow><meta property=og:site_name content="Klaus Laube"><meta property=og:type content=website><meta name=keywords content="desenvolvimento, web, python, django, es6, javascript, babel, browserify"><meta property=og:title content="Django e ES6 com django-compressor"><meta property=og:description content="Vamos falar sobre como utilizar o Django e o django-compressor para transpilar scripts ES6 em ES5, com ajuda do Node.js e Babelify."><meta property=og:url content=https://klauslaube.com.br/2016/06/20/django-e-es6-com-django-compressor.html><meta property=og:image content=https://klauslaube.com.br//images/blog/django-babel-auf-wiedersehen.png><meta property=fb:app_id content=262757647133878><meta name=google-site-verification content=xCq0H3B3JhkPcAdZ03J0vayijvH_g1rQVMZ_DVcMsQY><meta name=viewport content="width=device-width, initial-scale=1.0"><link rel=icon type=image/x-icon href=https://klauslaube.com.br/favicon.ico><link rel=alternate type=application/rss+xml title="Klaus Laube » Feed" href=https://klauslaube.com.br/feed/rss.xml><link rel=canonical href=https://klauslaube.com.br/2016/06/20/django-e-es6-com-django-compressor.html><link rel=stylesheet href=https://unpkg.com/purecss@1.0.0/build/pure-min.css integrity=sha384-nn4HPE8lTHyVtfCBi5yW9d20FjT8BJwUXyWZT9InLYax14RDjBj46LmSztkmNP9w crossorigin=anonymous><link rel=stylesheet href=https://klauslaube.com.br/theme/css/styles.min.css?0830b1e2></head> <body> <div class="Page pure-g is-fullEntry"> <div class="PageHeader pure-u-1"> <nav class="pure-menu pure-menu-open pure-menu-horizontal"> <a href=https://klauslaube.com.br/index.html title="Home page" class="PageHeader-link pure-menu-heading pure-menu-link">Klaus<span class=u-highlighted>Laube</a> <ul class="PageHeader-menu pure-menu-list"> <li class=pure-menu-item> <a href=https://about.me/klauslaube class="PageHeader-menu-link pure-menu-link">Contato</a> </li> </ul> </nav> </div> <div class="PageContent pure-u-1"> <article class="Article u-box" itemscope itemtype=http://schema.org/BlogPosting> <div itemprop=image itemscope itemtype=http://schema.org/ImageObject> <meta itemprop=url content=https://klauslaube.com.br//images/blog/django-babel-auf-wiedersehen.png> </div> <span itemprop=mainEntityOfPage> <header> <h1 class=Article-title itemprop="headline name"> Django e ES6 com django-compressor </h1> <p class=Article-meta> Por <span class=Article-author itemprop=author>Klaus Peter Laube</span>. <span class=Article-pubDate> Publicado em <time datetime=2016-06-20T23:04:00-03:00 itemprop=datePublished>20 Jun, 2016</time> </span> </p> </header> <div class=Article-content itemprop=articleBody> <img src=/images/blog/django-js-logo.png alt="Logo do Django e Javascript" class=representative-image width=180 height=180> <p>No <a href=https://klauslaube.com.br/2016/06/04/django-e-sass-com-django-compressor.html title="Django e Sass com django-compressor"><em>post</em> anterior</a>, falamos sobre como utilizar o <a href=https://klauslaube.com.br/tag/sass.html title="Leia mais sobre Sass"><em>Sass</em></a> com o <em>framework</em> <a href=https://klauslaube.com.br/tag/django.html title="Leia mais sobre Django"><em>Django</em></a> através da biblioteca <em>Compressor</em> (e sem necessitar de uma ferramenta intermediária para <em>build</em>). Nesse artigo, vamos utilizar o mesmo conceito e apresentar uma forma diferente de utilizar a nova versão do <a href=https://klauslaube.com.br/tag/javascript.html title="Leia mais sobre Javascript"><em>Javascript</em></a> com o <code>django-compressor</code>.</p> <!-- PELICAN_END_SUMMARY --> <h2>Instalando e configurando o Compressor</h2> <p>Vamos recaptular o processo de instalação do <code>django-compressor</code>:</p> <div class=highlight><pre><span></span>$ pip install django-compressor
</pre></div> <p>Não podemos esquecer de adicionar a <em>app</em> ao <code>INSTALLED_APPS</code>:</p> <div class=highlight><pre><span></span><span class=c1># settings.py</span>
<span class=n>INSTALLED_APPS</span> <span class=o>=</span> <span class=p>(</span>
    <span class=o>...</span>
    <span class=s1>&#39;compressor&#39;</span><span class=p>,</span>
    <span class=o>...</span>
<span class=p>)</span>
</pre></div> <p>E para finalizar, precisamos fazer os estáticos serem "encontráveis":</p> <div class=highlight><pre><span></span><span class=c1># settings.py</span>
<span class=n>STATICFILES_FINDERS</span> <span class=o>=</span> <span class=p>(</span>
    <span class=s1>&#39;django.contrib.staticfiles.finders.FileSystemFinder&#39;</span><span class=p>,</span>
    <span class=s1>&#39;django.contrib.staticfiles.finders.AppDirectoriesFinder&#39;</span><span class=p>,</span>
    <span class=o>...</span>
    <span class=s1>&#39;compressor.finders.CompressorFinder&#39;</span><span class=p>,</span>
<span class=p>)</span>
</pre></div> <p>Para simplificar o nosso exemplo, vou reaproveitar o cenário criado no <em>post</em> anterior:</p> <div class=highlight><pre><span></span><span class=c>&lt;!-- index.html --&gt;</span>

{% load compress %}
{% load staticfiles %}

{% compress js %}
    <span class=nt>&lt;script</span> <span class=na>src=</span><span class=s>&quot;{% static &#39;vendor/jquery/jquery.js&#39; %}&quot;</span><span class=nt>&gt;&lt;/script&gt;</span>
    <span class=nt>&lt;script</span> <span class=na>src=</span><span class=s>&quot;{% static &#39;js/app.js&#39; %}&quot;</span><span class=nt>&gt;&lt;/script&gt;</span>
{% endcompress %}
</pre></div> <p>Imagine que o nosso arquivo <code>js/app.js</code> é um <em>Javascript</em>, mas escrito seguindo as especificações do <a href=https://klauslaube.com.br/tag/es6.html title="Leia mais sobre ES6"><em>ES6</em></a>. Podendo ser algo semelhante ao exemplo abaixo:</p> <div class=highlight><pre><span></span><span class=kr>import</span> <span class=p>{</span><span class=nx>createStore</span><span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;redux&#39;</span>

<span class=kr>import</span> <span class=nx>rootReducer</span> <span class=nx>from</span> <span class=s1>&#39;./reducers&#39;</span>
<span class=kr>import</span> <span class=nx>App</span> <span class=nx>from</span> <span class=s1>&#39;./components/app&#39;</span>

<span class=kd>let</span> <span class=nx>store</span> <span class=o>=</span> <span class=nx>createStore</span><span class=p>(</span><span class=nx>rootReducer</span><span class=p>)</span>
<span class=nx>store</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>app</span><span class=p>.</span><span class=nx>subscriber</span><span class=p>)</span>
</pre></div> <p>O bloco de <code>{% compress js %}</code> será responsável por minificar e concatenar os nossos <em>scripts</em>. Se executarmos o comando <code>manage.py compress</code>, provavelmente não teremos nenhum problema, e o <a href=https://klauslaube.com.br/tag/html.html title="Leia mais sobre HTML"><em>HTML</em></a> de resposta será algo parecido com isso:</p> <div class=highlight><pre><span></span><span class=c>&lt;!-- index.html --&gt;</span>
<span class=nt>&lt;script</span> <span class=na>type=</span><span class=s>&quot;text/javascript&quot;</span> <span class=na>src=</span><span class=s>&quot;/static/CACHE/js/3ffb288f8747.js&quot;</span><span class=nt>&gt;&lt;/script&gt;</span>
</pre></div> <p>Mas o <em>ES6</em> ainda não é amplamente suportado pelos navegadores... logo, teremos que usar "transpiladores" para que o código seja traduzido em algo "entendível" pelos <em>browsers</em>.</p> <h2>Hello NPM my old friend</h2> <p>Eu sinceramente desconheço uma ferramenta que faça <a href=https://www.stevefenton.co.uk/2012/11/compiling-vs-transpiling/ title="Compiling vs Transpiling"><em>transpiling</em></a> de <em>ES6</em> para <em>ES5</em> melhor que o <a href=https://babeljs.io/ title="Use next generation JavaScript, today"><em>Babel</em></a>.</p> <p>E embora a gente "torça o nariz" para a necessidade de adicionar <a href=https://klauslaube.com.br/tag/node.html title="Leia mais sobre Node"><em>Node.js</em></a> à nossa <em>stack</em> <a href=https://klauslaube.com.br/tag/python.html title="Leia mais sobre Python"><em>Python</em></a>, o uso do <em>Babel</em> nessas condições faz certo sentido. Primeiro, por nos permitir escrever <em>Javascript</em> numa versão mais prática, legível e divertida. Segundo, que com o auxílio do <a href=http://browserify.org/ title="Browserify lets you require modules in the browser"><em>Browserify</em></a> (por exemplo), podemos deixar a resolução de <em>path</em> do <em>JS</em> nas mãos da tríade <em>NPM/Browserify/Babel</em> (ou você achou que aquele <code>import 'redux'</code> veio de graça?).</p> <p>Isso nos permite escrever <em>Javascript</em> modular, utilizando recursos que já são <em>built-in</em> (na especificação) da linguagem, sem necessariamente nos preocuparmos em como resolveremos as questões de importação (como por exemplo, se usaremos <a href=http://requirejs.org/ title="RequireJS is a JavaScript file and module loader"><em>RequireJS</em></a> ou <a href=https://github.com/cujojs/curl title="curl.js is small, fast, extensible module loader"><em>curl.js</em></a>) e deixamos toda essa responsabilidade nas mãos da ferramenta de <em>bundling</em> de sua escolha.</p> <p><img class=align-center src=/images/blog/django-babel-auf-wiedersehen.png width=620 height=258 title="Django + Babel é como dar um Auf Wiedersehen para o ES5 (fallsdownz.blogspot.com.br)" alt="Django + Babel é como dar um Auf Wiedersehen para o ES5 (fallsdownz.blogspot.com.br)"></p> <p>Sem mais delongas, vamos instalar as dependências que precisaremos para o nosso exemplo:</p> <div class=highlight><pre><span></span>npm install --save-dev babelify babel-preset-es2015 redux
</pre></div> <p>Dos pacotes acima, os mais fundamentais são:</p> <ul> <li><code>babelify</code>: Um <a href=http://babeljs.io/docs/plugins/#transform title="Babel plugins"><em>transform</em></a> de <em>Babel</em> para o <em>Browserify</em>;</li> <li><code>babel-preset-es2015</code>: Um <em>preset</em> com um apanhado de <em>plugins</em> necessários para compilar <em>ES2015</em> para <em>ES5</em>;</li> </ul> <p>O pacote <code>redux</code> é apenas uma dependência utilizada pelo exemplo, e não influencia diretamente no processo de <em>build</em>.</p> <p>Para facilitar a comunicação entre o <em>Django</em> e o <em>Babel</em>, vamos criar um arquivo de configuração <code>.babelrc</code>, na raíz do nosso projeto, com a seguinte configuração:</p> <div class=highlight><pre><span></span><span class=p>{</span>
  <span class=nt>&quot;presets&quot;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&quot;es2015&quot;</span><span class=p>]</span>
<span class=p>}</span>
</pre></div> <p>Voltamos ao <em>Django</em>, para terminar de configurar o nosso projeto.</p> <h2>Back to the Django</h2> <p>Como no exemplo do <em>post</em> anterior, vamos utilizar a capacidade de setarmos compiladores/transpiladores, no <code>django-compressor</code>, e passaremos a interpretar os arquivos <em>Javascript</em> utilizando o <em>Babel</em>:</p> <div class=highlight><pre><span></span><span class=c1># settings.py</span>
<span class=n>COMPRESS_PRECOMPILERS</span> <span class=o>=</span> <span class=p>(</span>
    <span class=p>(</span><span class=s1>&#39;text/es6&#39;</span><span class=p>,</span> <span class=s1>&#39;./node_modules/.bin/browserify {infile} -t babelify --outfile {outfile}&#39;</span><span class=p>),</span>
<span class=p>)</span>
</pre></div> <p>O <em>path</em> <code>./node_modules/.bin/browserify</code> é onde está o binário após ser instalado via <code>npm</code>. Os parâmetros <code>infile</code> e <code>outfile</code> dizem respeito ao arquivo de entrada e de saída, respectivamente.</p> <p>Agora basta voltarmos ao nosso <em>template</em>, e adicionarmos o atributo <code>type="text/es6</code> à nossa <em>tag</em> <code>&lt;script&gt;</code>:</p> <div class=highlight><pre><span></span><span class=c>&lt;!-- index.html --&gt;</span>

{% load compress %}
{% load staticfiles %}

{% compress js %}
    <span class=nt>&lt;script</span> <span class=na>src=</span><span class=s>&quot;{% static &#39;vendor/jquery/jquery.js&#39; %}&quot;</span><span class=nt>&gt;&lt;/script&gt;</span>
    <span class=nt>&lt;script</span> <span class=na>src=</span><span class=s>&quot;{% static &#39;js/app.js&#39; %}&quot;</span> <span class=na>type=</span><span class=s>&quot;text/es6&quot;</span><span class=nt>&gt;&lt;/script&gt;</span>
{% endcompress %}
</pre></div> <p>Pronto! Agora é só ver o resultado através do comando <code>python manage.py compress</code>.</p> <h2>Considerações finais</h2> <p>Tratando-se de uma aplicação em produção, onde é recomendado utilizar o <code>django-compressor</code> com <a href=http://django-compressor.readthedocs.io/en/latest/scenarios/#offline-compression title="Offline compression"><em>offline compression</em></a>, a adição do <em>Browserify</em> não impactará no tempo de resposta do seu servidor. No entanto, é certo que o servidor local, levantado através do <code>manage.py runserver</code>, leve um tempo maior para responder depois dessa adição.</p> <p>Na dúvida, não custa testar...</p> <p>Inicie utilizando o <em>Django</em> com <em>Compressor</em>. A partir do momento onde os tempos de resposta tornem-se muito altos, opte por uma ferramenta que <a href=https://klauslaube.com.br/2016/02/22/vivendo-sem-o-grunt.html title="Vivendo sem o Grunt">execute o <em>build</em> em paralelo</a>.</p> <p>Até a próxima!</p> <h2>Referências</h2> <ul> <li><a href=https://github.com/babel/babelify><em>Babelify - Browserify transform for Babel</em></a></li> <li><a href=https://django-compressor.readthedocs.io/en/latest/ ><em>Django Compressor - Compresses linked and inline JavaScript or CSS into a single cached file</em></a></li> </ul> </div> </span> <div class=Article-tags> <span class=Article-tagLabel>Tags:</span> <span itemprop=keywords> <a href=https://klauslaube.com.br/tag/desenvolvimento.html title="Leia mais sobre" class=Article-tagLink>desenvolvimento</a> <a href=https://klauslaube.com.br/tag/web.html title="Leia mais sobre" class=Article-tagLink>web</a> <a href=https://klauslaube.com.br/tag/python.html title="Leia mais sobre" class=Article-tagLink>python</a> <a href=https://klauslaube.com.br/tag/django.html title="Leia mais sobre" class=Article-tagLink>django</a> <a href=https://klauslaube.com.br/tag/es6.html title="Leia mais sobre" class=Article-tagLink>es6</a> <a href=https://klauslaube.com.br/tag/javascript.html title="Leia mais sobre" class=Article-tagLink>javascript</a> <a href=https://klauslaube.com.br/tag/babel.html title="Leia mais sobre" class=Article-tagLink>babel</a> <a href=https://klauslaube.com.br/tag/browserify.html title="Leia mais sobre" class=Article-tagLink>browserify</a> </span> </div> <div class=Article-comments> <div id=disqus_thread></div> <script type=text/javascript>
        var disqus_shortname = "klauslaube";
        var disqus_identifier = "2016/06/20/django-e-es6-com-django-compressor.html";

        (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script> <noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript rel=nofollow>comments powered by Disqus.</a></noscript> </div> </article> </div> <footer class="PageFooter pure-u-1"> <div class=u-box> <p>O conteúdo deste blog está sob a licença <a class=PageFooter-link href=http://creativecommons.org/licenses/by/3.0/deed.pt_BR title="Distribua, adapte, use. Mas mencione o autor." rel=nofollow>Creative Commons Attribution 3.0</a>.</p> <p>O código está disponível em <a class=PageFooter-link href=https://github.com/kplaube/blog/ title=Contribute! rel=nofollow>GitHub</a>.</p> </div> </footer> </div> <script>
        (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
        function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
        e=o.createElement(i);r=o.getElementsByTagName(i)[0];
        e.src='//www.google-analytics.com/analytics.js';
        r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
        ga('create','UA-19657400-1');ga('send','pageview');
    </script> </body> </html>