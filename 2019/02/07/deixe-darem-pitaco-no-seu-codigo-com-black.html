<!DOCTYPE html><html lang=pt-br> <head><meta charset=utf-8><title>Deixe darem pitaco no seu c√≥digo com Black | Klaus Laube</title><meta name=author content="Klaus Peter Laube"><meta name=description content="J√° abordamos code formatters aqui no blog. Para Javascript temos o Prettier como solu√ß√£o mais famosa, e h√° de se reconhecer a s√©rie de vantagens no uso da..."><meta name=robots content=index,follow><meta property=og:site_name content="Klaus Laube"><meta property=og:type content=website><meta name=keywords content="desenvolvimento, formatters, editores, black, python, vscode, vim"><meta property=og:title content="Deixe darem pitaco no seu c√≥digo com Black"><meta property=og:description content="J√° abordamos code formatters aqui no blog. Para Javascript temos o Prettier como solu√ß√£o mais famosa, e h√° de se reconhecer a s√©rie de vantagens no uso da..."><meta property=og:url content=https://klauslaube.com.br/2019/02/07/deixe-darem-pitaco-no-seu-codigo-com-black.html><meta property=og:image content=https://klauslaube.com.br//images/blog/black-walter.jpg><meta property=fb:app_id content=262757647133878><meta name=google-site-verification content=xCq0H3B3JhkPcAdZ03J0vayijvH_g1rQVMZ_DVcMsQY><meta name=viewport content="width=device-width, initial-scale=1.0"><link rel=icon type=image/x-icon href=https://klauslaube.com.br/favicon.ico><link rel=alternate type=application/rss+xml title="Klaus Laube ¬ª Feed" href=https://klauslaube.com.br/feed/rss.xml><link rel=canonical href=https://klauslaube.com.br/2019/02/07/deixe-darem-pitaco-no-seu-codigo-com-black.html><link rel=stylesheet href=https://unpkg.com/purecss@1.0.0/build/pure-min.css integrity=sha384-nn4HPE8lTHyVtfCBi5yW9d20FjT8BJwUXyWZT9InLYax14RDjBj46LmSztkmNP9w crossorigin=anonymous><link rel=stylesheet href=https://klauslaube.com.br/theme/css/styles.min.css?0830b1e2></head> <body> <div class="Page pure-g is-fullEntry"> <div class="PageHeader pure-u-1"> <nav class="pure-menu pure-menu-open pure-menu-horizontal"> <a href=https://klauslaube.com.br/index.html title="Home page" class="PageHeader-link pure-menu-heading pure-menu-link">Klaus<span class=u-highlighted>Laube</a> <ul class="PageHeader-menu pure-menu-list"> <li class=pure-menu-item> <a href=https://about.me/klauslaube class="PageHeader-menu-link pure-menu-link">Contato</a> </li> </ul> </nav> </div> <div class="PageContent pure-u-1"> <article class="Article u-box" itemscope itemtype=http://schema.org/BlogPosting> <div itemprop=image itemscope itemtype=http://schema.org/ImageObject> <meta itemprop=url content=https://klauslaube.com.br//images/blog/black-walter.jpg> </div> <span itemprop=mainEntityOfPage> <header> <h1 class=Article-title itemprop="headline name"> Deixe darem pitaco no seu c√≥digo com Black </h1> <p class=Article-meta> Por <span class=Article-author itemprop=author>Klaus Peter Laube</span>. <span class=Article-pubDate> Publicado em <time datetime=2019-02-07T14:20:00-02:00 itemprop=datePublished>07 Fev, 2019</time> </span> </p> </header> <div class=Article-content itemprop=articleBody> <img src=/images/blog/black-logo.png alt="Logo do Black" class=representative-image width=180 height=180> <p>J√° abordamos <a href=https://klauslaube.com.br/tag/formatters.html title="Leia mais sobre formatters"><em>code formatters</em></a> aqui no <em>blog</em>. Para <a href=https://klauslaube.com.br/tag/javascript.html title="Leia mais sobre Javascript"><em>Javascript</em></a> temos o <a href=https://klauslaube.com.br/2019/01/12/deixe-darem-pitaco-no-seu-codigo-com-prettier.html title="Deixe darem pitaco no seu c√≥digo com Prettier"><em>Prettier</em></a> como solu√ß√£o mais famosa, e h√° de se reconhecer a s√©rie de vantagens no uso da mesma. Acontece que para <a href=https://klauslaube.com.br/tag/python.html title="Leia mais sobre Python"><em>Python</em></a> temos algumas ferramentas t√£o interessantes quanto, como o <em>autopep8</em>, <em>yapf</em> e o <em>Black</em>.</p> <!-- PELICAN_END_SUMMARY --> <p>E √© sobre o √∫ltimo que falaremos nesse <em>post</em>.</p> <p>Se voc√™ est√° interessado em um comparativo, <em>Kevin Peters</em> escreveu um artigo bem interessante para o <em>Medium</em> chamado <a href=https://medium.com/3yourmind/auto-formatters-for-python-8925065f9505 title="Leia o artigo na √≠ntegra">"Auto formatters for Python"</a>.</p> <h2>Al√©m do PEP 8</h2> <p>A motiva√ß√£o para usar o <em>Black</em> √© a mesma descrita no <em>post</em> sobre <em>Prettier</em>: Reduzir tempo discutindo <em>code style</em>, e deixar com que uma ferramenta tome essa decis√£o pelo time.</p> <p>Em <em>Python</em>, o caminho para chegarmos a um consenso √© relativamente menor. Uma das primeiras coisas que aprendi ao iniciar a minha jornada programando com a linguagem foi seguir a <a href=https://www.python.org/dev/peps/pep-0008/ title="Style Guide for Python Code"><em>PEP 8</em></a> religiosamente. Nela est√£o descritas as conven√ß√µes de c√≥digo adotadas oficialmente, como linhas em branco, indenta√ß√£o, nomes, coment√°rios, etc. Qual o motivo de perder tempo pensando em um <em>style guide</em> para o seu projeto se isso j√° foi discutido e formalizado pela comunidade?</p> <p>Ferramentas de <em>linting</em> como <a href=https://github.com/PyCQA/pycodestyle title="Simple Python style checker in one Python file"><em>pycodestyle</em></a> e <a href=https://github.com/PyCQA/flake8 title="Flake8 is a wrapper around PyFlakes, pycodestyle and McCabe"><em>flake8</em></a> s√£o essenciais e muito comuns. S√£o elas que ir√£o te alertar sobre poss√≠veis quebras de estilo de c√≥digo.</p> <p>Mas com o <em>Black</em> vamos al√©m...</p> <h2>Formatador descompromissado</h2> <p>O <em>Black</em> √© um <em>code formatter</em> para <em>Python</em>, de c√≥digo aberto (<a href=https://github.com/ambv/black/blob/master/LICENSE title="The MIT License"><em>MIT</em></a>), que tem por lema tornar a formata√ß√£o "transparente", para que voc√™ possa focar no conte√∫do.</p> <p>O time do <em>Black</em> alega que a ferramenta √© "descompromissada", mas nem por isso ela deixa de ser pretensiosa. Diretamente do <a href=https://github.com/ambv/black/ title="Black no Github">reposit√≥rio no <em>Github</em></a>:</p> <blockquote> <p>By using it, you agree to cede control over minutiae of hand-formatting. In return, Black gives you speed, determinism, and freedom from pycodestyle nagging about formatting. You will save time and mental energy for more important matters.</p> </blockquote> <p>Em outras palavras, a ferramenta segue as recomenda√ß√µes da <em>PEP 8</em> e formata seu c√≥digo automaticamente. Na verdade, o <em>coding style</em> utilizado √© um <em>subset</em> da <em>PEP 8</em>, logo, algumas regras s√£o "manipuladas" (como <a href=https://github.com/ambv/black#line-length title="Leia na documenta√ß√£o do Black"><em>line-length</em></a> e <a href=https://github.com/ambv/black#strings title="Leia na documenta√ß√£o do Black">aspas ao inv√©s de ap√≥strofos</a>) de acordo com decis√µes tomadas pelo time de desenvolvedores da ferramenta.</p> <p><img class=align-center-keep-size src=/images/blog/black-walter.jpg width=730 height=411 title="Pare de perder tempo discutindo conven√ß√£o de c√≥digo no code review e v√° viver sua vida, como o Walter fez (gq.co.za)" alt="Pare de perder tempo discutindo conven√ß√£o de c√≥digo no code review e v√° viver sua vida, como o Walter fez (gq.co.za)"></p> <p>Caso voc√™ n√£o concorde com algumas liberdades que a ferramenta toma, √© poss√≠vel customizar algumas regras adotadas pelo editor. Por exemplo, se voc√™ √© um usu√°rio ass√≠duo de <em>single quotes</em> e n√£o concorda com o uso de <em>double quotes</em>, pode executar o utilit√°rio com o argumento <code>--skip-string-normalization</code>. Na humilde opini√£o de quem vos escreve, se voc√™ se pegar usando o <em>Black</em> com muitas exce√ß√µes, talvez valha a pena procurar outra ferramenta de <em>formatting</em>, como os pr√≥prios desenvolvedores sugerem:</p> <blockquote> <p>Pro-tip: If you're asking yourself "Do I need to configure anything?" the answer is "No". Black is all about sensible defaults.</p> </blockquote> <h2>No terminal</h2> <p>Mas chega de papo, vamos ao que interessa:</p> <div class=highlight><pre><span></span>$ pip install black
</pre></div> <p>Como qualquer biblioteca <em>Python</em>, instalamos o <em>Black</em> atrav√©s do utilit√°rio <code>pip</code>. Na sequ√™ncia, basta execut√°-lo apontando qual arquivo voc√™ pretende formatar.</p> <div class=highlight><pre><span></span>$ black test.py
reformatted test.py
All <span class=k>done</span>! ‚ú® üç∞ ‚ú®
<span class=m>1</span> file reformatted.
</pre></div> <p>Tamb√©m √© poss√≠vel passar um diret√≥rio como argumento:</p> <div class=highlight><pre><span></span>$ black plugins/
reformatted /Users/klaus/Workspace/blog/plugins/global_license.py
reformatted /Users/klaus/Workspace/blog/plugins/slideshare.py
All <span class=k>done</span>! ‚ú® üç∞ ‚ú®
<span class=m>2</span> files reformatted, <span class=m>4</span> files left unchanged.
</pre></div> <p>N√£o estranhe se a simp√°tica fatia de bolo acima abrir o seu apetite.</p> <p>Customiza√ß√µes, embora possam ser chamadas atrav√©s de par√¢metros de linha de comando, tamb√©m podem ser armazenadas no <code>pyproject.toml</code> do seu projeto, como ilustra a <a href=https://github.com/ambv/black#pyprojecttoml title="Leia mais na documenta√ß√£o do Black">documenta√ß√£o oficial</a>.</p> <h2>No editor</h2> <p>Mas o melhor mesmo √© ter o <em>Black</em> dispon√≠vel no seu editor, deixando-o trabalhar em tempo de escrita de c√≥digo.</p> <p>H√° uma vasta op√ß√£o de <a href=https://github.com/ambv/black#editor-integration title="Editor integration">editores que suportam o <em>Black</em></a>. Para o <a href=https://klauslaube.com.br/tag/vim.html title="Leia mais sobre o Vim"><em>Vim</em></a>, continuo com a opini√£o do artigo <a href=https://klauslaube.com.br/2017/10/15/vim-para-desenvolvimento-python.html title="Leia o artigo na √≠ntegra">"Vim para desenvolvimento Python"</a> e recomendo a utiliza√ß√£o do <a href=https://github.com/w0rp/ale title="Asynchronous Lint Engine for Vim"><em>ALE</em></a>:</p> <div class=highlight><pre><span></span><span class=c>&quot; ~/.vimrc</span>

Plug <span class=s1>&#39;w0rp/ale&#39;</span><span class=p>,</span> { <span class=s1>&#39;do&#39;</span>: <span class=s1>&#39;pip install black&#39;</span> }
<span class=k>call</span> plug#<span class=k>end</span><span class=p>()</span>

<span class=k>let</span> <span class=k>g</span>:ale_fix_on_save <span class=p>=</span> <span class=m>1</span>
<span class=k>let</span> <span class=k>g</span>:ale_fixers <span class=p>=</span> {
\   <span class=s1>&#39;python&#39;</span>: [
\       <span class=s1>&#39;black&#39;</span><span class=p>,</span>
\       <span class=s1>&#39;remove_trailing_lines&#39;</span><span class=p>,</span>
\       <span class=s1>&#39;trim_whitespace&#39;</span>
\   ]
\}
</pre></div> <p>J√° para o <a href=https://klauslaube.com.br/tag/vscode.html title="Leia mais sobre VS Code"><em>VS Code</em></a>, com o <a href="https://marketplace.visualstudio.com/items?itemName=ms-python.python" title="Python extension for Visual Studio Code"><em>plugin</em> oficial para <em>Python</em></a>, podemos configur√°-lo como ferramenta de <em>formatting</em>:</p> <div class=highlight><pre><span></span><span class=p>{</span>
    <span class=nt>&quot;python.formatting.blackPath&quot;</span><span class=p>:</span> <span class=s2>&quot;black&quot;</span><span class=p>,</span>
    <span class=nt>&quot;python.formatting.provider&quot;</span><span class=p>:</span> <span class=s2>&quot;black&quot;</span>
<span class=p>}</span>
</pre></div> <h2>Em todo lugar</h2> <p>Outra op√ß√£o que deveria ser adotada, independente da utiliza√ß√£o do <em>Black</em> no editor, √© o uso de <em>commit hooks</em> para formatar arquivos alterados controlados via <em>git</em>. Volto a recomendar o <a href=https://pre-commit.com/ title="A framework for managing and maintaining multi-language pre-commit hooks"><em>pre-commit</em></a> como ferramenta, e a boa not√≠cia √© que existe um <em>hook</em> com <em>Black</em> configurado e prontinho para uso:</p> <div class=highlight><pre><span></span><span class=nt>repos</span><span class=p>:</span>
<span class="p p-Indicator">-</span> <span class=nt>repo</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">https://github.com/ambv/black</span>
<span class=nt>rev</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">stable</span>
<span class=nt>hooks</span><span class=p>:</span>
<span class="p p-Indicator">-</span> <span class=nt>id</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">black</span>
    <span class="l l-Scalar l-Scalar-Plain">language_version</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">python3.7</span>
</pre></div> <h2>Considera√ß√µes finais</h2> <p>√â impressionante a quantidade de tempo e atrito que economizamos quando adotamos uma ferramenta como <em>Black</em> ou <em>yapf</em>. Discuss√µes relacionadas a <em>style guide</em> praticamente inexistem, e os <em>code reviews</em> s√£o mais focados no problema e na qualidade do c√≥digo, do que com conven√ß√µes.</p> <p>J√° tive experi√™ncias ruins com <em>formatters</em> em <em>Python</em>, √© verdade. Nem todo time ou projeto se adapta bem com esse tipo de "ferramenta impositiva", e embora os pontos positivos sejam √≥bvios, √© na pr√°tica que voc√™ ver√° os negativos. Mas n√£o me vejo mais deixando de ter esse tipo de aux√≠lio enquanto escrevo c√≥digo.</p> <p>√â tamb√©m uma forma de pensarmos na experi√™ncia dos outros desenvolvedores, que se juntar√£o ao projeto durante o seu ciclo de vida.</p> <p>At√© a pr√≥xima.</p> <h2>Refer√™ncias</h2> <ul> <li><a href=https://black.readthedocs.io/en/stable/ >Black - The uncompromising code formatter</a></li> <li><a href=https://www.mattlayman.com/blog/2018/python-code-black/ >Matt Leyman - Consistent Python code with Black</a></li> <li><a href=https://code.visualstudio.com/docs/python/editing#_formatting>Visual Studio Code - Editing Python code in VS Code</a></li> </ul> </div> </span> <div class=Article-tags> <span class=Article-tagLabel>Tags:</span> <span itemprop=keywords> <a href=https://klauslaube.com.br/tag/desenvolvimento.html title="Leia mais sobre" class=Article-tagLink>desenvolvimento</a> <a href=https://klauslaube.com.br/tag/formatters.html title="Leia mais sobre" class=Article-tagLink>formatters</a> <a href=https://klauslaube.com.br/tag/editores.html title="Leia mais sobre" class=Article-tagLink>editores</a> <a href=https://klauslaube.com.br/tag/black.html title="Leia mais sobre" class=Article-tagLink>black</a> <a href=https://klauslaube.com.br/tag/python.html title="Leia mais sobre" class=Article-tagLink>python</a> <a href=https://klauslaube.com.br/tag/vscode.html title="Leia mais sobre" class=Article-tagLink>vscode</a> <a href=https://klauslaube.com.br/tag/vim.html title="Leia mais sobre" class=Article-tagLink>vim</a> </span> </div> <div class=Article-comments> <div id=disqus_thread></div> <script type=text/javascript>
        var disqus_shortname = "klauslaube";
        var disqus_identifier = "2019/02/07/deixe-darem-pitaco-no-seu-codigo-com-black.html";

        (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script> <noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript rel=nofollow>comments powered by Disqus.</a></noscript> </div> </article> </div> <footer class="PageFooter pure-u-1"> <div class=u-box> <p>O conte√∫do deste blog est√° sob a licen√ßa <a class=PageFooter-link href=http://creativecommons.org/licenses/by/3.0/deed.pt_BR title="Distribua, adapte, use. Mas mencione o autor." rel=nofollow>Creative Commons Attribution 3.0</a>.</p> <p>O c√≥digo est√° dispon√≠vel em <a class=PageFooter-link href=https://github.com/kplaube/blog/ title=Contribute! rel=nofollow>GitHub</a>.</p> </div> </footer> </div> <script>
        (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
        function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
        e=o.createElement(i);r=o.getElementsByTagName(i)[0];
        e.src='//www.google-analytics.com/analytics.js';
        r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
        ga('create','UA-19657400-1');ga('send','pageview');
    </script> </body> </html>